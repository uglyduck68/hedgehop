%!PS-Adobe-3.0
%%BoundingBox: (atend)
%%Pages: (atend)
%%PageOrder: (atend)
%%DocumentFonts: (atend)
%%Creator: Frame 4.0
%%DocumentData: Clean7Bit
%%EndComments
%%BeginProlog
%
% Frame ps_prolog 5.0, for use with Frame 5.0 products
% This ps_prolog file is Copyright (c) 1986-1995 Frame Technology
% Corporation.  All rights reserved.  This ps_prolog file may be
% freely copied and distributed in conjunction with documents created
% using FrameMaker, FrameMaker/SGML and FrameViewer as long as this 
% copyright notice is preserved.
%
% FrameMaker users specify the proper paper size for each print job in the
% "Print" dialog's "Printer Paper Size" "Width" and "Height~ fields.  If the
% printer that the PS file is sent to does not support the requested paper
% size, or if there is no paper tray of the proper size currently installed, 
% then the job will not be printed.  The following flag, if set to true, will
% cause the job to print on the default paper in such cases.
/FMAllowPaperSizeMismatch            false def
%
% Frame products normally print colors as their true color on a color printer
% or as shades of gray, based on luminance, on a black-and white printer. The
% following flag, if set to true, forces all non-white colors to print as pure
% black. This has no effect on bitmap images.
/FMPrintAllColorsAsBlack             false def
%
% Frame products can either set their own line screens or use a printer's 
% default settings. Three flags below control this separately for no 
% separations, spot separations and process separations. If a flag
% is true, then the default printer settings will not be changed. If it is
% false, Frame products will use their own settings from a table based on
% the printer's resolution.
/FMUseDefaultNoSeparationScreen      true  def
/FMUseDefaultSpotSeparationScreen    true  def
/FMUseDefaultProcessSeparationScreen false def
%
% For any given PostScript printer resolution, Frame products have two sets of 
% screen angles and frequencies for printing process separations, which are 
% recomended by Adobe. The following variable chooses the higher frequencies
% when set to true or the lower frequencies when set to false. This is only
% effective if the appropriate FMUseDefault...SeparationScreen flag is false.
/FMUseHighFrequencyScreens true def
%
% The following is a set of predefined optimal frequencies and angles for various
% common dpi settings. This is taken from "Advances in Color Separation Using
% PostScript Software Technology," from Adobe Systems (3/13/89 P.N. LPS 0043)
% and corrolated with information which is in various PPD (4.0) files.
%
% The "dpiranges" figure is the minimum dots per inch device resolution which
% can support this setting. The "low" and "high" values are controlled by the
% setting of the FMUseHighFrequencyScreens flag above. The "TDot" flags control
% the use of the "Yellow Triple Dot" feature whereby the frequency id divided by
% three, but the dot function is "trippled" giving a block of 3x3 dots per cell.
%
% PatFreq is a compromise pattern frequency for ps Level 2 printers which is close
% to the ideal WYSIWYG pattern frequency of 9 repetitions/inch but does not beat
% (too badly) against the screen frequencies of any separations for that DPI.
/dpiranges   [  2540    2400    1693     1270    1200     635      600      0      ] def
/CMLowFreqs  [ 100.402  94.8683 89.2289 100.402  94.8683  66.9349  63.2456 47.4342 ] def
/YLowFreqs   [  95.25   90.0    84.65    95.25   90.0     70.5556  66.6667 50.0    ] def
/KLowFreqs   [  89.8026 84.8528 79.8088  89.8026 84.8528  74.8355  70.7107 53.033  ] def
/CLowAngles  [  71.5651 71.5651 71.5651 71.5651  71.5651  71.5651  71.5651 71.5651 ] def
/MLowAngles  [  18.4349 18.4349 18.4349 18.4349  18.4349  18.4349  18.4349 18.4349 ] def
/YLowTDot    [  true    true    false    true    true     false    false   false   ] def
/CMHighFreqs [ 133.87  126.491 133.843  108.503 102.523  100.402   94.8683 63.2456 ] def
/YHighFreqs  [ 127.0   120.0   126.975  115.455 109.091   95.25    90.0    60.0    ] def
/KHighFreqs  [ 119.737 113.137 119.713  128.289 121.218   89.8026  84.8528 63.6395 ] def
/CHighAngles [  71.5651 71.5651 71.5651  70.0169 70.0169  71.5651  71.5651 71.5651 ] def
/MHighAngles [  18.4349 18.4349 18.4349  19.9831 19.9831  18.4349  18.4349 18.4349 ] def
/YHighTDot   [  false   false   true     false   false    true     true    false   ] def
/PatFreq     [	10.5833 10.0     9.4055  10.5833 10.0	  10.5833  10.0	   9.375   ] def
%
% PostScript Level 2 printers contain an "Accurate Screens" feature which can
% improve process separation rendering at the expense of compute time. This 
% flag is ignored by PostScript Level 1 printers.
/FMUseAcccurateScreens true def
%
% The following PostScript procedure defines the spot function that Frame
% products will use for process separations. You may un-comment-out one of
% the alternative functions below, or use your own.
%
% Dot function
/FMSpotFunction {abs exch abs 2 copy add 1 gt 
		{1 sub dup mul exch 1 sub dup mul add 1 sub }
		{dup mul exch dup mul add 1 exch sub }ifelse } def
%
% Line function
% /FMSpotFunction { pop } def
%
% Elipse function
% /FMSpotFunction { dup 5 mul 8 div mul exch dup mul exch add 
%		sqrt 1 exch sub } def
%
%
/FMversion (5.0) def 
/fMLevel1 /languagelevel where {pop languagelevel} {1} ifelse 2 lt def
/FMPColor
	fMLevel1 {
		false
		/colorimage where {pop pop true} if
	} {
		true
	} ifelse
def
/FrameDict 400 dict def 
systemdict /errordict known not {/errordict 10 dict def
		errordict /rangecheck {stop} put} if
% The readline in PS 23.0 doesn't recognize cr's as nl's on AppleTalk
FrameDict /tmprangecheck errordict /rangecheck get put 
errordict /rangecheck {FrameDict /bug true put} put 
FrameDict /bug false put 
mark 
% Some PS machines read past the CR, so keep the following 3 lines together!
currentfile 5 string readline
00
0000000000
cleartomark 
errordict /rangecheck FrameDict /tmprangecheck get put 
FrameDict /bug get { 
	/readline {
		/gstring exch def
		/gfile exch def
		/gindex 0 def
		{
			gfile read pop 
			dup 10 eq {exit} if 
			dup 13 eq {exit} if 
			gstring exch gindex exch put 
			/gindex gindex 1 add def 
		} loop
		pop 
		gstring 0 gindex getinterval true 
		} bind def
	} if
/FMshowpage /showpage load def
/FMquit /quit load def
/FMFAILURE { 
	dup = flush 
	FMshowpage 
	/Helvetica findfont 12 scalefont setfont
	72 200 moveto show
	72 220 moveto show
	FMshowpage 
	FMquit 
	} def 
/FMVERSION {
	FMversion ne {
		(Frame product version does not match ps_prolog!  Check installation;)
		(also check ~/fminit and ./fminit for old versions) FMFAILURE
		} if
	} def 
/FMBADEPSF { 
	(Adobe's PostScript Language Reference Manual, 2nd Edition, section H.2.4)
	(says your EPS file is not valid, as it calls X              )
	dup dup (X) search pop exch pop exch pop length 
	5 -1 roll 
	putinterval 
	FMFAILURE
	} def
/fmConcatProcs
	{
	/proc2 exch cvlit def/proc1 exch cvlit def/newproc proc1 length proc2 length add array def
	newproc 0 proc1 putinterval newproc proc1 length proc2 putinterval newproc cvx
}def
FrameDict begin [
	/ALDsave
	/FMdicttop
	/FMoptop
	/FMpointsize
	/FMsaveobject
	/b
	/bitmapsave
	/blut
	/bpside
	/bs
	/bstring
	/bwidth
	/c
	/cf
	/cs
	/cynu
	/depth
	/edown
	/fh
	/fillvals
	/fw
	/fx
	/fy
	/g
	/gfile
	/gindex
	/grnt
	/gryt
	/gstring
	/height
	/hh
	/i
	/im
	/indx
	/is
	/k
	/kk
	/landscape
	/lb
	/len
	/llx
	/lly
	/m
	/magu
	/manualfeed
	/n
	/offbits
	/onbits
	/organgle
	/orgbangle
	/orgbfreq
	/orgbproc
	/orgbxfer
	/orgfreq
	/orggangle
	/orggfreq
	/orggproc
	/orggxfer
	/orgmatrix
	/orgproc
	/orgrangle
	/orgrfreq
	/orgrproc
	/orgrxfer
	/orgxfer
	/pagesave
	/paperheight
	/papersizedict
	/paperwidth
	/pos
	/pwid
	/r
	/rad
	/redt
	/sl
	/str
	/tran
	/u
	/urx
	/ury
	/val
	/width
	/width
	/ws
	/ww
	/x
	/x1
	/x2
	/xindex
	/xpoint
	/xscale
	/xx
	/y
	/y1
	/y2
	/yelu
	/yindex
	/ypoint
	/yscale
	/yy
] { 0 def } forall
/FmBD {bind def} bind def
systemdict /pdfmark known {
	/fMAcrobat true def
	
	/FmPD /pdfmark load def
	
	
	/FmPT /show load def
	
	
	currentdistillerparams /CoreDistVersion get 2000 ge {
	
		
		/FmPD2 /pdfmark load def
		
		
		
		
		
		/FmPA { mark exch /Dest exch 5 3 roll 
				/View [ /XYZ null 6 -2 roll FmDC exch pop null] /DEST FmPD 
		}FmBD
	} {
		
		/FmPD2 /cleartomark load def
		/FmPA {pop pop pop}FmBD
	} ifelse
} {
	
	/fMAcrobat false def
	/FmPD /cleartomark load def
	/FmPD2 /cleartomark load def
	/FmPT /pop load def
	/FmPA {pop pop pop}FmBD
} ifelse
/FmDC {
	transform fMDefaultMatrix itransform cvi exch cvi exch
}FmBD
/FmBx {
	dup 3 index lt {3 1 roll exch} if 
	1 index 4 index lt {4 -1 roll 3 1 roll exch 4 1 roll} if
}FmBD
/FMnone 0 def
/FMcyan 1 def
/FMmagenta 2 def
/FMyellow 3 def
/FMblack 4 def
/FMcustom 5 def
/fMNegative false def 
/FrameSepIs FMnone def 
/FrameSepBlack 0 def
/FrameSepYellow 0 def
/FrameSepMagenta 0 def
/FrameSepCyan 0 def
/FrameSepRed 1 def
/FrameSepGreen 1 def
/FrameSepBlue 1 def
/FrameCurGray 1 def
/FrameCurPat null def
/FrameCurColors [ 0 0 0 1 0 0 0 ] def 
/FrameColorEpsilon .001 def	
/eqepsilon {		
	sub dup 0 lt {neg} if
	FrameColorEpsilon le
} bind def
/FrameCmpColorsCMYK { 
	2 copy 0 get exch 0 get eqepsilon {
		2 copy 1 get exch 1 get eqepsilon {
			2 copy 2 get exch 2 get eqepsilon {
				3 get exch 3 get eqepsilon
			} {pop pop false} ifelse
		}{pop pop false} ifelse
	} {pop pop false} ifelse
} bind def
/FrameCmpColorsRGB { 
	2 copy 4 get exch 0 get eqepsilon {
		2 copy 5 get exch 1 get eqepsilon {
			6 get exch 2 get eqepsilon
		}{pop pop false} ifelse
	} {pop pop false} ifelse
} bind def
/RGBtoCMYK { 
	1 exch sub 
	3 1 roll 
	1 exch sub 
	3 1 roll 
	1 exch sub 
	3 1 roll 
	3 copy 
	2 copy 
	le { pop } { exch pop } ifelse 
	2 copy 
	le { pop } { exch pop } ifelse 
	dup dup dup 
	6 1 roll 
	4 1 roll 
	7 1 roll 
	sub 
	6 1 roll 
	sub 
	5 1 roll 
	sub 
	4 1 roll 
} bind def
/CMYKtoRGB { 
	dup dup 4 -1 roll add 						  
	5 1 roll 3 -1 roll add 						  
	4 1 roll add 								  
	1 exch sub dup 0 lt {pop 0} if 3 1 roll 	  
	1 exch sub dup 0 lt {pop 0} if exch 	      
	1 exch sub dup 0 lt {pop 0} if exch	  		  
} bind def
/FrameSepInit {
	1.0 RealSetgray
} bind def
/FrameSetSepColor { 
	/FrameSepBlue exch def
	/FrameSepGreen exch def
	/FrameSepRed exch def
	/FrameSepBlack exch def
	/FrameSepYellow exch def
	/FrameSepMagenta exch def
	/FrameSepCyan exch def
	/FrameSepIs FMcustom def
	setCurrentScreen	
} bind def
/FrameSetCyan {
	/FrameSepBlue 1.0 def
	/FrameSepGreen 1.0 def
	/FrameSepRed 0.0 def
	/FrameSepBlack 0.0 def
	/FrameSepYellow 0.0 def
	/FrameSepMagenta 0.0 def
	/FrameSepCyan 1.0 def
	/FrameSepIs FMcyan def
	setCurrentScreen	
} bind def
 
/FrameSetMagenta {
	/FrameSepBlue 1.0 def
	/FrameSepGreen 0.0 def
	/FrameSepRed 1.0 def
	/FrameSepBlack 0.0 def
	/FrameSepYellow 0.0 def
	/FrameSepMagenta 1.0 def
	/FrameSepCyan 0.0 def
	/FrameSepIs FMmagenta def
	setCurrentScreen
} bind def
 
/FrameSetYellow {
	/FrameSepBlue 0.0 def
	/FrameSepGreen 1.0 def
	/FrameSepRed 1.0 def
	/FrameSepBlack 0.0 def
	/FrameSepYellow 1.0 def
	/FrameSepMagenta 0.0 def
	/FrameSepCyan 0.0 def
	/FrameSepIs FMyellow def
	setCurrentScreen
} bind def
 
/FrameSetBlack {
	/FrameSepBlue 0.0 def
	/FrameSepGreen 0.0 def
	/FrameSepRed 0.0 def
	/FrameSepBlack 1.0 def
	/FrameSepYellow 0.0 def
	/FrameSepMagenta 0.0 def
	/FrameSepCyan 0.0 def
	/FrameSepIs FMblack def
	setCurrentScreen
} bind def
 
/FrameNoSep { 
	/FrameSepIs FMnone def
	setCurrentScreen
} bind def
/FrameSetSepColors { 
	FrameDict begin
	[ exch 1 add 1 roll ]
	/FrameSepColors  
	exch def end
	} bind def
/FrameColorInSepListCMYK { 
	FrameSepColors {  
       		exch dup 3 -1 roll 
       		FrameCmpColorsCMYK 
       		{ pop true exit } if
    	} forall 
	dup true ne {pop false} if
	} bind def
/FrameColorInSepListRGB { 
	FrameSepColors {  
       		exch dup 3 -1 roll 
       		FrameCmpColorsRGB 
       		{ pop true exit } if
    	} forall 
	dup true ne {pop false} if
	} bind def
/RealSetgray /setgray load def
/RealSetrgbcolor /setrgbcolor load def
/RealSethsbcolor /sethsbcolor load def
end 
/setgray { 
	FrameDict begin
	FrameSepIs FMnone eq
		{ RealSetgray } 
		{ 
		FrameSepIs FMblack eq 
			{ RealSetgray } 
			{ FrameSepIs FMcustom eq 
			  FrameSepRed 0 eq and
			  FrameSepGreen 0 eq and
			  FrameSepBlue 0 eq and {
			  	RealSetgray
			  } {
				1 RealSetgray pop 
			  } ifelse
			} ifelse
		} ifelse
	end
} bind def
/setrgbcolor { 
	FrameDict begin
	FrameSepIs FMnone eq
	{  RealSetrgbcolor }
	{
		3 copy [ 4 1 roll ] 
		FrameColorInSepListRGB
		{
				FrameSepBlue eq exch 
			 	FrameSepGreen eq and exch 
			 	FrameSepRed eq and
			 	{ 0 } { 1 } ifelse
		}
		{
			FMPColor {
				RealSetrgbcolor
				currentcmykcolor
			} {
				RGBtoCMYK
			} ifelse
			FrameSepIs FMblack eq
			{1.0 exch sub 4 1 roll pop pop pop} {
			FrameSepIs FMyellow eq
			{pop 1.0 exch sub 3 1 roll pop pop} {
			FrameSepIs FMmagenta eq
			{pop pop 1.0 exch sub exch pop } {
			FrameSepIs FMcyan eq
			{pop pop pop 1.0 exch sub } 
			{pop pop pop pop 1} ifelse } ifelse } ifelse } ifelse 
		} ifelse
		RealSetgray
	} 
	ifelse
	end
} bind def
/sethsbcolor {
	FrameDict begin
	FrameSepIs FMnone eq 
	{ RealSethsbcolor } 
	{
		RealSethsbcolor 
		currentrgbcolor  
		setrgbcolor 
	} 
	ifelse
	end
} bind def
FrameDict begin
/setcmykcolor where {
	pop /RealSetcmykcolor /setcmykcolor load def
} {
	/RealSetcmykcolor {
		4 1 roll
		3 { 3 index add 0 max 1 min 1 exch sub 3 1 roll} repeat 
		RealSetrgbcolor pop
	} bind def
} ifelse
userdict /setcmykcolor { 
		FrameDict begin
		FrameSepIs FMnone eq
		{ RealSetcmykcolor } 
		{
			4 copy [ 5 1 roll ]
			FrameColorInSepListCMYK
			{
				FrameSepBlack eq exch 
				FrameSepYellow eq and exch 
				FrameSepMagenta eq and exch 
				FrameSepCyan eq and 
				{ 0 } { 1 } ifelse
			}
			{
				FrameSepIs FMblack eq
				{1.0 exch sub 4 1 roll pop pop pop} {
				FrameSepIs FMyellow eq
				{pop 1.0 exch sub 3 1 roll pop pop} {
				FrameSepIs FMmagenta eq
				{pop pop 1.0 exch sub exch pop } {
				FrameSepIs FMcyan eq
				{pop pop pop 1.0 exch sub } 
				{pop pop pop pop 1} ifelse } ifelse } ifelse } ifelse 
			} ifelse
			RealSetgray
		}
		ifelse
		end
	} bind put
fMLevel1 { 
	
	
	
	/patScreenDict 7 dict dup begin
		<0f1e3c78f0e1c387> [ 45  { pop } {exch pop} 		.5   2 sqrt] FmBD
		<0f87c3e1f0783c1e> [ 135 { pop } {exch pop}			.5   2 sqrt] FmBD
		<cccccccccccccccc> [ 0   { pop } dup				.5   2	   ] FmBD
		<ffff0000ffff0000> [ 90  { pop } dup				.5   2	   ] FmBD
		<8142241818244281> [ 45  { 2 copy lt {exch} if pop}	dup .75  2 sqrt] FmBD
		<03060c183060c081> [ 45  { pop } {exch pop}			.875 2 sqrt] FmBD
		<8040201008040201> [ 135 { pop } {exch pop}			.875 2 sqrt] FmBD
	end def
} { 
	
	/patProcDict 5 dict dup begin
		<0f1e3c78f0e1c387> { 3 setlinewidth -1 -1 moveto 9 9 lineto stroke 
											4 -4 moveto 12 4 lineto stroke
											-4 4 moveto 4 12 lineto stroke} bind def
		<0f87c3e1f0783c1e> { 3 setlinewidth -1 9 moveto 9 -1 lineto stroke 
											-4 4 moveto 4 -4 lineto stroke
											4 12 moveto 12 4 lineto stroke} bind def
		<8142241818244281> { 1 setlinewidth -1 9 moveto 9 -1 lineto stroke
											-1 -1 moveto 9 9 lineto stroke } bind def
		<03060c183060c081> { 1 setlinewidth -1 -1 moveto 9 9 lineto stroke 
											4 -4 moveto 12 4 lineto stroke
											-4 4 moveto 4 12 lineto stroke} bind def
		<8040201008040201> { 1 setlinewidth -1 9 moveto 9 -1 lineto stroke 
											-4 4 moveto 4 -4 lineto stroke
											4 12 moveto 12 4 lineto stroke} bind def
	end def
	/patDict 15 dict dup begin
		/PatternType 1 def		
		/PaintType 2 def		
		/TilingType 3 def		
		/BBox [ 0 0 8 8 ] def 	
		/XStep 8 def			
		/YStep 8 def			
		/PaintProc {
			begin
			patProcDict bstring known {
				patProcDict bstring get exec
			} {
				8 8 true [1 0 0 -1 0 8] bstring imagemask
			} ifelse
			end
		} bind def
	end def
} ifelse
/combineColor {
    FrameSepIs FMnone eq
	{
		graymode fMLevel1 or not {
			
			[/Pattern [/DeviceCMYK]] setcolorspace
			FrameCurColors 0 4 getinterval aload pop FrameCurPat setcolor
		} {
			FrameCurColors 3 get 1.0 ge {
				FrameCurGray RealSetgray
			} {
				fMAcrobat not FMPColor graymode and and {
					0 1 3 { 
						FrameCurColors exch get
						1 FrameCurGray sub mul
					} for
					RealSetcmykcolor
				} {
					4 1 6 {
						FrameCurColors exch get
						graymode {
							1 exch sub 1 FrameCurGray sub mul 1 exch sub
						} {
							1.0 lt {FrameCurGray} {1} ifelse
						} ifelse
					} for
					RealSetrgbcolor
				} ifelse
			} ifelse
		} ifelse
	} { 
		FrameCurColors 0 4 getinterval aload
		FrameColorInSepListCMYK {
			FrameSepBlack eq exch 
			FrameSepYellow eq and exch 
			FrameSepMagenta eq and exch 
			FrameSepCyan eq and
			FrameSepIs FMcustom eq and
			{ FrameCurGray } { 1 } ifelse
		} {
			FrameSepIs FMblack eq
			{FrameCurGray 1.0 exch sub mul 1.0 exch sub 4 1 roll pop pop pop} {
			FrameSepIs FMyellow eq
			{pop FrameCurGray 1.0 exch sub mul 1.0 exch sub 3 1 roll pop pop} {
			FrameSepIs FMmagenta eq
			{pop pop FrameCurGray 1.0 exch sub mul 1.0 exch sub exch pop } {
			FrameSepIs FMcyan eq
			{pop pop pop FrameCurGray 1.0 exch sub mul 1.0 exch sub } 
			{pop pop pop pop 1} ifelse } ifelse } ifelse } ifelse 
		} ifelse
		graymode fMLevel1 or not {
			
			[/Pattern [/DeviceGray]] setcolorspace
			FrameCurPat setcolor
		} { 
			graymode not fMLevel1 and {
				
				dup 1 lt {pop FrameCurGray} if
			} if
			RealSetgray
		} ifelse
	} ifelse
} bind def
/savematrix {
	orgmatrix currentmatrix pop
	} bind def
/restorematrix {
	orgmatrix setmatrix
	} bind def
/fMDefaultMatrix matrix defaultmatrix def
/fMatrix2 matrix def
/dpi    72 0 fMDefaultMatrix dtransform
    dup mul exch   dup mul add   sqrt def
	
/freq dpi dup 72 div round dup 0 eq {pop 1} if 8 mul div def
/sangle 1 0 fMDefaultMatrix dtransform exch atan def
	sangle fMatrix2 rotate 
	fMDefaultMatrix fMatrix2 concatmatrix 
	dup 0 get /sflipx exch def
	    3 get /sflipy exch def
/screenIndex {
	0 1 dpiranges length 1 sub { dup dpiranges exch get 1 sub dpi le {exit} {pop} ifelse } for
} bind def
/getCyanScreen {
	FMUseHighFrequencyScreens { CHighAngles CMHighFreqs} {CLowAngles CMLowFreqs} ifelse
		screenIndex dup 3 1 roll get 3 1 roll get /FMSpotFunction load
} bind def
/getMagentaScreen {
	FMUseHighFrequencyScreens { MHighAngles CMHighFreqs } {MLowAngles CMLowFreqs} ifelse
		screenIndex dup 3 1 roll get 3 1 roll get /FMSpotFunction load
} bind def
/getYellowScreen {
	FMUseHighFrequencyScreens { YHighTDot YHighFreqs} { YLowTDot YLowFreqs } ifelse
		screenIndex dup 3 1 roll get 3 1 roll get { 3 div
			{2 { 1 add 2 div 3 mul dup floor sub 2 mul 1 sub exch} repeat
			FMSpotFunction } } {/FMSpotFunction load } ifelse
			0.0 exch
} bind def
/getBlackScreen  {
	FMUseHighFrequencyScreens { KHighFreqs } { KLowFreqs } ifelse
		screenIndex get 45.0 /FMSpotFunction load 
} bind def
/getSpotScreen {
	getBlackScreen
} bind def
/getCompositeScreen {
	getBlackScreen
} bind def
/FMSetScreen 
	fMLevel1 { /setscreen load 
	}{ {
		8 dict begin
		/HalftoneType 1 def
		/SpotFunction exch def
		/Angle exch def
		/Frequency exch def
		/AccurateScreens FMUseAcccurateScreens def
		currentdict end sethalftone
	} bind } ifelse
def
/setDefaultScreen {
	FMPColor {
		orgrxfer cvx orggxfer cvx orgbxfer cvx orgxfer cvx setcolortransfer
	}
	{
		orgxfer cvx settransfer
	} ifelse
	orgfreq organgle orgproc cvx setscreen
} bind def
/setCurrentScreen {
	FrameSepIs FMnone eq {
		FMUseDefaultNoSeparationScreen {
			setDefaultScreen
		} {
			getCompositeScreen FMSetScreen
		} ifelse
	} {
		FrameSepIs FMcustom eq {
			FMUseDefaultSpotSeparationScreen {
				setDefaultScreen
			} {
				getSpotScreen FMSetScreen
			} ifelse
		} {
			FMUseDefaultProcessSeparationScreen {
				setDefaultScreen
			} {
				FrameSepIs FMcyan eq {
					getCyanScreen FMSetScreen
				} {
					FrameSepIs FMmagenta eq {
						getMagentaScreen FMSetScreen
					} {
						FrameSepIs FMyellow eq {
							getYellowScreen FMSetScreen
						} {
							getBlackScreen FMSetScreen
						} ifelse
					} ifelse
				} ifelse
			} ifelse
		} ifelse
	} ifelse 
} bind def
end
	
/FMDOCUMENT { 
	array /FMfonts exch def 
	/#copies exch def
	FrameDict begin
	0 ne /manualfeed exch def
	/paperheight exch def
	/paperwidth exch def
	0 ne /fMNegative exch def 
	0 ne /edown exch def 
	/yscale exch def
	/xscale exch def
	fMLevel1 {
		manualfeed {setmanualfeed} if
		/FMdicttop countdictstack 1 add def 
		/FMoptop count def 
		setpapername 
		manualfeed {true} {papersize} ifelse 
		{manualpapersize} {false} ifelse 
		{desperatepapersize} {false} ifelse 
		{papersizefailure} if
		count -1 FMoptop {pop pop} for
		countdictstack -1 FMdicttop {pop end} for 
		}
		{2 dict
		 dup /PageSize [paperwidth paperheight] put
		 manualfeed {dup /ManualFeed manualfeed put} if
		 {setpagedevice} stopped {papersizefailure} if
		}
	ifelse 
	
	FMPColor {
		currentcolorscreen
			cvlit /orgproc exch def
				  /organgle exch def 
				  /orgfreq exch def
			cvlit /orgbproc exch def
				  /orgbangle exch def 
				  /orgbfreq exch def
			cvlit /orggproc exch def
				  /orggangle exch def 
				  /orggfreq exch def
			cvlit /orgrproc exch def
				  /orgrangle exch def 
				  /orgrfreq exch def
			currentcolortransfer 
			fMNegative {
				1 1 4 { 
					pop { 1 exch sub } fmConcatProcs 4 1 roll
				} for
				4 copy
				setcolortransfer
			} if
			cvlit /orgxfer exch def
			cvlit /orgbxfer exch def
			cvlit /orggxfer exch def
			cvlit /orgrxfer exch def
	} {
		currentscreen 
			cvlit /orgproc exch def
				  /organgle exch def 
				  /orgfreq exch def
				  
		currenttransfer 
		fMNegative {
			{ 1 exch sub } fmConcatProcs
			dup settransfer
		} if 
		cvlit /orgxfer exch def
	} ifelse
	end 
} def 
/FMBEGINPAGE { 
	FrameDict begin 
	/pagesave save def
	3.86 setmiterlimit
	/landscape exch 0 ne def
	landscape { 
		90 rotate 0 exch dup /pwid exch def neg translate pop 
	}{
		pop /pwid exch def
	} ifelse
	edown { [-1 0 0 1 pwid 0] concat } if
	0 0 moveto paperwidth 0 lineto paperwidth paperheight lineto 
	0 paperheight lineto 0 0 lineto 1 setgray fill
	xscale yscale scale
	/orgmatrix matrix def
	gsave 
} def 
/FMENDPAGE {
	grestore 
	pagesave restore
	end 
	showpage
	} def 
/FMFONTDEFINE { 
	FrameDict begin
	findfont 
	ReEncode 
	1 index exch 
	definefont 
	FMfonts 3 1 roll 
	put
	end 
	} def 
/FMFILLS {
	FrameDict begin dup
	array /fillvals exch def
	dict /patCache exch def
	end 
	} def 
/FMFILL {
	FrameDict begin
	 fillvals 3 1 roll put
	end 
	} def 
/FMNORMALIZEGRAPHICS { 
	newpath
	1 setlinewidth
	0 setlinecap
	0 0 0 sethsbcolor
	0 setgray 
	} bind def
/FMBEGINEPSF { 
	end 
	/FMEPSF save def 
	/showpage {} def 
% See Adobe's "PostScript Language Reference Manual, 2nd Edition", page 714.
% "...the following operators MUST NOT be used in an EPS file:" (emphasis ours)
	/banddevice {(banddevice) FMBADEPSF} def
	/clear {(clear) FMBADEPSF} def
	/cleardictstack {(cleardictstack) FMBADEPSF} def 
	/copypage {(copypage) FMBADEPSF} def
	/erasepage {(erasepage) FMBADEPSF} def
	/exitserver {(exitserver) FMBADEPSF} def
	/framedevice {(framedevice) FMBADEPSF} def
	/grestoreall {(grestoreall) FMBADEPSF} def
	/initclip {(initclip) FMBADEPSF} def
	/initgraphics {(initgraphics) FMBADEPSF} def
	/quit {(quit) FMBADEPSF} def
	/renderbands {(renderbands) FMBADEPSF} def
	/setglobal {(setglobal) FMBADEPSF} def
	/setpagedevice {(setpagedevice) FMBADEPSF} def
	/setshared {(setshared) FMBADEPSF} def
	/startjob {(startjob) FMBADEPSF} def
	/lettertray {(lettertray) FMBADEPSF} def
	/letter {(letter) FMBADEPSF} def
	/lettersmall {(lettersmall) FMBADEPSF} def
	/11x17tray {(11x17tray) FMBADEPSF} def
	/11x17 {(11x17) FMBADEPSF} def
	/ledgertray {(ledgertray) FMBADEPSF} def
	/ledger {(ledger) FMBADEPSF} def
	/legaltray {(legaltray) FMBADEPSF} def
	/legal {(legal) FMBADEPSF} def
	/statementtray {(statementtray) FMBADEPSF} def
	/statement {(statement) FMBADEPSF} def
	/executivetray {(executivetray) FMBADEPSF} def
	/executive {(executive) FMBADEPSF} def
	/a3tray {(a3tray) FMBADEPSF} def
	/a3 {(a3) FMBADEPSF} def
	/a4tray {(a4tray) FMBADEPSF} def
	/a4 {(a4) FMBADEPSF} def
	/a4small {(a4small) FMBADEPSF} def
	/b4tray {(b4tray) FMBADEPSF} def
	/b4 {(b4) FMBADEPSF} def
	/b5tray {(b5tray) FMBADEPSF} def
	/b5 {(b5) FMBADEPSF} def
	FMNORMALIZEGRAPHICS 
	[/fy /fx /fh /fw /ury /urx /lly /llx] {exch def} forall 
	fx fw 2 div add fy fh 2 div add  translate
	rotate
	fw 2 div neg fh 2 div neg translate
	fw urx llx sub div fh ury lly sub div scale 
	llx neg lly neg translate 
	/FMdicttop countdictstack 1 add def 
	/FMoptop count def 
	} bind def
/FMENDEPSF {
	count -1 FMoptop {pop pop} for 
	countdictstack -1 FMdicttop {pop end} for 
	FMEPSF restore
	FrameDict begin 
	} bind def
FrameDict begin 
/setmanualfeed {
%%BeginFeature *ManualFeed True
	 statusdict /manualfeed true put
%%EndFeature
	} bind def
/max {2 copy lt {exch} if pop} bind def
/min {2 copy gt {exch} if pop} bind def
/inch {72 mul} def
/pagedimen { 
	paperheight sub abs 16 lt exch 
	paperwidth sub abs 16 lt and
	{/papername exch def} {pop} ifelse
	} bind def
/setpapername { 
	/papersizedict 14 dict def 
	papersizedict begin
	/papername /unknown def 
		/Letter 8.5 inch 11.0 inch pagedimen
		/LetterSmall 7.68 inch 10.16 inch pagedimen
		/Tabloid 11.0 inch 17.0 inch pagedimen
		/Ledger 17.0 inch 11.0 inch pagedimen
		/Legal 8.5 inch 14.0 inch pagedimen
		/Statement 5.5 inch 8.5 inch pagedimen
		/Executive 7.5 inch 10.0 inch pagedimen
		/A3 11.69 inch 16.5 inch pagedimen
		/A4 8.26 inch 11.69 inch pagedimen
		/A4Small 7.47 inch 10.85 inch pagedimen
		/B4 10.125 inch 14.33 inch pagedimen
		/B5 7.16 inch 10.125 inch pagedimen
	end
	} bind def
/papersize {
	papersizedict begin
		/Letter {lettertray letter} def
		/LetterSmall {lettertray lettersmall} def
		/Tabloid {11x17tray 11x17} def
		/Ledger {ledgertray ledger} def
		/Legal {legaltray legal} def
		/Statement {statementtray statement} def
		/Executive {executivetray executive} def
		/A3 {a3tray a3} def
		/A4 {a4tray a4} def
		/A4Small {a4tray a4small} def
		/B4 {b4tray b4} def
		/B5 {b5tray b5} def
		/unknown {unknown} def
	papersizedict dup papername known {papername} {/unknown} ifelse get
	end
	statusdict begin stopped end 
	} bind def
/manualpapersize {
	papersizedict begin
		/Letter {letter} def
		/LetterSmall {lettersmall} def
		/Tabloid {11x17} def
		/Ledger {ledger} def
		/Legal {legal} def
		/Statement {statement} def
		/Executive {executive} def
		/A3 {a3} def
		/A4 {a4} def
		/A4Small {a4small} def
		/B4 {b4} def
		/B5 {b5} def
		/unknown {unknown} def
	papersizedict dup papername known {papername} {/unknown} ifelse get
	end
	stopped 
	} bind def
/desperatepapersize {
	statusdict /setpageparams known
		{
		paperwidth paperheight 0 1 
		statusdict begin
		{setpageparams} stopped 
		end
		} {true} ifelse 
	} bind def
/papersizefailure {
	FMAllowPaperSizeMismatch not
		{
(The requested paper size is not available in any currently-installed tray)
(Edit the PS file to "FMAllowPaperSizeMismatch true" to use default tray)
		 FMFAILURE } if
	} def
/DiacriticEncoding [
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /space /exclam /quotedbl
/numbersign /dollar /percent /ampersand /quotesingle /parenleft
/parenright /asterisk /plus /comma /hyphen /period /slash /zero /one
/two /three /four /five /six /seven /eight /nine /colon /semicolon
/less /equal /greater /question /at /A /B /C /D /E /F /G /H /I /J /K
/L /M /N /O /P /Q /R /S /T /U /V /W /X /Y /Z /bracketleft /backslash
/bracketright /asciicircum /underscore /grave /a /b /c /d /e /f /g /h
/i /j /k /l /m /n /o /p /q /r /s /t /u /v /w /x /y /z /braceleft /bar
/braceright /asciitilde /.notdef /Adieresis /Aring /Ccedilla /Eacute
/Ntilde /Odieresis /Udieresis /aacute /agrave /acircumflex /adieresis
/atilde /aring /ccedilla /eacute /egrave /ecircumflex /edieresis
/iacute /igrave /icircumflex /idieresis /ntilde /oacute /ograve
/ocircumflex /odieresis /otilde /uacute /ugrave /ucircumflex
/udieresis /dagger /.notdef /cent /sterling /section /bullet
/paragraph /germandbls /registered /copyright /trademark /acute
/dieresis /.notdef /AE /Oslash /.notdef /.notdef /.notdef /.notdef
/yen /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/ordfeminine /ordmasculine /.notdef /ae /oslash /questiondown
/exclamdown /logicalnot /.notdef /florin /.notdef /.notdef
/guillemotleft /guillemotright /ellipsis /.notdef /Agrave /Atilde
/Otilde /OE /oe /endash /emdash /quotedblleft /quotedblright
/quoteleft /quoteright /.notdef /.notdef /ydieresis /Ydieresis
/fraction /currency /guilsinglleft /guilsinglright /fi /fl /daggerdbl
/periodcentered /quotesinglbase /quotedblbase /perthousand
/Acircumflex /Ecircumflex /Aacute /Edieresis /Egrave /Iacute
/Icircumflex /Idieresis /Igrave /Oacute /Ocircumflex /.notdef /Ograve
/Uacute /Ucircumflex /Ugrave /dotlessi /circumflex /tilde /macron
/breve /dotaccent /ring /cedilla /hungarumlaut /ogonek /caron
] def
/ReEncode { 
	dup 
	length 
	dict begin 
	{
	1 index /FID ne 
		{def} 
		{pop pop} ifelse 
	} forall 
	0 eq {/Encoding DiacriticEncoding def} if 
	currentdict 
	end 
	} bind def
FMPColor 
	
	{
	/BEGINBITMAPCOLOR { 
		BITMAPCOLOR} def
	/BEGINBITMAPCOLORc { 
		BITMAPCOLORc} def
	/BEGINBITMAPTRUECOLOR { 
		BITMAPTRUECOLOR } def
	/BEGINBITMAPTRUECOLORc { 
		BITMAPTRUECOLORc } def
	/BEGINBITMAPCMYK { 
		BITMAPCMYK } def
	/BEGINBITMAPCMYKc { 
		BITMAPCMYKc } def
	}
	
	{
	/BEGINBITMAPCOLOR { 
		BITMAPGRAY} def
	/BEGINBITMAPCOLORc { 
		BITMAPGRAYc} def
	/BEGINBITMAPTRUECOLOR { 
		BITMAPTRUEGRAY } def
	/BEGINBITMAPTRUECOLORc { 
		BITMAPTRUEGRAYc } def
	/BEGINBITMAPCMYK { 
		BITMAPCMYKGRAY } def
	/BEGINBITMAPCMYKc { 
		BITMAPCMYKGRAYc } def
	}
ifelse
/K { 
	FMPrintAllColorsAsBlack {
		dup 1 eq 2 index 1 eq and 3 index 1 eq and not
			{7 {pop} repeat 0 0 0 1 0 0 0} if
	} if 
	FrameCurColors astore 
	pop combineColor
} bind def
/graymode true def
fMLevel1 {
	/fmGetFlip {
		fMatrix2 exch get mul 0 lt { -1 } { 1 } ifelse
	} FmBD
} if
/setPatternMode {
	fMLevel1 {
		2 index patScreenDict exch known {
			pop pop
			patScreenDict exch get aload pop 
			freq 								
			mul									
			5 2 roll							
			fMatrix2 currentmatrix 1 get 0 ne {
				3 -1 roll 90 add 3 1 roll 		
				sflipx 1 fmGetFlip sflipy 2 fmGetFlip neg mul
			} {  								
				sflipx 0 fmGetFlip sflipy 3 fmGetFlip mul 
			} ifelse
			0 lt {exch pop} {pop} ifelse 		
			fMNegative { 
				{neg} fmConcatProcs 			
			} if
			bind
			
			
			
			systemdict /setscreen get exec		
			/FrameCurGray exch def
		} {
			/bwidth  exch def
			/bpside  exch def
			/bstring exch def
			/onbits 0 def  /offbits 0 def
			freq sangle landscape {90 add} if 
				{/ypoint exch def
				 /xpoint exch def
				 /xindex xpoint 1 add 2 div bpside mul cvi def
				 /yindex ypoint 1 add 2 div bpside mul cvi def
				 bstring yindex bwidth mul xindex 8 idiv add get
				 1 7 xindex 8 mod sub bitshift and 0 ne fMNegative {not} if
				 {/onbits  onbits  1 add def 1}
				 {/offbits offbits 1 add def 0}
				 ifelse
				}
				setscreen
			offbits offbits onbits add div fMNegative {1.0 exch sub} if
			/FrameCurGray exch def
		} ifelse
	} { 
		pop pop
		dup patCache exch known {
			patCache exch get
		} { 
			dup
			patDict /bstring 3 -1 roll put
			patDict 
			9 PatFreq screenIndex get div dup matrix scale
			makepattern
			dup 
			patCache 4 -1 roll 3 -1 roll put
		} ifelse
		/FrameCurGray 0 def
		/FrameCurPat exch def
	} ifelse
	/graymode false def
	combineColor
} bind def
/setGrayScaleMode {
	graymode not {
		/graymode true def
		fMLevel1 {
			setCurrentScreen
		} if
	} if
	/FrameCurGray exch def
	combineColor
} bind def
/normalize {
	transform round exch round exch itransform
	} bind def
/dnormalize {
	dtransform round exch round exch idtransform
	} bind def
/lnormalize { 
	0 dtransform exch cvi 2 idiv 2 mul 1 add exch idtransform pop
	} bind def
/H { 
	lnormalize setlinewidth
	} bind def
/Z {
	setlinecap
	} bind def
	
/PFill {
	graymode fMLevel1 or not {
		gsave 1 setgray eofill grestore
	} if
} bind def
/PStroke {
	graymode fMLevel1 or not {
		gsave 1 setgray stroke grestore
	} if
	stroke
} bind def
/X { 
	fillvals exch get
	dup type /stringtype eq
	{8 1 setPatternMode} 
	{setGrayScaleMode}
	ifelse
	} bind def
/V { 
	PFill gsave eofill grestore
	} bind def
/Vclip {
	clip
	} bind def
/Vstrk {
	currentlinewidth exch setlinewidth PStroke setlinewidth
	} bind def
/N { 
	PStroke
	} bind def
/Nclip {
	strokepath clip newpath
	} bind def
/Nstrk {
	currentlinewidth exch setlinewidth PStroke setlinewidth
	} bind def
/M {newpath moveto} bind def
/E {lineto} bind def
/D {curveto} bind def
/O {closepath} bind def
/L { 
 	/n exch def
	newpath
	normalize
	moveto 
	2 1 n {pop normalize lineto} for
	} bind def
/Y { 
	L 
	closepath
	} bind def
/R { 
	/y2 exch def
	/x2 exch def
	/y1 exch def
	/x1 exch def
	x1 y1
	x2 y1
	x2 y2
	x1 y2
	4 Y 
	} bind def
/rarc 
	{rad 
	 arcto
	} bind def
/RR { 
	/rad exch def
	normalize
	/y2 exch def
	/x2 exch def
	normalize
	/y1 exch def
	/x1 exch def
	mark
	newpath
	{
	x1 y1 rad add moveto
	x1 y2 x2 y2 rarc
	x2 y2 x2 y1 rarc
	x2 y1 x1 y1 rarc
	x1 y1 x1 y2 rarc
	closepath
	} stopped {x1 y1 x2 y2 R} if 
	cleartomark
	} bind def
/RRR { 
	/rad exch def
	normalize /y4 exch def /x4 exch def
	normalize /y3 exch def /x3 exch def
	normalize /y2 exch def /x2 exch def
	normalize /y1 exch def /x1 exch def
	newpath
	normalize moveto 
	mark
	{
	x2 y2 x3 y3 rarc
	x3 y3 x4 y4 rarc
	x4 y4 x1 y1 rarc
	x1 y1 x2 y2 rarc
	closepath
	} stopped
	 {x1 y1 x2 y2 x3 y3 x4 y4 newpath moveto lineto lineto lineto closepath} if
	cleartomark
	} bind def
/C { 
	grestore
	gsave
	R 
	clip
	setCurrentScreen
} bind def
/CP { 
	grestore
	gsave
	Y 
	clip
	setCurrentScreen
} bind def
/F { 
	FMfonts exch get
	FMpointsize scalefont
	setfont
	} bind def
/Q { 
	/FMpointsize exch def
	F 
	} bind def
/T { 
	moveto show
	} bind def
/RF { 
	rotate
	0 ne {-1 1 scale} if
	} bind def
/TF { 
	gsave
	moveto 
	RF
	show
	grestore
	} bind def
/P { 
	moveto
	0 32 3 2 roll widthshow
	} bind def
/PF { 
	gsave
	moveto 
	RF
	0 32 3 2 roll widthshow
	grestore
	} bind def
/S { 
	moveto
	0 exch ashow
	} bind def
/SF { 
	gsave
	moveto
	RF
	0 exch ashow
	grestore
	} bind def
/B { 
	moveto
	0 32 4 2 roll 0 exch awidthshow
	} bind def
/BF { 
	gsave
	moveto
	RF
	0 32 4 2 roll 0 exch awidthshow
	grestore
	} bind def
/G { 
	gsave
	newpath
	normalize translate 0.0 0.0 moveto 
	dnormalize scale 
	0.0 0.0 1.0 5 3 roll arc 
	closepath 
	PFill fill
	grestore
	} bind def
/Gstrk {
	savematrix
    newpath
    2 index 2 div add exch 3 index 2 div sub exch 
    normalize 2 index 2 div sub exch 3 index 2 div add exch 
    translate
    scale 
    0.0 0.0 1.0 5 3 roll arc 
    restorematrix
    currentlinewidth exch setlinewidth PStroke setlinewidth
    } bind def
/Gclip { 
	newpath
	savematrix
	normalize translate 0.0 0.0 moveto 
	dnormalize scale 
	0.0 0.0 1.0 5 3 roll arc 
	closepath 
	clip newpath
	restorematrix
	} bind def
/GG { 
	gsave
	newpath
	normalize translate 0.0 0.0 moveto 
	rotate 
	dnormalize scale 
	0.0 0.0 1.0 5 3 roll arc 
	closepath
	PFill
	fill
	grestore
	} bind def
/GGclip { 
	savematrix
	newpath
    normalize translate 0.0 0.0 moveto 
    rotate 
    dnormalize scale 
    0.0 0.0 1.0 5 3 roll arc 
    closepath
	clip newpath
	restorematrix
	} bind def
/GGstrk { 
	savematrix
    newpath
    normalize translate 0.0 0.0 moveto 
    rotate 
    dnormalize scale 
    0.0 0.0 1.0 5 3 roll arc 
    closepath 
	restorematrix
    currentlinewidth exch setlinewidth PStroke setlinewidth
	} bind def
/A { 
	gsave
	savematrix
	newpath
	2 index 2 div add exch 3 index 2 div sub exch 
	normalize 2 index 2 div sub exch 3 index 2 div add exch 
	translate 
	scale 
	0.0 0.0 1.0 5 3 roll arc 
	restorematrix
	PStroke
	grestore
	} bind def
/Aclip {
	newpath
	savematrix
	normalize translate 0.0 0.0 moveto 
	dnormalize scale 
	0.0 0.0 1.0 5 3 roll arc 
	closepath 
	strokepath clip newpath
	restorematrix
} bind def
/Astrk {
	Gstrk
} bind def
/AA { 
	gsave
	savematrix
	newpath
	
	3 index 2 div add exch 4 index 2 div sub exch 
	
	normalize 3 index 2 div sub exch 4 index 2 div add exch
	translate 
	rotate 
	scale 
	0.0 0.0 1.0 5 3 roll arc 
	restorematrix
	PStroke
	grestore
	} bind def
/AAclip {
	savematrix
	newpath
    normalize translate 0.0 0.0 moveto 
    rotate 
    dnormalize scale 
    0.0 0.0 1.0 5 3 roll arc 
    closepath
	strokepath clip newpath
	restorematrix
} bind def
/AAstrk {
	GGstrk
} bind def
/BEGINPRINTCODE { 
	/FMdicttop countdictstack 1 add def 
	/FMoptop count 7 sub def 
	/FMsaveobject save def
	userdict begin 
	/showpage {} def 
	FMNORMALIZEGRAPHICS 
	3 index neg 3 index neg translate
	} bind def
/ENDPRINTCODE {
	count -1 FMoptop {pop pop} for 
	countdictstack -1 FMdicttop {pop end} for 
	FMsaveobject restore 
	} bind def
/gn { 
	0 
	{	46 mul 
		cf read pop 
		32 sub 
		dup 46 lt {exit} if 
		46 sub add 
		} loop
	add 
	} bind def
/cfs { 
	/str sl string def 
	0 1 sl 1 sub {str exch val put} for 
	str def 
	} bind def
/ic [ 
	0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0223
	0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0223
	0
	{0 hx} {1 hx} {2 hx} {3 hx} {4 hx} {5 hx} {6 hx} {7 hx} {8 hx} {9 hx}
	{10 hx} {11 hx} {12 hx} {13 hx} {14 hx} {15 hx} {16 hx} {17 hx} {18 hx}
	{19 hx} {gn hx} {0} {1} {2} {3} {4} {5} {6} {7} {8} {9} {10} {11} {12}
	{13} {14} {15} {16} {17} {18} {19} {gn} {0 wh} {1 wh} {2 wh} {3 wh}
	{4 wh} {5 wh} {6 wh} {7 wh} {8 wh} {9 wh} {10 wh} {11 wh} {12 wh}
	{13 wh} {14 wh} {gn wh} {0 bl} {1 bl} {2 bl} {3 bl} {4 bl} {5 bl} {6 bl}
	{7 bl} {8 bl} {9 bl} {10 bl} {11 bl} {12 bl} {13 bl} {14 bl} {gn bl}
	{0 fl} {1 fl} {2 fl} {3 fl} {4 fl} {5 fl} {6 fl} {7 fl} {8 fl} {9 fl}
	{10 fl} {11 fl} {12 fl} {13 fl} {14 fl} {gn fl}
	] def
/ms { 
	/sl exch def 
	/val 255 def 
	/ws cfs 
	/im cfs 
	/val 0 def 
	/bs cfs 
	/cs cfs 
	} bind def
400 ms 
/ip { 
	is 
	0 
	cf cs readline pop 
	{	ic exch get exec 
		add 
		} forall 
	pop 
	
	} bind def
/rip { 
	   
	  
	  bis ris copy pop 
      is
      0
      cf cs readline pop 
      {       ic exch get exec 
              add 
              } forall 
	  pop pop 
	  ris gis copy pop 
	  dup is exch 
	  
      cf cs readline pop 
      {       ic exch get exec 
              add 
              } forall 
	  pop pop
	  gis bis copy pop 
	  dup add is exch 
	  
      cf cs readline pop 
      {       ic exch get exec 
              add 
              } forall 
      pop 
      
      } bind def
/rip4 { 
	   
	  
	  kis cis copy pop 
      is
      0
      cf cs readline pop 
      {       ic exch get exec 
              add 
              } forall 
	  pop pop 
	  cis mis copy pop 
	  dup is exch 
	  
      cf cs readline pop 
      {       ic exch get exec 
              add 
              } forall 
	  pop pop
	  mis yis copy pop 
	  dup dup add is exch 
	  
      cf cs readline pop 
      {       ic exch get exec 
              add 
              } forall 
	  pop pop
	  yis kis copy pop 
	  3 mul is exch 
	  
      cf cs readline pop 
      {       ic exch get exec 
              add 
              } forall 
      pop 
      
      } bind def
/wh { 
	/len exch def 
	/pos exch def 
	ws 0 len getinterval im pos len getinterval copy pop
	pos len 
	} bind def
/bl { 
	/len exch def 
	/pos exch def 
	bs 0 len getinterval im pos len getinterval copy pop
	pos len 
	} bind def
/s1 1 string def
/fl { 
	/len exch def 
	/pos exch def 
	/val cf s1 readhexstring pop 0 get def
	pos 1 pos len add 1 sub {im exch val put} for
	pos len 
	} bind def
/hx { 
	3 copy getinterval 
	cf exch readhexstring pop pop 
	} bind def
/wbytes { 
      dup dup
      8 gt { pop 8 idiv mul }
      { 8 eq {pop} {1 eq {7 add 8 idiv} {3 add 4 idiv} ifelse} ifelse } ifelse
	} bind def
/BEGINBITMAPBWc { 
	1 {} COMMONBITMAPc
	} bind def
/BEGINBITMAPGRAYc { 
	8 {} COMMONBITMAPc
	} bind def
/BEGINBITMAP2BITc { 
	2 {} COMMONBITMAPc
	} bind def
/COMMONBITMAPc { 
		 
	/cvtProc exch def
	/depth exch def
	gsave
	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/lb width depth wbytes def 
	sl lb lt {lb ms} if 
	/bitmapsave save def 
	cvtProc                
	/is im 0 lb getinterval def 
	ws 0 lb getinterval is copy pop 
	/cf currentfile def 
	width height depth [width 0 0 height neg 0 height] 
	{ip} image 
	bitmapsave restore 
	grestore
	} bind def
/BEGINBITMAPBW { 
	1 {} COMMONBITMAP
	} bind def
/BEGINBITMAPGRAY { 
	8 {} COMMONBITMAP
	} bind def
/BEGINBITMAP2BIT { 
	2 {} COMMONBITMAP
	} bind def
/COMMONBITMAP { 
	/cvtProc exch def
	/depth exch def
	gsave
	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/bitmapsave save def 
	cvtProc              
	/is width depth wbytes string def
	/cf currentfile def 
	width height depth [width 0 0 height neg 0 height] 
	{cf is readhexstring pop} image
	bitmapsave restore 
	grestore
	} bind def
/ngrayt 256 array def
/nredt 256 array def
/nbluet 256 array def
/ngreent 256 array def
fMLevel1 {
/colorsetup {
	currentcolortransfer
	/gryt exch def
	/blut exch def
	/grnt exch def
	/redt exch def
	0 1 255 {
		/indx exch def
		/cynu 1 red indx get 255 div sub def
		/magu 1 green indx get 255 div sub def
		/yelu 1 blue indx get 255 div sub def
		/kk cynu magu min yelu min def
		/u kk currentundercolorremoval exec def
%		/u 0 def
		nredt indx 1 0 cynu u sub max sub redt exec put
		ngreent indx 1 0 magu u sub max sub grnt exec put
		nbluet indx 1 0 yelu u sub max sub blut exec put
		ngrayt indx 1 kk currentblackgeneration exec sub gryt exec put
	} for
	{255 mul cvi nredt exch get}
	{255 mul cvi ngreent exch get}
	{255 mul cvi nbluet exch get}
	{255 mul cvi ngrayt exch get}
	setcolortransfer
	{pop 0} setundercolorremoval
	{} setblackgeneration
	} bind def
}
{
/colorSetup2 {
	[ /Indexed /DeviceRGB 255 
		{dup red exch get 255 div 
		 exch dup green exch get 255 div 
		 exch blue exch get 255 div}
	] setcolorspace
} bind def
} ifelse
/fakecolorsetup {
	/tran 256 string def
	0 1 255 {/indx exch def 
		tran indx
		red indx get 77 mul
		green indx get 151 mul
		blue indx get 28 mul
		add add 256 idiv put} for
	currenttransfer
	{255 mul cvi tran exch get 255.0 div}
	exch fmConcatProcs settransfer
} bind def
/BITMAPCOLOR { 
	/depth 8 def
	gsave
	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/bitmapsave save def
	fMLevel1 {	
		colorsetup
		/is width depth wbytes string def
		/cf currentfile def 
		width height depth [width 0 0 height neg 0 height] 
		{cf is readhexstring pop} {is} {is} true 3 colorimage 
	} {
		colorSetup2
		/is width depth wbytes string def
		/cf currentfile def 
		7 dict dup begin
			/ImageType 1 def
			/Width width def
			/Height height def
			/ImageMatrix [width 0 0 height neg 0 height] def
			/DataSource {cf is readhexstring pop} bind def
			/BitsPerComponent depth def
			/Decode [0 255] def
		end image	
	} ifelse
	bitmapsave restore 
	grestore
	} bind def
/BITMAPCOLORc { 
	/depth 8 def
	gsave
	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/lb width depth wbytes def 
	sl lb lt {lb ms} if 
	/bitmapsave save def 
	fMLevel1 {	
		colorsetup
		/is im 0 lb getinterval def 
		ws 0 lb getinterval is copy pop 
		/cf currentfile def 
		width height depth [width 0 0 height neg 0 height] 
		{ip} {is} {is} true 3 colorimage
	} {
		colorSetup2
		/is im 0 lb getinterval def 
		ws 0 lb getinterval is copy pop 
		/cf currentfile def 
		7 dict dup begin
			/ImageType 1 def
			/Width width def
			/Height height def
			/ImageMatrix [width 0 0 height neg 0 height] def
			/DataSource {ip} bind def
			/BitsPerComponent depth def
			/Decode [0 255] def
		end image	
	} ifelse
	bitmapsave restore 
	grestore
	} bind def
/BITMAPTRUECOLORc { 
	/depth 24 def
        gsave
 	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/lb width depth wbytes def 
	sl lb lt {lb ms} if 
	/bitmapsave save def 
        
	/is im 0 lb getinterval def	
	/ris im 0 width getinterval def	
	/gis im width width getinterval def	
	/bis im width 2 mul width getinterval def 
        
	ws 0 lb getinterval is copy pop 
	/cf currentfile def 
	width height 8 [width 0 0 height neg 0 height] 
	{width rip pop ris} {gis} {bis} true 3 colorimage
	bitmapsave restore 
	grestore
	} bind def
/BITMAPCMYKc { 
	/depth 32 def
        gsave
 	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/lb width depth wbytes def 
	sl lb lt {lb ms} if 
	/bitmapsave save def 
        
	/is im 0 lb getinterval def	
	/cis im 0 width getinterval def	
	/mis im width width getinterval def	
	/yis im width 2 mul width getinterval def 
	/kis im width 3 mul width getinterval def 
        
	ws 0 lb getinterval is copy pop 
	/cf currentfile def 
	width height 8 [width 0 0 height neg 0 height] 
	{width rip4 pop cis} {mis} {yis} {kis} true 4 colorimage
	bitmapsave restore 
	grestore
	} bind def
/BITMAPTRUECOLOR { 
        gsave
		
		3 index 2 div add exch	
		4 index 2 div add exch	
		translate		
		rotate			
		1 index 2 div neg	
		1 index 2 div neg	
		translate		
		scale			
		/height exch def /width exch def
        /bitmapsave save def 
        /is width string def
        /gis width string def
        /bis width string def
        /cf currentfile def 
        width height 8 [width 0 0 height neg 0 height] 
        { cf is readhexstring pop } 
        { cf gis readhexstring pop } 
        { cf bis readhexstring pop } 
        true 3 colorimage 
        bitmapsave restore 
        grestore
        } bind def
/BITMAPCMYK { 
        gsave
		
		3 index 2 div add exch	
		4 index 2 div add exch	
		translate		
		rotate			
		1 index 2 div neg	
		1 index 2 div neg	
		translate		
		scale			
		/height exch def /width exch def
        /bitmapsave save def 
        /is width string def
        /mis width string def
        /yis width string def
        /kis width string def
        /cf currentfile def 
        width height 8 [width 0 0 height neg 0 height] 
        { cf is readhexstring pop } 
        { cf mis readhexstring pop } 
        { cf yis readhexstring pop } 
        { cf kis readhexstring pop } 
        true 4 colorimage 
        bitmapsave restore 
        grestore
        } bind def
/BITMAPTRUEGRAYc { 
	/depth 24 def
        gsave
	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/lb width depth wbytes def 
	sl lb lt {lb ms} if 
        /bitmapsave save def 
        
	/is im 0 lb getinterval def	
	/ris im 0 width getinterval def	
	/gis im width width getinterval def	
	/bis im width 2 mul width getinterval def 
        ws 0 lb getinterval is copy pop 
        /cf currentfile def 
        width height 8 [width 0 0 height neg 0 height] 
        {width rip pop ris gis bis width gray} image
        bitmapsave restore 
        grestore
        } bind def
/BITMAPCMYKGRAYc { 
	/depth 32 def
        gsave
	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/lb width depth wbytes def 
	sl lb lt {lb ms} if 
        /bitmapsave save def 
        
	/is im 0 lb getinterval def	
	/cis im 0 width getinterval def	
	/mis im width width getinterval def	
	/yis im width 2 mul width getinterval def 
	/kis im width 3 mul width getinterval def 
        ws 0 lb getinterval is copy pop 
        /cf currentfile def 
        width height 8 [width 0 0 height neg 0 height] 
        {width rip pop cis mis yis kis width cgray} image
        bitmapsave restore 
        grestore
        } bind def
/cgray { 
        /ww exch def
        /k exch def
        /y exch def
        /m exch def
        /c exch def
        0 1 ww 1 sub { /i exch def c i get m i get y i get k i get CMYKtoRGB
				.144 mul 3 1 roll .587 mul 3 1 roll .299 mul add add
				c i 3 -1 roll floor cvi put } for
        c
 		} bind def
/gray { 
        /ww exch def
        /b exch def
        /g exch def
        /r exch def
        0 1 ww 1 sub { /i exch def r i get .299 mul g i get .587 mul
			b i get .114 mul add add r i 3 -1 roll floor cvi put } for
        r
        } bind def
/BITMAPTRUEGRAY { 
        gsave
		
		3 index 2 div add exch	
		4 index 2 div add exch	
		translate		
		rotate			
		1 index 2 div neg	
		1 index 2 div neg	
		translate		
		scale			
		/height exch def /width exch def
        /bitmapsave save def 
        /is width string def
        /gis width string def
        /bis width string def
        /cf currentfile def 
        width height 8 [width 0 0 height neg 0 height] 
        { cf is readhexstring pop 
          cf gis readhexstring pop 
          cf bis readhexstring pop width gray}  image
        bitmapsave restore 
        grestore
        } bind def
/BITMAPCMYKGRAY { 
        gsave
		
		3 index 2 div add exch	
		4 index 2 div add exch	
		translate		
		rotate			
		1 index 2 div neg	
		1 index 2 div neg	
		translate		
		scale			
		/height exch def /width exch def
        /bitmapsave save def 
        /is width string def
        /yis width string def
        /mis width string def
        /kis width string def
        /cf currentfile def 
        width height 8 [width 0 0 height neg 0 height] 
        { cf is readhexstring pop 
          cf mis readhexstring pop 
          cf yis readhexstring pop 
          cf kis readhexstring pop width cgray}  image
        bitmapsave restore 
        grestore
        } bind def
/BITMAPGRAY { 
	8 {fakecolorsetup} COMMONBITMAP
	} bind def
/BITMAPGRAYc { 
	8 {fakecolorsetup} COMMONBITMAPc
	} bind def
/ENDBITMAP {
	} bind def
end 
	/ALDmatrix matrix def ALDmatrix currentmatrix pop
/StartALD {
	/ALDsave save def
	 savematrix
	 ALDmatrix setmatrix
	} bind def
/InALD {
	 restorematrix
	} bind def
/DoneALD {
	 ALDsave restore
	} bind def
/I { setdash } bind def
/J { [] 0 setdash } bind def
%%EndProlog
%%BeginSetup
(5.0) FMVERSION
1 1 0 0 612 792 0 1 19 FMDOCUMENT
0 0 /Times-Roman FMFONTDEFINE
1 0 /Palatino-Roman FMFONTDEFINE
2 0 /Helvetica-Bold FMFONTDEFINE
3 0 /Helvetica FMFONTDEFINE
4 0 /Courier-Bold FMFONTDEFINE
5 0 /Helvetica-BoldOblique FMFONTDEFINE
6 0 /Courier FMFONTDEFINE
32 FMFILLS
0 0 FMFILL
1 0.1 FMFILL
2 0.3 FMFILL
3 0.5 FMFILL
4 0.7 FMFILL
5 0.9 FMFILL
6 0.97 FMFILL
7 1 FMFILL
8 <0f1e3c78f0e1c387> FMFILL
9 <0f87c3e1f0783c1e> FMFILL
10 <cccccccccccccccc> FMFILL
11 <ffff0000ffff0000> FMFILL
12 <8142241818244281> FMFILL
13 <03060c183060c081> FMFILL
14 <8040201008040201> FMFILL
16 1 FMFILL
17 0.9 FMFILL
18 0.7 FMFILL
19 0.5 FMFILL
20 0.3 FMFILL
21 0.1 FMFILL
22 0.03 FMFILL
23 0 FMFILL
24 <f0e1c3870f1e3c78> FMFILL
25 <f0783c1e0f87c3e1> FMFILL
26 <3333333333333333> FMFILL
27 <0000ffff0000ffff> FMFILL
28 <7ebddbe7e7dbbd7e> FMFILL
29 <fcf9f3e7cf9f3f7e> FMFILL
30 <7fbfdfeff7fbfdfe> FMFILL
%%EndSetup
%%Page: "1" 1
%%BeginPaperSize: Letter
%%EndPaperSize
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
J
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(1) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(POSIX) 250.97 474 T
(Example Code) 181.96 431 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "1" 1
%%Page: "2" 2
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(2) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(T) 155.61 732 T
(ab) 174.73 732 T
(le of Contents) 216.38 732 T
3 18 Q
(\322Creating & Joining Threads: m) 18 672 T
(ulti_thr) 266.9 672 T
(.c\323) 320.02 672 T
(4) 583.99 672 T
(\322Classic Producer/Consumer) 18 650 T
(: one_queue_prob) 248.58 650 T
(lem.c\323) 394.33 650 T
(10) 573.98 650 T
(\322Classic Producer/Consumer) 18 628 T
(: one_queue_solution.c\323) 248.58 628 T
(15) 573.98 628 T
(\322Using a Single Length Counter\323) 18 606 T
(19) 573.98 606 T
(\322Cancellation: cancellation.c\323) 18 584 T
(21) 573.98 584 T
(\322Threads and X11: ThreadWin.c\323) 18 562 T
(32) 573.98 562 T
(\322Link) 18 540 T
(ed Lists) 56.65 540 T
(, Global Mute) 118.4 540 T
(x: list_global_loc) 224.91 540 T
(k.c\323) 356.6 540 T
(37) 573.98 540 T
(\322Link) 18 518 T
(ed Lists) 56.65 518 T
(, Global R) 118.4 518 T
(WLoc) 197.89 518 T
(k+: list_global_rw2.c\323) 243.54 518 T
(45) 573.98 518 T
(\322Link) 18 496 T
(ed Lists) 56.65 496 T
(, 2 Local Mute) 118.4 496 T
(x) 230.92 496 T
(es: list_2local_loc) 239.38 496 T
(ks) 380.07 496 T
(.c\323) 397.8 496 T
(55) 573.98 496 T
(\322Stoppab) 18 474 T
(le Queue: stop_queue_prob) 90.68 474 T
(lem.c\323) 313.47 474 T
(65) 573.98 474 T
(\322Stoppab) 18 452 T
(le Queue: stop_queue_solution.c\323) 90.68 452 T
(70) 573.98 452 T
(\322Threads and Soc) 18 430 T
(k) 160.7 430 T
(ets: client.c\323) 169.34 430 T
(76) 573.98 430 T
(\322T&S: No Threads: ser) 18 408 T
(v) 198.59 408 T
(er) 207.14 408 T
(.c\323) 222.25 408 T
(81) 573.98 408 T
(\322T&S: Producer/Consumer) 18 386 T
(: ser) 230.6 386 T
(v) 266.15 386 T
(er_pc.c\323) 274.7 386 T
(95) 573.98 386 T
(\322Rob) 18 364 T
(ust Ser) 56.65 364 T
(v) 114.21 364 T
(er Using select\050\051: ser) 122.76 364 T
(v) 289.33 364 T
(er_select.c\323) 297.88 364 T
(107) 563.98 364 T
(\322Creating Thread-Local Signals:callout_tests) 18 342 T
(.c\323) 371.86 342 T
(125) 563.98 342 T
(\322Creating Thread-Local Signals: callout.c \050libr) 18 320 T
(ar) 377.93 320 T
(y\051\323) 394.47 320 T
(129) 563.98 320 T
(\322P) 18 298 T
(assing Shared Data: matr) 35.28 298 T
(ix_prob) 239.63 298 T
(lem.c\323) 298.3 298 T
(135) 563.98 298 T
(\322P) 18 276 T
(assing Stac) 35.28 276 T
(k Data: matr) 127.96 276 T
(ix_solution.c\323) 226.26 276 T
(139) 563.98 276 T
(\322T) 18 254 T
(esting Recursiv) 32.83 254 T
(e Mute) 155.41 254 T
(x) 209.9 254 T
(es: test_recursiv) 218.36 254 T
(e_m) 348.95 254 T
(ute) 383.78 254 T
(x.c\323) 408.26 254 T
(148) 563.98 254 T
(\322Bil\325) 18 232 T
(s Extensions \050Libr) 47.09 232 T
(ar) 189.95 232 T
(y\051: thread_e) 206.5 232 T
(xtensions) 302 232 T
(.h\323) 377.77 232 T
(150) 563.98 232 T
(\322Bil\325) 18 210 T
(s Extensions \050Libr) 47.09 210 T
(ar) 189.95 210 T
(y\051: thread_e) 206.5 210 T
(xtensions) 302 210 T
(.c\323) 377.77 210 T
(157) 563.98 210 T
(\322Misusing the Cache: cache_thr) 18 188 T
(ash.c\323) 270.92 188 T
(185) 563.98 188 T
(\322Misusing the Cache: f) 18 166 T
(alse_shar) 196.52 166 T
(ing.c\323) 274.82 166 T
(187) 563.98 166 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "2" 2
%%Page: "3" 3
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(3) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 63 594 756 C
18 147.83 554.79 749 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
212.25 252.89 218.37 360.95 R
0 X
0 0 0 1 0 0 0 K
V
0.5 H
2 Z
N
414.28 280.29 420.4 571.95 R
V
N
363.89 497.01 370.01 541.71 R
V
N
440.62 605 440.62 607.98 450.99 605 440.62 602.03 4 Y
0 Z
N
440.62 605 440.62 607.98 450.99 605 440.62 602.03 4 Y
V
440.37 605 410.59 605 2 L
2 Z
N
396.59 641 396.59 643.98 406.96 641 396.59 638.03 4 Y
0 Z
N
396.59 641 396.59 643.98 406.96 641 396.59 638.03 4 Y
V
396.34 641 366.56 641 2 L
2 Z
N
345.44 677.72 345.44 680.7 355.82 677.72 345.44 674.75 4 Y
0 Z
N
345.44 677.72 345.44 680.7 355.82 677.72 345.44 674.75 4 Y
V
345.19 677.72 315.41 677.72 2 L
2 Z
N
267.96 731.76 267.96 211.9 2 L
1 H
N
2 14 Q
(C) 0 -90 265.75 201.12 TF
264.48 484.77 274.18 612.92 R
3 X
V
0.5 H
0 X
N
464.38 731.76 464.38 211.9 2 L
1 H
N
(E) 0 -90 459.36 201.09 TF
459.54 344.37 469.23 467.49 R
3 X
V
0.5 H
0 X
N
290.67 641.72 290.67 638.75 280.29 641.72 290.67 644.7 4 Y
0 Z
N
290.67 641.72 290.67 638.75 280.29 641.72 290.67 644.7 4 Y
V
320.69 641.72 290.92 641.72 2 L
2 Z
N
J
292.02 532.28 292.02 529.31 281.65 532.28 292.02 535.26 4 Y
0 Z
N
292.02 532.28 292.02 529.31 281.65 532.28 292.02 535.26 4 Y
V
J
322.05 532.28 292.27 532.28 2 L
J
322.05 532.28 321.3 532.28 2 L
2 Z
N
[1.488 4.465] 1.488 I
321.3 532.28 293.03 532.28 2 L
N
J
293.03 532.28 292.27 532.28 2 L
N
J
366.95 731.76 366.95 211.9 2 L
1 H
N
(A) 0 -90 361.92 201.12 TF
417.34 731.76 417.34 211.9 2 L
N
(D) 0 -90 412.31 201.12 TF
408.67 569.72 426.01 642.44 R
7 X
V
0.5 H
0 X
N
J
440.32 353.01 440.32 355.98 450.69 353.01 440.32 350.03 4 Y
0 Z
N
440.32 353.01 440.32 355.98 450.69 353.01 440.32 350.03 4 Y
V
J
272.58 353.01 440.07 353.01 2 L
J
272.58 353.01 273.33 353.01 2 L
2 Z
N
[1.495 4.486] 1.495 I
273.33 353.01 439.31 353.01 2 L
N
J
439.31 353.01 440.07 353.01 2 L
N
J
126.25 547.72 144.62 593.62 R
N
(W) 0 -90 109.89 598.25 TF
(orking) 0 -90 109.89 585.88 TF
(Sleeping) 0 -90 112.32 486.86 TF
134.35 442.79 144.62 472.57 R
3 X
V
0 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(Zombie) 0 -90 112.32 708.56 TF
134.35 668.78 144.62 698.55 R
V
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
124.81 347.91 124.8 344.93 114.43 347.91 124.8 350.89 4 Y
0 Z
N
124.81 347.91 124.8 344.93 114.43 347.91 124.8 350.89 4 Y
V
157.27 347.91 125.05 347.91 2 L
2 Z
N
J
125.21 207.81 125.21 204.84 114.83 207.81 125.21 210.79 4 Y
0 Z
N
125.21 207.81 125.21 204.84 114.83 207.81 125.21 210.79 4 Y
V
J
157.68 207.81 125.46 207.81 2 L
J
157.68 207.81 156.93 207.81 2 L
2 Z
N
[1.335 4.006] 1.335 I
156.93 207.81 126.21 207.81 2 L
N
J
126.21 207.81 125.46 207.81 2 L
N
J
(create) 0 -90 93.3 368.86 TF
(join) 0 -90 92.89 214.69 TF
J
440.78 498.35 440.75 501.32 451.15 498.44 440.8 495.37 4 Y
0 Z
N
440.78 498.35 440.75 501.32 451.15 498.44 440.8 495.37 4 Y
V
J
368.22 497.73 440.53 498.35 2 L
J
368.22 497.73 368.97 497.73 2 L
2 Z
N
[1.507 4.52] 1.507 I
368.97 497.73 439.78 498.34 2 L
N
J
439.78 498.34 440.53 498.35 2 L
N
J
215.31 731.72 215.31 211.86 2 L
1 H
N
(B) 0 -90 210.28 201.08 TF
206.63 360.17 223.98 504.16 R
7 X
V
0.5 H
0 X
N
J
440.78 280.29 440.78 283.27 451.15 280.29 440.78 277.31 4 Y
0 Z
N
440.78 280.29 440.78 283.27 451.15 280.29 440.78 277.31 4 Y
V
J
417.17 280.29 440.53 280.29 2 L
J
417.17 280.29 417.92 280.29 2 L
2 Z
N
[1.457 4.371] 1.457 I
417.92 280.29 439.78 280.29 2 L
N
J
439.78 280.29 440.53 280.29 2 L
N
J
237.8 496.29 237.8 493.31 227.42 496.29 237.8 499.26 4 Y
0 Z
N
237.8 496.29 237.8 493.31 227.42 496.29 237.8 499.26 4 Y
V
267.82 496.29 238.05 496.29 2 L
2 Z
N
358.28 532.28 375.62 677.72 R
7 X
V
0 X
N
455.71 423.57 473.05 605 R
7 X
V
0 X
N
260.66 353.01 278 532.28 R
7 X
V
0 X
N
455.71 245.73 473.05 355.17 R
7 X
V
0 X
N
260.66 567.56 278 641.72 R
7 X
V
0 X
N
J
396.59 570.44 396.59 573.42 406.96 570.44 396.59 567.47 4 Y
0 Z
N
396.59 570.44 396.59 573.42 406.96 570.44 396.59 567.47 4 Y
V
J
396.34 570.44 323.57 570.44 2 L
J
396.34 570.44 388.59 570.44 2 L
2 Z
N
[14.202 9.621] 14.202 I
388.59 570.44 331.32 570.44 2 L
N
J
331.32 570.44 323.57 570.44 2 L
N
J
316.56 731.76 316.56 211.9 2 L
1 H
N
(main) 0 -90 311.61 203.53 TF
307.89 532.29 325.23 714.44 R
7 X
V
0.5 H
0 X
N
(cancel\050D\051) 0 -90 313.19 632.74 TF
(join\050main\051) 0 -90 266.29 636.61 TF
(join\050D\051) 0 -90 460.82 327.49 TF
(join\050C\051) 0 -90 460.82 470.05 TF
(join\050A\051) 0 -90 460.82 543.49 TF
J
124.81 280.85 124.8 277.87 114.43 280.85 124.8 283.82 4 Y
0 Z
N
124.81 280.85 124.8 277.87 114.43 280.85 124.8 283.82 4 Y
V
J
157.27 280.85 125.05 280.85 2 L
J
157.27 280.85 149.52 280.85 2 L
2 Z
N
[24.677 16.716] 24.677 I
149.52 280.85 132.8 280.85 2 L
N
J
132.8 280.85 125.05 280.85 2 L
N
J
(cancel) 0 -90 93.3 304.14 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 32 Q
(POSIX Thread Create and Join) 0 -90 512 687 TF
18 63 594 756 C
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "3" 3
%%Page: "4" 4
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(4) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Creating & Joining Threads:) 64.96 732 T
(m) 215.42 684 T
(ulti_thr) 246.71 684 T
(.c) 366.55 684 T
4 12 Q
(/*                multi_thr.c                */) 18 614 T
(/*) 18 586 T
(  Simple program that just illustrates thread creation, thread exiting,) 18 572 T
(  waiting for threads, and returning status from threads.) 18 558 T
(*/) 18 544 T
(/*) 18 516 T
(cc -o multi_thr multi_thr.c -L. -R. -g -lpthread -lthread -pthread_extensions -) 18 502 T
(lposix4) 18 488 T
(*/) 18 474 T
(#define _POSIX_C_SOURCE 199506L) 18 446 T
(#include <stdio.h>) 18 418 T
(#include <stdlib.h>) 18 404 T
(#include <pthread.h>) 18 390 T
(#include <time.h>) 18 376 T
(#include \322thread_extensions.h\323) 18 362 T
(/* Function prototypes for thread routines */) 18 320 T
(void *sub_a\050void *\051;) 18 306 T
(void *sub_b\050void *\051;) 18 292 T
(void *sub_c\050void *\051;) 18 278 T
(void *sub_d\050void *\051;) 18 264 T
(void *sub_e\050void *\051;) 18 250 T
(pthread_t               tid_a, tid_b, tid_c, tid_d, tid_e, tid_main;) 18 222 T
(pthread_attr_t          attr;) 18 208 T
(int                     zero;) 18 194 T
(float                   f;) 18 180 T
(int time1\050\051) 18 138 T
({return\050time\050NULL\051-zero\051;}) 18 124 T
(void *sub_a\050void *arg\051) 18 82 T
({int            err, i;) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "4" 4
%%Page: "5" 5
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(5) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_t      tid = pthread_self\050\051;) 18 748 T
( printf\050\322[%2d] A: \134t In thread A [%s]\134n\323, time1\050\051, thread_name\050tid\051\051;) 18 720 T
( sleep\0501\051;) 18 706 T
( PTHREAD_CREATE\050&tid_d, &attr, sub_d, NULL\051;) 18 692 T
( printf\050\322[%2d] A: \134t Created thread D [%s]\134n\323, time1\050\051, thread_name\050tid_d\051\051;) 18 678 T
( sleep\0503\051;) 18 650 T
( printf\050\322[%2d] A: \134t Thread exiting...\134n\323, time1\050\051\051;) 18 636 T
( return\050\050void *\05177\051;            /* Same as pthread_exit\050\050void *\05177\051 */) 18 622 T
(}) 18 608 T
(void *sub_b\050void *arg\051) 18 566 T
({pthread_t      tid = pthread_self\050\051;) 18 552 T
( printf\050\322[%2d] B: \134t In thread B [%s]\134n\323, time1\050\051, thread_name\050tid\051\051;) 18 538 T
( sleep\0504\051;) 18 510 T
( printf\050\322[%2d] B: \134t Thread exiting...\134n\323, time1\050\051\051;) 18 482 T
( pthread_exit\050NULL\051;) 18 468 T
(}) 18 454 T
(void *sub_c\050void *arg\051) 18 412 T
({void           *status;) 18 398 T
( int            err, i;) 18 384 T
( pthread_t tid = pthread_self\050\051;) 18 356 T
( pthread_t      *ptid = \050pthread_t *\051 arg; /* Passing a POINTER to the TID */) 18 342 T
( char           *name = thread_name\050tid\051;) 18 328 T
( printf\050\322[%2d] C: \134t In thread C [%s]\134n\323, time1\050\051, name\051;) 18 300 T
( sleep\0502\051;) 18 286 T
( printf\050\322[%2d] C: \134t Joining main thread...\134n\323, time1\050\051\051;) 18 258 T
( if \050err=pthread_join\050*ptid, &status\051\051) 18 244 T
(   printf\050\322pthread_join Error. %s\323, strerror\050err\051\051, exit\0501\051;) 18 230 T
( printf\050\322[%2d] C: \134t Main thread [%s] returning status: %d\134n\323,) 18 216 T
(        time1\050\051, thread_name\050*ptid\051, \050int\051 status\051;) 18 202 T
( sleep\0501\051;) 18 174 T
( PTHREAD_CREATE\050&tid_b, &attr, sub_b, NULL\051;) 18 146 T
( printf\050\322[%2d] C: \134t Created thread B [%s]\134n\323, time1\050\051, thread_name\050tid_b\051\051;) 18 132 T
( sleep\0504\051;) 18 104 T
( printf\050\322[%2d] C: \134t Thread exiting...\134n\323, time1\050\051\051;) 18 90 T
( f = 88.8;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "5" 5
%%Page: "6" 6
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(6) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_exit\050\050void *\051 &f\051;) 18 748 T
(}) 18 734 T
(void *cleanup\050void *arg\051) 18 706 T
({pthread_t tid = pthread_self\050\051;) 18 692 T
( char *name = thread_name\050tid\051;) 18 678 T
(  printf\050\322[%2d] D: \134t %s cancelled! \134n\323, time1\050\051, name\051;) 18 650 T
(}) 18 636 T
(void * sub_d\050void *arg\051) 18 580 T
({int            err, i;) 18 566 T
( pthread_t      tid_e;) 18 552 T
( void           *status;) 18 538 T
( pthread_t      tid = pthread_self\050\051;) 18 524 T
( printf\050\322[%2d] D: \134t In thread D [%s]\134n\323, time1\050\051, thread_name\050tid\051\051;) 18 496 T
( pthread_cleanup_push\050cleanup, NULL\051;) 18 468 T
( pthread_setcanceltype\050PTHREAD_CANCEL_ASYNCHRONOUS, NULL\051;) 18 454 T
( pthread_setcancelstate\050PTHREAD_CANCEL_ENABLE, NULL\051;) 18 440 T
( sleep\0501\051;) 18 412 T
( PTHREAD_CREATE\050&tid_e, &attr, sub_e, NULL\051;) 18 398 T
( printf\050\322[%2d] D: \134t Created thread E [%s]\134n\323, time1\050\051, thread_name\050tid_e\051\051;) 18 384 T
( sleep\0505\051;) 18 356 T
(        /* D should get cancelled before this runs. */) 18 328 T
( printf\050\322[%2d] D: \134t Thread exiting...\134n\323, time1\050\051\051;) 18 314 T
( pthread_cleanup_pop\0500\051;) 18 300 T
( return\050\050void *\05155\051;) 18 286 T
(}) 18 272 T
(void * sub_e\050void *arg\051) 18 230 T
({int            err, i;) 18 216 T
( void           *status;) 18 202 T
( pthread_t      tid = pthread_self\050\051;) 18 188 T
( printf\050\322[%2d] E: \134t In thread E [%s]\134n\323, time1\050\051, thread_name\050tid\051\051;) 18 160 T
( sleep\0503\051;) 18 132 T
( printf\050\322[%2d] E: \134t Joining thread A...\134n\323, time1\050\051\051;) 18 118 T
( if \050err=pthread_join\050tid_a, &status\051\051) 18 104 T
(   printf\050\322pthread_join Error. %s\323, strerror\050err\051\051, exit\0501\051;) 18 90 T
( printf\050\322[%2d] E: \134t Thread A [%s] returning status: %d\134n\323,) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "6" 6
%%Page: "7" 7
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(7) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(        time1\050\051, thread_name\050tid_a\051, \050int\051 status\051;) 18 748 T
( sleep\0502\051;) 18 720 T
( printf\050\322[%2d] E: \134t Joining thread C...\134n\323, time1\050\051\051;) 18 692 T
( if \050err=pthread_join\050tid_c, &status\051\051) 18 678 T
(   printf\050\322pthread_join Error. %s\323, strerror\050err\051\051, exit\0501\051;) 18 664 T
( printf\050\322[%2d] E: \134t Thread C [%s] returning status: %f\134n\323,) 18 650 T
(        time1\050\051, thread_name\050tid_c\051, *\050\050float *\051 status\051\051;) 18 636 T
( sleep\0502\051;) 18 608 T
( printf\050\322[%2d] E: \134t Joining thread D...\134n\323, time1\050\051\051;) 18 594 T
( if \050err=pthread_join\050tid_d, &status\051\051) 18 580 T
(   printf\050\322pthread_join Error. %s\323, strerror\050err\051\051, exit\0501\051;) 18 566 T
( if \050\050void*\051 status == \050void*\051 PTHREAD_CANCELED\051) 18 552 T
(   printf\050\322[%2d] E: \134t Thread D [%s] returning status: PTHREAD_CANCELED\134n\323,) 18 538 T
(          time1\050\051, thread_name\050tid_d\051\051;) 18 524 T
( else) 18 510 T
(   printf\050\322[%2d] E: \134t Thread D [%s] returning status: %d\134n\323,) 18 496 T
(          time1\050\051, thread_name\050tid_d\051, \050int\051 status\051;) 18 482 T
( sleep\0501\051;) 18 454 T
( printf\050\322[%2d] E: \134t Thread exiting...\134n\323, time1\050\051\051;) 18 440 T
( pthread_exit\050\050void *\05144\051;) 18 426 T
(}) 18 412 T
(main\050\051) 18 356 T
({int            err;) 18 342 T
( zero = time\050NULL\051;) 18 314 T
( tid_main = pthread_self\050\051;) 18 300 T
( printf\050\322Time Thread \134t Event\134n\323\051;) 18 286 T
( printf\050\322==== ====== \134t =====\134n\323\051;) 18 272 T
( printf\050\322[%2d] Main: \134t Started [%s]\134n\323, time1\050\051, thread_name\050tid_main\051\051;) 18 258 T
( PTHREAD_ATTR_INIT\050&attr\051;) 18 230 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 216 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_JOINABLE\051; /* Also default */) 18 202 T
( sleep\0501\051;) 18 174 T
( PTHREAD_CREATE\050&tid_a, &attr, sub_a, NULL\051;) 18 160 T
( printf\050\322[%2d] Main: \134t Created thread A [%s]\134n\323, time1\050\051, thread_name\050tid_a\051\051;) 18 146 T
( sleep\0501\051;) 18 118 T
( PTHREAD_CREATE\050&tid_c, &attr, sub_c, \050void *\051 &tid_main\051;) 18 104 T
( printf\050\322[%2d] Main: \134t Created thread C [%s]\134n\323, time1\050\051, thread_name\050tid_c\051\051;) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "7" 7
%%Page: "8" 8
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(8) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( sleep\0502\051;) 18 748 T
( printf\050\322[%2d] Main: \134t Cancelling thread D [%s]\134n\323,) 18 734 T
(        time1\050\051, thread_name\050tid_d\051\051;) 18 720 T
( pthread_cancel\050tid_d\051;) 18 706 T
( sleep\0501\051;) 18 678 T
( printf\050\322[%2d] Main: \134t Thread exiting...\134n\323, time1\050\051\051;) 18 664 T
( pthread_exit\050\050void *\051 NULL\051;) 18 650 T
(}) 18 636 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "8" 8
%%Page: "9" 9
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(9) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 152.15 548.19 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 18 Q
0 X
0 0 0 1 0 0 0 K
(Output: J) 0 -90 451.72 304.01 TF
(une) 0 -90 451.72 224.38 TF
(...) 0 -90 451.72 192.01 TF
477.13 546.5 M
 479.57 553.63 467.87 560.26 460.22 551.5 D
 452.53 542.68 443.1 564.21 429.63 548.17 D
3 H
2 Z
N
90 450 1.5 1.5 90 453.8 527.98 GG
453.8 529.48 450 529.48 453.8 542.72 457.6 529.48 4 Y
0 Z
N
453.8 529.48 450 529.48 453.8 542.72 457.6 529.48 4 Y
V
453.8 527.98 453.8 518.17 2 L
2 Z
N
182.24 590.83 M
 184.68 597.96 172.98 604.59 165.33 595.83 D
 157.64 587.01 148.21 608.54 134.74 592.49 D
N
90 450 1.5 1.5 90 158.9 572.31 GG
158.9 573.81 155.11 573.81 158.9 587.05 162.7 573.81 4 Y
0 Z
N
158.9 573.81 155.11 573.81 158.9 587.05 162.7 573.81 4 Y
V
158.9 572.31 158.9 562.49 2 L
2 Z
N
303.99 576.88 340.71 650.32 R
1 H
N
90 450 8.76 8.28 270 322.35 594.4 GG
90 450 8.76 8.28 270 322.35 594.4 AA
339.99 606.53 303.99 606.53 2 L
N
(Jan) 0 -90 317.67 643.59 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
303.99 468.89 340.71 542.32 R
N
90 450 8.76 8.28 270 322.35 486.4 GG
90 450 8.76 8.28 270 322.35 486.4 AA
339.99 498.53 303.99 498.53 2 L
N
(Jon) 0 -90 317.67 535.59 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
317.49 556.91 320.05 558.42 322.73 547.98 314.93 555.41 4 Y
0.5 H
0 Z
N
317.49 556.91 320.05 558.42 322.73 547.98 314.93 555.41 4 Y
V
323.43 594.16 M
 316.5 583.49 310.91 568.12 317.36 557.13 D
2 Z
N
315.51 682.16 352.23 747.52 R
1 H
N
90 450 7.8 8.28 270 333.87 697.75 GG
90 450 7.8 8.28 270 333.87 697.75 AA
322.39 665.62 325.02 665.86 323.2 656.45 319.76 665.39 4 Y
0 Z
N
322.39 665.62 325.02 665.86 323.2 656.45 319.76 665.39 4 Y
V
338.35 694.76 M
 344.11 681.84 337.22 676.49 326.53 673.07 D
 323.48 672.09 322.06 669.41 322.35 666.12 D
2 Z
N
351.51 708.55 315.51 708.55 2 L
N
(T1) 0 -90 329.19 741.52 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
210.7 546.19 247.42 619.63 R
N
90 450 8.76 8.28 270 229.06 563.71 GG
90 450 8.76 8.28 270 229.06 563.71 AA
246.7 575.83 210.7 575.83 2 L
N
(Jim) 0 -90 224.38 612.89 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
297.31 689.52 296.64 692.42 307.43 691.88 297.99 686.62 4 Y
0.5 H
0 Z
N
297.31 689.52 296.64 692.42 307.43 691.88 297.99 686.62 4 Y
V
232.74 631.7 M
 242.29 661.03 267.84 677.15 293.73 688.09 D
 294.84 688.55 295.9 689.19 297.07 689.46 D
2 Z
N
447.12 602.15 450.09 602.18 447.21 591.78 444.14 602.12 4 Y
0 Z
N
447.12 602.15 450.09 602.18 447.21 591.78 444.14 602.12 4 Y
V
360.15 693.52 M
 455.18 670.4 446.81 635.19 447.11 602.4 D
2 Z
N
471.25 322.25 473.99 321.05 467.07 312.71 468.51 323.45 4 Y
0 Z
N
471.25 322.25 473.99 321.05 467.07 312.71 468.51 323.45 4 Y
V
439.23 509.73 M
 430.67 436.89 500.96 390.1 471.35 322.48 D
2 Z
N
(Pr) 0 -90 107.42 631.15 TF
(oducer) 0 -90 107.42 612.5 TF
(Consumer) 0 -90 402.33 582.36 TF
193.54 609.05 193.97 611.66 202.62 607.55 193.11 606.45 4 Y
1 H
0 Z
N
193.54 609.05 193.97 611.66 202.62 607.55 193.11 606.45 4 Y
V
148.23 607.26 M
 135.77 622.99 143.88 663.51 169.9 653.12 D
 189.26 645.38 174.17 622.19 186.76 612.23 D
 188.74 610.66 190.81 609.5 193.04 609.13 D
2 Z
N
2 32 Q
(Classic Pr) 0 -90 502.35 666.88 TF
(oducer/Consumer) 0 -90 502.35 512.77 TF
427.99 368.5 M
 430.43 375.63 418.73 382.26 411.08 373.5 D
 403.39 364.68 393.96 386.21 380.49 370.17 D
3 H
N
90 450 1.5 1.5 90 404.65 349.98 GG
404.65 351.48 400.86 351.48 404.65 364.72 408.45 351.48 4 Y
0 Z
N
404.65 351.48 400.86 351.48 404.65 364.72 408.45 351.48 4 Y
V
404.65 349.98 404.65 340.17 2 L
2 Z
N
2 18 Q
(Consumer) 0 -90 353.19 404.36 TF
396.48 400.23 399.48 400.26 396.55 389.78 393.48 400.21 4 Y
0.5 H
0 Z
N
396.48 400.23 399.48 400.26 396.55 389.78 393.48 400.21 4 Y
V
353.3 671.52 M
 404.05 603.09 395.79 496.15 396.48 400.48 D
2 Z
N
424.3 264.69 424.26 267.34 433.54 264.85 424.35 262.04 4 Y
1 H
0 Z
N
424.3 264.69 424.26 267.34 433.54 264.85 424.35 262.04 4 Y
V
387.35 350.88 M
 371.93 325 380.65 286.23 408.35 268.29 D
 412.39 265.67 417.97 264.58 423.8 264.68 D
2 Z
N
187.24 416.09 M
 189.68 423.22 177.98 429.85 170.33 421.09 D
 162.64 412.27 153.21 433.8 139.74 417.76 D
3 H
N
90 450 1.5 1.5 90 163.9 397.57 GG
163.9 399.07 160.11 399.07 163.9 412.32 167.7 399.07 4 Y
0 Z
N
163.9 399.07 160.11 399.07 163.9 412.32 167.7 399.07 4 Y
V
163.9 397.57 163.9 387.76 2 L
2 Z
N
215.7 371.45 252.42 444.89 R
1 H
N
90 450 8.76 8.28 270 234.06 388.97 GG
90 450 8.76 8.28 270 234.06 388.97 AA
251.7 401.1 215.7 401.1 2 L
N
(Jac) 0 -90 229.38 438.15 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(Pr) 0 -90 112.42 456.42 TF
(oducer) 0 -90 112.42 437.77 TF
198.54 434.32 198.97 436.92 207.62 432.82 198.11 431.71 4 Y
0 Z
N
198.54 434.32 198.97 436.92 207.62 432.82 198.11 431.71 4 Y
V
153.23 432.52 M
 140.77 448.26 148.88 488.77 174.9 478.38 D
 194.26 470.64 179.17 447.46 191.76 437.49 D
 193.74 435.92 195.81 434.77 198.04 434.4 D
2 Z
N
293.27 675.36 292.19 677.78 301.7 679.14 294.35 672.94 4 Y
0 Z
N
293.27 675.36 292.19 677.78 301.7 679.14 294.35 672.94 4 Y
V
237.35 449.88 M
 276.67 488.42 285.37 542.76 277.97 594.88 D
 274.27 620.95 266.79 663.49 292.81 675.16 D
2 Z
N
300.99 361.89 337.71 435.32 R
N
90 450 8.76 8.28 270 319.35 379.4 GG
90 450 8.76 8.28 270 319.35 379.4 AA
336.99 391.53 300.99 391.53 2 L
N
(Joe) 0 -90 314.67 428.59 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
314.49 449.91 317.05 451.42 319.73 440.98 311.93 448.41 4 Y
0.5 H
0 Z
N
314.49 449.91 317.05 451.42 319.73 440.98 311.93 448.41 4 Y
V
320.43 487.16 M
 313.5 476.49 307.91 461.12 314.36 450.13 D
2 Z
N
300.99 254.24 337.71 327.68 R
1 H
N
90 450 8.76 8.28 270 319.35 271.76 GG
90 450 8.76 8.28 270 319.35 271.76 AA
336.99 283.88 300.99 283.88 2 L
N
(Ja) 0 -90 314.67 320.94 TF
(y) 0 -90 314.67 301.28 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
314.49 342.27 317.05 343.77 319.73 333.33 311.92 340.76 4 Y
0.5 H
0 Z
N
314.49 342.27 317.05 343.77 319.73 333.33 311.92 340.76 4 Y
V
320.43 379.52 M
 313.49 368.84 307.91 353.47 314.36 342.48 D
2 Z
N
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "9" 9
%%Page: "10" 10
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(10) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Classic Pr) 59.29 732 T
(oducer/Consumer:) 232.67 732 T
(one_queue_pr) 115.49 684 T
(ob) 360.83 684 T
(lem.c) 404.46 684 T
4 12 Q
(/*                one_queue_problem.c                */) 18 614 T
(/*) 18 586 T
(  This is the prototypical producer/consumer example done by) 18 572 T
(  building a singly linked list.  Note the use of the semaphore) 18 558 T
(  to prevent the consumers from running when the list is empty.) 18 544 T
(  Unfortunately, there\325s nothing to prevent the list from getting) 18 530 T
(  infinitely long...) 18 516 T
(  Delays are inserted to simulate disk I/O \050and to make things) 18 488 T
(  run slower!\051.) 18 474 T
(*/) 18 460 T
(/*) 18 418 T
(cc -o one_queue_problem one_queue_problem.c -L. -R. -g -lpthread -lthread -) 18 404 T
(pthread_extensions -lposix4) 18 390 T
(*/) 18 376 T
(#define _POSIX_C_SOURCE 199506L) 18 348 T
(#include <pthread.h>) 18 320 T
(#include <semaphore.h>) 18 306 T
(#include <errno.h>) 18 292 T
(#include <time.h>) 18 278 T
(#include \322thread_extensions.h\323) 18 264 T
(typedef struct request_struct) 18 222 T
({int                    client;) 18 208 T
( char                   *buf;) 18 194 T
( pthread_t              tid;) 18 180 T
( struct request_struct  *next;) 18 166 T
(} request_t;) 18 152 T
(request_t               *requests = NULL;) 18 124 T
(pthread_mutex_t         requests_lock = PTHREAD_MUTEX_INITIALIZER;) 18 110 T
(pthread_attr_t          attr;) 18 96 T
(sem_t                   requests_length;) 18 82 T
(int) 18 68 T
(max_length_empirical = 0, sval;) 217 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "10" 10
%%Page: "11" 11
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(1) 297 31.12 T
(1) 302.34 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(int                     GET_DELAY = 100, PROCESS_DELAY = 250;) 18 748 T
(int                     N_PROD = 2, N_CONS = 2;) 18 734 T
(void print_requests\050\051) 18 678 T
({request_t *r = requests;) 18 664 T
( while \050r != NULL\051) 18 636 T
(   {printf\050\322<Request: %d>\134n\323, r->client\051;) 18 622 T
(    r = r->next;) 18 608 T
(  }) 18 594 T
(}) 18 580 T
(request_t *get_request\050\051) 18 538 T
({static int count = 0;) 18 524 T
( static pthread_mutex_t mr  = PTHREAD_MUTEX_INITIALIZER;) 18 510 T
( int c;) 18 496 T
( request_t *request;) 18 482 T
( pthread_t tid = pthread_self\050\051;) 18 468 T
( delay\050GET_DELAY, 0\051;) 18 440 T
( pthread_mutex_lock\050&mr\051;) 18 426 T
( c=count++;) 18 412 T
( pthread_mutex_unlock\050&mr\051;) 18 398 T
( request = \050request_t *\051 malloc\050sizeof\050request_t\051\051;) 18 370 T
( request->client = c;                        /* Cannot use count here! */) 18 356 T
( request->tid = pthread_self\050\051;) 18 342 T
( DEBUG\050printf\050\322[%s] Creating request  %4d\134n\323, thread_name\050tid\051, c\051\051;) 18 314 T
( return\050request\051;) 18 300 T
(}) 18 286 T
(void process_request\050request_t *request\051) 18 244 T
({pthread_t tid = pthread_self\050\051;) 18 230 T
(  delay\050PROCESS_DELAY, 0\051;) 18 216 T
(  DEBUG\050printf\050\322[%s] Processed request %4d [%s]\134n\323, thread_name\050tid\051,) 18 202 T
(               request->client, thread_name\050request->tid\051\051\051;) 18 188 T
(  free\050request\051;) 18 174 T
(}) 18 160 T
(request_t *remove_request\050\051) 18 118 T
({request_t *request;) 18 104 T
( pthread_mutex_lock\050&requests_lock\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "11" 11
%%Page: "12" 12
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(12) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( request = requests;) 18 748 T
( requests = requests->next;) 18 734 T
( pthread_mutex_unlock\050&requests_lock\051;) 18 720 T
( return\050request\051;) 18 706 T
(}) 18 692 T
(void add_request\050request_t *request\051) 18 650 T
({) 18 636 T
( pthread_mutex_lock\050&requests_lock\051;) 18 622 T
( request->next = requests;                      /* Insert at head of list */) 18 608 T
( requests = request;) 18 594 T
( sem_getvalue\050&requests_length, &sval\051;) 18 580 T
( if \050sval+1 > max_length_empirical\051) 18 566 T
(   max_length_empirical = sval+1;) 18 552 T
( pthread_mutex_unlock\050&requests_lock\051;) 18 538 T
(}) 18 524 T
(void *producer\050void *arg\051) 18 482 T
({request_t      *request;) 18 468 T
( while\050TRUE\051) 18 440 T
(   {) 18 426 T
(     request = get_request\050\051;) 18 412 T
(     add_request\050request\051;) 18 398 T
(     sem_post\050&requests_length\051;) 18 384 T
(   }) 18 370 T
(}) 18 356 T
(void *consumer\050void *arg\051) 18 314 T
({request_t      *request;) 18 300 T
( while\050TRUE\051) 18 272 T
(   {) 18 258 T
(     SEM_WAIT\050&requests_length\051;) 18 244 T
(     request = remove_request\050\051;) 18 230 T
(     process_request\050request\051;) 18 216 T
(   }) 18 202 T
(}) 18 188 T
(main\050int argc, char **argv\051) 18 146 T
({int i;) 18 132 T
(pthread_t tid;) 18 118 T
( SEM_INIT\050&requests_length, NULL,  0\051;) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "12" 12
%%Page: "13" 13
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(13) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( PTHREAD_ATTR_INIT\050&attr\051;) 18 748 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 734 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 720 T
( if \050argc >= 2\051 GET_DELAY = atoi\050argv[1]\051;) 18 692 T
( if \050argc >= 3\051 PROCESS_DELAY = atoi\050argv[2]\051;) 18 678 T
( if \050argc >= 4\051 N_PROD        = atoi\050argv[3]\051;) 18 664 T
( if \050argc >= 5\051 N_CONS        = atoi\050argv[4]\051;) 18 650 T
( printf\050\322GET_DELAY \050ms\051 = %d PROCESS_DELAY \050ms\051 = %d N_PROD = %d N_CONS = %d\134n\323,) 18 636 T
(        GET_DELAY, PROCESS_DELAY, N_PROD, N_CONS\051;) 18 622 T
( for \050i=0; i<N_CONS; i++\051) 18 594 T
(   PTHREAD_CREATE\050&tid, &attr, consumer, NULL\051;) 18 580 T
( for \050i=0; i<N_PROD; i++\051) 18 566 T
(   PTHREAD_CREATE\050&tid, &attr, producer, NULL\051;) 18 552 T
( sleep\05020\051;) 18 524 T
( sem_getvalue\050&requests_length, &sval\051;) 18 510 T
( printf\050\322Done.\134nCurrent List length: %d Max length was: %d\134n\323,) 18 496 T
(sval, max_length_empirical\051;) 74 482 T
( exit\0500\051;) 18 468 T
(}) 18 454 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "13" 13
%%Page: "14" 14
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(14) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Ex) 146.45 732 T
(er) 190.12 732 T
(cise Objective) 223.42 732 T
2 18 Q
-0.61 (Edit the code in) 18 658 P
4 F
-1.31 (one_queue_problem.c) 154.61 658 P
2 F
-0.61 ( and \336x it so that the length) 359.81 658 P
(of the list ne) 18 636 T
(ver e) 123.75 636 T
(xceeds some n) 165.51 636 T
(umber \050sa) 294.39 636 T
(y 10\051.) 380.05 636 T
(Hint: Using) 18 570 T
4 F
(sem_getvalue\050\051) 119 570 T
2 F
( will not help!) 270.2 570 T
-0.34 (Don\325t peek at) 18 526 P
4 F
-0.72 (one_queue_solution.c) 135.02 526 P
2 F
-0.34 ( until y) 351.02 526 P
-0.34 (ou ha) 407.92 526 P
-0.34 (ve \336gured it out) 455.32 526 P
(on y) 18 504 T
(our o) 54.56 504 T
(wn! \050The objective is not to g) 99.29 504 T
(et the ans) 347.51 504 T
(wer) 431.26 504 T
(, the objective) 461.2 504 T
(is f) 18 482 T
(or y) 43.65 482 T
(ou to think about the issue) 76.21 482 T
(, so that when y) 305.42 482 T
(ou encounter) 440.01 482 T
(something similar in real code) 18 460 T
(, y) 277.27 460 T
(ou\325) 296.84 460 T
(ll be ab) 323.48 460 T
(le to deal with it!\051) 385.33 460 T
(There is reall) 18 394 T
(y onl) 128.79 394 T
(y one simple solution to the pr) 170.53 394 T
(ob) 431.23 394 T
(lem.) 453.04 394 T
(Wild Guess at Time to Completion:) 18 350 T
(30 min) 198 328 T
(utes think/design time) 254.84 328 T
(.) 445.25 328 T
(2 min) 198 306 T
(utes pr) 244.84 306 T
(ogramming/deb) 304.49 306 T
(ug) 439.15 306 T
(ging) 460.96 306 T
(My solution c) 198 284 T
(hang) 312.84 284 T
(ed 4 lines of code) 356.02 284 T
(.) 507.44 284 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "14" 14
%%Page: "15" 15
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(15) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Classic Pr) 59.29 732 T
(oducer/Consumer:) 232.67 732 T
(one_queue_) 115.96 684 T
5 F
(solution) 326.02 684 T
2 F
(.c) 466.02 684 T
4 12 Q
(/*                one_queue_solution.c                */) 18 628 T
(/*) 18 600 T
(  This is the prototypical producer/consumer example done by) 18 586 T
(  building a singly linked list.  Note the use of the semaphore) 18 572 T
(  to prevent the consumers from running when the list is empty.) 18 558 T
(  The second semaphore prevents the list from getting) 18 544 T
(  infinitely long.) 18 530 T
(  Delays are inserted to simulate disk I/O \050and to make things) 18 502 T
(  run slower!\051.) 18 488 T
(*/) 18 474 T
(/*) 18 446 T
(cc -o one_queue_solution one_queue_solution.c -L. -R. -g -lpthread -lthread -) 18 432 T
(pthread_extensions -lposix4) 18 418 T
(*/) 18 404 T
(#define _POSIX_C_SOURCE 199506L) 18 376 T
(#include <pthread.h>) 18 348 T
(#include <semaphore.h>) 18 334 T
(#include <errno.h>) 18 320 T
(#include <time.h>) 18 306 T
(#include \322thread_extensions.h\323) 18 292 T
(struct request_struct) 18 236 T
({int                    client;) 18 222 T
( char                   *buf;) 18 208 T
( pthread_t              tid;) 18 194 T
( struct request_struct  *next;) 18 180 T
(};) 18 166 T
(typedef struct request_struct request_t;) 18 152 T
(request_t               *requests = NULL;) 18 124 T
(pthread_mutex_t         requests_lock = PTHREAD_MUTEX_INITIALIZER;) 18 110 T
(pthread_attr_t          attr;) 18 96 T
(sem_t                   requests_slots, requests_length;) 18 82 T
(int) 18 68 T
(max_length_empirical = 0, sval;) 342 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "15" 15
%%Page: "16" 16
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(16) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(int                     GET_DELAY = 200, PROCESS_DELAY = 250;) 18 748 T
(int                     N_PROD = 2, N_CONS = 2;) 18 734 T
(void print_requests\050\051) 18 678 T
({request_t *r = requests;) 18 664 T
( while \050r != NULL\051) 18 636 T
(   {printf\050\322<Request: %d>\134n\323, r->client\051;) 18 622 T
(    r = r->next;) 18 608 T
(  }) 18 594 T
(}) 18 580 T
(request_t *get_request\050\051) 18 538 T
({static int count = 0;) 18 524 T
( static pthread_mutex_t mr  = PTHREAD_MUTEX_INITIALIZER;) 18 510 T
( int c;) 18 496 T
( request_t *request;) 18 482 T
( pthread_t tid = pthread_self\050\051;) 18 468 T
( delay\050GET_DELAY, 0\051;) 18 440 T
( pthread_mutex_lock\050&mr\051;) 18 426 T
( c=count++;) 18 412 T
( pthread_mutex_unlock\050&mr\051;) 18 398 T
( request = \050request_t *\051 malloc\050sizeof\050request_t\051\051;) 18 370 T
( request->client = c;                        /* Cannot use count here! */) 18 356 T
( request->tid = pthread_self\050\051;) 18 342 T
( DEBUG\050printf\050\322[%s] Creating request  %4d\134n\323, thread_name\050tid\051, c\051\051;) 18 314 T
( return\050request\051;) 18 300 T
(}) 18 286 T
(void process_request\050request_t *request\051) 18 244 T
({pthread_t tid = pthread_self\050\051;) 18 230 T
(  delay\050PROCESS_DELAY, 0\051;) 18 202 T
(  DEBUG\050printf\050\322[%s] Processed request %4d [%s]\134n\323, thread_name\050tid\051,) 18 188 T
(               request->client, thread_name\050request->tid\051\051\051;) 18 174 T
(  free\050request\051;) 18 160 T
(}) 18 146 T
(request_t *remove_request\050\051) 18 104 T
({request_t *request;) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "16" 16
%%Page: "17" 17
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(17) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_mutex_lock\050&requests_lock\051;) 18 748 T
( request = requests;) 18 734 T
( requests = requests->next;) 18 720 T
( pthread_mutex_unlock\050&requests_lock\051;) 18 706 T
( return\050request\051;) 18 692 T
(}) 18 678 T
(void add_request\050request_t *request\051) 18 636 T
({) 18 622 T
( pthread_mutex_lock\050&requests_lock\051;) 18 608 T
( request->next = requests;                      /* Insert at head of list */) 18 594 T
( requests = request;) 18 580 T
( sem_getvalue\050&requests_length, &sval\051;) 18 566 T
( if \050sval+1 > max_length_empirical\051) 18 552 T
(   max_length_empirical = sval+1;) 18 538 T
( pthread_mutex_unlock\050&requests_lock\051;) 18 524 T
(}) 18 510 T
(void *producer\050void *arg\051) 18 454 T
({request_t      *request;) 18 440 T
( while\050TRUE\051) 18 412 T
(   {) 18 398 T
(     SEM_WAIT\050&requests_slots\051;) 18 384 T
(     request = get_request\050\051;) 18 370 T
(     add_request\050request\051;) 18 356 T
(     sem_post\050&requests_length\051;) 18 342 T
(   }) 18 328 T
(}) 18 314 T
(void *consumer\050void *arg\051) 18 272 T
({request_t      *request;) 18 258 T
( while\050TRUE\051) 18 230 T
(   {) 18 216 T
(     SEM_WAIT\050&requests_length\051;) 18 202 T
(     request = remove_request\050\051;) 18 188 T
(     process_request\050request\051;) 18 174 T
(     sem_post\050&requests_slots\051;) 18 160 T
(   }) 18 146 T
(}) 18 132 T
(main\050int argc, char **argv\051) 18 90 T
({int i;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "17" 17
%%Page: "18" 18
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(18) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_t tid;) 18 748 T
( SEM_INIT\050&requests_length, NULL,  0\051;) 18 720 T
( SEM_INIT\050&requests_slots, NULL, 10\051;) 18 706 T
( PTHREAD_ATTR_INIT\050&attr\051;) 18 678 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 664 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 650 T
( if \050argc >= 2\051 GET_DELAY = atoi\050argv[1]\051;) 18 622 T
( if \050argc >= 3\051 PROCESS_DELAY = atoi\050argv[2]\051;) 18 608 T
( if \050argc >= 4\051 N_PROD        = atoi\050argv[3]\051;) 18 594 T
( if \050argc >= 5\051 N_CONS        = atoi\050argv[4]\051;) 18 580 T
( printf\050\322GET_DELAY \050ms\051 = %d PROCESS_DELAY \050ms\051 = %d N_PROD = %d N_CONS = %d\134n\323,) 18 566 T
(        GET_DELAY, PROCESS_DELAY, N_PROD, N_CONS\051;) 18 552 T
( for \050i=0; i<N_CONS; i++\051) 18 524 T
(   PTHREAD_CREATE\050&tid, &attr, consumer, NULL\051;) 18 510 T
( for \050i=0; i<N_PROD; i++\051) 18 496 T
(   PTHREAD_CREATE\050&tid, &attr, producer, NULL\051;) 18 482 T
( sleep\05020\051;) 18 454 T
( sem_getvalue\050&requests_length, &sval\051;) 18 440 T
( printf\050\322Done.\134nCurrent List length: %d Max length was: %d\134n\323,) 18 426 T
(sval, max_length_empirical\051;) 198 412 T
( exit\0500\051;) 18 398 T
(}) 18 384 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "18" 18
%%Page: "19" 19
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(19) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Using a Single Length Counter) 42.97 732 T
4 14 Q
(producer\050\051) 18 652.67 T
({while\050TRUE\051) 18 635.67 T
( {request = get_request\050\051;) 18 618.67 T
(  pthread_mutex_lock\050&m\051;) 18 601.67 T
(  while \050length>10\051) 18 584.67 T
(    pthread_cond_wait\050&producer_cv, &m\051;) 18 567.67 T
(  add\050request\051;) 18 550.67 T
(  length++;) 18 533.67 T
(  pthread_mutex_unlock\050&m\051;) 18 516.67 T
(  pthread_cond_signal\050&consumer_cv\051;) 18 499.67 T
(}}) 18 482.67 T
(consumer\050\051) 18 414.67 T
({while\050TRUE\051) 18 397.67 T
( {pthread_mutex_lock\050&m\051;) 18 380.67 T
(  while \050length==0\051) 18 363.67 T
(    pthread_cond_wait\050&consumer_cv, &m\051;) 18 346.67 T
(  request = remove\050\051;) 18 329.67 T
(  length--;) 18 312.67 T
(  pthread_mutex_unlock\050&m\051;) 18 295.67 T
(  pthread_cond_signal\050&producer_cv\051;) 18 278.67 T
(  process\050request\051;) 18 261.67 T
(}}) 18 244.67 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "19" 19
%%Page: "20" 20
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(20) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 133 549 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
301.65 680.21 M
 304.09 687.34 292.39 693.97 284.74 685.21 D
 277.05 676.4 267.62 697.93 254.15 681.88 D
3 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
90 450 1.5 1.5 90 278.32 661.69 GG
278.32 663.19 274.52 663.19 278.32 676.44 282.12 663.19 4 Y
0 Z
N
278.32 663.19 274.52 663.19 278.32 676.44 282.12 663.19 4 Y
V
278.32 661.69 278.32 651.88 2 L
2 Z
N
428.09 485.14 M
 430.53 492.27 418.83 498.9 411.18 490.14 D
 403.49 481.32 394.07 502.85 380.59 486.8 D
N
90 450 1.5 1.5 90 404.76 466.62 GG
404.76 468.12 400.96 468.12 404.76 481.36 408.56 468.12 4 Y
0 Z
N
404.76 468.12 400.96 468.12 404.76 481.36 408.56 468.12 4 Y
V
404.76 466.62 404.76 456.8 2 L
2 Z
N
2 18 Q
(if \050\336nd_pid\050\051\051) 0 -90 412.55 424.41 TF
(pthread_cancel\050...\051) 0 -90 394.67 412.1 TF
341.25 490.14 M
 343.69 497.27 331.99 503.9 324.34 495.14 D
 316.65 486.32 307.22 507.85 293.75 491.8 D
N
90 450 1.5 1.5 90 317.92 471.61 GG
317.92 473.11 314.12 473.11 317.92 486.36 321.71 473.11 4 Y
0 Z
N
317.92 473.11 314.12 473.11 317.92 486.36 321.71 473.11 4 Y
V
317.92 471.61 317.92 461.8 2 L
2 Z
N
(if \050\336nd_pid\050\051\051) 0 -90 325.71 429.4 TF
(pthread_cancel\050...\051) 0 -90 307.83 417.09 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
239.73 489.46 M
 242.17 496.59 230.47 503.22 222.82 494.46 D
 215.13 485.64 205.71 507.17 192.23 491.12 D
N
90 450 1.5 1.5 90 216.4 470.94 GG
216.4 472.44 212.6 472.44 216.4 485.68 220.2 472.44 4 Y
0 Z
N
216.4 472.44 212.6 472.44 216.4 485.68 220.2 472.44 4 Y
V
216.4 470.94 216.4 461.12 2 L
2 Z
N
(if \050\336nd_pid\050\051\051) 0 -90 224.19 428.73 TF
(pthread_cancel\050...\051) 0 -90 206.32 416.42 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
145.86 483.7 M
 148.3 490.83 136.6 497.46 128.95 488.7 D
 121.25 479.88 111.83 501.41 98.36 485.36 D
N
90 450 1.5 1.5 90 122.52 465.18 GG
122.52 466.68 118.73 466.68 122.52 479.92 126.32 466.68 4 Y
0 Z
N
122.52 466.68 118.73 466.68 122.52 479.92 126.32 466.68 4 Y
V
122.52 465.18 122.52 455.36 2 L
2 Z
N
(if \050\336nd_pid\050\051\051) 0 -90 130.31 422.97 TF
(pthread_cancel\050...\051) 0 -90 112.44 410.66 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
380.48 443.64 377.95 444.4 383.15 452.47 383.01 442.87 4 Y
1 H
0 Z
N
380.48 443.64 377.95 444.4 383.15 452.47 383.01 442.87 4 Y
V
313.91 272.49 M
 372.65 306.61 362.52 384.33 380.33 443.16 D
2 Z
N
259.77 463.07 257.9 461.21 253.29 469.59 261.64 464.93 4 Y
0 Z
N
259.77 463.07 257.9 461.21 253.29 469.59 261.64 464.93 4 Y
V
305.99 270.33 M
 244.45 312.34 311.12 411.4 260.12 462.71 D
2 Z
N
157.73 459.32 155.36 458.15 153.65 467.58 160.1 460.48 4 Y
0 Z
N
157.73 459.32 155.36 458.15 153.65 467.58 160.1 460.48 4 Y
V
308.15 267.45 M
 263.63 247.12 216.66 186.5 191.95 235.88 D
 162.89 293.93 178.07 359.58 162.91 420.88 D
 160 432.61 163.63 447.35 157.95 458.87 D
2 Z
N
377.77 544.92 380.34 545.54 379.92 535.97 375.21 544.31 4 Y
0 Z
N
377.77 544.92 380.34 545.54 379.92 535.97 375.21 544.31 4 Y
V
293.03 651.92 M
 337.8 633.13 366.67 591.12 377.66 545.41 D
2 Z
N
313.32 516.53 315.87 517.21 315.71 507.63 310.77 515.84 4 Y
0 Z
N
313.32 516.53 315.87 517.21 315.71 507.63 310.77 515.84 4 Y
V
282.23 647.6 M
 287.77 617.78 303.44 553.25 313.19 517.01 D
2 Z
N
218.93 519.38 221.57 519.52 219.42 510.19 216.3 519.24 4 Y
0 Z
N
218.93 519.38 221.57 519.52 219.42 510.19 216.3 519.24 4 Y
V
267.11 647.6 M
 219.92 622.08 216.39 567.66 218.91 519.88 D
2 Z
N
120.94 518.53 123.57 518.79 121.84 509.35 118.31 518.28 4 Y
0 Z
N
120.94 518.53 123.57 518.79 121.84 509.35 118.31 518.28 4 Y
V
262.07 659.12 M
 183.88 658.06 113.28 597.1 120.89 519.03 D
2 Z
N
2 32 Q
(Cancellation) 0 -90 502.06 512.24 TF
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "20" 20
%%Page: "21" 21
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(21) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Cancellation:) 192.98 732 T
(cancellation.c) 186.95 684 T
4 12 Q
(/*                cancellation.c                */) 18 614 T
(/*) 18 586 T
(   This program does a heuristic search for an integer, then cancels) 18 572 T
(   all threads that didn\325t find it.  The actual heuristic is silly) 18 558 T
(   \050it calls rand_r\050\051\051, but the technique is valid.) 18 544 T
(   All of the calls to delay\050\051 are there to slow things down and) 18 516 T
(   make different contention situations more likely.) 18 502 T
(   A couple of simple cleanup handlers are included.  In a real) 18 474 T
(   program, these would be even more complex.) 18 460 T
(   NB: sem_trywait\050\051 EBUSY in 2.5 is a bug.) 18 432 T
(   It *should* be EAGAIN \050fixed in 2.6\051.) 18 418 T
(*/) 18 404 T
(/*) 18 376 T
(cc -o cancellation cancellation.c -L. -R. -g -lpthread -lthread -) 18 362 T
(pthread_extensions -lposix4) 18 348 T
(*/) 18 334 T
(#define _POSIX_C_SOURCE 199506L) 18 306 T
(#include <stdio.h>) 18 292 T
(#include <stdlib.h>) 18 278 T
(#include <unistd.h>) 18 264 T
(#include <pthread.h>) 18 250 T
(#include <semaphore.h>) 18 236 T
(#include <errno.h>) 18 222 T
(#include \322thread_extensions.h\323) 18 208 T
(#ifdef __sun2_5                 /* This is a bug in Solaris 2.5 */) 18 180 T
(#define MY_EAGAIN EBUSY) 18 166 T
(#else) 18 152 T
(#define MY_EAGAIN EAGAIN        /* Correct errno value from trywait\050\051 */) 18 138 T
(#endif) 18 124 T
(#define NUM_THREADS 25          /* the number of searching threads */) 18 96 T
(pthread_attr_t  attr;) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "21" 21
%%Page: "22" 22
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(22) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(pthread_t       threads[NUM_THREADS];) 18 748 T
(pthread_mutex_t threads_lock = PTHREAD_MUTEX_INITIALIZER;) 18 734 T
(pthread_mutex_t wait_lock    = PTHREAD_MUTEX_INITIALIZER;) 18 720 T
(pthread_mutex_t rand_lock    = PTHREAD_MUTEX_INITIALIZER;) 18 706 T
(sem_t           death_lock;     /* I\325m using it like a lock */) 18 692 T
(pthread_mutex_t count_lock   = PTHREAD_MUTEX_INITIALIZER;) 18 678 T
(pthread_cond_t  wait_cv      = PTHREAD_COND_INITIALIZER;) 18 664 T
(sem_t           cancel_barrier;) 18 650 T
(int answer;             /* Protected by death_lock */) 18 636 T
(void count_tries\050int i\051         /* Note the encapsulation */) 18 594 T
({static int count=0, old_count=0, max_count = 0;) 18 580 T
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 18 566 T
( pthread_mutex_lock\050&count_lock\051;) 18 538 T
( count += i;) 18 524 T
( if \050i == -1\051 printf\050\322\134n\134nTotal attempt count: %d\134n\323, max_count\051;) 18 510 T
( if \050count > max_count\051) 18 496 T
(   max_count = count;) 18 482 T
( pthread_mutex_unlock\050&count_lock\051;) 18 468 T
(}) 18 454 T
(void cleanup_count\050void *arg\051) 18 412 T
({int *ip = \050int *\051 arg;) 18 398 T
( int i = *ip;) 18 384 T
( pthread_t tid = pthread_self\050\051;) 18 370 T
( char *name = thread_name\050tid\051;) 18 356 T
( count_tries\050i\051;) 18 328 T
( printf\050\322%s exited \050maybe cancelled\051 on its %d try.\134n\323, name, i\051;) 18 314 T
( /* Note that you can\325t tell if the thread exited, or was cancelled. */) 18 300 T
(}) 18 286 T
(void cleanup_lock\050void *arg\051) 18 244 T
({pthread_t tid = pthread_self\050\051;) 18 230 T
( char *name = thread_name\050tid\051;) 18 216 T
(  printf\050\322Freeing & releasing: %s\134n\323, name\051;) 18 188 T
(  free\050arg\051;) 18 174 T
(  pthread_mutex_unlock\050&rand_lock\051;) 18 160 T
(        /* This would be hard to do in a real program. */) 18 146 T
(}) 18 132 T
(void *search\050void *arg\051) 18 90 T
({char *p;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "22" 22
%%Page: "23" 23
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(23) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( unsigned int seed;) 18 748 T
( int i=0, j, err, guess, target = \050int\051 arg;) 18 734 T
( pthread_t tid = pthread_self\050\051;) 18 720 T
( char *name = thread_name\050tid\051;) 18 706 T
( seed = \050unsigned int\051 tid;) 18 678 T
( pthread_cleanup_push\050cleanup_count, \050void *\051 &i\051; /* Q: Why &i ? */) 18 650 T
( pthread_setcanceltype\050PTHREAD_CANCEL_DEFERRED, NULL\051;) 18 636 T
( pthread_setcancelstate\050PTHREAD_CANCEL_ENABLE, NULL\051;) 18 622 T
( sem_post\050&cancel_barrier\051;     /* Don\325t start cancelling before here!   8 */) 18 608 T
( while \0501\051) 18 580 T
(   {i++;) 18 566 T
(        /* Extra stuff to make it more realistic and complex. */) 18 538 T
(    pthread_mutex_lock\050&rand_lock\051;) 18 524 T
(    p = \050char *\051 malloc\05010\051;            /* Must free this up! */) 18 510 T
(        /* Q:  What if you allow cancellation here? */) 18 496 T
(    pthread_cleanup_push\050cleanup_lock, \050void *\051 p\051;     /*  4 */) 18 482 T
(    guess = rand_r\050&seed\051;) 18 468 T
(    delay\0500, 10\051;) 18 454 T
(    pthread_testcancel\050\051;                               /*  5 */) 18 440 T
(    pthread_cleanup_pop\0500\051;) 18 426 T
(    /* Q:  What if you allow cancellation here? */      /*  6 */) 18 412 T
(    free\050p\051;) 18 398 T
(    pthread_mutex_unlock\050&rand_lock\051;) 18 384 T
(    delay\0500, 10\051;) 18 356 T
(    if \050target == guess\051) 18 328 T
(      {printf\050\322%s found the number on try %d!\134n\323, name, i\051; /*  7 */) 18 314 T
(       /* I could also simply do a sem_wait\050\051 and let cancellation work. */) 18 300 T
(       while \050\050\050err = sem_trywait\050&death_lock\051\051 == -1\051 && \050errno == EINTR\051\051 ;) 18 286 T
(       if \050\050err == -1\051 && \050errno == MY_EAGAIN\051\051) 18 272 T
(         /*  1 */) 18 258 T
(         {printf\050\322%s Exiting...\134n\323, name\051;) 18 244 T
(           pthread_exit\050NULL\051;                  /*  3 */) 18 230 T
(         }) 18 216 T
(       answer = guess;) 18 202 T
(       delay\0505000, 0\051;  /* Encourage a few more threads to find it. */) 18 188 T
(       /* Make sure all threads have gotten to #8 before cancelling */) 18 160 T
(       thread_single_barrier\050&cancel_barrier, NUM_THREADS\051;) 18 146 T
(       pthread_mutex_lock\050&threads_lock\051;) 18 132 T
(       for \050j=0;j<NUM_THREADS;j++\051) 18 118 T
(         if \050!pthread_equal\050threads[j], tid\051\051) 18 104 T
(           if \050pthread_cancel\050threads[j]\051 == ESRCH\051     /*  2 */) 18 90 T
(             printf\050\322Missed thread %s\134n\323, thread_name\050threads[j]\051\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "23" 23
%%Page: "24" 24
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(24) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(       pthread_mutex_unlock\050&threads_lock\051;) 18 748 T
(       break;                   /* Cannot release death_lock yet! */) 18 734 T
(     }) 18 720 T
(    pthread_testcancel\050\051;       /* Insert a known cancellation point */) 18 706 T
(  }) 18 692 T
( pthread_cleanup_pop\0501\051;) 18 678 T
( pthread_exit\050NULL\051;) 18 664 T
(}) 18 650 T
(start_searches\050\051) 18 608 T
({int i, pid, n_cancelled=0, status;) 18 594 T
( pthread_t tid;) 18 580 T
( pid = getpid\050\051;) 18 552 T
( while \050pid > RAND_MAX\051) 18 524 T
(     pid /= 2;) 18 510 T
( printf\050\322\134n\134nSearching for the number = %d...\134n\323, pid\051;) 18 482 T
( pthread_mutex_lock\050&threads_lock\051;   /* Q: Why do we need threads_lock ? */) 18 454 T
( for \050i=0;i<NUM_THREADS;i++\051) 18 440 T
(   PTHREAD_CREATE\050&threads[i], &attr, search, \050void *\051pid\051;) 18 426 T
( pthread_mutex_unlock\050&threads_lock\051;) 18 412 T
( for \050i=0;i<NUM_THREADS;i++\051) 18 384 T
(   {pthread_mutex_lock\050&threads_lock\051;) 18 370 T
(    tid = threads[i];                      /* Actually a constant now */) 18 356 T
(    pthread_mutex_unlock\050&threads_lock\051;   /* Q: Why like this? */) 18 342 T
(    pthread_join\050tid, \050void **\051 &status\051;) 18 328 T
(    if \050\050void *\051status == \050void *\051PTHREAD_CANCELED\051 n_cancelled++;) 18 314 T
(  }) 18 300 T
( sem_post\050&death_lock\051;         /* Cannot release any earlier! */) 18 286 T
( count_tries\050-1\051;) 18 272 T
( printf\050\322%d of the threads were cancelled.\134n\323, n_cancelled\051;) 18 258 T
( printf\050\322The answer was: %d\134n\323, answer\051;) 18 244 T
(}) 18 230 T
(main\050\051) 18 188 T
({int i;) 18 174 T
( PTHREAD_ATTR_INIT\050&attr\051;) 18 146 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 132 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_JOINABLE\051;/* Also default */) 18 118 T
( SEM_INIT\050&death_lock, NULL, 1\051;) 18 104 T
( SEM_INIT\050&cancel_barrier, NULL, 0\051;) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "24" 24
%%Page: "25" 25
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(25) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( for \050i=0; i<2; i++\051) 18 748 T
(   start_searches\050\051;) 18 734 T
( printf\050\322Done\134n\323\051;) 18 706 T
( exit\0500\051;) 18 692 T
(}) 18 678 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "25" 25
%%Page: "26" 26
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(26) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Cancellation:) 192.98 732 T
(cancellation_not.c) 148.95 684 T
4 12 Q
(/*                cancellation_not.c                */) 18 628 T
(/*) 18 600 T
(   This program does a heuristic search for an integer, then cancels) 18 586 T
(   all threads that didn\325t find it.  The actual heuristic is silly) 18 572 T
(   \050it calls rand_r\050\051\051, but the technique is valid.) 18 558 T
(   All of the calls to delay\050\051 are there to slow things down and) 18 530 T
(   make different contention situations more likely.) 18 516 T
(   A couple of simple cleanup handlers are included.  In a real) 18 488 T
(   program, these would be even more complex.) 18 474 T
(   NB: sem_trywait\050\051 EBUSY in 2.5 is a bug.) 18 446 T
(   It *should* be EAGAIN \050fixed in 2.6\051.) 18 432 T
(*/) 18 418 T
(/*) 18 390 T
(cc -o cancellation cancellation.c -L. -R. -g -lpthread -lthread -) 18 376 T
(pthread_extensions -lposix4) 18 362 T
(*/) 18 348 T
(#define _POSIX_C_SOURCE 199506L) 18 320 T
(#include <stdio.h>) 18 306 T
(#include <stdlib.h>) 18 292 T
(#include <unistd.h>) 18 278 T
(#include <pthread.h>) 18 264 T
(#include <semaphore.h>) 18 250 T
(#include <errno.h>) 18 236 T
(#include \322thread_extensions.h\323) 18 222 T
(#ifdef __sun2_5                 /* This is a bug in Solaris 2.5 */) 18 194 T
(#define MY_EBUSY EBUSY) 18 180 T
(#else) 18 166 T
(#define MY_EBUSY EAGAIN         /* Correct errno value from trywait\050\051 */) 18 152 T
(#endif) 18 138 T
(#define NUM_THREADS 25          /* the number of searching threads */) 18 110 T
(pthread_attr_t  attr;) 18 82 T
(pthread_t       threads[NUM_THREADS];) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "26" 26
%%Page: "27" 27
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(27) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(pthread_mutex_t threads_lock = PTHREAD_MUTEX_INITIALIZER;) 18 748 T
(pthread_mutex_t wait_lock    = PTHREAD_MUTEX_INITIALIZER;) 18 734 T
(pthread_mutex_t rand_lock    = PTHREAD_MUTEX_INITIALIZER;) 18 720 T
(sem_t           death_lock;     /* I\325m using it like a lock */) 18 706 T
(pthread_mutex_t count_lock   = PTHREAD_MUTEX_INITIALIZER;) 18 692 T
(pthread_cond_t  wait_cv      = PTHREAD_COND_INITIALIZER;) 18 678 T
(pthread_mutex_t cancel_lock   = PTHREAD_MUTEX_INITIALIZER;) 18 650 T
(int             time_to_die;) 18 636 T
(int answer;             /* Protected by death_lock */) 18 608 T
(void my_testcancel\050\051) 18 566 T
({int die;) 18 552 T
( if \050time_to_die\051       /* Quick test w/o mutex.  Might be TRUE in error. */) 18 524 T
(   {pthread_mutex_lock\050&cancel_lock\051;) 18 510 T
(    die = time_to_die;) 18 496 T
(    pthread_mutex_unlock\050&cancel_lock\051;) 18 482 T
(    /* NB: This will run the cleanup handlers. */) 18 468 T
(    if \050die\051 pthread_exit\050\050void *\051PTHREAD_CANCELED\051;) 18 454 T
(  }) 18 440 T
(}) 18 426 T
(void count_tries\050int i\051         /* Note the encapsulation */) 18 398 T
({static int count=0, old_count=0, max_count = 0;) 18 384 T
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 18 370 T
( pthread_mutex_lock\050&count_lock\051;) 18 342 T
( count += i;) 18 328 T
( if \050i == -1\051 printf\050\322\134n\134nTotal attempt count: %d\134n\323, max_count\051;) 18 314 T
( if \050count > max_count\051) 18 300 T
(   max_count = count;) 18 286 T
( pthread_mutex_unlock\050&count_lock\051;) 18 272 T
(}) 18 258 T
(void cleanup_count\050void *arg\051) 18 216 T
({int *ip = \050int *\051 arg;) 18 202 T
( int i = *ip;) 18 188 T
( pthread_t tid = pthread_self\050\051;) 18 174 T
( char *name = thread_name\050tid\051;) 18 160 T
( count_tries\050i\051;) 18 132 T
( printf\050\322%s exited \050maybe cancelled\051 on its %d try.\134n\323, name, i\051;) 18 118 T
( /* Note that you can\325t tell if the thread exited, or was cancelled. */) 18 104 T
(}) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "27" 27
%%Page: "28" 28
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(28) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(void cleanup_lock\050void *arg\051) 18 734 T
({pthread_t tid = pthread_self\050\051;) 18 720 T
( char *name = thread_name\050tid\051;) 18 706 T
(  printf\050\322Freeing & releasing: %s\134n\323, name\051;) 18 678 T
(  free\050arg\051;) 18 664 T
(  pthread_mutex_unlock\050&rand_lock\051;) 18 650 T
(        /* This would be hard to do in a real program. */) 18 636 T
(}) 18 622 T
(void *search\050void *arg\051) 18 580 T
({char *p;) 18 566 T
( unsigned int seed;) 18 552 T
( int i=0, j, err, guess, target = \050int\051 arg;) 18 538 T
( pthread_t tid = pthread_self\050\051;) 18 524 T
( char *name = thread_name\050tid\051;) 18 510 T
( seed = \050unsigned int\051 tid;) 18 482 T
( pthread_setcanceltype\050PTHREAD_CANCEL_DEFERRED, NULL\051;) 18 454 T
( pthread_setcancelstate\050PTHREAD_CANCEL_ENABLE, NULL\051;) 18 440 T
( pthread_cleanup_push\050cleanup_count, \050void *\051 &i\051; /* Q: Why &i ? */) 18 426 T
( while \0501\051) 18 398 T
(   {i++;) 18 384 T
(        /* Extra stuff to make it more realistic and complex. */) 18 356 T
(    pthread_mutex_lock\050&rand_lock\051;) 18 342 T
(    p = \050char *\051 malloc\05010\051;            /* Must free this up! */) 18 328 T
(        /* Q:  What if you allow cancellation here? */) 18 314 T
(    pthread_cleanup_push\050cleanup_lock, \050void *\051 p\051;     /*   4 */) 18 300 T
(    guess = rand_r\050&seed\051;) 18 286 T
(    delay\0500, 10\051;) 18 272 T
(    my_testcancel\050\051;                            /*   5 */) 18 258 T
(    pthread_cleanup_pop\0500\051;) 18 244 T
(    /* Q:  What if you allow cancellation here? */      /*   6 */) 18 230 T
(    free\050p\051;) 18 216 T
(    pthread_mutex_unlock\050&rand_lock\051;) 18 202 T
(    delay\0500, 10\051;) 18 174 T
(    if \050target == guess\051) 18 146 T
(      {printf\050\322%s found the number on try %d!\134n\323, name, i\051; /*   7 */) 18 132 T
(       /* I could also simply do a sem_wait\050\051 and let cancellation work. */) 18 118 T
(       while \050\050\050err = sem_trywait\050&death_lock\051\051 == -1\051 && \050errno == EINTR\051\051 ;) 18 104 T
(       if \050\050err == -1\051 && \050errno == MY_EBUSY\051\051   /*  1 */) 18 90 T
(         {printf\050\322%s Exiting...\134n\323, name\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "28" 28
%%Page: "29" 29
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(29) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(           pthread_exit\050NULL\051;                  /*   3 */) 18 748 T
(         }) 18 734 T
(       delay\0505000, 0\051;  /* Encourage a few more threads to find it. */) 18 720 T
(       answer = guess;) 18 706 T
(       pthread_mutex_lock\050&cancel_lock\051;) 18 692 T
(       time_to_die = TRUE;) 18 678 T
(       pthread_mutex_unlock\050&cancel_lock\051;) 18 664 T
(       break;                   /* Cannot release death_lock yet! */) 18 650 T
(     }) 18 636 T
(    my_testcancel\050\051;    /* Insert a known cancellation point */) 18 622 T
(  }) 18 608 T
( pthread_cleanup_pop\0501\051;) 18 594 T
( pthread_exit\050NULL\051;) 18 580 T
(}) 18 566 T
(start_searches\050\051) 18 524 T
({int i, pid, n_cancelled=0, status;) 18 510 T
( pthread_t tid;) 18 496 T
( pid = getpid\050\051;) 18 468 T
( while \050pid > RAND_MAX\051) 18 440 T
(     pid /= 2;) 18 426 T
( pthread_mutex_lock\050&cancel_lock\051;) 18 412 T
( time_to_die = FALSE;) 18 398 T
( pthread_mutex_unlock\050&cancel_lock\051;) 18 384 T
( printf\050\322\134n\134nSearching for the number = %d...\134n\323, pid\051;) 18 342 T
( pthread_mutex_lock\050&threads_lock\051;   /* Q: Why do we need threads_lock ? */) 18 314 T
( for \050i=0;i<NUM_THREADS;i++\051) 18 300 T
(   PTHREAD_CREATE\050&threads[i], &attr, search, \050void *\051pid\051;) 18 286 T
( pthread_mutex_unlock\050&threads_lock\051;) 18 272 T
( for \050i=0;i<NUM_THREADS;i++\051) 18 244 T
(   {pthread_mutex_lock\050&threads_lock\051;) 18 230 T
(    tid = threads[i];                      /* Actually a constant now */) 18 216 T
(    pthread_mutex_unlock\050&threads_lock\051;   /* Q: Why like this? */) 18 202 T
(    pthread_join\050tid, \050void **\051 &status\051;) 18 188 T
(    if \050\050void *\051status == \050void *\051PTHREAD_CANCELED\051 n_cancelled++;) 18 174 T
(  }) 18 160 T
( sem_post\050&death_lock\051;         /* Cannot release any earlier! */) 18 146 T
( count_tries\050-1\051;) 18 132 T
( printf\050\322%d of the threads were cancelled.\134n\323, n_cancelled\051;) 18 118 T
( printf\050\322The answer was: %d\134n\323, answer\051;) 18 104 T
(}) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "29" 29
%%Page: "30" 30
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(30) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(main\050\051) 18 734 T
({int i;) 18 720 T
( PTHREAD_ATTR_INIT\050&attr\051;) 18 692 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 678 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_JOINABLE\051;/* Also default */) 18 664 T
( SEM_INIT\050&death_lock, NULL, 1\051;) 18 650 T
( for \050i=0; i<2; i++\051) 18 622 T
(   start_searches\050\051;) 18 608 T
( printf\050\322Done\134n\323\051;) 18 580 T
( exit\0500\051;) 18 566 T
(}) 18 552 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "30" 30
%%Page: "31" 31
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(31) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 63 594 756 C
18 99 594 738 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
3 H
0 Z
0 X
0 0 0 1 0 0 0 K
90 450 55.5 75.52 270 229.23 313.1 AA
214.68 329.39 245.43 393.46 R
7 X
V
0.5 H
0 X
N
214.68 238.27 245.43 287.97 R
7 X
V
0 X
N
2 14 Q
(Read) 0 -90 225.44 278.57 TF
(Ex) 0 -90 225.44 388.95 TF
(ecute) 0 -90 225.44 371.97 TF
90 450 1.5 1.5 190.68 260.63 263.12 GG
259.15 262.84 259.58 260.6 251.33 261.37 258.73 265.09 4 Y
3 H
N
259.15 262.84 259.58 260.6 251.33 261.37 258.73 265.09 4 Y
V
263.56 263.67 260.63 263.12 2 L
7 X
V
2 Z
0 X
N
90 450 1.5 1.5 16.27 199.94 363.91 GG
201.38 364.33 200.75 366.49 208.9 366.53 202.01 362.17 4 Y
0 Z
N
201.38 364.33 200.75 366.49 208.9 366.53 202.01 362.17 4 Y
V
197.1 363.08 199.94 363.91 2 L
7 X
V
2 Z
0 X
N
4 F
(WorkComplete\050\051) 0 -90 169.31 629.41 TF
({... revert button ...}) 0 -90 155.58 629.41 TF
(ButtonPushed\050\051) 0 -90 289.84 648.32 TF
({.. invert button ...) 0 -90 276.11 648.32 TF
254.14 423.35 252.07 425 259.87 430.58 256.22 421.71 4 Y
1 H
0 Z
N
254.14 423.35 252.07 425 259.87 430.58 256.22 421.71 4 Y
V
231.85 395.24 253.83 422.96 2 L
7 X
V
2 Z
0 X
N
185.54 428.07 184.01 425.91 178.02 433.4 187.07 430.23 4 Y
0 Z
N
185.54 428.07 184.01 425.91 178.02 433.4 187.07 430.23 4 Y
V
231.85 395.24 185.95 427.78 2 L
7 X
V
2 Z
0 X
N
2 F
(Pipe) 0 -90 139.21 189.41 TF
(Mouse) 0 -90 291.51 264.84 TF
197.22 240.19 195.43 242.13 204.01 246.43 199.01 238.24 4 Y
0 Z
N
197.22 240.19 195.43 242.13 204.01 246.43 199.01 238.24 4 Y
V
153.71 181.38 185.02 212.31 166.9 212.31 196.85 239.85 4 L
2 Z
N
260.79 248.88 261.08 246.25 251.63 247.86 260.5 251.51 4 Y
0 Z
N
260.79 248.88 261.08 246.25 251.63 247.86 260.5 251.51 4 Y
V
283.33 236.61 265.2 236.61 269.6 249.87 261.29 248.94 4 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
(DoWork\050\051) 0 -90 412.26 351.61 TF
({sleep\0506\051;) 0 -90 394.26 351.61 TF
(write\050Pipe\051;) 0 -90 376.89 351.61 TF
(}) 0 -90 358.26 351.61 TF
( pthread_create\050DoWork\051;}) 0 -90 262.11 648.32 TF
2 36 Q
(Windo) 0 -90 532.15 543.6 TF
(w T) 0 -90 532.15 434.16 TF
(oolkits) 0 -90 532.15 377.03 TF
4 14 Q
(% ThreadWin [MT]) 0 -90 450.24 665.4 TF
18 63 594 756 C
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "31" 31
%%Page: "32" 32
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(32) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Threads and X11:) 155.95 732 T
(ThreadWin.c) 197.98 684 T
4 12 Q
( /*                ThreadWin.c                */) 18 614 T
(/*) 18 586 T
(  Simple window program that inverts the colour of each button for) 18 572 T
(  6 seconds.) 18 558 T
(  In the non-threaded version, it hangs for 6 seconds with the GUI) 18 530 T
(  inactive \050tho events are queued\051.  In the MT version, it spawns off) 18 516 T
(  a new thread to do that long \322calculation\323, hence the GUI remains) 18 502 T
(  active.  Upon completion, the thread writes to a pipe.  The X) 18 488 T
(  notifier reads from that pipe and inverts the colour back to the) 18 474 T
(  original colour.) 18 460 T
(*/) 18 446 T
(/*) 18 432 T
(cc -o ThreadWin ThreadWin.c -L. -R. -g -lpthread -lthread -pthread_extensions -) 18 418 T
(lposix4 -I/usr/dt/include -I/usr/openwin/include -L/usr/openwin/lib -L/usr/dt/) 18 404 T
(lib -R/usr/openwin/lib -R/usr/dt/lib -lXm -lXt -lX11 -lm) 18 390 T
(*/) 18 362 T
(#define _POSIX_C_SOURCE 199506L) 18 334 T
(#include <stdio.h>) 18 320 T
(#include <unistd.h>) 18 306 T
(#include <stdlib.h>) 18 292 T
(#include <math.h>) 18 278 T
(#include <X11/Intrinsic.h>) 18 264 T
(#include <X11/X.h>) 18 250 T
(#include <X11/StringDefs.h>) 18 236 T
(#include <Xm/Xm.h>) 18 222 T
(#include <Xm/RowColumn.h>) 18 208 T
(#include <Xm/PushB.h>) 18 194 T
(#include <pthread.h>) 18 180 T
(#include \322thread_extensions.h\323) 18 166 T
(#define READ 0) 18 138 T
(#define WRITE 1) 18 124 T
(/* function prototypes */) 18 82 T
(int                     ButtonPushed\050Widget, XtPointer\051;) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "32" 32
%%Page: "33" 33
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(33) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(void                    *DoWork\050void *\051;) 18 748 T
(XtAppContext            _XtDefaultAppContext\050\051;) 18 734 T
(XtInputCallbackProc     WorkComplete\050\051;) 18 720 T
(static int              message[2];) 18 706 T
(pthread_attr_t          attr;) 18 692 T
(main\050int argc, char **argv\051) 18 650 T
({Widget                 toplevel, base, button[200];) 18 636 T
( Arg                    wargs[10];) 18 622 T
( int                    i, MT=0, N_BUTTONS=25;) 18 608 T
( char                   but_label[5];) 18 594 T
( XEvent                 event, fake;) 18 580 T
( Display                *disp;) 18 566 T
( Window                 win;) 18 552 T
( XtAppContext           app;) 18 538 T
( pthread_t              tid;) 18 524 T
( /* check arguments */) 18 496 T
( if \050argc > 2\051) 18 482 T
(   printf\050\322Usage: %s [MT]\134n\323, argv[0]\051, exit\0500\051;) 18 468 T
( if \050argc == 2 && strcmp\050argv[1], \322MT\323\051 == 0\051 MT = 1;) 18 440 T
( if \050pipe\050message\051 < 0\051) 18 412 T
(   {fprintf\050stderr, \322Can\325t open pipe\134n\323\051;) 18 398 T
(    exit\0501\051;) 18 384 T
(  }) 18 370 T
( PTHREAD_ATTR_INIT\050&attr\051;) 18 356 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 342 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 328 T
( PTHREAD_CREATE\050&tid, &attr, killer, \050void *\051 60\051;) 18 314 T
( /* setup our main window */) 18 286 T
( toplevel=XtInitialize\050argv[0], \322ThreadWin\323, NULL, 0, &argc, argv\051;) 18 272 T
( /* set some arguments for our Row/Column Widget */) 18 244 T
( XtSetArg\050wargs[0], XmNorientation, XmHORIZONTAL\051;) 18 230 T
( XtSetArg\050wargs[1], XmNentryAlignment, XmALIGNMENT_CENTER\051;) 18 216 T
( XtSetArg\050wargs[2], XmNisAligned, True\051;) 18 202 T
( XtSetArg\050wargs[3], XmNnumColumns, \050int\051floor\050sqrt\050\050double\051N_BUTTONS\051\051\051;) 18 188 T
( XtSetArg\050wargs[4], XmNpacking, XmPACK_COLUMN\051;) 18 174 T
( /* create the Row/Column Widget */) 18 146 T
( base=XtCreateManagedWidget\050\322base\323, xmRowColumnWidgetClass,) 18 132 T
(                            toplevel, wargs, 5\051;) 18 118 T
( /* create the button widgets with the button number as it label */) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "33" 33
%%Page: "34" 34
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(34) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( for \050i=0;i<N_BUTTONS;i++\051) 18 748 T
(   {sprintf\050but_label, \322 %d \322, i\051;) 18 734 T
(    XtSetArg\050wargs[0], XmNlabelString,) 18 720 T
(             XmStringCreate\050but_label, XmSTRING_DEFAULT_CHARSET\051\051;) 18 706 T
(    button[i] = XmCreatePushButton\050base, \322button\323, wargs, 1\051;) 18 692 T
(    /* tell the button to call ButtonPushed\050\051 when pushed */) 18 664 T
(    XtAddCallback\050button[i], XmNactivateCallback,) 18 650 T
(                  \050XtCallbackProc\051 ButtonPushed, \050void *\051MT\051;) 18 636 T
(  }) 18 622 T
( /* manage the buttons and go into the X event loop */) 18 594 T
( XtManageChildren\050button, N_BUTTONS\051;) 18 580 T
( XtRealizeWidget\050toplevel\051;) 18 566 T
( app = _XtDefaultAppContext\050\051;) 18 552 T
( XtAppAddInput\050app, message[READ], \050void *\051XtInputReadMask,) 18 538 T
(               \050XtInputCallbackProc\051WorkComplete, NULL\051;) 18 524 T
( XtMainLoop\050\051;) 18 510 T
(}) 18 496 T
(XtInputCallbackProc WorkComplete\050\051) 18 454 T
({Pixel          fg, bg;) 18 440 T
( Arg            warg[2];) 18 426 T
( Widget         w;) 18 412 T
( if \050read\050message[READ], &w, sizeof\050w\051\051 != sizeof\050w\051\051) 18 384 T
(   {fprintf\050stderr, \322Read error\134n\323\051;) 18 370 T
(   exit\0501\051;) 18 356 T
( }) 18 342 T
( /* get the buttons foreground and background colors */) 18 314 T
( XtSetArg\050warg[0], XmNforeground, &fg\051;) 18 300 T
( XtSetArg\050warg[1], XmNbackground, &bg\051;) 18 286 T
( XtGetValues\050w, warg, 2\051;) 18 272 T
( /* swap the buttons foreground and background colors */) 18 244 T
( XtSetArg\050warg[0], XmNforeground, bg\051;) 18 230 T
( XtSetArg\050warg[1], XmNbackground, fg\051;) 18 216 T
( XtSetValues\050w, warg, 2\051;) 18 202 T
( XtSetSensitive\050w, True\051;) 18 174 T
( return\050\050XtInputCallbackProc\0510\051;) 18 160 T
(}) 18 146 T
(/*) 18 118 T
(        Button callback routine -- Called when a button is pushed) 18 104 T
(*/) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "34" 34
%%Page: "35" 35
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(35) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(int ButtonPushed\050Widget w, XtPointer MT\051) 18 748 T
({int            mt = \050int\051 MT;) 18 734 T
( Pixel          fg, bg;) 18 720 T
( Arg            warg[2];) 18 706 T
( pthread_t      tid;) 18 692 T
( XtSetSensitive\050w, False\051;) 18 664 T
( /* get the buttons foreground and background colors */) 18 636 T
( XtSetArg\050warg[0], XmNforeground, &fg\051;) 18 622 T
( XtSetArg\050warg[1], XmNbackground, &bg\051;) 18 608 T
( XtGetValues\050w, warg, 2\051;) 18 594 T
( /* swap the buttons foreground and background colors */) 18 566 T
( XtSetArg\050warg[0], XmNforeground, bg\051;) 18 552 T
( XtSetArg\050warg[1], XmNbackground, fg\051;) 18 538 T
( XtSetValues\050w, warg, 2\051;) 18 524 T
( if \050MT\051) 18 496 T
(   PTHREAD_CREATE\050&tid, &attr, DoWork, \050void *\051w\051;) 18 482 T
( else) 18 468 T
(   DoWork\050\050void *\051w\051;) 18 454 T
( return\0500\051;) 18 412 T
(}) 18 398 T
(void *DoWork\050void *arg\051) 18 356 T
({Widget                 w = \050Widget\051 arg;) 18 342 T
( pthread_t              tid = pthread_self\050\051;) 18 328 T
( char                   *name = thread_name\050tid\051;) 18 314 T
( printf\050\322Thread %s: Start Processing...\134n\323, name\051;) 18 286 T
( sleep\0506\051;) 18 272 T
( printf\050\322Thread %s: Processing done...\134n\323, name\051;) 18 258 T
( if \050write\050message[WRITE], &w, sizeof\050w\051\051 != sizeof\050w\051\051) 18 230 T
(   {fprintf\050stderr, \322Write error\134n\323\051;) 18 216 T
(    exit\0501\051;) 18 202 T
(  }) 18 188 T
( return\050\050void *\0510\051;) 18 174 T
(}) 18 160 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "35" 35
%%Page: "36" 36
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(36) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 152.15 550.07 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
445.59 640.24 482.31 718.72 R
1 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
347.67 620.08 414.61 723.76 R
N
410.31 336.41 451.35 552.4 R
N
410.31 386.09 451.35 482.57 R
N
2 18 Q
(Jan) 0 -90 427.62 539.66 TF
($15000) 0 -90 426.9 461.35 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 430.83 360.17 GG
90 450 9.36 8.28 270 430.83 360.17 AA
315.99 292.49 357.03 508.48 R
N
315.99 342.17 357.03 438.65 R
N
(Kim) 0 -90 333.31 495.74 TF
($18000) 0 -90 332.59 417.43 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 336.51 316.25 GG
90 450 9.36 8.28 270 336.51 316.25 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
218.07 221.21 259.11 437.21 R
N
218.07 270.89 259.11 367.37 R
N
(Mari) 0 -90 235.39 424.46 TF
($64000) 0 -90 234.67 346.15 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 238.59 244.97 GG
90 450 9.36 8.28 270 238.59 244.97 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
237.69 469.35 240.33 469.38 237.8 460.13 235.05 469.31 4 Y
0 Z
N
237.69 469.35 240.33 469.38 237.8 460.13 235.05 469.31 4 Y
V
336.87 315.53 M
 346.82 300.04 348.96 264.39 322.27 279.37 D
 254.06 317.65 304.33 421.13 270.27 488.32 D
 264.84 499.04 244.37 499.58 239.1 484.43 D
 237.46 479.73 237.62 474.8 237.68 469.85 D
2 Z
N
331.64 532.11 334.28 532 331.23 522.91 329 532.23 4 Y
0 Z
N
331.64 532.11 334.28 532 331.23 522.91 329 532.23 4 Y
V
430.47 358.01 M
 439.36 340.16 429.44 308.04 405.6 327.31 D
 349.88 372.36 397.57 470.5 378.98 544.99 D
 375.05 560.74 348.7 563.74 339.39 552.21 D
 334.57 546.24 331.96 539.52 331.66 532.61 D
2 Z
N
90 450 9.36 8.28 270 463.95 658.96 GG
90 450 9.36 8.28 270 463.95 658.96 AA
424.14 572.3 426.76 572.65 425.36 563.17 421.52 571.95 4 Y
0 Z
N
424.14 572.3 426.76 572.65 425.36 563.17 421.52 571.95 4 Y
V
465.03 655.36 M
 480.18 625.1 462.04 612.57 433.93 604.55 D
 420.95 600.85 422.21 586.73 424.07 572.79 D
2 Z
N
380.32 723.76 380.32 620.08 2 L
N
414.79 655.36 347.86 655.36 2 L
N
481.59 671.92 445.59 671.92 2 L
N
(list) 0 -90 459.27 711.52 TF
(m) 0 -90 394.86 716.56 TF
(ute) 0 -90 394.86 700.92 TF
(x) 0 -90 394.86 674.19 TF
(sleep) 0 -90 359.76 716.56 TF
90 450 9.36 9.39 270 365.22 640.24 GG
90 450 9.36 9.39 270 365.22 640.24 AA
290.94 508.04 292.54 510.14 298.29 502.47 289.35 505.93 4 Y
0 Z
N
290.94 508.04 292.54 510.14 298.29 502.47 289.35 505.93 4 Y
V
261.44 678.4 M
 255.66 622.87 241.82 545.27 290.54 508.34 D
2 Z
N
245.6 660.4 282.32 738.88 R
N
90 450 9.36 8.28 270 263.96 679.12 GG
90 450 9.36 8.28 270 263.96 679.12 AA
281.6 692.08 245.6 692.08 2 L
N
(ptr) 0 -90 259.28 731.68 TF
278.71 611.44 231.2 566.08 2 L
4 H
N
280.88 565.36 229.76 615.04 2 L
N
(NO!) 0 -90 292.52 603.52 TF
(1) 0 -90 394.33 645.21 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 32 Q
(Linked Lists: Global Loc) 0 -90 518.23 647.88 TF
(k) 0 -90 518.23 276.87 TF
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "36" 36
%%Page: "37" 37
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(37) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Linked Lists, Global Mute) 72.22 732 T
(x:) 507.78 732 T
(list_global_loc) 156.29 684 T
(k.c) 405.67 684 T
4 12 Q
( /*                list_global_lock.c                */) 18 614 T
(/*) 18 586 T
(  Make a list of people \050with names like \322Jan_1234\323\051 and their salaries.) 18 558 T
(  Then spawn some threads to run down that list and give raises to all) 18 544 T
(  the people I like.  Spawn some more threads to delete from the list) 18 530 T
(  the people you don\325t like.  \050Some people I like might also be people) 18 516 T
(  you don\325t like.\051) 18 502 T
(  Insert delays during the raising and deleting functions to simulate disk) 18 474 T
(  I/O and make the program more interesting.) 18 460 T
(  Now consider the following parameters:) 18 432 T
(        o  Raise delay) 18 418 T
(        o  Liquidation delay) 18 404 T
(        o  Time for average search) 18 390 T
(  Which of the various locking designs works fastest for which combination) 18 362 T
(  of the above?) 18 348 T
(  This program allocates one global mutex to protect everything.) 18 292 T
(  GLOBAL_LOCK) 18 264 T
(         __________________________________) 18 236 T
(        |    Name      |  salary  |  next  |) 18 222 T
(        |  \322Jan_123\323   |  100000  |    o---|------>) 18 208 T
(        |______________|__________|________|) 18 194 T
(*/) 18 166 T
(/*) 18 138 T
(cc -o list_global_lock list_global_lock.c -L. -R. -g -lpthread -lthread -) 18 124 T
(pthread_extensions -lposix4) 18 110 T
(*/) 18 96 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "37" 37
%%Page: "38" 38
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(38) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(#define _POSIX_C_SOURCE 199506L) 18 748 T
(#include <signal.h>) 18 720 T
(#include <stdio.h>) 18 706 T
(#include <pthread.h>) 18 692 T
(#include <semaphore.h>) 18 678 T
(#include <errno.h>) 18 664 T
(#include <time.h>) 18 650 T
(#include <sys/time.h>) 18 636 T
(#include <stdlib.h>) 18 622 T
(#include \322thread_extensions.h\323) 18 608 T
(typedef struct person_struct) 18 566 T
({char *                 name;) 18 552 T
( int                    salary;) 18 538 T
( struct person_struct * next;) 18 524 T
(} person_t;) 18 510 T
(sem_t           barrier;) 18 440 T
(pthread_mutex_t people_lock = PTHREAD_MUTEX_INITIALIZER;) 18 426 T
(person_t        people;) 18 412 T
(int             E_THREADS = 1;         /* # threads running liquidate */) 18 384 T
(int             F_THREADS = 10;        /* # threads running raise */) 18 370 T
(int             N_PEOPLE = 1000;       /* # of people in initial list */) 18 356 T
(int             N_FRIENDS = 100;       /* # of people to give raises */) 18 342 T
(int             LIQUIDATE_DELAY = 100; /* sleep time during liquidation */) 18 328 T
(int             RAISE_DELAY = 100;     /* sleep time during raise giving */) 18 314 T
(void count_conflicts\050int i\051             /* Note the encapsulation */) 18 258 T
({static int             count=0, old_count=0, max_count = 0;) 18 244 T
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 18 230 T
( pthread_mutex_lock\050&count_lock\051;) 18 202 T
( count += i;) 18 188 T
( if \050i == -1\051 printf\050\322Conflicts: %d\134n\323, max_count\051;) 18 174 T
( if \050count > max_count\051) 18 160 T
(   max_count = count;) 18 146 T
( pthread_mutex_unlock\050&count_lock\051;) 18 132 T
(}) 18 118 T
(void count_finds\050int i\051         /* Note the encapsulation */) 18 90 T
({static int count=0, old_count=0, max_count = 0;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "38" 38
%%Page: "39" 39
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(39) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 18 748 T
( pthread_mutex_lock\050&count_lock\051;) 18 720 T
( count += i;) 18 706 T
( if \050i == -1\051 printf\050\322Total raises + liquidations: %d\134n\323, max_count\051;) 18 692 T
( if \050count > max_count\051) 18 678 T
(   max_count = count;) 18 664 T
( pthread_mutex_unlock\050&count_lock\051;) 18 650 T
(}) 18 636 T
(void print_people\050person_t *p\051  /* Debugging function. Not 100% MT safe */) 18 594 T
({int i = 0;) 18 580 T
( pthread_mutex_lock\050&people_lock\051;) 18 552 T
( while\050p != NULL\051) 18 538 T
(   {printf\050\322\050%s  %d\051 \322, p->name, p->salary\051;) 18 524 T
(    p = p->next;) 18 510 T
(    i++;) 18 496 T
(    if \050\050i % 5\051 == 0\051 printf\050\322\134n\323\051;) 18 482 T
(  }) 18 468 T
( pthread_mutex_unlock\050&people_lock\051;) 18 454 T
(}) 18 440 T
(person_t *find_person\050char *name\051) 18 398 T
({person_t *p = &people, *p1, *p2;) 18 384 T
( p1 = p->next;) 18 356 T
( while\050p1 != NULL\051) 18 342 T
(   {if \050strcmp\050p1->name, name\051 == 0\051) 18 328 T
(      /* Found! Return previous, Still holding p->lock ! */) 18 314 T
(      {count_finds\0501\051; return\050p\051;}) 18 300 T
(    p = p1;) 18 286 T
(    p1 = p->next;) 18 272 T
(  }) 18 258 T
( return\050NULL\051;                           /* Couldn\325t find \324em!  Too bad. */) 18 244 T
(}) 18 230 T
(void give_raise\050person_t *p\051) 18 188 T
({) 18 174 T
(  if \050p == NULL\051 return;) 18 160 T
(  p->next->salary++;) 18 146 T
(  delay\050RAISE_DELAY, 0\051;) 18 132 T
(}) 18 118 T
(pthread_mutex_lock_conflicts\050pthread_mutex_t *people_lock\051) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "39" 39
%%Page: "40" 40
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(40) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
({if \050pthread_mutex_trylock\050people_lock\051 == EBUSY\051) 18 748 T
(      {count_conflicts\0501\051;) 18 734 T
(       pthread_mutex_lock\050people_lock\051;) 18 720 T
(  }) 18 706 T
(}) 18 692 T
(void *give_friends_raise\050void *arg\051) 18 664 T
({person_t *p, *friends = \050person_t *\051 arg;) 18 650 T
(  while\050friends != NULL\051) 18 622 T
(    {pthread_mutex_lock_conflicts\050&people_lock\051;) 18 608 T
(     p = find_person\050friends->name\051;) 18 594 T
(     give_raise\050p\051;) 18 580 T
(     pthread_mutex_unlock\050&people_lock\051;) 18 566 T
(     friends = friends->next;) 18 552 T
(     delay\0500, 0\051;) 18 538 T
(   }) 18 524 T
(  sem_post\050&barrier\051;) 18 510 T
(}) 18 496 T
(void liquidate_person\050person_t *p\051) 18 454 T
({person_t  *p1;) 18 440 T
( p1 = p->next;) 18 412 T
( p->next = p1->next;) 18 398 T
( DEBUG\050printf\050\322Killing: \050%s %d\051\134n\323, p1->name, p1->salary\051\051;) 18 370 T
( free\050p1->name\051;) 18 356 T
( free\050p1\051;) 18 342 T
( delay\050LIQUIDATE_DELAY, 0\051;) 18 328 T
( return;) 18 314 T
(}) 18 300 T
(void *liquidate_enemies\050void *arg\051) 18 258 T
({person_t *p, *enemies = \050person_t *\051 arg;) 18 244 T
(  while\050enemies != NULL\051) 18 216 T
(    {pthread_mutex_lock_conflicts\050&people_lock\051;) 18 202 T
(     p = find_person\050enemies->name\051;) 18 188 T
(     if \050p\051 liquidate_person\050p\051;) 18 174 T
(     pthread_mutex_unlock\050&people_lock\051;) 18 160 T
(     enemies = enemies->next;) 18 146 T
(     delay\0500, 0\051;) 18 132 T
(   }) 18 118 T
( DEBUG\050{printf\050\322\134nAfter the purge...\134n\323\051; print_people\050people.next\051;}\051;) 18 104 T
( sem_post\050&barrier\051;) 18 90 T
(}) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "40" 40
%%Page: "41" 41
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(41) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(person_t *make_list_of_friends\050int seed1\051) 18 720 T
({int i, r;) 18 706 T
( unsigned int seed = \050int\051 seed1;) 18 692 T
( char s[20], *s1;) 18 678 T
( person_t *p, friends;) 18 664 T
( friends.next = NULL;) 18 636 T
( for \050i=0; i<N_FRIENDS; i++\051) 18 608 T
(   {r = rand_r\050&seed\051 % N_PEOPLE;) 18 594 T
(    sprintf\050s, \322Jan_%d\323, r\051;) 18 580 T
(    s1 = \050char *\051 malloc\050strlen\050s\051+1\051;) 18 566 T
(    strcpy\050s1, s\051;) 18 552 T
(    p = \050person_t *\051 malloc\050sizeof\050person_t\051\051;) 18 538 T
(    p->name = s1;) 18 524 T
(    p->next = friends.next;) 18 510 T
(    friends.next = p;) 18 496 T
(  }) 18 482 T
( return\050friends.next\051;) 18 468 T
(}) 18 454 T
(person_t *make_list_of_enemies\050int s\051) 18 412 T
({) 18 398 T
(  return\050make_list_of_friends\050s\051\051;) 18 384 T
(}) 18 370 T
(void add_to_people\050char *name\051) 18 328 T
({person_t *p;) 18 314 T
( p = \050person_t *\051 malloc\050sizeof\050person_t\051\051;) 18 286 T
( p->name = name;) 18 272 T
( pthread_mutex_lock\050&people_lock\051;) 18 258 T
( p->next = people.next;) 18 244 T
( people.next = p;) 18 230 T
( pthread_mutex_unlock\050&people_lock\051;) 18 216 T
(}) 18 202 T
(void make_list_of_people\050\051) 18 160 T
({int i, n;) 18 146 T
( char s[20], *s1;) 18 132 T
( for \050i=0; i<N_PEOPLE; i++\051) 18 104 T
(   {sprintf\050s, \322Jan_%d\323, i\051;) 18 90 T
(    s1 = \050char *\051 malloc\050strlen\050s\051+1\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "41" 41
%%Page: "42" 42
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(42) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    strcpy\050s1, s\051;) 18 748 T
(    add_to_people\050s1\051;) 18 734 T
(  }) 18 720 T
(}) 18 706 T
(main\050int argc, char *argv[]\051) 18 664 T
({int i;) 18 650 T
( pthread_attr_t attr;) 18 636 T
(  pthread_t tid;) 18 622 T
( SEM_INIT\050&barrier, NULL, 0\051;) 18 594 T
( PTHREAD_ATTR_INIT\050&attr\051;) 18 580 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 566 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 552 T
( people.next = NULL;) 18 538 T
( people.name = \050char *\051 -1;                     /* SEGV if you touch this ! */) 18 524 T
( if \050argc >= 2\051 LIQUIDATE_DELAY = atoi\050argv[1]\051;) 18 496 T
( if \050argc >= 3\051 RAISE_DELAY     = atoi\050argv[2]\051;) 18 482 T
( if \050argc >= 4\051 N_PEOPLE        = atoi\050argv[3]\051;) 18 468 T
( if \050argc >= 5\051 N_FRIENDS       = atoi\050argv[4]\051;) 18 454 T
( if \050argc >= 6\051 E_THREADS       = atoi\050argv[5]\051;) 18 440 T
( if \050argc >= 7\051 F_THREADS       = atoi\050argv[6]\051;) 18 426 T
( printf\050) 18 398 T
( \322list_global_lock\050LIQUIDATE: %d RAISE: %d N_PEOPLE: %d\134n N_FRIENDS: %d) 18 384 T
(E_THREADS: %d F_THREADS: %d\051\134n\323,) 18 370 T
( LIQUIDATE_DELAY, RAISE_DELAY, N_PEOPLE, N_FRIENDS, E_THREADS, F_THREADS \051;) 18 356 T
( make_list_of_people\050\051;) 18 328 T
( iobench_start\050\051;) 18 314 T
( for \050i=0; i<F_THREADS; i++\051) 18 300 T
(   PTHREAD_CREATE\050&tid, &attr, give_friends_raise, make_list_of_friends\050i*10\051\051;) 18 286 T
( for \050i=0; i<E_THREADS; i++\051) 18 272 T
(   PTHREAD_CREATE\050&tid, &attr, liquidate_enemies, make_list_of_enemies\050i\051\051;) 18 258 T
( thread_single_barrier\050&barrier, F_THREADS + E_THREADS\051;/* Instead of join\050\051! */) 18 230 T
( iobench_end\050\051;) 18 216 T
( count_finds\050-1\051;) 18 202 T
( count_conflicts\050-1\051;) 18 188 T
( iobench_report\050\051;) 18 174 T
( printf\050\322Done\134n\323\051;) 18 160 T
( exit\0500\051;) 18 146 T
(}) 18 132 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "42" 42
%%Page: "43" 43
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(43) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 2 Q
0 X
(/) 305.72 754.67 T
18 140.15 563.47 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
464.99 640.24 501.71 718.72 R
1 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
328.36 605.68 455.07 723.76 R
N
429.71 336.41 470.75 552.4 R
N
429.71 386.09 470.75 482.57 R
N
2 18 Q
(Jan) 0 -90 447.03 539.66 TF
($15000) 0 -90 446.31 461.35 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 450.23 360.17 GG
90 450 9.36 8.28 270 450.23 360.17 AA
335.39 292.49 376.43 508.48 R
N
335.39 342.17 376.43 438.65 R
N
(Kim) 0 -90 352.71 495.74 TF
($18000) 0 -90 351.99 417.43 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 355.91 316.25 GG
90 450 9.36 8.28 270 355.91 316.25 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
237.47 221.21 278.51 437.21 R
N
237.47 270.89 278.51 367.37 R
N
(Mari) 0 -90 254.79 424.46 TF
($64000) 0 -90 254.07 346.15 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 257.99 244.97 GG
90 450 9.36 8.28 270 257.99 244.97 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
257.09 469.35 259.73 469.38 257.2 460.13 254.45 469.31 4 Y
0 Z
N
257.09 469.35 259.73 469.38 257.2 460.13 254.45 469.31 4 Y
V
356.27 315.53 M
 366.21 300.04 368.36 264.39 341.67 279.37 D
 273.46 317.65 323.73 421.13 289.67 488.32 D
 284.24 499.04 263.77 499.58 258.5 484.43 D
 256.86 479.73 257.02 474.8 257.08 469.85 D
2 Z
N
351.04 532.11 353.68 532 350.64 522.91 348.4 532.23 4 Y
0 Z
N
351.04 532.11 353.68 532 350.64 522.91 348.4 532.23 4 Y
V
449.87 358.01 M
 458.76 340.16 448.84 308.04 425 327.31 D
 369.28 372.36 416.97 470.5 398.38 544.99 D
 394.45 560.74 368.1 563.74 358.79 552.21 D
 353.97 546.24 351.36 539.52 351.06 532.61 D
2 Z
N
90 450 9.36 8.28 270 483.35 658.96 GG
90 450 9.36 8.28 270 483.35 658.96 AA
449.75 566.25 452.38 566.54 450.75 557.09 447.12 565.96 4 Y
0 Z
N
449.75 566.25 452.38 566.54 450.75 557.09 447.12 565.96 4 Y
V
485.15 655.36 M
 498.31 623.14 482.56 609.79 458.17 601.26 D
 446.73 597.26 448.06 581.81 449.7 566.75 D
2 Z
N
395.87 723.76 395.87 605.68 2 L
N
455.07 640.24 329.08 640.24 2 L
N
500.99 671.92 464.99 671.92 2 L
N
(list) 0 -90 478.67 711.52 TF
(writer) 0 -90 408.15 715.84 TF
(w_sleep) 0 -90 377.19 715.84 TF
90 450 9.36 8.28 270 381.74 622.96 GG
90 450 9.36 8.28 270 381.74 622.96 AA
310.34 508.04 311.94 510.14 317.69 502.47 308.75 505.93 4 Y
0 Z
N
310.34 508.04 311.94 510.14 317.69 502.47 308.75 505.93 4 Y
V
280.84 678.4 M
 275.06 622.87 261.22 545.27 309.94 508.34 D
2 Z
N
265 660.4 301.71 738.88 R
N
90 450 9.36 8.28 270 283.36 679.12 GG
90 450 9.36 8.28 270 283.36 679.12 AA
301 692.08 265 692.08 2 L
N
(ptr) 0 -90 278.68 731.68 TF
298.12 611.44 250.6 566.08 2 L
4 H
N
300.28 565.36 249.16 615.04 2 L
N
(NO!) 0 -90 304.63 554.44 TF
426.99 723.76 426.99 605.68 2 L
1 H
N
362.91 723.76 362.91 606.4 2 L
N
(reader) 0 -90 434.23 715.84 TF
(s) 0 -90 434.23 661.09 TF
(r_sleep) 0 -90 340 715.84 TF
90 450 9.36 8.28 270 344.55 622.24 GG
90 450 9.36 8.28 270 344.55 622.24 AA
(0) 0 -90 406.96 628.72 TF
(3) 0 -90 434.95 628.65 TF
408.99 168.65 468.03 272.33 R
N
437.79 272.33 437.79 168.65 2 L
N
468.2 203.93 409.16 203.93 2 L
N
(m) 0 -90 450.07 265.13 TF
(ute) 0 -90 450.07 249.49 TF
(x) 0 -90 450.07 222.76 TF
(sleep) 0 -90 419.11 265.13 TF
90 450 9.36 8.28 270 424.47 188.81 GG
90 450 9.36 8.28 270 424.47 188.81 AA
(1) 0 -90 449.6 193.78 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(Salar) 0 -90 484.72 269.45 TF
(y_Loc) 0 -90 484.72 225.24 TF
(k) 0 -90 484.72 173.58 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(With one R) 0 -90 178.63 728.88 TF
(W Loc) 0 -90 178.63 635.6 TF
(k pr) 0 -90 178.63 581.96 TF
(otecting the) 0 -90 178.63 549.31 TF
5 F
(entire) 0 -90 178.63 442.3 TF
2 F
( list & one m) 0 -90 178.63 393.29 TF
(ute) 0 -90 178.63 286.62 TF
(x f) 0 -90 178.63 259.89 TF
(or salar) 0 -90 178.63 239.24 TF
(y) 0 -90 178.63 174.03 TF
(No outside pointer) 0 -90 160.63 728.88 TF
(s allo) 0 -90 160.63 570.14 TF
(wed without holding the R) 0 -90 160.63 524.38 TF
(W Loc) 0 -90 160.63 301.09 TF
(k.) 0 -90 160.63 247.45 TF
(Could y) 0 -90 142.63 728.88 TF
(ou sear) 0 -90 142.63 663.32 TF
(c) 0 -90 142.63 599.66 TF
(h do) 0 -90 142.63 589.83 TF
(wn the list with a read loc) 0 -90 142.63 552.1 TF
(k and then ask f) 0 -90 142.63 334.39 TF
(or a) 0 -90 142.63 198.71 TF
(write loc) 0 -90 124.63 728.88 TF
(k?) 0 -90 124.63 656.21 TF
2 32 Q
(Linked Lists: Global R) 0 -90 531.63 673.88 TF
(WLoc) 0 -90 531.63 337.3 TF
(k) 0 -90 531.63 250.84 TF
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "43" 43
%%Page: "44" 44
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(44) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 108 585 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
410.99 336.41 452.03 552.4 R
1 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
410.99 386.09 452.03 482.57 R
N
2 18 Q
(Jan) 0 -90 428.3 539.66 TF
($15000) 0 -90 427.58 461.35 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 431.51 360.17 GG
90 450 9.36 8.28 270 431.51 360.17 AA
332.9 481.65 335.52 481.39 332.01 472.49 330.27 481.9 4 Y
0 Z
N
332.9 481.65 335.52 481.39 332.01 472.49 330.27 481.9 4 Y
V
431.15 348.78 M
 440.04 335.44 430.12 311.43 406.28 325.83 D
 350.55 359.51 398.25 432.86 379.66 488.54 D
 375.73 500.31 349.38 502.56 340.07 493.94 D
 336.15 490.31 333.36 486.41 332.95 482.14 D
2 Z
N
424.91 572.33 427.54 572.66 426.06 563.18 422.29 572.01 4 Y
0 Z
N
424.91 572.33 427.54 572.66 426.06 563.18 422.29 572.01 4 Y
V
465.71 661.84 M
 480.86 629.49 462.72 616.1 434.61 607.53 D
 421.41 603.51 422.96 587.97 424.85 572.83 D
2 Z
N
278.98 477.76 281.28 479.06 283.54 469.74 276.68 476.45 4 Y
0 Z
N
278.98 477.76 281.28 479.06 283.54 469.74 276.68 476.45 4 Y
V
264.32 678.4 M
 261.32 613.26 252.42 524.47 278.73 478.19 D
2 Z
N
246.27 660.4 282.99 738.88 R
N
90 450 9.36 8.28 270 264.63 679.12 GG
90 450 9.36 8.28 270 264.63 679.12 AA
282.27 692.08 246.27 692.08 2 L
N
(ptr) 0 -90 259.95 731.68 TF
(OK) 0 -90 293.2 603.52 TF
452.19 336.41 493.23 552.4 R
N
452.19 386.09 493.23 482.57 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
461.52 406.24 486 448 R
N
473.76 448 473.76 406.96 2 L
N
486 421.36 462.24 421.36 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 10 Q
(1) 0 -90 476.66 416.84 TF
90 450 3.96 3.6 270 467.28 413.8 GG
90 450 3.96 3.6 270 467.28 413.8 AA
270.76 243.53 311.79 459.53 R
N
270.76 293.21 311.79 389.69 R
N
2 18 Q
(Kim) 0 -90 288.07 446.78 TF
($99000) 0 -90 287.35 368.47 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 291.27 267.29 GG
90 450 9.36 8.28 270 291.27 267.29 AA
311.96 243.53 353 459.53 R
N
311.96 293.21 353 389.69 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
324 316.24 348.48 358 R
N
336.24 358 336.24 316.96 2 L
N
348.48 331.36 324.72 331.36 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 10 Q
(0) 0 -90 339.14 326.84 TF
90 450 3.96 3.6 270 329.76 323.8 GG
90 450 3.96 3.6 270 329.76 323.8 AA
447.15 648.16 483.87 726.64 R
N
90 450 9.36 8.28 270 465.51 666.88 GG
90 450 9.36 8.28 270 465.51 666.88 AA
483.15 679.84 447.15 679.84 2 L
N
2 18 Q
(list) 0 -90 460.83 719.44 TF
167.08 194.57 208.12 410.57 R
N
167.08 244.25 208.12 340.73 R
N
(Kari) 0 -90 184.39 397.82 TF
($80000) 0 -90 183.67 319.51 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 187.6 218.33 GG
90 450 9.36 8.28 270 187.6 218.33 AA
208.28 194.57 249.32 410.57 R
N
208.28 244.25 249.32 340.73 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
218.52 262.24 243 304 R
N
230.76 304 230.76 262.96 2 L
N
243 277.36 219.24 277.36 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 10 Q
(0) 0 -90 233.66 272.84 TF
90 450 3.96 3.6 270 224.28 269.8 GG
90 450 3.96 3.6 270 224.28 269.8 AA
232.93 425.35 235.57 425.27 232.65 416.14 230.29 425.43 4 Y
0 Z
N
232.93 425.35 235.57 425.27 232.65 416.14 230.29 425.43 4 Y
V
290.48 260.68 M
 295.66 243.87 289.88 213.61 275.98 231.77 D
 243.51 274.2 271.3 366.65 260.47 436.83 D
 258.18 451.67 242.82 454.5 237.4 443.63 D
 234.69 438.21 233.13 432.1 232.95 425.85 D
2 Z
N
2 18 Q
(With one m) 0 -90 131.91 716.88 TF
(ute) 0 -90 131.91 620.23 TF
(x pr) 0 -90 131.91 593.51 TF
(otecting the  list and a local salar) 0 -90 131.91 560.85 TF
(y loc) 0 -90 131.91 277.57 TF
(k.) 0 -90 131.91 236.91 TF
(Outside pointer) 0 -90 113.91 716.88 TF
(s m) 0 -90 113.91 584.13 TF
(ust hold the) 0 -90 113.91 553.47 TF
5 F
(appr) 0 -90 113.91 446.46 TF
(opriate) 0 -90 113.91 407.82 TF
2 F
( m) 0 -90 113.91 347.81 TF
(ute) 0 -90 113.91 327.16 TF
(x.) 0 -90 113.91 300.43 TF
2 32 Q
(Linked Lists: Global Loc) 0 -90 517.91 645.88 TF
(k + local) 0 -90 517.91 274.87 TF
2 18 Q
(\050cf: Ref) 0 -90 95.91 716.88 TF
(erence counting\051) 0 -90 95.91 655.07 TF
305.28 617.92 432 736 R
N
372.8 736 372.8 617.92 2 L
N
432 652.48 306 652.48 2 L
N
(writer) 0 -90 385.07 728.08 TF
(w_sleep) 0 -90 354.11 728.08 TF
90 450 9.36 8.28 270 358.67 635.2 GG
90 450 9.36 8.28 270 358.67 635.2 AA
403.92 736 403.92 617.92 2 L
N
339.84 736 339.84 618.64 2 L
N
(reader) 0 -90 411.16 728.08 TF
(s) 0 -90 411.16 673.32 TF
(r_sleep) 0 -90 316.93 728.08 TF
90 450 9.36 8.28 270 321.48 634.48 GG
90 450 9.36 8.28 270 321.48 634.48 AA
(0) 0 -90 383.89 640.96 TF
(3) 0 -90 411.88 640.89 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "44" 44
%%Page: "45" 45
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(45) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Linked Lists, Global R) 42.52 732 T
(WLoc) 419.18 732 T
(k+:) 516.46 732 T
(list_global_rw2.c) 160.94 684 T
4 12 Q
(/*                list_global_rw2.c                */) 18 614 T
(/*) 18 586 T
(  Make a list of people \050with names like \322Jan_1234\323\051 and their salaries.) 18 558 T
(  Then spawn some threads to run down that list and give raises to all) 18 544 T
(  the people I like.  Spawn some more threads to delete from the list) 18 530 T
(  the people you don\325t like.  \050Some people I like might also be people) 18 516 T
(  you don\325t like.\051) 18 502 T
(  Insert delays during the raising and deleting functions to simulate disk) 18 474 T
(  I/O and make the program more interesting.) 18 460 T
(  Now consider the following parameters:) 18 432 T
(        o  Raise delay) 18 418 T
(        o  Liquidation delay) 18 404 T
(        o  Time for average search) 18 390 T
(  Which of the various locking designs works fastest for which combination) 18 362 T
(  of the above?) 18 348 T
(  This program allocates one global rwlock to protect the list itself, and) 18 292 T
(  one mutex to protect each salary.  It is *vital* that you know exactly) 18 278 T
(  what each lock is going to protect.) 18 264 T
(  GLOBAL_RWLOCK) 18 236 T
(         __________________________________) 18 208 T
(        |              |  salary  |        |) 18 194 T
(        |              |  lock    |        |) 18 180 T
(        |--------------|----------|--------|) 18 166 T
(        |    Name      |  salary  |  next  |) 18 152 T
(        |  \322Jan_123\323   |  100000  |    o---|------>) 18 138 T
(        |______________|__________|________|) 18 124 T
(*/) 18 82 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "45" 45
%%Page: "46" 46
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(46) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(/*) 18 748 T
(cc -o list_global_rw2 list_global_rw2.c -L. -R. -g -lpthread -lthread -) 18 734 T
(pthread_extensions -lposix4) 18 720 T
(*/) 18 706 T
(#define _POSIX_C_SOURCE 199506L) 18 664 T
(#include <signal.h>) 18 636 T
(#include <stdio.h>) 18 622 T
(#include <pthread.h>) 18 608 T
(#include <semaphore.h>) 18 594 T
(#include <errno.h>) 18 580 T
(#include <time.h>) 18 566 T
(#include <stdlib.h>) 18 552 T
(#include \322thread_extensions.h\323) 18 538 T
(typedef struct person_struct) 18 496 T
({char *                 name;) 18 482 T
( int                    salary;) 18 468 T
( pthread_mutex_t        salary_lock;) 18 454 T
( struct person_struct * next;) 18 440 T
(} person_t;) 18 426 T
(sem_t           barrier;) 18 384 T
(thread_rwlock_t people_lock;) 18 370 T
(person_t        people;) 18 356 T
(int             E_THREADS = 1;         /* # threads running liquidate */) 18 328 T
(int             F_THREADS = 10;        /* # threads running raise */) 18 314 T
(int             N_PEOPLE = 1000;       /* # of people in initial list */) 18 300 T
(int             N_FRIENDS = 100;       /* # of people to give raises */) 18 286 T
(int             LIQUIDATE_DELAY = 100; /* sleep time during liquidation */) 18 272 T
(int             RAISE_DELAY = 100;     /* sleep time during raise giving */) 18 258 T
(void count_conflicts\050int i\051             /* Note the encapsulation */) 18 202 T
({static int count=0, old_count=0, max_count = 0;) 18 188 T
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 18 174 T
( pthread_mutex_lock\050&count_lock\051;) 18 146 T
( count += i;) 18 132 T
( if \050i == -1\051 printf\050\322Conflicts: %d\134n\323, max_count\051;) 18 118 T
( if \050count > max_count\051) 18 104 T
(   max_count = count;) 18 90 T
( pthread_mutex_unlock\050&count_lock\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "46" 46
%%Page: "47" 47
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(47) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(}) 18 748 T
(void count_finds\050int i\051         /* Note the encapsulation */) 18 720 T
({static int count=0, old_count=0, max_count = 0;) 18 706 T
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 18 692 T
( pthread_mutex_lock\050&count_lock\051;) 18 664 T
( count += i;) 18 650 T
( if \050i == -1\051 printf\050\322Total raises + liquidations: %d\134n\323, max_count\051;) 18 636 T
( if \050count > max_count\051) 18 622 T
(   max_count = count;) 18 608 T
( pthread_mutex_unlock\050&count_lock\051;) 18 594 T
(}) 18 580 T
(void print_people\050person_t *p\051  /* Debugging function. Not 100% MT safe */) 18 538 T
({int i = 0;) 18 524 T
( printf\050\322\050\322\051;) 18 496 T
( thread_rw_rdlock\050&people_lock\051;) 18 482 T
( while\050p != NULL\051) 18 468 T
(   {pthread_mutex_lock\050&\050p->salary_lock\051\051;) 18 454 T
(    printf\050\322\050%s  %d\051 \322, p->name, p->salary\051;) 18 440 T
(    pthread_mutex_unlock\050&\050p->salary_lock\051\051;) 18 426 T
(    p = p->next;) 18 412 T
(    i++;) 18 398 T
(    if \050\050i % 5\051 == 0\051 printf\050\322\134n \322\051;) 18 384 T
(  }) 18 370 T
( thread_rw_unlock\050&people_lock\051;) 18 356 T
( printf\050\322\051\134n\323\051;) 18 342 T
(}) 18 328 T
(person_t *find_person\050char *name\051) 18 272 T
({person_t *p = &people, *p1, *p2;) 18 258 T
( p1 = p->next;) 18 230 T
( while\050p1 != NULL\051) 18 216 T
(   {if \050strcmp\050p1->name, name\051 == 0\051) 18 202 T
(      /* Found! Return previous */) 18 188 T
(      {count_finds\0501\051; return\050p\051;}) 18 174 T
(    p = p1;) 18 160 T
(    p1 = p->next;) 18 146 T
(  }) 18 132 T
( return\050NULL\051;                   /* Couldn\325t find \324em!  Too bad. */) 18 118 T
(}) 18 104 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "47" 47
%%Page: "48" 48
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(48) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(void give_raise\050person_t *p\051) 18 748 T
({person_t *p1;) 18 734 T
(  if \050p != NULL\051) 18 706 T
(    {p1 = p->next;) 18 692 T
(     DEBUG\050printf\050\322Giving raise to: \050%s %d\051\134n\323, p1->name, p1->salary\051\051) 18 678 T
(     pthread_mutex_lock\050&\050p1->salary_lock\051\051;) 18 664 T
(     thread_rw_unlock\050&people_lock\051;            /* Unlock here */) 18 650 T
(     p1->salary++;) 18 636 T
(     delay\050RAISE_DELAY, 0\051;      /* If the delay is outside the lock? */) 18 622 T
(     pthread_mutex_unlock\050&\050p1->salary_lock\051\051;) 18 608 T
(   }) 18 594 T
( else) 18 580 T
(     thread_rw_unlock\050&people_lock\051;            /* Unlock here */) 18 566 T
(}) 18 552 T
(thread_rw_rdlock_conflicts\050thread_rwlock_t *people_lock\051) 18 524 T
({if \050thread_rw_tryrdlock\050people_lock\051 == EBUSY\051) 18 510 T
(   {count_conflicts\0501\051;) 18 496 T
(    thread_rw_rdlock\050people_lock\051;) 18 482 T
(  }) 18 468 T
(}) 18 454 T
(thread_rw_wrlock_conflicts\050thread_rwlock_t *people_lock\051) 18 412 T
({if \050thread_rw_trywrlock\050people_lock\051 == EBUSY\051) 18 398 T
(   {count_conflicts\0501\051;) 18 384 T
(    thread_rw_wrlock\050people_lock\051;) 18 370 T
(  }) 18 356 T
(}) 18 342 T
(void *give_friends_raise\050void *arg\051) 18 314 T
({person_t *p, *friends = \050person_t *\051 arg;) 18 300 T
(  while\050friends != NULL\051) 18 272 T
(    {thread_rw_rdlock_conflicts\050&people_lock\051;) 18 258 T
(     p = find_person\050friends->name\051;) 18 244 T
(     give_raise\050p\051;) 18 230 T
(     friends = friends->next;) 18 216 T
(   }) 18 202 T
(  sem_post\050&barrier\051;) 18 188 T
(}) 18 174 T
(void liquidate_person\050person_t *p\051) 18 118 T
({person_t  *p1;) 18 104 T
( if \050p\051) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "48" 48
%%Page: "49" 49
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(49) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(   {p1 = p->next;) 18 748 T
(    p->next = p1->next;) 18 734 T
(    thread_rw_unlock\050&people_lock\051;) 18 720 T
(    pthread_mutex_lock\050&\050p1->salary_lock\051\051;) 18 692 T
(    pthread_mutex_unlock\050 &\050p1->salary_lock\051\051;) 18 678 T
(    pthread_mutex_destroy\050&\050p1->salary_lock\051\051;) 18 664 T
(    DEBUG\050printf\050\322Killing: \050%s %d\051\134n\323, p1->name, p1->salary\051\051) 18 650 T
(    free\050p1->name\051;) 18 636 T
(    free\050p1\051;) 18 622 T
(    delay\050LIQUIDATE_DELAY, 0\051;) 18 608 T
(  }) 18 594 T
( else) 18 580 T
(   thread_rw_unlock\050&people_lock\051;) 18 566 T
( return;) 18 538 T
(}) 18 524 T
(void *liquidate_enemies\050void *arg\051) 18 468 T
({person_t *p, *enemies = \050person_t *\051 arg;) 18 454 T
(  while\050enemies != NULL\051) 18 426 T
(    {thread_rw_wrlock_conflicts\050&people_lock\051;) 18 412 T
(     p = find_person\050enemies->name\051;) 18 398 T
(     liquidate_person\050p\051;) 18 384 T
(     enemies = enemies->next;) 18 370 T
(   }) 18 356 T
( DEBUG\050{printf\050\322\134nAfter the purge...\134n\323\051; print_people\050people.next\051;}\051) 18 342 T
( sem_post\050&barrier\051;) 18 328 T
(}) 18 314 T
(person_t *make_list_of_friends\050int seed1\051) 18 272 T
({int i, r;) 18 258 T
( unsigned int seed = \050int\051 seed1;) 18 244 T
( char s[20], *s1;) 18 230 T
( person_t *p, friends;) 18 216 T
( friends.next = NULL;) 18 188 T
( for \050i=0; i<N_FRIENDS; i++\051) 18 160 T
(   {r = rand_r\050&seed\051 % N_PEOPLE;) 18 146 T
(    sprintf\050s, \322Jan_%d\323, r\051;) 18 132 T
(    s1 = \050char *\051 malloc\050strlen\050s\051+1\051;) 18 118 T
(    strcpy\050s1, s\051;) 18 104 T
(    p = \050person_t *\051 malloc\050sizeof\050person_t\051\051;) 18 90 T
(    p->name = s1;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "49" 49
%%Page: "50" 50
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(50) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    p->next = friends.next;) 18 748 T
(    friends.next = p;) 18 734 T
(  }) 18 720 T
( return\050friends.next\051;) 18 706 T
(}) 18 692 T
(person_t *make_list_of_enemies\050int s\051) 18 650 T
({) 18 636 T
(  return\050make_list_of_friends\050s\051\051;) 18 622 T
(}) 18 608 T
(void add_to_people\050char *name\051) 18 566 T
({person_t *p;) 18 552 T
( p = \050person_t *\051 malloc\050sizeof\050person_t\051\051;) 18 524 T
( p->name = name;) 18 510 T
( pthread_mutex_init\050&\050p->salary_lock\051, NULL\051;) 18 496 T
( thread_rw_wrlock\050&people_lock\051;) 18 482 T
( p->next = people.next;) 18 468 T
( people.next = p;) 18 454 T
( thread_rw_unlock\050&people_lock\051;) 18 440 T
(}) 18 426 T
(void make_list_of_people\050\051) 18 384 T
({int i, n;) 18 370 T
( char s[20], *s1;) 18 356 T
( for \050i=0; i<N_PEOPLE; i++\051) 18 328 T
(   {sprintf\050s, \322Jan_%d\323, i\051;) 18 314 T
(    s1 = \050char *\051 malloc\050strlen\050s\051+1\051;) 18 300 T
(    strcpy\050s1, s\051;) 18 286 T
(    add_to_people\050s1\051;) 18 272 T
(  }) 18 258 T
(}) 18 244 T
(main\050int argc, char *argv[]\051) 18 202 T
({int i;) 18 188 T
( pthread_attr_t attr;) 18 174 T
(  pthread_t tid;) 18 160 T
( SEM_INIT\050&barrier, NULL, 0\051;) 18 132 T
( PTHREAD_ATTR_INIT\050&attr\051;) 18 118 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 104 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 90 T
( thread_rwlock_init\050&people_lock, NULL\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "50" 50
%%Page: "51" 51
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(51) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( people.next = NULL;) 18 748 T
( people.name = \050char *\051 -1;                     /* SEGV if you touch this ! */) 18 734 T
( if \050argc >= 2\051 LIQUIDATE_DELAY = atoi\050argv[1]\051;) 18 706 T
( if \050argc >= 3\051 RAISE_DELAY     = atoi\050argv[2]\051;) 18 692 T
( if \050argc >= 4\051 N_PEOPLE        = atoi\050argv[3]\051;) 18 678 T
( if \050argc >= 5\051 N_FRIENDS       = atoi\050argv[4]\051;) 18 664 T
( if \050argc >= 6\051 E_THREADS       = atoi\050argv[5]\051;) 18 650 T
( if \050argc >= 7\051 F_THREADS       = atoi\050argv[6]\051;) 18 636 T
( printf\050) 18 608 T
( \322list_global_rw2\050LIQUIDATE: %d RAISE: %d N_PEOPLE: %d\134n N_FRIENDS: %d) 18 594 T
(E_THREADS: %d F_THREADS: %d\051\134n\323,) 18 580 T
( LIQUIDATE_DELAY, RAISE_DELAY, N_PEOPLE, N_FRIENDS, E_THREADS, F_THREADS \051;) 18 566 T
( make_list_of_people\050\051;) 18 538 T
( iobench_start\050\051;) 18 524 T
( for \050i=0; i<F_THREADS; i++\051) 18 510 T
(   PTHREAD_CREATE\050&tid, &attr, give_friends_raise, make_list_of_friends\050i*10\051\051;) 18 496 T
( for \050i=0; i<E_THREADS; i++\051) 18 482 T
(   PTHREAD_CREATE\050&tid, &attr, liquidate_enemies, make_list_of_enemies\050i\051\051;) 18 468 T
( thread_single_barrier\050&barrier, F_THREADS + E_THREADS\051;) 18 440 T
( iobench_end\050\051;) 18 426 T
( count_finds\050-1\051;) 18 412 T
( count_conflicts\050-1\051;) 18 398 T
( iobench_report\050\051;) 18 384 T
( printf\050\322Done\134n\323\051;) 18 370 T
( exit\0500\051;) 18 356 T
(}) 18 328 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "51" 51
%%Page: "52" 52
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(52) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Ex) 150.05 732 T
(er) 193.72 732 T
(cise Objective) 227.02 732 T
2 18 Q
(Examine the code in eac) 18 658 T
(h of the diff) 226.91 658 T
(erent list implementations and) 324.72 658 T
-0.85 (under) 18 636 P
-0.85 (stand it. Estimate whic) 67.73 636 P
-0.85 (h design should be faster with diff) 259.06 636 P
-0.85 (erent) 545.84 636 P
(dela) 18 614 T
(y times. T) 53.66 614 T
(est. Fill out the tab) 135.61 614 T
(le belo) 294.46 614 T
(w) 351.22 614 T
(.) 364.5 614 T
(No) 18 570 T
(w \336gure out wh) 41.72 570 T
(y y) 173.38 570 T
(ou g) 197.95 570 T
(et some od) 236.12 570 T
(d looking n) 330.97 570 T
(umber of con\337icts.) 426.8 570 T
(What should the eff) 18 548 T
(ect be of replacing simple m) 184.82 548 T
(ute) 426.55 548 T
(x) 453.28 548 T
(es with FIFO) 463.1 548 T
(m) 18 526 T
(ute) 33.64 526 T
(x) 60.37 526 T
(es?) 70.2 526 T
-0.24 (What is the time of e) 18 482 P
-0.24 (x) 191.56 482 P
-0.24 (ecution f) 201.38 482 P
-0.24 (or eac) 275.79 482 P
-0.24 (h of these designs? Figure out) 328.4 482 P
(the appr) 18 460 T
(opriate n) 88.65 460 T
(umber) 164.48 460 T
(s to \336ll in f) 219.22 460 T
(or eac) 308.88 460 T
(h of the three parameter) 361.73 460 T
(s) 567.5 460 T
(whic) 18 438 T
(h will give y) 57.83 438 T
(ou the most useful data.) 158.44 438 T
(Hint: Star) 18 394 T
(t b) 99.36 394 T
(y \336guring out ho) 121 394 T
(w long it takes to compare eac) 262.73 394 T
(h mem-) 523.64 394 T
(ber of the list with no dela) 18 372 T
(ys. And ho) 239.69 372 T
(w long it takes to loc) 331.43 372 T
(k local) 508.12 372 T
(loc) 18 350 T
(ks.  Then y) 43.65 350 T
(ou should be ab) 136.24 350 T
(le to \336ll in the data f) 274.09 350 T
(or the rest of the) 442.76 350 T
(entries fr) 18 328 T
(om theor) 94.66 328 T
(y onl) 171.85 328 T
(y) 213.59 328 T
(.) 222.16 328 T
2 14 Q
-1.95 (Default Dela) 184.9 274.67 P
-1.95 (ys) 263.58 274.67 P
-1.95 (Zer) 394.49 274.67 P
-1.95 (o Dela) 415.99 274.67 P
-1.95 (y) 455.78 274.67 P
-1.3 (\050use 10,000 people\051) 365.42 257.67 P
(Global Mute) 18 206.67 T
(x) 97.91 206.67 T
(Global R) 18 155.67 T
(W +) 75.01 155.67 T
(Local Mute) 18 138.67 T
(x) 90.91 138.67 T
(T) 18 87.67 T
(w) 25.71 87.67 T
(o Local Mute) 36.33 87.67 T
(x) 121.68 87.67 T
(es) 129.33 87.67 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "52" 52
%%Page: "53" 53
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(53) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 152.15 546.75 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
410.99 336.41 452.03 552.4 R
1 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
410.99 386.09 452.03 482.57 R
N
2 18 Q
(Jan) 0 -90 428.3 539.66 TF
($15000) 0 -90 427.58 461.35 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 431.51 360.17 GG
90 450 9.36 8.28 270 431.51 360.17 AA
332.9 481.65 335.52 481.39 332.01 472.49 330.27 481.9 4 Y
0 Z
N
332.9 481.65 335.52 481.39 332.01 472.49 330.27 481.9 4 Y
V
431.15 348.78 M
 440.04 335.44 430.12 311.43 406.28 325.83 D
 350.55 359.51 398.25 432.86 379.66 488.54 D
 375.73 500.31 349.38 502.56 340.07 493.94 D
 336.15 490.31 333.36 486.41 332.95 482.14 D
2 Z
N
424.91 572.33 427.54 572.66 426.06 563.18 422.29 572.01 4 Y
0 Z
N
424.91 572.33 427.54 572.66 426.06 563.18 422.29 572.01 4 Y
V
465.71 661.84 M
 480.86 629.49 462.72 616.1 434.61 607.53 D
 421.41 603.51 422.96 587.97 424.85 572.83 D
2 Z
N
278.98 477.76 281.28 479.06 283.54 469.74 276.68 476.45 4 Y
0 Z
N
278.98 477.76 281.28 479.06 283.54 469.74 276.68 476.45 4 Y
V
264.32 678.4 M
 261.32 613.26 252.42 524.47 278.73 478.19 D
2 Z
N
246.27 660.4 282.99 738.88 R
N
90 450 9.36 8.28 270 264.63 679.12 GG
90 450 9.36 8.28 270 264.63 679.12 AA
282.27 692.08 246.27 692.08 2 L
N
(ptr) 0 -90 259.95 731.68 TF
(OK) 0 -90 293.2 603.52 TF
452.19 336.41 493.23 552.4 R
N
452.19 386.09 493.23 482.57 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
461.55 340.01 486.03 381.77 R
N
473.79 381.77 473.79 340.73 2 L
N
486.03 355.13 462.27 355.13 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 10 Q
(1) 0 -90 476.69 350.61 TF
90 450 3.96 3.6 270 467.31 347.57 GG
90 450 3.96 3.6 270 467.31 347.57 AA
270.76 243.53 311.79 459.53 R
N
270.76 293.21 311.79 389.69 R
N
2 18 Q
(Kim) 0 -90 288.07 446.78 TF
($99000) 0 -90 287.35 368.47 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 291.27 267.29 GG
90 450 9.36 8.28 270 291.27 267.29 AA
311.96 243.53 353 459.53 R
N
311.96 293.21 353 389.69 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
321.32 247.13 345.8 288.89 R
N
333.56 288.89 333.56 247.85 2 L
N
345.8 262.25 322.04 262.25 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 10 Q
(0) 0 -90 336.46 257.73 TF
90 450 3.96 3.6 270 327.08 254.69 GG
90 450 3.96 3.6 270 327.08 254.69 AA
447.15 648.16 483.87 726.64 R
N
90 450 9.36 8.28 270 465.51 666.88 GG
90 450 9.36 8.28 270 465.51 666.88 AA
483.15 679.84 447.15 679.84 2 L
N
2 18 Q
(list) 0 -90 460.83 719.44 TF
167.08 194.57 208.12 410.57 R
N
167.08 244.25 208.12 340.73 R
N
(Kari) 0 -90 184.39 397.82 TF
($80000) 0 -90 183.67 319.51 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 187.6 218.33 GG
90 450 9.36 8.28 270 187.6 218.33 AA
208.28 194.57 249.32 410.57 R
N
208.28 244.25 249.32 340.73 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
217.64 198.17 242.12 239.93 R
N
229.88 239.93 229.88 198.89 2 L
N
242.12 213.29 218.36 213.29 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 10 Q
(0) 0 -90 232.78 208.77 TF
90 450 3.96 3.6 270 223.4 205.73 GG
90 450 3.96 3.6 270 223.4 205.73 AA
232.93 425.35 235.57 425.27 232.65 416.14 230.29 425.43 4 Y
0 Z
N
232.93 425.35 235.57 425.27 232.65 416.14 230.29 425.43 4 Y
V
290.48 260.68 M
 295.66 243.87 289.88 213.61 275.98 231.77 D
 243.51 274.2 271.3 366.65 260.47 436.83 D
 258.18 451.67 242.82 454.5 237.4 443.63 D
 234.69 438.21 233.13 432.1 232.95 425.85 D
2 Z
N
354.27 633.04 413.31 736.72 R
N
383.07 736.72 383.07 633.04 2 L
N
413.48 668.32 354.44 668.32 2 L
N
2 18 Q
(m) 0 -90 395.35 729.52 TF
(ute) 0 -90 395.35 713.88 TF
(x) 0 -90 395.35 687.15 TF
(sleep) 0 -90 364.39 729.52 TF
90 450 9.36 8.28 270 369.75 653.2 GG
90 450 9.36 8.28 270 369.75 653.2 AA
(1) 0 -90 394.88 658.17 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(With one m) 0 -90 131.91 716.88 TF
(ute) 0 -90 131.91 620.23 TF
(x pr) 0 -90 131.91 593.51 TF
(otecting eac) 0 -90 131.91 560.85 TF
(h element in the list.) 0 -90 131.91 456 TF
(Outside pointer) 0 -90 113.91 716.88 TF
(s m) 0 -90 113.91 584.13 TF
(ust hold the) 0 -90 113.91 553.47 TF
5 F
(appr) 0 -90 113.91 446.46 TF
(opriate) 0 -90 113.91 407.82 TF
2 F
( m) 0 -90 113.91 347.81 TF
(ute) 0 -90 113.91 327.16 TF
(x.) 0 -90 113.91 300.43 TF
2 32 Q
(Linked Lists: Single Loc) 0 -90 517.91 645.88 TF
(k) 0 -90 517.91 278.42 TF
2 18 Q
(\050cf: Ref) 0 -90 95.91 716.88 TF
(erence counting\051) 0 -90 95.91 655.07 TF
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "53" 53
%%Page: "54" 54
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(54) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 136.15 548.75 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
403.99 336.41 445.03 552.4 R
1 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
403.99 386.09 445.03 482.57 R
N
2 18 Q
(Jan) 0 -90 421.3 539.66 TF
($15000) 0 -90 420.58 461.35 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 424.51 360.17 GG
90 450 9.36 8.28 270 424.51 360.17 AA
325.9 481.65 328.52 481.39 325.01 472.49 323.27 481.9 4 Y
0 Z
N
325.9 481.65 328.52 481.39 325.01 472.49 323.27 481.9 4 Y
V
424.15 348.78 M
 433.04 335.44 423.12 311.43 399.28 325.83 D
 343.55 359.51 391.25 432.86 372.66 488.54 D
 368.73 500.31 342.38 502.56 333.07 493.94 D
 329.15 490.31 326.36 486.41 325.95 482.14 D
2 Z
N
417.82 572.3 420.43 572.65 419.04 563.17 415.2 571.95 4 Y
0 Z
N
417.82 572.3 420.43 572.65 419.04 563.17 415.2 571.95 4 Y
V
458.71 655.36 M
 473.86 625.1 455.72 612.57 427.61 604.55 D
 414.63 600.85 415.89 586.73 417.75 572.79 D
2 Z
N
267.91 480.28 270.29 481.39 271.77 471.97 265.52 479.17 4 Y
0 Z
N
267.91 480.28 270.29 481.39 271.77 471.97 265.52 479.17 4 Y
V
256.07 679.12 M
 253.62 614.63 246.06 527.19 267.7 480.73 D
2 Z
N
239.27 660.4 275.99 738.88 R
N
90 450 9.36 8.28 270 257.63 679.12 GG
90 450 9.36 8.28 270 257.63 679.12 AA
275.27 692.08 239.27 692.08 2 L
N
(ptr) 0 -90 252.96 731.68 TF
(OK) 0 -90 286.2 603.52 TF
445.19 336.41 486.23 552.4 R
N
445.19 386.09 486.23 482.57 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
454.55 340.01 479.03 381.77 R
N
466.79 381.77 466.79 340.73 2 L
N
479.03 355.13 455.27 355.13 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 10 Q
(0) 0 -90 469.69 350.61 TF
90 450 3.96 3.6 270 460.31 347.57 GG
90 450 3.96 3.6 270 460.31 347.57 AA
263.76 243.53 304.79 459.53 R
N
263.76 293.21 304.79 389.69 R
N
2 18 Q
(Kim) 0 -90 281.07 446.78 TF
($99000) 0 -90 280.35 368.47 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 284.27 267.29 GG
90 450 9.36 8.28 270 284.27 267.29 AA
304.96 243.53 346 459.53 R
N
304.96 293.21 346 389.69 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
314.32 247.13 338.8 288.89 R
N
326.56 288.89 326.56 247.85 2 L
N
338.8 262.25 315.04 262.25 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 10 Q
(0) 0 -90 329.46 257.73 TF
90 450 3.96 3.6 270 320.08 254.69 GG
90 450 3.96 3.6 270 320.08 254.69 AA
440.15 648.16 476.87 726.64 R
N
90 450 9.36 8.28 270 458.51 666.88 GG
90 450 9.36 8.28 270 458.51 666.88 AA
476.15 679.84 440.15 679.84 2 L
N
2 18 Q
(list) 0 -90 453.83 719.44 TF
160.08 194.57 201.12 410.57 R
N
160.08 244.25 201.12 340.73 R
N
(Kari) 0 -90 177.39 397.82 TF
($80000) 0 -90 176.67 319.51 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 180.6 218.33 GG
90 450 9.36 8.28 270 180.6 218.33 AA
201.28 194.57 242.32 410.57 R
N
201.28 244.25 242.32 340.73 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
210.64 198.17 235.12 239.93 R
N
222.88 239.93 222.88 198.89 2 L
N
235.12 213.29 211.36 213.29 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 10 Q
(0) 0 -90 225.78 208.77 TF
90 450 3.96 3.6 270 216.4 205.73 GG
90 450 3.96 3.6 270 216.4 205.73 AA
225.93 425.35 228.57 425.27 225.65 416.14 223.29 425.43 4 Y
0 Z
N
225.93 425.35 228.57 425.27 225.65 416.14 223.29 425.43 4 Y
V
283.48 260.68 M
 288.66 243.87 282.88 213.61 268.98 231.77 D
 236.51 274.2 264.3 366.65 253.47 436.83 D
 251.18 451.67 235.82 454.5 230.4 443.63 D
 227.69 438.21 226.13 432.1 225.95 425.85 D
2 Z
N
454.55 415.61 479.03 457.37 R
N
466.79 457.37 466.79 416.33 2 L
N
479.03 430.73 455.27 430.73 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(0) 0 -90 469.69 426.21 TF
90 450 3.96 3.6 270 460.31 423.17 GG
90 450 3.96 3.6 270 460.31 423.17 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
315.59 324.17 340.07 365.93 R
N
327.83 365.93 327.83 324.89 2 L
N
340.07 339.29 316.31 339.29 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(1) 0 -90 330.73 334.77 TF
90 450 3.96 3.6 270 321.35 331.73 GG
90 450 3.96 3.6 270 321.35 331.73 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
211.92 276.65 236.4 318.41 R
N
224.16 318.41 224.16 277.37 2 L
N
236.4 291.77 212.64 291.77 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(0) 0 -90 227.05 287.25 TF
90 450 3.96 3.6 270 217.68 284.21 GG
90 450 3.96 3.6 270 217.68 284.21 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
349.27 623.68 408.31 727.36 R
N
378.07 727.36 378.07 623.68 2 L
N
408.47 658.96 349.43 658.96 2 L
N
2 18 Q
(m) 0 -90 390.35 720.16 TF
(ute) 0 -90 390.35 704.52 TF
(x) 0 -90 390.35 677.79 TF
(sleep) 0 -90 359.39 720.16 TF
90 450 9.36 8.28 270 364.75 643.84 GG
90 450 9.36 8.28 270 364.75 643.84 AA
(1) 0 -90 389.88 648.81 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(One m) 0 -90 111.91 740.88 TF
(ute) 0 -90 111.91 685.22 TF
(x pr) 0 -90 111.91 658.49 TF
(otecting the structure) 0 -90 111.91 625.84 TF
(, and one pr) 0 -90 111.91 440.64 TF
(otecting the data.) 0 -90 111.91 338.97 TF
(Outside pointer) 0 -90 93.91 740.88 TF
(s m) 0 -90 93.91 608.13 TF
(ust hold the) 0 -90 93.91 577.47 TF
5 F
(appr) 0 -90 93.91 470.46 TF
(opriate) 0 -90 93.91 431.82 TF
2 F
( m) 0 -90 93.91 371.81 TF
(ute) 0 -90 93.91 351.16 TF
(x.) 0 -90 93.91 324.43 TF
2 32 Q
(Linked Lists: T) 0 -90 514.91 634.88 TF
(w) 0 -90 514.91 410.97 TF
(o Loc) 0 -90 514.91 386.72 TF
(ks) 0 -90 514.91 302.01 TF
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "54" 54
%%Page: "55" 55
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(55) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Linked Lists, 2 Local Mute) 46.37 732 T
(x) 493.96 732 T
(es:) 513.61 732 T
(list_2local_loc) 148.27 684 T
(ks.c) 393.68 684 T
4 12 Q
( /*                list_2local_locks.c                */) 18 614 T
(/*) 18 586 T
(  Make a list of people \050with names like \322Jan_1234\323\051 and their salaries.) 18 558 T
(  Then spawn some threads to run down that list and give raises to all) 18 544 T
(  the people I like.  Spawn some more threads to delete from the list) 18 530 T
(  the people you don\325t like.  \050Some people I like might also be people) 18 516 T
(  you don\325t like.\051) 18 502 T
(  Insert delays during the raising and deleting functions to simulate disk) 18 474 T
(  I/O and make the program more interesting.) 18 460 T
(  Now consider the following parameters:) 18 432 T
(        o  Raise delay) 18 418 T
(        o  Liquidation delay) 18 404 T
(        o  Time for average search) 18 390 T
(  Which of the various locking designs works fastest for which combination) 18 362 T
(  of the above?) 18 348 T
(  This program allocates two mutexes per element, one to protect the) 18 292 T
(  next-pointer and following member, the other to protect the salary of) 18 278 T
(  the current member.  It is *vital* that you know exactly what each) 18 264 T
(  lock is going to protect.) 18 250 T
(         __________________________________) 18 222 T
(        |              |  salary  |  next  |) 18 208 T
(        |              |  lock    |  lock  |) 18 194 T
(        |--------------|----------|--------|) 18 180 T
(        |    Name      |  salary  |  next  |) 18 166 T
(        |  \322Jan_123\323   |  100000  |    o---|------>) 18 152 T
(        |______________|__________|________|) 18 138 T
(*/) 18 110 T
(/*) 18 82 T
(cc -o list_2local_locks list_2local_locks.c -L. -R. -g -lpthread -lthread -) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "55" 55
%%Page: "56" 56
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(56) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(pthread_extensions -lposix4) 18 748 T
(*/) 18 734 T
(#define _POSIX_C_SOURCE 199506L) 18 692 T
(#include <signal.h>) 18 664 T
(#include <stdio.h>) 18 650 T
(#include <pthread.h>) 18 636 T
(#include <semaphore.h>) 18 622 T
(#include <errno.h>) 18 608 T
(#include <time.h>) 18 594 T
(#include <stdlib.h>) 18 580 T
(#include \322thread_extensions.h\323) 18 566 T
(typedef struct person_struct) 18 524 T
({char *                 name;) 18 510 T
( int                    salary;) 18 496 T
( struct person_struct * next;) 18 482 T
( pthread_mutex_t        next_lock;) 18 468 T
( pthread_mutex_t        salary_lock;) 18 454 T
(} person_t;) 18 440 T
(sem_t          barrier;) 18 412 T
(person_t        people;) 18 398 T
(int             E_THREADS = 1;         /* # threads running liquidate */) 18 370 T
(int             F_THREADS = 10;        /* # threads running raise */) 18 356 T
(int             N_PEOPLE = 1000;       /* # of people in initial list */) 18 342 T
(int             N_FRIENDS = 100;       /* # of people to give raises */) 18 328 T
(int             LIQUIDATE_DELAY = 100; /* sleep time during liquidation */) 18 314 T
(int             RAISE_DELAY = 100;     /* sleep time during raise giving */) 18 300 T
(void count_conflicts\050int i\051             /* Note the encapsulation */) 18 258 T
({static int count=0, old_count=0, max_count = 0;) 18 244 T
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 18 230 T
( pthread_mutex_lock\050&count_lock\051;) 18 202 T
( count += i;) 18 188 T
( if \050i == -1\051 printf\050\322Conflicts: %d\134n\323, max_count\051;) 18 174 T
( if \050count > max_count\051) 18 160 T
(   max_count = count;) 18 146 T
( pthread_mutex_unlock\050&count_lock\051;) 18 132 T
(}) 18 118 T
(void count_finds\050int i\051         /* Note the encapsulation */) 18 90 T
({static int count=0, old_count=0, max_count = 0;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "56" 56
%%Page: "57" 57
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(57) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 18 748 T
( pthread_mutex_lock\050&count_lock\051;) 18 720 T
( count += i;) 18 706 T
( if \050i == -1\051 printf\050\322Total raises + liquidations: %d\134n\323, max_count\051;) 18 692 T
( if \050count > max_count\051) 18 678 T
(   max_count = count;) 18 664 T
( pthread_mutex_unlock\050&count_lock\051;) 18 650 T
(}) 18 636 T
(void print_people\050person_t *p\051  /* Debugging function. Not 100% MT safe */) 18 594 T
({int i = 0;) 18 580 T
(  while\050p != NULL\051) 18 552 T
(    {printf\050\322\050%s  %d\051 \322, p->name, p->salary\051;) 18 538 T
(     p = p->next;) 18 524 T
(     i++;) 18 510 T
(     if \050\050i % 5\051 == 0\051 printf\050\322\134n\323\051;) 18 496 T
(   }) 18 482 T
(}) 18 468 T
(void add_to_people\050char *name\051) 18 426 T
({person_t *p;) 18 412 T
( p = \050person_t *\051 malloc\050sizeof\050person_t\051\051;) 18 384 T
( p->name = name;) 18 370 T
( pthread_mutex_init\050&\050p->next_lock\051, NULL\051;) 18 356 T
( pthread_mutex_init\050&\050p->salary_lock\051, NULL\051;) 18 342 T
( pthread_mutex_lock\050&\050people.next_lock\051\051;) 18 328 T
( p->next = people.next;) 18 314 T
( people.next = p;) 18 300 T
( pthread_mutex_unlock\050&\050people.next_lock\051\051;) 18 286 T
(}) 18 272 T
(pthread_mutex_lock_conflicts\050pthread_mutex_t *people_lock\051) 18 244 T
({if \050pthread_mutex_trylock\050people_lock\051 == EBUSY\051) 18 230 T
(      {count_conflicts\0501\051;) 18 216 T
(       pthread_mutex_lock\050people_lock\051;) 18 202 T
(  }) 18 188 T
(}) 18 174 T
(person_t *find_person\050char *name\051) 18 146 T
({person_t *p = &people, *p1, *p2;) 18 132 T
( pthread_mutex_lock\050&\050p->next_lock\051\051;) 18 104 T
( p1 = p->next;) 18 90 T
( while\050p1 != NULL\051) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "57" 57
%%Page: "58" 58
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(58) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(   {if \050strcmp\050p1->name, name\051 == 0\051) 18 748 T
(      /* Found! Return *previous* person, Still holding p->lock ! */) 18 734 T
(      {count_finds\0501\051; return\050p\051;}) 18 720 T
(    pthread_mutex_lock_conflicts\050&\050p1->next_lock\051\051;) 18 706 T
(    pthread_mutex_unlock\050&\050p->next_lock\051\051;) 18 692 T
(    p = p1;) 18 678 T
(    p1 = p->next;) 18 664 T
(  }) 18 650 T
( pthread_mutex_unlock\050&\050p->next_lock\051\051;) 18 636 T
( return\050NULL\051;   /* Couldn\325t find \324em!  Too bad. No Locks held */) 18 622 T
(}) 18 608 T
(void give_raise\050person_t *p\051) 18 566 T
({person_t *p1;) 18 552 T
( if \050p == NULL\051  return;) 18 524 T
( p1 = p->next;) 18 510 T
( pthread_mutex_lock\050&\050p1->salary_lock\051\051;) 18 496 T
( pthread_mutex_unlock\050&\050p->next_lock\051\051; /* Unlock here!! */) 18 482 T
( p1->salary++;) 18 468 T
( delay\050RAISE_DELAY, 0\051;) 18 454 T
( pthread_mutex_unlock\050&\050p1->salary_lock\051\051;) 18 440 T
(}) 18 426 T
(void *give_friends_raise\050void *arg\051) 18 384 T
({person_t *p, *friends = \050person_t *\051 arg;) 18 370 T
(  while\050friends != NULL\051) 18 342 T
(    {p = find_person\050friends->name\051;) 18 328 T
(     give_raise\050p\051;) 18 314 T
(     friends = friends->next;) 18 300 T
(   }) 18 286 T
(  sem_post\050&barrier\051;) 18 272 T
(}) 18 258 T
(void liquidate_person\050person_t *p\051) 18 202 T
({person_t  *p1;) 18 188 T
( p1 = p->next;) 18 160 T
( pthread_mutex_lock\050&\050p1->next_lock\051\051;) 18 146 T
( p->next = p1->next;) 18 132 T
( pthread_mutex_unlock\050&\050p->next_lock\051\051;) 18 118 T
( DEBUG\050printf\050\322Killing: \050%s %d\051\134n\323, p1->name, p1->salary\051\051) 18 90 T
( pthread_mutex_lock\050&\050p1->salary_lock\051\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "58" 58
%%Page: "59" 59
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(59) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_mutex_unlock\050 &\050p1->next_lock\051\051;) 18 748 T
( pthread_mutex_destroy\050&\050p1->next_lock\051\051;) 18 734 T
( pthread_mutex_unlock\050 &\050p1->salary_lock\051\051;) 18 720 T
( pthread_mutex_destroy\050&\050p1->salary_lock\051\051;) 18 706 T
( free\050p1->name\051;) 18 692 T
( free\050p1\051;) 18 678 T
( delay\050LIQUIDATE_DELAY, 0\051;) 18 664 T
( return;) 18 650 T
(}) 18 636 T
(void *liquidate_enemies\050void *arg\051) 18 594 T
({person_t *p, *enemies = \050person_t *\051 arg;) 18 580 T
(  while\050enemies != NULL\051) 18 552 T
(    {p = find_person\050enemies->name\051;) 18 538 T
(     if \050p\051) 18 524 T
(       liquidate_person\050p\051;) 18 510 T
(     enemies = enemies->next;) 18 496 T
(   }) 18 482 T
( DEBUG\050{printf\050\322\134nAfter the purge...\134n\323\051; print_people\050people.next\051;}\051) 18 468 T
( sem_post\050&barrier\051;) 18 454 T
(}) 18 440 T
(person_t *make_list_of_friends\050int seed1\051) 18 398 T
({int i, r;) 18 384 T
( unsigned int seed = \050int\051 seed1;) 18 370 T
( char s[20], *s1;) 18 356 T
( person_t *p, friends;) 18 342 T
( friends.next = NULL;) 18 314 T
( for \050i=0; i<N_FRIENDS; i++\051) 18 286 T
(   {r = rand_r\050&seed\051 % N_PEOPLE;) 18 272 T
(    sprintf\050s, \322Jan_%d\323, r\051;) 18 258 T
(    s1 = \050char *\051 malloc\050strlen\050s\051+1\051;) 18 244 T
(    strcpy\050s1, s\051;) 18 230 T
(    p = \050person_t *\051 malloc\050sizeof\050person_t\051\051;) 18 216 T
(    p->name = s1;) 18 202 T
(    p->next = friends.next;) 18 188 T
(    friends.next = p;) 18 174 T
(  }) 18 160 T
( return\050friends.next\051;) 18 146 T
(}) 18 132 T
(person_t *make_list_of_enemies\050int s\051) 18 90 T
({) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "59" 59
%%Page: "60" 60
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(60) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  return\050make_list_of_friends\050s\051\051;) 18 748 T
(}) 18 734 T
(void *make_list_of_people\050\051) 18 678 T
({int i, n;) 18 664 T
( char s[20], *s1;) 18 650 T
( for \050i=0; i<N_PEOPLE; i++\051) 18 622 T
(   {sprintf\050s, \322Jan_%d\323, i\051;) 18 608 T
(    s1 = \050char *\051 malloc\050strlen\050s\051+1\051;) 18 594 T
(    strcpy\050s1, s\051;) 18 580 T
(    add_to_people\050s1\051;) 18 566 T
(  }) 18 552 T
(}) 18 538 T
(main\050int argc, char *argv[]\051) 18 496 T
({int i;) 18 482 T
( pthread_attr_t attr;) 18 468 T
(  pthread_t tid;) 18 454 T
( SEM_INIT\050&barrier, NULL, 0\051;) 18 426 T
( PTHREAD_ATTR_INIT\050&attr\051;) 18 412 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 398 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 384 T
( people.next = NULL;) 18 370 T
( people.name = \050char *\051 -1;             /* SEGV if you touch this ! */) 18 356 T
( pthread_mutex_init\050&\050people.next_lock\051, NULL\051;) 18 342 T
( if \050argc >= 2\051 LIQUIDATE_DELAY = atoi\050argv[1]\051;) 18 300 T
( if \050argc >= 3\051 RAISE_DELAY     = atoi\050argv[2]\051;) 18 286 T
( if \050argc >= 4\051 N_PEOPLE        = atoi\050argv[3]\051;) 18 272 T
( if \050argc >= 5\051 N_FRIENDS       = atoi\050argv[4]\051;) 18 258 T
( if \050argc >= 6\051 E_THREADS       = atoi\050argv[5]\051;) 18 244 T
( if \050argc >= 7\051 F_THREADS       = atoi\050argv[6]\051;) 18 230 T
( printf\050) 18 202 T
( \322list_2local_locks\050LIQUIDATE: %d RAISE: %d N_PEOPLE: %d\134n N_FRIENDS: %d) 18 188 T
(E_THREADS: %d F_THREADS: %d\051\134n\323,) 18 174 T
( LIQUIDATE_DELAY, RAISE_DELAY, N_PEOPLE, N_FRIENDS, E_THREADS, F_THREADS \051;) 18 160 T
( make_list_of_people\050\051;) 18 118 T
( iobench_start\050\051;) 18 104 T
( for \050i=0; i<F_THREADS; i++\051) 18 90 T
(   PTHREAD_CREATE\050&tid, &attr, give_friends_raise, make_list_of_friends\050i*10\051\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "60" 60
%%Page: "61" 61
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(61) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( for \050i=0; i<E_THREADS; i++\051) 18 748 T
(   PTHREAD_CREATE\050&tid, &attr, liquidate_enemies, make_list_of_enemies\050i\051\051;) 18 734 T
( thread_single_barrier\050&barrier, F_THREADS + E_THREADS\051;) 18 706 T
( iobench_end\050\051;) 18 692 T
( count_finds\050-1\051;) 18 678 T
( count_conflicts\050-1\051;) 18 664 T
( iobench_report\050\051;) 18 650 T
( printf\050\322Done\134n\323\051;) 18 636 T
( exit\0500\051;) 18 622 T
(}) 18 594 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "61" 61
%%Page: "62" 62
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(62) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 132.15 542.75 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
400.99 336.41 442.03 552.4 R
1 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
400.99 386.09 442.03 482.57 R
N
2 18 Q
(Jan) 0 -90 418.3 539.66 TF
($15000) 0 -90 417.58 461.35 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 421.51 360.17 GG
90 450 9.36 8.28 270 421.51 360.17 AA
322.94 481.98 325.57 481.71 322.02 472.81 320.31 482.24 4 Y
0 Z
N
322.94 481.98 325.57 481.71 322.02 472.81 320.31 482.24 4 Y
V
421.68 350.46 M
 430.62 337.27 420.64 313.53 396.67 327.78 D
 340.65 361.07 388.6 433.6 369.91 488.66 D
 365.96 500.3 339.48 502.52 330.11 494 D
 326.22 490.45 323.41 486.65 322.99 482.47 D
2 Z
N
414.82 572.3 417.43 572.65 416.04 563.17 412.2 571.95 4 Y
0 Z
N
414.82 572.3 417.43 572.65 416.04 563.17 412.2 571.95 4 Y
V
455.71 655.36 M
 470.86 625.1 452.72 612.57 424.61 604.55 D
 411.63 600.85 412.89 586.73 414.75 572.79 D
2 Z
N
268.81 477.73 271.1 479.07 273.51 469.73 266.52 476.38 4 Y
0 Z
N
268.81 477.73 271.1 479.07 273.51 469.73 266.52 476.38 4 Y
V
253.69 677.68 M
 250.6 612.76 241.47 524.2 268.56 478.15 D
2 Z
N
236.27 660.4 272.99 738.88 R
N
90 450 9.36 8.28 270 254.63 679.12 GG
90 450 9.36 8.28 270 254.63 679.12 AA
272.27 692.08 236.27 692.08 2 L
N
(ptr) 0 -90 249.96 731.68 TF
(OK) 0 -90 216.96 580.84 TF
442.19 336.41 483.23 552.4 R
N
442.19 386.09 483.23 482.57 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
456.38 340.73 480.35 382.49 R
N
468.37 382.49 468.37 341.45 2 L
N
480.35 355.85 446.51 355.85 2 L
N
2 10 Q
(2) 0 -90 471.15 351.33 TF
90 450 3.96 3.53 270 451.45 347.57 GG
90 450 3.96 3.53 270 451.45 347.57 AA
260.76 243.53 301.79 459.53 R
N
260.76 293.21 301.79 389.69 R
N
2 18 Q
(Kim) 0 -90 278.07 446.78 TF
($99000) 0 -90 277.35 368.47 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 281.27 267.29 GG
90 450 9.36 8.28 270 281.27 267.29 AA
301.96 243.53 343 459.53 R
N
301.96 293.21 343 389.69 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
437.15 648.16 473.87 726.64 R
N
90 450 9.36 8.28 270 455.51 666.88 GG
90 450 9.36 8.28 270 455.51 666.88 AA
473.15 679.84 437.15 679.84 2 L
N
(list) 0 -90 450.83 719.44 TF
157.08 194.57 198.12 410.57 R
N
157.08 244.25 198.12 340.73 R
N
(Kari) 0 -90 174.39 397.82 TF
($80000) 0 -90 173.67 319.51 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 9.36 8.28 270 177.6 218.33 GG
90 450 9.36 8.28 270 177.6 218.33 AA
198.28 194.57 239.32 410.57 R
N
198.28 244.25 239.32 340.73 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
222.93 425.35 225.57 425.27 222.65 416.14 220.29 425.43 4 Y
0 Z
N
222.93 425.35 225.57 425.27 222.65 416.14 220.29 425.43 4 Y
V
280.48 260.68 M
 285.66 243.87 279.88 213.61 265.98 231.77 D
 233.51 274.2 261.3 366.65 250.47 436.83 D
 248.18 451.67 232.82 454.5 227.4 443.63 D
 224.69 438.21 223.13 432.1 222.95 425.85 D
2 Z
N
451.55 415.61 476.03 457.37 R
N
463.79 457.37 463.79 416.33 2 L
N
476.03 430.73 452.27 430.73 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 10 Q
(0) 0 -90 466.69 426.21 TF
90 450 3.96 3.6 270 457.31 423.17 GG
90 450 3.96 3.6 270 457.31 423.17 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
312.59 324.17 337.07 365.93 R
N
324.83 365.93 324.83 324.89 2 L
N
337.07 339.29 313.31 339.29 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(1) 0 -90 327.73 334.77 TF
90 450 3.96 3.6 270 318.35 331.73 GG
90 450 3.96 3.6 270 318.35 331.73 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
208.92 276.65 233.4 318.41 R
N
221.16 318.41 221.16 277.37 2 L
N
233.4 291.77 209.64 291.77 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(0) 0 -90 224.05 287.25 TF
90 450 3.96 3.6 270 214.68 284.21 GG
90 450 3.96 3.6 270 214.68 284.21 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
446.51 340.73 456.38 382.49 R
N
(0) 0 -90 458.36 351.53 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
315.98 249.29 339.95 291.05 R
N
327.97 291.05 327.97 250.01 2 L
N
339.95 264.41 306.11 264.41 2 L
N
(1) 0 -90 330.76 259.89 TF
90 450 3.96 3.53 270 311.05 256.13 GG
90 450 3.96 3.53 270 311.05 256.13 AA
306.11 249.29 315.98 291.05 R
N
(0) 0 -90 317.96 260.09 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
211.59 199.61 235.55 241.37 R
N
223.57 241.37 223.57 200.33 2 L
N
235.55 214.73 201.72 214.73 2 L
N
(0) 0 -90 226.36 210.21 TF
90 450 3.96 3.53 270 206.65 206.45 GG
90 450 3.96 3.53 270 206.65 206.45 AA
201.72 199.61 211.59 241.37 R
N
(0) 0 -90 213.56 210.41 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
299.63 621.52 426.35 739.6 R
N
367.15 739.6 367.15 621.52 2 L
N
426.35 656.08 300.35 656.08 2 L
N
2 18 Q
(writer) 0 -90 379.42 731.68 TF
(w_sleep) 0 -90 348.47 731.68 TF
90 450 9.36 8.28 270 353.02 638.8 GG
90 450 9.36 8.28 270 353.02 638.8 AA
398.27 739.6 398.27 621.52 2 L
N
334.19 739.6 334.19 622.24 2 L
N
(reader) 0 -90 405.51 731.68 TF
(s) 0 -90 405.51 676.92 TF
(r_sleep) 0 -90 311.28 731.68 TF
90 450 9.36 8.28 270 315.83 638.08 GG
90 450 9.36 8.28 270 315.83 638.08 AA
(0) 0 -90 378.24 644.56 TF
(3) 0 -90 406.23 644.49 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(R/W loc) 0 -90 118.91 740.88 TF
(k pr) 0 -90 118.91 675.23 TF
(otecting the structure) 0 -90 118.91 642.58 TF
(, and m) 0 -90 118.91 457.38 TF
(ute) 0 -90 118.91 394.72 TF
(x pr) 0 -90 118.91 367.99 TF
(otecting the data.) 0 -90 118.91 335.34 TF
(Outside pointer) 0 -90 100.91 740.88 TF
(s m) 0 -90 100.91 608.13 TF
(ust hold the) 0 -90 100.91 577.47 TF
5 F
(appr) 0 -90 100.91 470.46 TF
(opriate) 0 -90 100.91 431.82 TF
2 F
( m) 0 -90 100.91 371.81 TF
(ute) 0 -90 100.91 351.16 TF
(x/loc) 0 -90 100.91 324.43 TF
(k.) 0 -90 100.91 283.77 TF
2 32 Q
(Linked Lists: R/W Loc) 0 -90 508.91 687.88 TF
(k & Loc) 0 -90 508.91 354.24 TF
(k) 0 -90 508.91 239.3 TF
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "62" 62
%%Page: "63" 63
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(63) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 152.15 558.19 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 18 Q
0 X
0 0 0 1 0 0 0 K
(Output: J) 0 -90 469.72 304.01 TF
(une) 0 -90 469.72 224.38 TF
(...) 0 -90 469.72 192.01 TF
468.13 442.5 M
 470.57 449.63 458.87 456.26 451.22 447.5 D
 443.53 438.68 434.1 460.21 420.63 444.17 D
3 H
2 Z
N
90 450 1.5 1.5 90 444.8 423.98 GG
444.8 425.48 441 425.48 444.8 438.72 448.6 425.48 4 Y
0 Z
N
444.8 425.48 441 425.48 444.8 438.72 448.6 425.48 4 Y
V
444.8 423.98 444.8 414.17 2 L
2 Z
N
200.24 590.83 M
 202.68 597.96 190.98 604.59 183.33 595.83 D
 175.64 587.01 166.21 608.54 152.74 592.49 D
N
90 450 1.5 1.5 90 176.9 572.31 GG
176.9 573.81 173.11 573.81 176.9 587.05 180.7 573.81 4 Y
0 Z
N
176.9 573.81 173.11 573.81 176.9 587.05 180.7 573.81 4 Y
V
176.9 572.31 176.9 562.49 2 L
2 Z
N
321.99 576.88 358.71 650.32 R
1 H
N
90 450 8.76 8.28 270 340.35 594.4 GG
90 450 8.76 8.28 270 340.35 594.4 AA
357.99 606.53 321.99 606.53 2 L
N
(Jan) 0 -90 335.67 643.59 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
321.99 468.89 358.71 542.32 R
N
90 450 8.76 8.28 270 340.35 486.4 GG
90 450 8.76 8.28 270 340.35 486.4 AA
357.99 498.53 321.99 498.53 2 L
N
(Jon) 0 -90 335.67 535.59 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
335.49 556.91 338.05 558.42 340.73 547.98 332.93 555.41 4 Y
0.5 H
0 Z
N
335.49 556.91 338.05 558.42 340.73 547.98 332.93 555.41 4 Y
V
341.43 594.16 M
 334.5 583.49 328.91 568.12 335.36 557.13 D
2 Z
N
333.51 682.16 370.23 747.52 R
1 H
N
90 450 7.8 8.28 270 351.87 697.75 GG
90 450 7.8 8.28 270 351.87 697.75 AA
340.39 665.62 343.02 665.86 341.2 656.45 337.76 665.39 4 Y
0 Z
N
340.39 665.62 343.02 665.86 341.2 656.45 337.76 665.39 4 Y
V
356.35 694.76 M
 362.11 681.84 355.22 676.49 344.53 673.07 D
 341.48 672.09 340.06 669.41 340.35 666.12 D
2 Z
N
369.51 708.55 333.51 708.55 2 L
N
(T1) 0 -90 347.19 741.52 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
228.7 546.19 265.42 619.63 R
N
90 450 8.76 8.28 270 247.06 563.71 GG
90 450 8.76 8.28 270 247.06 563.71 AA
264.7 575.83 228.7 575.83 2 L
N
(Jim) 0 -90 242.38 612.89 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
315.31 689.52 314.64 692.42 325.43 691.88 315.99 686.62 4 Y
0.5 H
0 Z
N
315.31 689.52 314.64 692.42 325.43 691.88 315.99 686.62 4 Y
V
250.74 631.7 M
 260.29 661.03 285.84 677.15 311.73 688.09 D
 312.84 688.55 313.9 689.19 315.07 689.46 D
2 Z
N
285.83 204.24 M
 288.27 211.38 276.57 218.01 268.92 209.24 D
 261.23 200.43 251.8 221.96 238.33 205.91 D
3 H
N
90 450 1.5 1.5 90 262.49 185.72 GG
262.49 187.22 258.7 187.22 262.49 200.47 266.29 187.22 4 Y
0 Z
N
262.49 187.22 258.7 187.22 262.49 200.47 266.29 187.22 4 Y
V
262.49 185.72 262.49 175.91 2 L
2 Z
N
435.23 478.16 438.21 478.19 435.34 467.78 432.26 478.13 4 Y
0.5 H
0 Z
N
435.23 478.16 438.21 478.19 435.34 467.78 432.26 478.13 4 Y
V
378.15 693.52 M
 444.6 639.17 434.44 554.55 435.23 478.41 D
2 Z
N
491.91 321.7 494.5 320.23 486.8 312.67 489.32 323.16 4 Y
0 Z
N
491.91 321.7 494.5 320.23 486.8 312.67 489.32 323.16 4 Y
V
463.11 430.73 M
 456.09 388.28 513.21 359.28 492.04 321.91 D
2 Z
N
(Pr) 0 -90 125.42 631.15 TF
(oducer) 0 -90 125.42 612.5 TF
(Stopper) 0 -90 211.89 234.31 TF
(Consumer) 0 -90 393.33 478.36 TF
(stop 0) 0 -90 264.88 383.34 TF
251.38 319.61 288.1 387.43 R
1 H
N
287.38 343.63 251.38 343.63 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
319.9 346.98 320.43 344.4 310.89 345.14 319.37 349.57 4 Y
0 Z
N
319.9 346.98 320.43 344.4 310.89 345.14 319.37 349.57 4 Y
V
427.91 426.65 M
 450.47 380.97 421.95 311.79 364.49 329.57 D
 350.64 333.86 336.98 350.48 320.39 347.08 D
2 Z
N
211.54 609.05 211.97 611.66 220.62 607.55 211.11 606.45 4 Y
0 Z
N
211.54 609.05 211.97 611.66 220.62 607.55 211.11 606.45 4 Y
V
166.23 607.26 M
 153.77 622.99 161.88 663.51 187.9 653.12 D
 207.26 645.38 192.17 622.19 204.76 612.23 D
 206.74 610.66 208.81 609.5 211.04 609.13 D
2 Z
N
225.05 369.73 224.87 372.37 234.25 370.34 225.22 367.1 4 Y
0 Z
N
225.05 369.73 224.87 372.37 234.25 370.34 225.22 367.1 4 Y
V
160.61 579.97 M
 138.76 515.5 112.21 414.63 187.9 374.67 D
 199.13 368.74 211.96 368.87 224.55 369.7 D
2 Z
N
(Stop?) 0 -90 185.43 431 TF
(Stop?) 0 -90 337.97 333.1 TF
270.76 295.27 268.13 295.03 269.94 304.44 273.39 295.5 4 Y
0 Z
N
270.76 295.27 268.13 295.03 269.94 304.44 273.39 295.5 4 Y
V
262.55 220.35 M
 271.39 242.13 273.09 269.23 270.8 294.77 D
2 Z
N
(Set) 0 -90 277.8 266.5 TF
2 32 Q
(Stoppab) 0 -90 524.35 688.88 TF
(le Pr) 0 -90 524.35 561.2 TF
(oducer/Consumer) 0 -90 524.35 492.46 TF
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "63" 63
%%Page: "64" 64
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(64) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Ex) 146.45 732 T
(er) 190.12 732 T
(cise Objective) 223.42 732 T
2 18 Q
(Edit the code in) 18 701 T
4 F
(stop_queue_problem.c) 157.03 701 T
2 F
( and use the ne) 373.03 701 T
(w global) 503.8 701 T
(v) 18 679 T
(ariab) 27.65 679 T
(le) 70.49 679 T
(,) 85.68 679 T
4 F
(stop) 95.69 679 T
2 F
(. When) 138.89 679 T
4 F
(stop==FALSE) 202.9 679 T
2 F
(, the pr) 321.7 679 T
(ogram runs as bef) 381.35 679 T
(ore) 537.03 679 T
(.) 565.4 679 T
(When it g) 18 657 T
(ets c) 99.18 657 T
(hang) 140.02 657 T
(ed to) 183.2 657 T
4 F
(TRUE) 231.21 657 T
2 F
(, then the pr) 274.41 657 T
(oducer) 377.06 657 T
(s will stop ad) 436.81 657 T
(ding) 549.67 657 T
(ne) 18 635 T
(w elements and e) 38.74 635 T
(xit. \050The) 187.52 635 T
(y ma) 256.27 635 T
(y complete whate) 296.93 635 T
(ver the) 446.71 635 T
(y\325) 505.46 635 T
(re w) 519.75 635 T
(ork-) 555.41 635 T
(ing on.\051 The consumer) 18 613 T
(s will also stop consuming and e) 210.76 613 T
(xit. \050The) 491.58 613 T
(y) 560.32 613 T
(MUST complete their current job.\051) 18 591 T
(Print out the length of the queue after the) 18 547 T
(y ha) 370.76 547 T
(ve e) 406.51 547 T
(xited. Set) 441.27 547 T
4 F
(stop) 526.3 547 T
2 F
(bac) 18 525 T
(k to) 48.65 525 T
4 F
(FALSE) 85.66 525 T
2 F
( and create some ne) 139.66 525 T
(w consumer) 312.46 525 T
(s.) 417.22 525 T
5 F
(After) 437.24 525 T
2 F
( the consum-) 479.23 525 T
(er) 18 503 T
(s ha) 34.74 503 T
(ve emptied the queue) 70.49 503 T
(, star) 254.72 503 T
(t up some ne) 298.1 503 T
(w pr) 408.85 503 T
(oducer) 445.5 503 T
(s.) 505.24 503 T
-0.54 (I ha) 18 459 P
-0.54 (ve a thread whic) 48.21 459 P
-0.54 (h calls) 186.48 459 P
4 F
-1.16 (stopper\050\051) 246.45 459 P
2 F
-0.54 (, whic) 343.65 459 P
-0.54 (h sleeps f) 392.95 459 P
-0.54 (or 4 seconds,) 474.56 459 P
(then sets) 18 437 T
4 F
(stop) 102.02 437 T
2 F
( to) 145.22 437 T
4 F
(TRUE) 172.22 437 T
2 F
(. It m) 215.42 437 T
(ust do whate) 257.08 437 T
(ver is necessar) 366.82 437 T
(y to wake) 497.09 437 T
(up sleeping consumer) 18 415 T
(s or pr) 208.78 415 T
(oducer) 264.44 415 T
(s, then e) 324.18 415 T
(xit itself) 396.94 415 T
(.) 464.78 415 T
(Don\325t use UNIX signals!) 18 371 T
(My solution is in) 18 327 T
4 F
(stop_queues_solution.c) 164.03 327 T
2 F
(.  Man) 401.63 327 T
(y minor \050and) 452.29 327 T
(major\051 v) 18 305 T
(ariations are possib) 87.66 305 T
(le) 257.54 305 T
(.) 272.92 305 T
(Wild Guess at Time to Completion:) 18 151 T
(30 min) 198 129 T
(utes think/design time) 254.84 129 T
(.) 445.25 129 T
(2 hour) 198 107 T
(s pr) 252.74 107 T
(ogramming/deb) 285.39 107 T
(ug) 420.05 107 T
(ging) 441.86 107 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "64" 64
%%Page: "65" 65
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(65) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Stoppab) 152.15 732 T
(le Queue:) 295.79 732 T
(stop_queue_pr) 109.49 684 T
(ob) 366.82 684 T
(lem.c) 410.45 684 T
4 12 Q
(/*                stop_queue_problem.c                */) 18 628 T
(/*) 18 600 T
(  This is the prototypical producer/consumer example done by) 18 586 T
(  building a singly linked list. Every few seconds we stop the) 18 572 T
(  queue completely, letting the consumers complete their current) 18 558 T
(  request, but not taking anything new from the queue.  Upon) 18 544 T
(  restart, the consumers get to empty the list before the producers) 18 530 T
(  start.) 18 516 T
(  Delays are inserted to simulate disk I/O \050and to make things) 18 488 T
(  run slower!\051.) 18 474 T
(*/) 18 460 T
(/*) 18 432 T
(cc -o stop_queue_problem stop_queue_problem.c -L. -R. -g -lpthread -lthread -) 18 418 T
(lthread_extensions -lposix4) 18 404 T
(*/) 18 390 T
(#define _POSIX_C_SOURCE 199506L) 18 362 T
(#include <pthread.h>) 18 334 T
(#include <semaphore.h>) 18 320 T
(#include <errno.h>) 18 306 T
(#include <time.h>) 18 292 T
(#include \322thread_extensions.h\323) 18 278 T
(typedef struct request_struct) 18 236 T
({int                    client;) 18 222 T
( char                   *buf;) 18 208 T
( pthread_t              tid;) 18 194 T
( struct request_struct  *next;) 18 180 T
(} request_t;) 18 166 T
(request_t               *requests = NULL;) 18 138 T
(int                     length = 0;) 18 124 T
(pthread_cond_t          requests_producer = PTHREAD_COND_INITIALIZER;) 18 110 T
(pthread_cond_t          requests_consumer = PTHREAD_COND_INITIALIZER;) 18 96 T
(pthread_mutex_t         requests_lock = PTHREAD_MUTEX_INITIALIZER;) 18 82 T
(pthread_attr_t          attr;) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "65" 65
%%Page: "66" 66
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(66) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(sem_t                   barrier;) 18 748 T
(int                     GET_DELAY = 20, PROCESS_DELAY = 250;) 18 734 T
(int                     stop = FALSE;) 18 720 T
(int                     N_PROD = 2, N_CONS = 2;) 18 706 T
(int                     n_produced = 0, n_processed = 0;) 18 692 T
(void print_requests\050\051) 18 636 T
({request_t *r = requests;) 18 622 T
( while \050r != NULL\051) 18 594 T
(   {printf\050\322<Request: %d>\134n\323, r->client\051;) 18 580 T
(    r = r->next;) 18 566 T
(  }) 18 552 T
(}) 18 538 T
(request_t *get_request\050\051) 18 496 T
({static pthread_mutex_t mr  = PTHREAD_MUTEX_INITIALIZER;) 18 482 T
( int c;) 18 468 T
( request_t *request;) 18 454 T
( pthread_t tid = pthread_self\050\051;) 18 440 T
( char *name = thread_name\050tid\051;) 18 426 T
( delay\050GET_DELAY, 0\051;) 18 398 T
( pthread_mutex_lock\050&mr\051;) 18 384 T
( c=n_produced++;) 18 370 T
( pthread_mutex_unlock\050&mr\051;) 18 356 T
( request = \050request_t *\051 malloc\050sizeof\050request_t\051\051;) 18 328 T
( request->client = c;                        /* Cannot use count here! */) 18 314 T
( request->tid = tid;) 18 300 T
( DEBUG\050printf\050\322[%s] Creating request  %4d\134n\323, name, c\051\051;) 18 272 T
( return\050request\051;) 18 258 T
(}) 18 244 T
(void process_request\050request_t *request\051) 18 202 T
({static pthread_mutex_t mr  = PTHREAD_MUTEX_INITIALIZER;) 18 188 T
( pthread_t tid = pthread_self\050\051;) 18 174 T
( char *name = thread_name\050tid\051;) 18 160 T
( delay\050PROCESS_DELAY, 0\051;) 18 132 T
( DEBUG\050printf\050\322[%s] Processed request %4d [%s]\134n\323,) 18 118 T
(              name, request->client, thread_name\050request->tid\051\051\051;) 18 104 T
( free\050request\051;) 18 90 T
( pthread_mutex_lock\050&mr\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "66" 66
%%Page: "67" 67
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(67) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( n_processed++;) 18 748 T
( pthread_mutex_unlock\050&mr\051;) 18 734 T
(}) 18 720 T
(request_t *remove_request\050\051) 18 678 T
({request_t *request;) 18 664 T
( request = requests;) 18 636 T
( requests = requests->next;) 18 622 T
( length--;) 18 608 T
( return\050request\051;) 18 594 T
(}) 18 580 T
(void add_request\050request_t *request\051) 18 538 T
({) 18 524 T
( request->next = requests;                      /* Insert at head of list */) 18 510 T
( requests = request;) 18 496 T
( length++;) 18 482 T
(}) 18 468 T
(void *producer\050void *arg\051) 18 426 T
({request_t *request;) 18 412 T
( while\050TRUE\051) 18 398 T
(   {request = get_request\050\051;) 18 384 T
(    pthread_mutex_lock\050&requests_lock\051;) 18 370 T
(    while \050length >= 10\051) 18 356 T
(      {delay\05020, 0\051;            /* Leave in!  Makes lost wakeup more likely. */) 18 342 T
(       pthread_cond_wait\050&requests_producer, &requests_lock\051;}) 18 328 T
(    add_request\050request\051;) 18 314 T
(    pthread_mutex_unlock\050&requests_lock\051;) 18 300 T
(    pthread_cond_signal\050&requests_consumer\051;) 18 286 T
(  }) 18 272 T
( pthread_mutex_unlock\050&requests_lock\051;) 18 258 T
( sem_post\050&barrier\051;) 18 244 T
( pthread_exit\050NULL\051;) 18 230 T
(}) 18 216 T
(void *consumer\050void *arg\051) 18 174 T
({request_t *request;) 18 160 T
( while\050TRUE\051) 18 132 T
(   {pthread_mutex_lock\050&requests_lock\051;) 18 118 T
(    while \050length == 0\051) 18 104 T
(      {delay\05020, 0\051;                    /* Leave in!  Makes lost wakeup more) 18 90 T
(likely. */) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "67" 67
%%Page: "68" 68
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(68) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(       pthread_cond_wait\050&requests_consumer, &requests_lock\051;}) 18 748 T
(    request = remove_request\050\051;) 18 734 T
(    pthread_mutex_unlock\050&requests_lock\051;) 18 720 T
(    pthread_cond_signal\050&requests_producer\051;) 18 706 T
(    process_request\050request\051;) 18 692 T
(  }) 18 678 T
( pthread_mutex_unlock\050&requests_lock\051;) 18 664 T
( sem_post\050&barrier\051;) 18 650 T
( pthread_exit\050NULL\051;) 18 636 T
(}) 18 622 T
(void *stopper\050void *arg\051) 18 580 T
({) 18 566 T
(  sleep\0504\051;) 18 552 T
(  stop = TRUE;) 18 538 T
(  printf\050\322Time to stop!\134n\323\051;) 18 524 T
(  pthread_exit\050NULL\051;) 18 510 T
(}) 18 496 T
(main\050int argc, char **argv\051) 18 454 T
({int i, j;) 18 440 T
( pthread_t tid;) 18 426 T
( SEM_INIT\050&barrier, NULL,  0\051;) 18 398 T
( PTHREAD_ATTR_INIT\050&attr\051;) 18 384 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 370 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 356 T
( if \050argc >= 2\051 GET_DELAY     = atoi\050argv[1]\051;) 18 328 T
( if \050argc >= 3\051 PROCESS_DELAY = atoi\050argv[2]\051;) 18 314 T
( if \050argc >= 4\051 N_PROD        = atoi\050argv[3]\051;) 18 300 T
( if \050argc >= 5\051 N_CONS        = atoi\050argv[4]\051;) 18 286 T
( printf\050\322GET_DELAY \050ms\051 = %d PROCESS_DELAY \050ms\051 = %d N_PROD = %d N_CONS = %d\134n\323,) 18 272 T
(        GET_DELAY, PROCESS_DELAY, N_PROD, N_CONS\051;) 18 258 T
( PTHREAD_CREATE\050&tid, &attr, killer, \050void *\051 60\051;) 18 244 T
( for \050j=0; j < 3; j++\051) 18 216 T
(   {printf\050\322Starting consumers. List length: %d Produced: %d Consumed %d.\134n\323,) 18 202 T
(           length, n_produced, n_processed\051;) 18 188 T
(    for \050i=0; i<N_CONS; i++\051) 18 174 T
(      PTHREAD_CREATE\050&tid, &attr, consumer, NULL\051;) 18 160 T
(    printf\050\322Starting producers. List length: %d Produced: %d Consumed %d.\134n\323,) 18 118 T
(           length, n_produced, n_processed\051;) 18 104 T
(    for \050i=0; i<N_PROD; i++\051) 18 90 T
(      PTHREAD_CREATE\050&tid, &attr, producer, NULL\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "68" 68
%%Page: "69" 69
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(69) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    PTHREAD_CREATE\050&tid, &attr, stopper, NULL\051;) 18 734 T
(    thread_single_barrier\050&barrier, N_PROD+N_CONS\051;) 18 720 T
(    stop = FALSE;) 18 706 T
(    printf\050\322All exited. List length: %d Produced: %d Consumed %d.\134n\323,) 18 692 T
(           length, n_produced, n_processed\051;) 18 678 T
(    sleep\0504\051;) 18 664 T
(   }) 18 650 T
( printf\050\322Done\134n\323\051;) 18 636 T
( exit\0500\051;) 18 622 T
(}) 18 608 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "69" 69
%%Page: "70" 70
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(70) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Stoppab) 152.15 732 T
(le Queue:) 295.79 732 T
(stop_queue_solution.c) 109.96 684 T
4 12 Q
( /*                stop_queue_solution.c                */) 18 628 T
(/*) 18 600 T
(  This is the prototypical producer/consumer example done by) 18 586 T
(  building a singly linked list. Every few seconds we stop the) 18 572 T
(  queue completely, letting the consumers complete their current) 18 558 T
(  request, but not taking anything new from the queue.  Upon) 18 544 T
(  restart, the consumers get to empty the list before the producers) 18 530 T
(  start.) 18 516 T
(  Delays are inserted to simulate disk I/O \050and to make things) 18 488 T
(  run slower!\051.) 18 474 T
(*/) 18 460 T
(/*) 18 432 T
(cc -o stop_queue_solution stop_queue_solution.c -L. -R. -g -lpthread -lthread -) 18 418 T
(pthread_extensions -lposix4) 18 404 T
(*/) 18 390 T
(#define _POSIX_C_SOURCE 199506L) 18 362 T
(#include <pthread.h>) 18 334 T
(#include <semaphore.h>) 18 320 T
(#include <errno.h>) 18 306 T
(#include <time.h>) 18 292 T
(#include \322thread_extensions.h\323) 18 278 T
(typedef struct request_struct) 18 236 T
({int                    client;) 18 222 T
( char                   *buf;) 18 208 T
( pthread_t              tid;) 18 194 T
( struct request_struct  *next;) 18 180 T
(} request_t;) 18 166 T
(request_t               *requests = NULL;) 18 138 T
(int                     length = 0;) 18 124 T
(pthread_cond_t          requests_producer = PTHREAD_COND_INITIALIZER;) 18 110 T
(pthread_cond_t          requests_consumer = PTHREAD_COND_INITIALIZER;) 18 96 T
(pthread_mutex_t         requests_lock = PTHREAD_MUTEX_INITIALIZER;) 18 82 T
(pthread_attr_t          attr;) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "70" 70
%%Page: "71" 71
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(71) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(sem_t                   barrier;) 18 748 T
(int                     GET_DELAY = 200, PROCESS_DELAY = 250;) 18 734 T
(int                     stop = FALSE;) 18 720 T
(int                     N_PROD = 2, N_CONS = 2;) 18 706 T
(int                     n_processed = 0, n_produced = 0;) 18 692 T
(void print_requests\050\051) 18 636 T
({request_t *r = requests;) 18 622 T
( while \050r != NULL\051) 18 594 T
(   {printf\050\322<Request: %d>\134n\323, r->client\051;) 18 580 T
(    r = r->next;) 18 566 T
(  }) 18 552 T
(}) 18 538 T
(request_t *get_request\050\051) 18 496 T
({static pthread_mutex_t mr  = PTHREAD_MUTEX_INITIALIZER;) 18 482 T
( int c;) 18 468 T
( request_t *request;) 18 454 T
( pthread_t tid = pthread_self\050\051;) 18 440 T
( char *name = thread_name\050tid\051;) 18 426 T
( delay\050GET_DELAY, 0\051;) 18 398 T
( pthread_mutex_lock\050&mr\051;) 18 384 T
( c=n_produced++;) 18 370 T
( pthread_mutex_unlock\050&mr\051;) 18 356 T
( request = \050request_t *\051 malloc\050sizeof\050request_t\051\051;) 18 328 T
( request->client = c;                        /* Cannot use count here! */) 18 314 T
( request->tid = tid;) 18 300 T
( DEBUG\050printf\050\322[%s] Creating request  %4d\134n\323, name, c\051\051;) 18 272 T
( return\050request\051;) 18 258 T
(}) 18 244 T
(void process_request\050request_t *request\051) 18 202 T
({static pthread_mutex_t mr  = PTHREAD_MUTEX_INITIALIZER;) 18 188 T
( pthread_t tid = pthread_self\050\051;) 18 174 T
( char *name = thread_name\050tid\051;) 18 160 T
( delay\050PROCESS_DELAY, 0\051;) 18 132 T
( DEBUG\050printf\050\322[%s] Processed request %4d [%s]\134n\323,) 18 118 T
(              name, request->client, thread_name\050request->tid\051\051\051;) 18 104 T
( free\050request\051;) 18 90 T
( pthread_mutex_lock\050&mr\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "71" 71
%%Page: "72" 72
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(72) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( n_processed++;) 18 748 T
( pthread_mutex_unlock\050&mr\051;) 18 734 T
(}) 18 720 T
(request_t *remove_request\050\051) 18 664 T
({request_t *request;) 18 650 T
( request = requests;) 18 622 T
( requests = requests->next;) 18 608 T
( length--;) 18 594 T
( return\050request\051;) 18 580 T
(}) 18 566 T
(void add_request\050request_t *request\051) 18 524 T
({) 18 510 T
( request->next = requests;                      /* Insert at head of list */) 18 496 T
( requests = request;) 18 482 T
( length++;) 18 468 T
(}) 18 454 T
(void *producer\050void *arg\051) 18 412 T
({request_t *request;) 18 398 T
( while\050TRUE\051) 18 384 T
(   {request = get_request\050\051;) 18 370 T
(    pthread_mutex_lock\050&requests_lock\051;) 18 356 T
(    while \050\050length >= 10\051 && \050!stop\051\051) 18 342 T
(      pthread_cond_wait\050&requests_producer, &requests_lock\051;) 18 328 T
(    add_request\050request\051;) 18 314 T
(    if \050stop\051 break;) 18 300 T
(    pthread_mutex_unlock\050&requests_lock\051;) 18 286 T
(    pthread_cond_signal\050&requests_consumer\051;) 18 272 T
(  }) 18 258 T
( pthread_mutex_unlock\050&requests_lock\051;) 18 244 T
( sem_post\050&barrier\051;) 18 230 T
( pthread_exit\050NULL\051;) 18 216 T
(}) 18 202 T
(void *consumer\050void *arg\051) 18 160 T
({request_t *request;) 18 146 T
( while\050TRUE\051) 18 118 T
(   {pthread_mutex_lock\050&requests_lock\051;) 18 104 T
(    while \050\050length == 0\051 && \050!stop\051\051) 18 90 T
(      pthread_cond_wait\050&requests_consumer, &requests_lock\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "72" 72
%%Page: "73" 73
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(73) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    if \050stop\051 break;) 18 748 T
(    request = remove_request\050\051;) 18 734 T
(    pthread_mutex_unlock\050&requests_lock\051;) 18 720 T
(    pthread_cond_signal\050&requests_producer\051;) 18 706 T
(    process_request\050request\051;) 18 692 T
(  }) 18 678 T
( pthread_mutex_unlock\050&requests_lock\051;) 18 664 T
( sem_post\050&barrier\051;) 18 650 T
( pthread_exit\050NULL\051;) 18 636 T
(}) 18 622 T
(void *stopper\050void *arg\051) 18 580 T
({) 18 566 T
(  sleep\0504\051;) 18 552 T
(  pthread_mutex_lock\050&requests_lock\051;) 18 538 T
(  stop = TRUE;                          /* No mutex? Lost wakeup!! */) 18 524 T
(  pthread_mutex_unlock\050&requests_lock\051;) 18 510 T
(  printf\050\322Time to stop!\134n\323\051;) 18 496 T
(  pthread_cond_broadcast\050&requests_producer\051;) 18 482 T
(  pthread_cond_broadcast\050&requests_consumer\051;) 18 468 T
(  pthread_exit\050NULL\051;) 18 454 T
(}) 18 440 T
(main\050int argc, char **argv\051) 18 384 T
({int i, j;) 18 370 T
( pthread_t tid;) 18 356 T
( SEM_INIT\050&barrier, NULL,  0\051;) 18 328 T
( PTHREAD_ATTR_INIT\050&attr\051;) 18 314 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 300 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 286 T
( if \050argc >= 2\051 GET_DELAY     = atoi\050argv[1]\051;) 18 258 T
( if \050argc >= 3\051 PROCESS_DELAY = atoi\050argv[2]\051;) 18 244 T
( if \050argc >= 4\051 N_PROD        = atoi\050argv[3]\051;) 18 230 T
( if \050argc >= 5\051 N_CONS        = atoi\050argv[4]\051;) 18 216 T
( printf\050\322GET_DELAY \050ms\051 = %d PROCESS_DELAY \050ms\051 = %d N_PROD = %d N_CONS = %d\134n\323,) 18 202 T
(        GET_DELAY, PROCESS_DELAY, N_PROD, N_CONS\051;) 18 188 T
( PTHREAD_CREATE\050&tid, &attr, killer, \050void *\051 60\051;) 18 174 T
( for \050j=0; j < 3; j++\051) 18 146 T
(   {printf\050\322Starting consumers. List length: %d Produced: %d Consumed %d.\134n\323,) 18 132 T
(           length, n_produced, n_processed\051;) 18 118 T
(    for \050i=0; i<N_CONS; i++\051) 18 104 T
(      PTHREAD_CREATE\050&tid, &attr, consumer, NULL\051;) 18 90 T
(    pthread_mutex_lock\050&requests_lock\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "73" 73
%%Page: "74" 74
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(74) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    while \050length != 0\051) 18 734 T
(      pthread_cond_wait\050&requests_producer, &requests_lock\051;) 18 720 T
(    printf\050\322Starting producers. List length: %d Produced: %d Consumed %d.\134n\323,) 18 692 T
(           length, n_produced, n_processed\051;) 18 678 T
(    pthread_mutex_unlock\050&requests_lock\051;) 18 664 T
(    for \050i=0; i<N_PROD; i++\051) 18 650 T
(      PTHREAD_CREATE\050&tid, &attr, producer, NULL\051;) 18 636 T
(    PTHREAD_CREATE\050&tid, &attr, stopper, NULL\051;) 18 608 T
(    thread_single_barrier\050&barrier, N_PROD+N_CONS\051;) 18 594 T
(    stop = FALSE;) 18 580 T
(    printf\050\322All exited. List length: %d Produced: %d Consumed %d.\134n\323,) 18 566 T
(           length, n_produced, n_processed\051;) 18 552 T
(    sleep\0504\051;) 18 538 T
(   }) 18 524 T
( printf\050\322Done\134n\323\051;) 18 510 T
( exit\0500\051;) 18 496 T
(}) 18 482 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "74" 74
%%Page: "75" 75
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(75) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 63 594 756 C
18 81 594 738 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
0 0 0 1 0 0 0 K
(Soc) 0 -90 541.15 588.6 TF
(kets: Client Side) 0 -90 541.15 523.3 TF
472.3 666 472.3 387 180 387 180 666 4 Y
7 X
V
0.5 H
2 Z
0 X
N
472.3 270 472.3 126 55.17 126 55.17 270 4 Y
V
0 Z
N
90 450 2 2 90 360.39 354.93 GG
360.39 356.93 356.42 356.93 360.39 370.74 364.35 356.93 4 Y
4 H
N
360.39 356.93 356.42 356.93 360.39 370.74 364.35 356.93 4 Y
V
90 450 2 2 270 360.39 311.07 GG
360.39 309.07 364.35 309.07 360.39 295.26 356.42 309.07 4 Y
N
360.39 309.07 364.35 309.07 360.39 295.26 356.42 309.07 4 Y
V
360.39 354.93 360.39 311.07 2 L
N
4 14 Q
(fd = connect\050...\051;) 0 -90 441.77 594 TF
(\322Request 1...\323) 0 -90 425.95 594 TF
(\322Request 2...\323) 0 -90 410.12 594 TF
(...) 0 -90 394.3 594 TF
(\322Request 10000...\323) 0 -90 378.47 594 TF
J
90 450 1.5 1.5 90 421.43 357.81 GG
421.43 359.31 417.63 359.31 421.43 372.56 425.23 359.31 4 Y
3 H
N
421.43 359.31 417.63 359.31 421.43 372.56 425.23 359.31 4 Y
V
J
90 450 1.5 1.5 270 421.43 308.19 GG
421.43 306.69 425.23 306.69 421.43 293.44 417.63 306.69 4 Y
N
421.43 306.69 425.23 306.69 421.43 293.44 417.63 306.69 4 Y
V
J
421.43 357.81 421.43 308.19 2 L
J
421.43 357.81 421.43 355.31 2 L
2 Z
N
[4.375 7.875] 4.375 I
421.43 355.31 421.43 310.69 2 L
N
J
421.43 310.69 421.43 308.19 2 L
N
J
(fd = connect\050...\051;) 0 -90 252.48 594 TF
(\322Request 1...\323) 0 -90 237.09 594 TF
(\322Request 2...\323) 0 -90 221.71 594 TF
(...) 0 -90 206.32 594 TF
(\322Request 10000...\323) 0 -90 190.93 594 TF
J
90 450 1.5 1.5 90 289.44 357.81 GG
289.44 359.31 285.64 359.31 289.44 372.56 293.23 359.31 4 Y
0 Z
N
289.44 359.31 285.64 359.31 289.44 372.56 293.23 359.31 4 Y
V
J
90 450 1.5 1.5 270 289.44 308.19 GG
289.44 306.69 293.23 306.69 289.44 293.44 285.64 306.69 4 Y
N
289.44 306.69 293.23 306.69 289.44 293.44 285.64 306.69 4 Y
V
J
289.44 357.81 289.44 308.19 2 L
J
289.44 357.81 289.44 355.31 2 L
2 Z
N
[4.375 7.875] 4.375 I
289.44 355.31 289.44 310.69 2 L
N
J
289.44 310.69 289.44 308.19 2 L
N
2 24 Q
(Client 1) 0 -90 488.09 554.69 TF
(Ser) 0 -90 493.51 243 TF
(ver) 0 -90 493.51 204.07 TF
J
137.09 666 137.09 387 45 387 45 666 4 Y
7 X
V
0.5 H
0 X
N
4 14 Q
(fd = connect\050...\051;) 0 -90 109.79 594 TF
(\322Request 1...\323) 0 -90 97.86 594 TF
(\322Request 2...\323) 0 -90 85.92 594 TF
(...) 0 -90 73.98 594 TF
(\322Request 10000...\323) 0 -90 62.04 594 TF
J
90 450 1.5 1.5 90 85.69 357.81 GG
85.69 359.31 81.9 359.31 85.69 372.56 89.49 359.31 4 Y
3 H
0 Z
N
85.69 359.31 81.9 359.31 85.69 372.56 89.49 359.31 4 Y
V
J
90 450 1.5 1.5 270 85.69 308.19 GG
85.69 306.69 89.49 306.69 85.69 293.44 81.9 306.69 4 Y
N
85.69 306.69 89.49 306.69 85.69 293.44 81.9 306.69 4 Y
V
J
85.69 357.81 85.69 308.19 2 L
J
85.69 357.81 85.69 355.31 2 L
2 Z
N
[4.375 7.875] 4.375 I
85.69 355.31 85.69 310.69 2 L
N
J
85.69 310.69 85.69 308.19 2 L
N
2 24 Q
(Client 2) 0 -90 149 554.69 TF
J
90 450 2 2 90 146.74 354.93 GG
146.74 356.93 142.78 356.93 146.74 370.74 150.7 356.93 4 Y
4 H
0 Z
N
146.74 356.93 142.78 356.93 146.74 370.74 150.7 356.93 4 Y
V
90 450 2 2 270 146.74 311.07 GG
146.74 309.07 150.7 309.07 146.74 295.26 142.78 309.07 4 Y
N
146.74 309.07 150.7 309.07 146.74 295.26 142.78 309.07 4 Y
V
146.74 354.93 146.74 311.07 2 L
N
2 18 Q
(fd1) 0 -90 425.64 342 TF
(fd2) 0 -90 294.91 342 TF
(fd3) 0 -90 89.91 342 TF
(6500) 0 -90 376.3 351 TF
(6500) 0 -90 161.12 351 TF
J
391.24 621.15 M
 388.48 614.02 401.71 607.39 410.36 616.15 D
 419.05 624.96 429.71 603.43 444.94 619.48 D
1 H
2 Z
N
417.62 630.52 420.26 630.52 417.62 621.3 414.97 630.52 4 Y
0 Z
N
417.62 630.52 420.26 630.52 417.62 621.3 414.97 630.52 4 Y
V
417.62 631.02 417.62 649.48 2 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
200.01 621.15 M
 197.33 614.02 210.19 607.39 218.6 616.15 D
 227.05 624.96 237.41 603.43 252.22 619.48 D
N
225.66 630.52 228.3 630.52 225.66 621.3 223.01 630.52 4 Y
0 Z
N
225.66 630.52 228.3 630.52 225.66 621.3 223.01 630.52 4 Y
V
225.66 631.02 225.66 649.48 2 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
68.28 619.67 M
 66.19 612.54 76.17 605.9 82.69 614.67 D
 89.25 623.48 97.29 601.95 108.78 618 D
N
88.17 629.04 90.82 629.04 88.17 619.81 85.53 629.04 4 Y
0 Z
N
88.17 629.04 90.82 629.04 88.17 619.81 85.53 629.04 4 Y
V
88.17 629.54 88.17 648 2 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 14 Q
(\322Reply 1...\323) 0 -90 339.08 566.4 TF
(\322Reply 2...\323) 0 -90 325.62 566.4 TF
(...) 0 -90 312.15 566.4 TF
(\322Reply 10000...\323) 0 -90 298.69 566.4 TF
309.55 593.55 M
 307.21 586.42 318.46 579.79 325.81 588.55 D
 333.21 597.36 342.28 575.83 355.23 591.88 D
N
331.99 602.92 334.64 602.92 331.99 593.7 329.35 602.92 4 Y
0 Z
N
331.99 602.92 334.64 602.92 331.99 593.7 329.35 602.92 4 Y
V
331.99 603.42 331.99 621.88 2 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 63 594 756 C
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "75" 75
%%Page: "76" 76
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(76) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Threads and Soc) 119.3 732 T
(kets:) 408.67 732 T
(c) 244.33 684 T
(lient.c) 263.63 684 T
4 12 Q
( /*                client.c                */) 18 614 T
(/*) 18 586 T
(  The client side simply sends a hugh number of requests to the) 18 572 T
(  chosen server as fast as requested, spawing one thread to do the) 18 558 T
(  sending and another to receive the replies. You may request multiple) 18 544 T
(  pairs of senders & receivers each with their own socket. The) 18 530 T
(  senders & receivers run asynchronously intentionally, thus replies) 18 516 T
(  may be received out-of-order.) 18 502 T
(  The client will try the requested port first, then the next higher) 18 474 T
(  port and keep going \050in case the server is actually on another port\051.) 18 460 T
(  Nothing interesting here.) 18 432 T
(cc -o client client.c -L. -R. -g -lpthread -pthread_extensions -lposix4 -lnsl -) 18 390 T
(lsocket) 18 376 T
(*/) 18 362 T
(#define _POSIX_C_SOURCE 199506L) 18 320 T
(#define __EXTENSIONS__) 18 306 T
(#include <stdio.h>) 18 278 T
(#include <sys/types.h>) 18 264 T
(#include <sys/socket.h>) 18 250 T
(#include <netinet/in.h>) 18 236 T
(#include <arpa/inet.h>) 18 222 T
(#include <string.h>) 18 208 T
(#include <unistd.h>) 18 194 T
(#include <stdlib.h>) 18 180 T
(#include <pthread.h>) 18 166 T
(#include <sys/resource.h>) 18 152 T
(#include \322thread_extensions.h\323) 18 138 T
(/* Constants etc. rlimit set to MAX_FDS in main\050\051 */) 18 96 T
(#define                 MESSAGE_SIZE 70) 18 82 T
(#define                 MAX_FDS  1000) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "76" 76
%%Page: "77" 77
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(77) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(/* 127.0.0.1 is the loopback address.  You may change it. */) 18 734 T
(const char              *SERV_HOST_ADDR =   \322127.0.0.1\323;) 18 720 T
(int                     REQUESTED_TCP_PORT = 6500, ACTUAL_TCP_PORT;) 18 706 T
(int) 18 692 T
(MAX_PORT_RANGE = 100;) 270 692 T
(int                     N_REQUESTS = 10000;) 18 678 T
(int                     SLEEP = 0, SPIN= 0, N_CONSUMERS=10;) 18 664 T
(int                     PID;) 18 650 T
(thread_single_barrier_t client_barrier;) 18 636 T
(const char              *END_CLIENT_MSG =) 18 622 T
(  \322End\1340                                                                   \322;) 18 608 T
(/* A bunch of simple helper functions */) 18 566 T
(void set_up_signal_mask\050\051 {) 18 538 T
( sigset_t               s, s1, s2;) 18 524 T
( static struct          sigaction action;) 18 510 T
(/* Block everything first \050in particular SIGPIPE\051 */) 18 482 T
( sigfillset\050&s\051;) 18 468 T
( pthread_sigmask\050SIG_BLOCK, &s, &s2\051;) 18 454 T
( sigemptyset\050&s\051;) 18 440 T
( sigaddset\050&s, SIGINT\051;                 /* For ^C */) 18 412 T
( pthread_sigmask\050SIG_UNBLOCK, &s, &s1\051;) 18 398 T
(}) 18 384 T
(/* Send out N_REQUESTS requests to server */) 18 328 T
(void *send_requests\050void *arg\051 {) 18 314 T
(  int            i, j, sockfd = \050int\051 arg, err;) 18 300 T
(  char           obuf[MESSAGE_SIZE], ibuf[MESSAGE_SIZE];) 18 286 T
(  char           *name = thread_name\050pthread_self\050\051\051;) 18 272 T
(  set_up_signal_mask\050\051;) 18 244 T
(  printf\050\322Client_%d[%s] \134tSending %d requests on fd#%d...\134n\323,) 18 230 T
( PID, name, N_REQUESTS, sockfd\051;) 54 216 T
(  for \050j=0; j<N_REQUESTS; j++\051 {) 18 202 T
(    sprintf\050obuf, \322Client_%d[%s] Request: %d\323, PID, name, j\051;) 18 188 T
(    err=write\050sockfd, obuf, MESSAGE_SIZE\051;) 18 174 T
(    if \050err == -1\051 {) 18 160 T
(      printf\050\322Write failed from Client_%d[%s]\134n\323, PID, name\051;) 18 146 T
(      perror\050\322\322\051;) 18 132 T
(      pthread_exit\050NULL\051;) 18 118 T
(    }) 18 104 T
(    DEBUG\050printf\050\322Client_%d[%s] sent: \324%s\325\134n\323, PID, name, obuf\051\051;) 18 90 T
(    delay\050SLEEP, SPIN\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "77" 77
%%Page: "78" 78
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(78) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    if \050\050j%1000 == 0\051 && ! \050j==0\051\051) 18 748 T
(      printf\050\322Client_%d[%s] \134tSent %d segments on fd#%d.\134n\323,) 18 734 T
(     PID, name, j, sockfd\051;) 54 720 T
(  }) 18 706 T
(  err=write\050sockfd, END_CLIENT_MSG, MESSAGE_SIZE\051;) 18 692 T
(  if \050err == -1\051 {) 18 678 T
(    printf\050\322Write END failed from Client_%d[%s]\134n\323, PID, name\051;) 18 664 T
(    perror\050\322\322\051;) 18 650 T
(    thread_single_barrier_post\050&client_barrier\051;) 18 636 T
(    pthread_exit\050NULL\051;) 18 622 T
(  }) 18 608 T
(  DEBUG\050printf\050\322Client_%d[%s] sent: \324%s\325\134n\323, PID, name, END_CLIENT_MSG\051\051;) 18 594 T
(  printf\050\322Client_%d[%s] \134tDone sending on fd#%d.\134n\323, PID, name, sockfd\051;) 18 580 T
(}) 18 566 T
(/* Listen to segments until \322End\323 */) 18 524 T
(void *receive_replies\050void *arg\051 {) 18 510 T
(  int                    i, j, sockfd = \050int\051 arg;) 18 496 T
(  struct sockaddr_in     serv_addr;) 18 482 T
(  char                   obuf[MESSAGE_SIZE], ibuf[MESSAGE_SIZE];) 18 468 T
(  char                   *name = thread_name\050pthread_self\050\051\051;) 18 454 T
(  set_up_signal_mask\050\051;) 18 426 T
(  printf\050\322Client_%d[%s] \134tReceiving segments on fd#%d...\134n\323,) 18 412 T
( PID, name, sockfd\051;) 54 398 T
(  for \050j=1; TRUE; j++\051) 18 370 T
(    {int         nbytes;) 18 356 T
(    nbytes = read\050sockfd, ibuf, MESSAGE_SIZE\051;) 18 328 T
(    if \050nbytes != MESSAGE_SIZE\051 {) 18 314 T
(      printf\050\322Read failed from Client_%d[%s]\134n\323, PID, name\051;) 18 300 T
(      if \050nbytes < 0\051 perror\050\322\322\051;) 18 286 T
(      thread_single_barrier_post\050&client_barrier\051;) 18 272 T
(      pthread_exit\050NULL\051;) 18 258 T
(    }) 18 244 T
(    DEBUG\050printf\050\322Client_%d[%s] received: \324%s\325\134n\323, PID, name, ibuf\051\051;) 18 230 T
(    if \050strncmp\050ibuf, END_CLIENT_MSG, 3\051 == 0\051 break;) 18 202 T
(    if \050\050j%1000 == 0\051 && ! \050j==0\051\051) 18 188 T
(      printf\050\322Client_%d[%s] \134tReceived %d segments on fd#%d.\134n\323,) 18 174 T
(             PID, name, j, sockfd\051;) 18 160 T
(    }) 18 146 T
(  close\050sockfd\051;) 18 118 T
(  if \050j < N_REQUESTS\051) 18 104 T
(    printf\050\322Client_%d[%s] \134tDone receiving on fd#%d.\134) 18 90 T
(Server dropped %d requests!\134n\323,) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "78" 78
%%Page: "79" 79
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(79) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(   PID, name, sockfd, N_REQUESTS-j\051;) 54 748 T
(  else) 18 734 T
(    printf\050\322Client_%d[%s] \134tDone receiving on fd#%d.\134n\323, PID, name, sockfd\051;) 18 720 T
(  thread_single_barrier_post\050&client_barrier\051;) 18 706 T
(}) 18 692 T
(int open_a_socket\050\051 {) 18 650 T
(  struct sockaddr_in     serv_addr;) 18 636 T
(  int sockfd, j;) 18 622 T
(  for \050j=REQUESTED_TCP_PORT; j<REQUESTED_TCP_PORT+MAX_PORT_RANGE;j++\051 {) 18 594 T
(    if \050\050sockfd = socket\050AF_INET, SOCK_STREAM, 0\051\051 < 0\051) 18 580 T
(      {perror\050\322clientsoc: can\325t open stream socket \322\051; abort\050\051;}) 18 566 T
(    memset\050\050char *\051 &serv_addr, 0, sizeof\050serv_addr\051\051;) 18 552 T
(    serv_addr.sin_family = AF_INET;) 18 538 T
(    serv_addr.sin_addr.s_addr = inet_addr\050SERV_HOST_ADDR\051;) 18 524 T
(    serv_addr.sin_port = htons\050j\051;) 18 510 T
(    if \050connect\050sockfd, \050struct sockaddr *\051 &serv_addr, sizeof\050serv_addr\051\051 < 0\051) 18 496 T
(      {) 18 482 T
(DEBUG\050printf\050\322Can\325t connect to server on port %d\134n\323, j\051\051;) 54 468 T
(close\050sockfd\051;) 54 454 T
(      }) 18 440 T
(    else) 18 426 T
(      break;) 18 412 T
(    if \050j==REQUESTED_TCP_PORT+MAX_PORT_RANGE-1\051 { /* Maybe server was down? */) 18 398 T
(      printf\050\322Maybe server was down? Starting again...\134n\323\051;) 18 384 T
(      j=REQUESTED_TCP_PORT-1;) 18 370 T
(      sleep\0505\051;) 18 356 T
(/* Don\325t rush. Let the server restart */) 126 356 T
(    }) 18 342 T
(  }) 18 328 T
(  ACTUAL_TCP_PORT=j;) 18 314 T
(  return\050sockfd\051;) 18 300 T
(}) 18 286 T
(main\050int argc, char **argv\051 {) 18 244 T
(  int                    i, j, sockfd, N_SOCKETS = 1;) 18 230 T
(  pthread_attr_t         attr;) 18 216 T
(  pthread_t              tid;) 18 202 T
(  struct rlimit) 18 188 T
(r;) 198 188 T
(  PID = getpid\050\051;) 18 146 T
(  if \050argc > 1\051 REQUESTED_TCP_PORT = atoi\050argv[1]\051;) 18 132 T
(  if \050argc > 2\051 SLEEP = atoi\050argv[2]\051;) 18 118 T
(  if \050argc > 3\051 SPIN = atoi\050argv[3]\051;) 18 104 T
(  if \050argc > 4\051 N_SOCKETS = atoi\050argv[4]\051;) 18 90 T
(  if \050argc > 5\051 N_REQUESTS = atoi\050argv[5]\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "79" 79
%%Page: "80" 80
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(80) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  if \050N_SOCKETS > MAX_FDS\051) 18 748 T
(      printf\050\322No more than %d connections allowed!\134n\323, MAX_FDS\051, abort\050\051;) 18 734 T
(  printf\050\322Client_%d\050PORT %d SLEEP %dms SPIN %dus N_SOCKETS %d \134) 18 720 T
(N_REQUESTS %d\051\134n\323,) 18 706 T
( PID, REQUESTED_TCP_PORT, SLEEP, SPIN, N_SOCKETS, N_REQUESTS\051;) 54 692 T
(  getrlimit\050RLIMIT_NOFILE, &r\051;) 18 636 T
(  r.rlim_cur=MAX_FDS+10;) 18 622 T
(  setrlimit\050RLIMIT_NOFILE, &r\051;) 18 608 T
(  /*  printf\050\322Current limit: %d Max limit: %d\134n\323, r.rlim_cur, r.rlim_max\051; */) 18 594 T
(  set_up_signal_mask\050\051;) 18 580 T
(  PTHREAD_ATTR_INIT\050&attr\051;) 18 538 T
(  pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 524 T
(  pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 510 T
(  thread_single_barrier_init\050&client_barrier, N_SOCKETS\051;) 18 496 T
(  iobench_start\050\051;) 18 468 T
(  for \050i=0; i < N_SOCKETS; i++\051 {) 18 440 T
(    sockfd=open_a_socket\050\051;) 18 426 T
(    printf\050\322Connected to server on port %d\134n\323, ACTUAL_TCP_PORT\051;) 18 412 T
(    PTHREAD_CREATE\050&tid, &attr, send_requests, \050void *\051 sockfd\051;) 18 398 T
(    PTHREAD_CREATE\050&tid, &attr, receive_replies, \050void *\051 sockfd\051;) 18 384 T
(  }) 18 370 T
(  thread_single_barrier_wait\050&client_barrier\051;) 18 342 T
(  iobench_end\050\051;) 18 328 T
(  iobench_report\050\051;) 18 314 T
(  exit\050NULL\051;) 18 300 T
(}) 18 286 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "80" 80
%%Page: "81" 81
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(81) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(T&S: No Threads:) 153.99 732 T
(ser) 237.85 684 T
(ver) 292.25 684 T
(.c) 344.12 684 T
4 12 Q
(/*                server_simple.c                */) 18 614 T
(/*) 18 586 T
(  A simple server program.  It sets up a TCP port for the client) 18 558 T
(  program to connect to.) 18 544 T
(  This version is unthreaded and very slow if there is any I/O delay) 18 516 T
(  simulated.) 18 502 T
(  On most errors this programs just aborts.) 18 474 T
(*/) 18 446 T
(/*) 18 390 T
(cc -o serve_simpler server_simple.c -L. -R. -g -lpthread  -lthread_extensions -) 18 376 T
(lposix4 -lnsl -lsocket) 18 362 T
(*/) 18 348 T
(#define _POSIX_C_SOURCE 199506L) 18 320 T
(/* Note that you need to define  __EXTENSIONS__ when using sockets. */) 18 306 T
(#define __EXTENSIONS__) 18 292 T
(#include <stdio.h>) 18 236 T
(#include <sys/types.h>) 18 222 T
(#include <sys/socket.h>) 18 208 T
(#include <netinet/in.h>) 18 194 T
(#include <arpa/inet.h>) 18 180 T
(#include <pthread.h>) 18 166 T
(#include <semaphore.h>) 18 152 T
(#include <time.h>) 18 138 T
(#include <limits.h>) 18 124 T
(#include <errno.h>) 18 110 T
(#include \322thread_extensions.h\323) 18 96 T
(/* Constants etc. */) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "81" 81
%%Page: "82" 82
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(82) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(#define                 MESSAGE_SIZE 70) 18 748 T
(const int               MAX_FDS = OPEN_MAX-10;         /* Solaris constant */) 18 706 T
( /* String sent by & to client when done */) 18 692 T
(const char              *END_CLIENT_MSG =) 18 678 T
(  \322End\1340                                                                   \322;) 18 664 T
(/* The structures for clients, and requests */) 18 594 T
(typedef struct client_struct {) 18 566 T
(  int                   socket;                 /* socket fd */) 18 538 T
(  char                  name[30];               /* \322Client_123[T@23]\323 */) 18 524 T
(  int                   outstanding_requests;   /* No. unanswered */) 18 510 T
(  pthread_mutex_t       lock;) 18 482 T
(  pthread_cond_t        cv;) 18 468 T
(} client_t;) 18 454 T
(typedef struct request_struct {) 18 426 T
(  client_t              *client;) 18 412 T
(  char                  data[MESSAGE_SIZE]; /* \322Client_7[T@4] Request: 4\323 */) 18 398 T
(  struct request_struct *next;) 18 384 T
(} request_t;) 18 370 T
(/* Optional command line arguments \050+ defaults\051 */) 18 300 T
(int                     SLEEP = 0, SPIN= 0, N_CONSUMERS=10;) 18 286 T
(int) 18 272 T
(REQUESTED_TCP_PORT = 6500, ACTUAL_TCP_PORT,) 217 272 T
(MAX_PORT_RANGE=100;) 217 258 T
(int                     STOPPER_SLEEP=-1, KILLER_SLEEP=-1;) 18 244 T
(/* Other useful bits */) 18 174 T
(int                     PID;) 18 160 T
(pthread_attr_t          attr;) 18 146 T
(int                     port_socket;) 18 132 T
(int                     n_replies=0;) 18 118 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "82" 82
%%Page: "83" 83
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(83) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(/* A List of REQUESTS with protection and related varaibles. */) 18 636 T
(request_t               *requests =     NULL;) 18 622 T
(int                     length =        0;) 18 608 T
(pthread_mutex_t         requests_lock = PTHREAD_MUTEX_INITIALIZER;) 18 594 T
(pthread_cond_t          producer_cv =   PTHREAD_COND_INITIALIZER;) 18 580 T
(pthread_cond_t          consumer_cv =   PTHREAD_COND_INITIALIZER;) 18 566 T
(/* Some function declarations */) 18 510 T
(client_t *new_client\050int\051;) 18 482 T
(void *producer\050void *\051;) 18 468 T
(request_t *get_request\050client_t *\051;) 18 454 T
(void *process_request\050request_t *\051;) 18 440 T
(/* A bunch of simple helper functions */) 18 398 T
(void set_up_signal_mask\050\051 {) 18 370 T
( sigset_t               s, s1, s2;) 18 356 T
( static struct          sigaction action;) 18 342 T
(/* Block everything first \050in particular SIGPIPE\051 */) 18 314 T
( sigfillset\050&s\051;) 18 300 T
( pthread_sigmask\050SIG_BLOCK, &s, &s2\051;) 18 286 T
( sigemptyset\050&s\051;) 18 272 T
( sigaddset\050&s, SIGUSR1\051;                /* For stopper\050\051 */) 18 258 T
( sigaddset\050&s, SIGINT\051;                 /* For ^C */) 18 244 T
( pthread_sigmask\050SIG_UNBLOCK, &s, &s1\051;) 18 230 T
(}) 18 216 T
(/* Keep track of the current number of clients for stats & fd limit */) 18 174 T
(int client_max_count = 0;) 18 160 T
(int count_clients\050int i\051 {) 18 132 T
(  static pthread_mutex_t counter_lock = PTHREAD_MUTEX_INITIALIZER;) 18 118 T
(  static int             client_count = 0;) 18 104 T
(  int j;) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "83" 83
%%Page: "84" 84
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(84) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  pthread_mutex_lock\050&counter_lock\051;) 18 748 T
(  client_count += i;) 18 734 T
(  if \050client_count > client_max_count\051) 18 720 T
(    client_max_count = client_count;) 18 706 T
(  j = client_count;) 18 692 T
(  pthread_mutex_unlock\050&counter_lock\051;) 18 678 T
(  return\050j\051;) 18 664 T
(}) 18 650 T
(int count_requests\050int i\051 {) 18 454 T
(  static int count=0;) 18 440 T
(  static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 18 426 T
( pthread_mutex_lock\050&count_lock\051;) 18 398 T
( count += i;) 18 384 T
( i = count;) 18 370 T
( pthread_mutex_unlock\050&count_lock\051;) 18 356 T
( return\050i\051;) 18 342 T
(/* Can\325t return count */) 287 342 T
(}) 18 328 T
(void print_requests\050\051) 18 300 T
({request_t              *r = requests;) 18 286 T
( while \050r != NULL\051) 18 258 T
(   {printf\050\322<Request: %d>\134n\323, r->client->socket\051;) 18 244 T
(    r = r->next;) 18 230 T
(  }) 18 216 T
(}) 18 202 T
(/* Synchronize on the number of OUTSTANDING REQUESTS per client. */) 18 160 T
(void wait_for_requests_to_zero\050client_t *client\051 {) 18 132 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "84" 84
%%Page: "85" 85
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(85) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(}) 18 748 T
(int decrement_requests_for\050client_t *client\051 {) 18 720 T
(  int i;) 18 706 T
(  return\050i\051;) 18 594 T
(}) 18 580 T
(void increment_requests_for\050client_t *client\051 {) 18 552 T
(}) 18 496 T
(/* Build a new REQUEST */) 18 454 T
(request_t *new_request\050client_t *client, char *ibuf\051 {) 18 426 T
(  request_t             *request;) 18 412 T
(  pthread_t tid = pthread_self\050\051;) 18 384 T
(  DEBUG\050printf\050\322Server_%d[%s] get_request\050\051 received: \134\323%s\134\323\134n\323,) 18 370 T
(               PID, thread_name\050tid\051, ibuf\051\051;) 18 356 T
(  request = \050request_t *\051 malloc\050sizeof\050request_t\051\051;) 18 342 T
(  request->client = client;) 18 328 T
(  strcpy\050request->data, ibuf\051;) 18 314 T
(  count_requests\0501\051;) 18 300 T
(  return\050request\051;) 18 174 T
(}) 18 160 T
(int delete_request\050request_t *request\051 {) 18 118 T
(  int i;) 18 104 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "85" 85
%%Page: "86" 86
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(86) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  free\050request\051;) 18 748 T
(  return\050i\051;) 18 734 T
(}) 18 720 T
(/*) 18 664 T
(  Send \322End\323 and close the socket.) 18 650 T
(*/) 18 608 T
(void close_client\050client_t *client\051 {) 18 580 T
(  int j;) 18 566 T
(  DEBUG\050printf\050\322Closing socket %s...\134n\323, client->name\051\051;) 18 538 T
(  pthread_mutex_lock\050&client->lock\051;) 18 510 T
(  if \050client->socket != -1\051 {) 18 496 T
(/* Ensure only close\050\051 once. */) 234 496 T
(    write\050client->socket, END_CLIENT_MSG, MESSAGE_SIZE\051;   /* Ignore errors */) 18 482 T
(    close\050client->socket\051;) 18 468 T
(    client->socket = -1;) 18 454 T
(    j = count_clients\050-1\051;) 18 412 T
(    DEBUG\050printf\050\322Closed %s. \050%d active clients\051\134n\323,) 18 370 T
(                 client->name, count_clients\0500\051\051\051;) 18 356 T
(  }) 18 342 T
(  pthread_mutex_unlock\050&client->lock\051;) 18 328 T
(}) 18 314 T
(void write_msg\050client_t *client, char *obuf\051 {) 18 230 T
(  int                   nbytes, socket, active;) 18 216 T
(  char                  *cname;) 18 202 T
(  char                  *t_name = thread_name\050pthread_self\050\051\051;) 18 188 T
(  DEBUG\050printf\050\322Server_%d[%s] write_msg\050\051 sending: \134\323%s\134\323\134n\323,) 18 160 T
(               PID, t_name, obuf\051\051;) 18 146 T
(  pthread_mutex_lock\050&client->lock\051;) 18 132 T
(  socket = client->socket;) 18 118 T
(  cname  = client->name;) 18 104 T
(  pthread_mutex_unlock\050&client->lock\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "86" 86
%%Page: "87" 87
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(87) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  retry: nbytes = write\050socket, obuf, MESSAGE_SIZE\051;) 18 720 T
(  if \050nbytes == MESSAGE_SIZE\051 {) 18 692 T
(    return;) 18 678 T
(  }) 18 664 T
(  if \050nbytes > -1\051 {) 18 636 T
(    printf\050\322Only wrote %d bytes to %s. \050Impossible?\051\323, nbytes, cname\051;) 18 622 T
(    abort\050\051;) 18 608 T
(  }) 18 594 T
(  if \050errno == EINTR\051 {) 18 566 T
(    printf\050\322EINTR while trying to write to %s on fd#%d. retrying...\134n\323,) 18 552 T
(   cname, socket\051;) 74 538 T
(    goto retry;) 18 524 T
(  }) 18 510 T
(  if \050\050errno == EPIPE\051 || \050errno == EBADF\051\051 {) 18 482 T
(    printf\050\322Failed trying to write to %s. \134n\323, cname\051;) 18 468 T
(    perror\050\322Closing socket\323\051;) 18 454 T
(    close_client\050client\051;) 18 398 T
(    return;) 18 384 T
(  }) 18 370 T
(  else) 18 356 T
(    perror\050\322Unknown bug \050Impossible?\051\323\051, abort\050\051;) 18 342 T
(}) 18 328 T
(/* Manipulate the requests list. Caller must own requests_lock. */) 18 272 T
(request_t *remove_request\050\051 {) 18 258 T
(  request_t *request;) 18 244 T
(  request = requests;) 18 216 T
(  requests = requests->next;) 18 202 T
(  length--;) 18 188 T
(  return\050request\051;) 18 174 T
(}) 18 160 T
(void add_request\050request_t *request\051 {) 18 132 T
(  request->next = requests;) 18 118 T
(/* Insert at head of list */) 306 118 T
(  requests = request;) 18 104 T
(  length++;) 18 90 T
(}) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "87" 87
%%Page: "88" 88
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(88) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(int open_port\050\051 {) 18 720 T
(  struct sockaddr_in    cli_addr, serv_addr;) 18 706 T
(  int                   port_socket, clilen, i;) 18 692 T
(  /* Open a new port. Try to get requested port. */) 18 664 T
(  if\050\050port_socket = socket\050AF_INET, SOCK_STREAM, 0\051\051 < 0\051) 18 650 T
(    perror\050\322Can\325t create new socket\323\051, abort\050\051;) 18 636 T
(  for \050i=REQUESTED_TCP_PORT; i< REQUESTED_TCP_PORT+MAX_PORT_RANGE; i++\051 {) 18 608 T
(    memset\050\050char *\051 &serv_addr, 0, sizeof\050serv_addr\051\051;) 18 594 T
(    serv_addr.sin_family = AF_INET;) 18 580 T
(    serv_addr.sin_addr.s_addr = htonl\050INADDR_ANY\051;) 18 566 T
(    serv_addr.sin_port = htons\050i\051;) 18 552 T
(    if \050bind\050port_socket, \050struct sockaddr *\051&serv_addr, sizeof\050serv_addr\051\051<0\051) 18 538 T
(      {DEBUG\050printf\050\322Can\325t bind to port %d\134n\323, i\051\051;}) 18 524 T
(    else {) 18 510 T
(      printf\050\322Server bound to port: %d\134n\323, i\051;) 18 496 T
(      ACTUAL_TCP_PORT=i;) 18 482 T
(      listen\050port_socket, 5\051;) 18 468 T
(      return\050port_socket\051;) 18 454 T
(    }) 18 440 T
(  }) 18 426 T
(  printf\050\322Could not find an available port from %d to %d\323,) 18 412 T
( REQUESTED_TCP_PORT, REQUESTED_TCP_PORT+MAX_PORT_RANGE\051;) 74 398 T
(  abort\050\051;) 18 384 T
(}) 18 370 T
(client_t *accept_a_connection\050int port_socket\051 {) 18 314 T
(  int                   new_socket, clilen;) 18 300 T
(  struct sockaddr_in    cli_addr;) 18 286 T
(  clilen = sizeof\050cli_addr\051;) 18 258 T
(  new_socket = accept\050port_socket, \050struct sockaddr *\051 &cli_addr, &clilen\051;) 18 244 T
(  if \050new_socket < 0\051) 18 230 T
(    perror\050\322Accept failed. \050Impossible?\051\323\051, abort\050\051;) 18 216 T
(  return\050new_client\050new_socket\051\051;) 18 188 T
(}) 18 174 T
(void *reporter\050void *arg\051 {) 18 132 T
(  while \050TRUE\051 {) 18 104 T
(    sleep\05030\051;) 18 90 T
(    printf\050\322Server up on port %d. Processed %d requests.\134n\323,) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "88" 88
%%Page: "89" 89
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(89) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(   ACTUAL_TCP_PORT, count_requests\0500\051\051;) 74 748 T
(  }) 18 734 T
(}) 18 720 T
(int startup_initialize\050\051 {) 18 678 T
(  int) 18 664 T
(i;) 144 664 T
(  set_up_signal_mask\050\051;) 18 636 T
(  PTHREAD_ATTR_INIT\050&attr\051;) 18 608 T
(  pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 594 T
(  pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 580 T
(}) 18 552 T
(void *acceptor\050void *arg\051 {) 18 510 T
(  client_t *client;) 18 496 T
(  pthread_t tid;) 18 482 T
(  int port_socket = \050int\051 arg;) 18 468 T
(  while \050TRUE\051 {) 18 440 T
(    client = accept_a_connection\050port_socket\051;) 18 426 T
(    PTHREAD_CREATE\050&tid, &attr, producer, \050void *\051 client\051;) 18 412 T
(  }) 18 398 T
(}) 18 384 T
(client_t *new_client\050int socket\051 {) 18 328 T
(  client_t *client = \050client_t *\051 malloc\050sizeof\050client_t\051\051;) 18 314 T
(  client->socket = socket;) 18 286 T
(  client->outstanding_requests=0;) 18 258 T
(  count_clients\0501\051;) 18 244 T
(  DEBUG\050printf\050\322New Client fd#%d. \050%d active clients\051\134n\323,) 18 230 T
(       socket, count_clients\0500\051\051\051;) 74 216 T
(  return\050client\051;) 18 202 T
(}) 18 188 T
(void *producer\050void *arg\051 {) 18 160 T
(  request_t *request;) 18 146 T
(  client_t *client = \050client_t *\051 arg;) 18 132 T
(  DEBUG\050printf\050\322Producer starting.\134n\323\051\051;) 18 104 T
(  while \050TRUE\051 {) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "89" 89
%%Page: "90" 90
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(90) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    request = get_request\050client\051;) 18 748 T
(    if \050request == NULL\051  {) 18 734 T
(      close_client\050client\051;) 18 720 T
(      return;) 18 706 T
(    }) 18 692 T
(    process_request\050request\051;) 18 678 T
(  }) 18 664 T
(}) 18 650 T
(request_t *get_request\050client_t *client\051 {) 18 622 T
(  request_t) 18 608 T
(*request;) 144 608 T
(  char) 18 594 T
(ibuf[MESSAGE_SIZE];) 144 594 T
(  int) 18 580 T
(nbytes;) 144 580 T
(  nbytes = read\050client->socket, ibuf, MESSAGE_SIZE\051;) 18 552 T
(  if \050nbytes != MESSAGE_SIZE\051 {printf\050\322Read failed!\134n\323\051; abort\050\051;}) 18 538 T
(  if \050strncmp\050ibuf, END_CLIENT_MSG, 3\051 == 0\051 return\050NULL\051;) 18 524 T
(  request = new_request\050client, ibuf\051;) 18 496 T
(  return\050request\051;) 18 482 T
(}) 18 468 T
(/* Send a reply back to client */) 18 412 T
(void *process_request\050request_t *request\051 {) 18 398 T
(  client_t              *client = request->client;) 18 384 T
(  char                  *cname;) 18 370 T
(  char                  obuf[MESSAGE_SIZE];) 18 356 T
(  char                  *t_name = thread_name\050pthread_self\050\051\051;) 18 342 T
(  int                   i, nbytes, finishing, socket;) 18 328 T
(  DEBUG\050printf\050\322Server_%d[%s] processing: \134\323%s\134\323\134n\323,) 18 300 T
(       PID, t_name, request->data\051\051;) 74 286 T
(  delay\050SLEEP, SPIN\051;) 18 258 T
(  sprintf\050obuf, \322Server_%d[%s] reply %d to %s\323,) 18 244 T
(  PID, t_name, n_replies++, request->data\051;) 74 230 T
(  write_msg\050client, obuf\051;) 18 216 T
(  delete_request\050request\051;) 18 202 T
(}) 18 188 T
(main\050int argc, char **argv\051 {) 18 160 T
(  int                   i;) 18 146 T
(  pthread_t tid;) 18 132 T
(  PID = getpid\050\051;) 18 104 T
(  if \050argc > 1\051 REQUESTED_TCP_PORT = atoi\050argv[1]\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "90" 90
%%Page: "91" 91
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(91) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  if \050argc > 2\051 SLEEP = atoi\050argv[2]\051;) 18 748 T
(  if \050argc > 3\051 SPIN = atoi\050argv[3]\051;) 18 734 T
(  if \050argc > 4\051 N_CONSUMERS = atoi\050argv[4]\051;) 18 720 T
(  if \050argc > 5\051 STOPPER_SLEEP = atoi\050argv[5]\051;) 18 706 T
(  if \050argc > 6\051 KILLER_SLEEP = atoi\050argv[6]\051;) 18 692 T
(  printf\050\322Server_%d\050TCP_PORT %d SLEEP %dms SPIN %dus N_CONSUMERS \134n\134) 18 678 T
(%d STOPPER %ds KILLER %ds\051\134n\323,) 18 664 T
(         PID, REQUESTED_TCP_PORT, SLEEP, SPIN, N_CONSUMERS,) 18 650 T
(         STOPPER_SLEEP, KILLER_SLEEP\051;) 18 636 T
(  startup_initialize\050\051;) 18 608 T
(  PTHREAD_CREATE\050&tid, &attr, reporter, NULL\051;) 18 580 T
(  port_socket = open_port\050\051;) 18 552 T
(  if \050KILLER_SLEEP > 0\051) 18 538 T
(    PTHREAD_CREATE\050&tid, &attr, killer, \050void *\051 KILLER_SLEEP\051;) 18 524 T
(  acceptor\050\050void *\051port_socket\051;) 18 496 T
(}) 18 482 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "91" 91
%%Page: "92" 92
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(92) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 152.15 543.75 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
450.05 254 M
 453.18 260.26 438.14 266.08 428.3 258.39 D
 418.4 250.65 406.28 269.55 388.95 255.46 D
3 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
90 450 1.5 1.5 90 420.04 235.28 GG
420.04 236.78 416.24 236.78 420.04 250.02 423.83 236.78 4 Y
0 Z
N
420.04 236.78 416.24 236.78 420.04 250.02 423.83 236.78 4 Y
V
420.04 235.28 420.04 229.13 2 L
2 Z
N
366.81 255.44 M
 369.94 261.7 354.9 267.52 345.06 259.83 D
 335.16 252.09 323.04 270.99 305.71 256.9 D
N
90 450 1.5 1.5 90 336.8 236.72 GG
336.8 238.22 333 238.22 336.8 251.46 340.59 238.22 4 Y
0 Z
N
336.8 238.22 333 238.22 336.8 251.46 340.59 238.22 4 Y
V
336.8 236.72 336.8 230.57 2 L
2 Z
N
290.21 259.76 M
 293.35 266.02 278.3 271.84 268.46 264.15 D
 258.57 256.41 246.45 275.31 229.12 261.22 D
N
90 450 1.5 1.5 90 260.2 241.04 GG
260.2 242.54 256.4 242.54 260.2 255.78 264 242.54 4 Y
0 Z
N
260.2 242.54 256.4 242.54 260.2 255.78 264 242.54 4 Y
V
260.2 241.04 260.2 234.89 2 L
2 Z
N
213.17 256.88 M
 216.31 263.14 201.26 268.96 191.43 261.27 D
 181.53 253.53 169.41 272.43 152.08 258.34 D
N
90 450 1.5 1.5 90 183.16 238.16 GG
183.16 239.66 179.36 239.66 183.16 252.9 186.96 239.66 4 Y
0 Z
N
183.16 239.66 179.36 239.66 183.16 252.9 186.96 239.66 4 Y
V
183.16 238.16 183.16 232.01 2 L
2 Z
N
321.61 402.54 M
 324.75 408.8 309.7 414.62 299.87 406.92 D
 289.97 399.19 277.85 418.09 260.52 404 D
N
90 450 1.5 1.5 90 291.6 383.81 GG
291.6 385.31 287.8 385.31 291.6 398.56 295.4 385.31 4 Y
0 Z
N
291.6 385.31 287.8 385.31 291.6 398.56 295.4 385.31 4 Y
V
291.6 383.81 291.6 377.67 2 L
2 Z
N
388.73 294.71 391.15 295.78 392.46 286.28 386.32 293.64 4 Y
1 H
0 Z
N
388.73 294.71 391.15 295.78 392.46 286.28 386.32 293.64 4 Y
V
320.11 371.47 M
 348.5 351.2 374.48 327.02 388.53 295.17 D
2 Z
N
326.74 286.61 329.22 287.55 330.04 277.98 324.27 285.66 4 Y
0 Z
N
326.74 286.61 329.22 287.55 330.04 277.98 324.27 285.66 4 Y
V
307.87 367.87 M
 314.14 340.73 316.68 312.96 326.57 287.08 D
2 Z
N
246.43 296.45 249.07 296.67 247.2 287.26 243.8 296.23 4 Y
0 Z
N
246.43 296.45 249.07 296.67 247.2 287.26 243.8 296.23 4 Y
V
277.63 369.31 M
 258.56 350.52 244.15 323.81 246.39 296.95 D
2 Z
N
185.3 297.27 187.93 296.96 184.23 288.09 182.67 297.57 4 Y
0 Z
N
185.3 297.27 187.93 296.96 184.23 288.09 182.67 297.57 4 Y
V
266.83 372.19 M
 229.61 361.38 190 337.5 185.36 297.76 D
2 Z
N
293.19 569.45 290.55 569.45 293.19 578.67 295.84 569.45 4 Y
0 Z
N
293.19 569.45 290.55 569.45 293.19 578.67 295.84 569.45 4 Y
V
293.19 446.8 295.84 446.8 293.19 437.58 290.55 446.8 4 Y
N
293.19 446.8 295.84 446.8 293.19 437.58 290.55 446.8 4 Y
V
293.19 568.95 293.19 447.3 2 L
N
2 18 Q
(Soc) 0 -90 304.71 545.2 TF
(ket) 0 -90 304.71 512.55 TF
(\322Data Segment ...) 0 -90 444.73 529 TF
(\323) 0 -90 444.73 382.12 TF
(\322D) 0 -90 336.73 331 TF
(.S...) 0 -90 336.73 309.54 TF
(\323) 0 -90 336.73 279.68 TF
(\322D) 0 -90 265.96 332.09 TF
(.S...) 0 -90 265.96 310.63 TF
(\323) 0 -90 265.96 280.77 TF
(\322Data Segment ...) 0 -90 176.08 538 TF
(\323) 0 -90 176.08 391.12 TF
404.79 684.88 476.07 737.44 R
N
290.31 676.24 361.59 728.8 R
N
172.24 670.48 243.51 723.04 R
N
437.78 289.27 440.27 288.38 434.7 280.58 435.29 290.15 4 Y
N
437.78 289.27 440.27 288.38 434.7 280.58 435.29 290.15 4 Y
V
443.48 664.38 440.99 663.56 440.64 673.08 445.98 665.19 4 Y
N
443.48 664.38 440.99 663.56 440.64 673.08 445.98 665.19 4 Y
V
443.64 663.9 M
 470.77 580.93 490.13 493.2 475.17 405.54 D
 468.33 365.46 451.55 328.03 437.95 289.74 D
N
163.74 307.05 166.3 307.74 166.12 298.13 161.18 306.37 4 Y
N
163.74 307.05 166.3 307.74 166.12 298.13 161.18 306.37 4 Y
V
199.04 651.2 197.01 652.88 204.92 658.29 201.07 649.51 4 Y
N
199.04 651.2 197.01 652.88 204.92 658.29 201.07 649.51 4 Y
V
198.72 650.81 M
 126.77 564 147.76 433.1 160.79 327.21 D
 161.58 320.73 161.89 313.99 163.61 307.54 D
N
(W) 0 -90 101.91 721.88 TF
(orker thread e) 0 -90 101.91 705.96 TF
(xits after ser) 0 -90 101.91 586.19 TF
(ving the one request.) 0 -90 101.91 478.97 TF
2 32 Q
(Master/Sla) 0 -90 512.91 744.88 TF
(ve \0502\051 \322Thread per Request\323) 0 -90 512.91 585.29 TF
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "92" 92
%%Page: "93" 93
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(93) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Ex) 146.45 732 T
(er) 190.12 732 T
(cise Objective) 223.42 732 T
2 18 Q
-0.35 (Edit the code in) 18 658 P
4 F
-0.75 (server.c) 155.65 658 P
2 F
-0.35 ( and c) 242.05 658 P
-0.35 (hang) 293.19 658 P
-0.35 (e it so that instead of pr) 336.38 658 P
-0.35 (ocess-) 536.97 658 P
(ing e) 18 636 T
(ver) 59.74 636 T
(y request as it comes in, the incoming requests are put) 86.94 636 T
(onto a queue) 18 614 T
(. Then create 10 consumer threads whic) 130.37 614 T
(h e) 472.32 614 T
(x) 498.06 614 T
(ecute the) 507.89 614 T
(c) 18 592 T
(lassic Pr) 27.65 592 T
(oducer/Consumer code to remo) 101.34 592 T
(ve those requests and) 373.03 592 T
(send replies bac) 18 570 T
(k \050as in the e) 158.71 570 T
(xisting code\051.) 267.48 570 T
(Extra: Ad) 18 526 T
(d a method of stopping the ser) 97.83 526 T
(ver) 361.04 526 T
(, suc) 386.98 526 T
(h as in) 427.82 526 T
4 F
(stop_queue_solution.c) 18 504 T
2 F
(.) 244.8 504 T
(Hint: Soc) 18 460 T
(ket connections take ~5 min) 96.64 460 T
(utes to time-out if y) 337.05 460 T
(our pr) 502.61 460 T
(o-) 554.26 460 T
(gram crashes \050e) 18 438 T
(.g., y) 156.42 438 T
(ou ^C it\051. Y) 196.99 438 T
(ou can run the code with diff) 289.71 438 T
(erent) 534.56 438 T
(soc) 18 416 T
(kets:) 48.65 416 T
4 F
(% server 6501&) 18 372 T
(% client 6501) 18 350 T
2 F
(Make sure that y) 18 306 T
(ou send replies to) 158.6 306 T
5 F
(all) 317.65 306 T
2 F
( the requests. The c) 337.66 306 T
(lient will) 506.36 306 T
(tell y) 18 284 T
(ou if it didn\325t g) 58.57 284 T
(et all the replies:) 182.75 284 T
4 F
(Client[T@5] Done recving. Server dropped 85 requests!) 18 240 T
2 F
(My solution is in) 18 196 T
4 F
(server_pc.c) 164.03 196 T
2 F
(. Man) 282.83 196 T
(y minor v) 328.48 196 T
(ariations of the same) 408.15 196 T
(basic code are possib) 18 174 T
(le) 205.9 174 T
(.) 221.27 174 T
(Wild Guess at Time to Completion:) 18 130 T
(30 min) 198 108 T
(utes think/design time) 254.84 108 T
(.) 445.25 108 T
(2 hour) 198 86 T
(s pr) 252.74 86 T
(ogramming/deb) 285.39 86 T
(ug) 420.05 86 T
(ging) 441.86 86 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "93" 93
%%Page: "94" 94
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(94) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 152.15 548.51 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
441.97 254 M
 444.65 260.26 431.8 266.08 423.39 258.39 D
 414.93 250.65 404.58 269.55 389.77 255.46 D
3 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
90 450 1.5 1.5 90 416.33 235.28 GG
416.33 236.78 412.53 236.78 416.33 250.02 420.13 236.78 4 Y
0 Z
N
416.33 236.78 412.53 236.78 416.33 250.02 420.13 236.78 4 Y
V
416.33 235.28 416.33 229.13 2 L
2 Z
N
370.85 255.44 M
 373.53 261.7 360.67 267.52 352.27 259.83 D
 343.81 252.09 333.46 270.99 318.65 256.9 D
N
90 450 1.5 1.5 90 345.21 236.72 GG
345.21 238.22 341.41 238.22 345.21 251.46 349.01 238.22 4 Y
0 Z
N
345.21 238.22 341.41 238.22 345.21 251.46 349.01 238.22 4 Y
V
345.21 236.72 345.21 230.57 2 L
2 Z
N
305.41 259.76 M
 308.09 266.02 295.23 271.84 286.83 264.15 D
 278.37 256.41 268.01 275.31 253.21 261.22 D
N
90 450 1.5 1.5 90 279.77 241.04 GG
279.77 242.54 275.97 242.54 279.77 255.78 283.56 242.54 4 Y
0 Z
N
279.77 242.54 275.97 242.54 279.77 255.78 283.56 242.54 4 Y
V
279.77 241.04 279.77 234.89 2 L
2 Z
N
239.59 256.88 M
 242.26 263.14 229.41 268.96 221 261.27 D
 212.55 253.53 202.19 272.43 187.38 258.34 D
N
90 450 1.5 1.5 90 213.94 238.16 GG
213.94 239.66 210.15 239.66 213.94 252.9 217.74 239.66 4 Y
0 Z
N
213.94 239.66 210.15 239.66 213.94 252.9 217.74 239.66 4 Y
V
213.94 238.16 213.94 232.01 2 L
2 Z
N
333.94 455.1 M
 336.62 461.36 323.77 467.17 315.36 459.48 D
 306.9 451.75 296.55 470.64 281.74 456.56 D
N
90 450 1.5 1.5 90 308.3 436.37 GG
308.3 437.87 304.5 437.87 308.3 451.12 312.1 437.87 4 Y
0 Z
N
308.3 437.87 304.5 437.87 308.3 451.12 312.1 437.87 4 Y
V
308.3 436.37 308.3 430.23 2 L
2 Z
N
310 479.03 312.64 479.03 310 469.81 307.36 479.03 4 Y
1 H
0 Z
N
310 479.03 312.64 479.03 310 469.81 307.36 479.03 4 Y
V
310 670 310 479.53 2 L
2 Z
N
4 14 Q
(\322request #435\323) 0 -90 321.83 657.76 TF
403.3 684.88 464.2 737.44 R
0 Z
N
305.49 676.24 366.39 728.8 R
N
204.61 670.48 265.51 723.04 R
N
436.43 664.13 433.87 663.42 433.94 673.05 438.99 664.85 4 Y
N
436.43 664.13 433.87 663.42 433.94 673.05 438.99 664.85 4 Y
V
436.56 663.65 M
 459.73 580.73 476.2 493.11 463.43 405.54 D
 457.04 361.67 440.75 320.86 428.34 278.88 D
2 Z
N
227.17 650.68 225.01 652.2 232.48 658.2 229.32 649.16 4 Y
0 Z
N
227.17 650.68 225.01 652.2 232.48 658.2 229.32 649.16 4 Y
V
226.88 650.27 M
 165.43 563.2 183.72 432.89 194.83 327.21 D
 195.9 316.99 196.8 306.39 199.79 296.38 D
2 Z
N
390.39 492.64 408.84 553.12 R
0 Z
N
408.84 515.68 390.39 515.68 2 L
2 Z
N
90 450 4.68 3.69 270 399.61 505.24 GG
90 450 4.68 3.69 270 399.61 505.24 AA
(R1) 0 -90 394.67 547.01 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
390.39 412.73 408.84 473.21 R
0 Z
N
408.84 435.77 390.39 435.77 2 L
2 Z
N
90 450 4.68 3.69 270 399.61 425.33 GG
90 450 4.68 3.69 270 399.61 425.33 AA
(R2) 0 -90 394.67 467.09 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
390.39 327.05 408.84 387.53 R
0 Z
N
408.84 350.09 390.39 350.09 2 L
2 Z
N
90 450 4.68 3.69 270 399.61 339.65 GG
90 450 4.68 3.69 270 399.61 339.65 AA
(R3) 0 -90 394.67 381.41 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
399.61 484.96 402.26 484.96 399.61 475.74 396.97 484.96 4 Y
0 Z
N
399.61 484.96 402.26 484.96 399.61 475.74 396.97 484.96 4 Y
V
399.61 502.01 399.61 485.46 2 L
2 Z
N
400.23 402.16 402.87 402.16 400.23 392.94 397.58 402.16 4 Y
0 Z
N
400.23 402.16 402.87 402.16 400.23 392.94 397.58 402.16 4 Y
V
400.23 419.21 400.23 402.66 2 L
2 Z
N
372.98 536.26 371.87 538.66 381.36 540.12 374.08 533.86 4 Y
0 Z
N
372.98 536.26 371.87 538.66 381.36 540.12 374.08 533.86 4 Y
V
321.96 446.2 M
 333.4 434.06 358.15 443.86 361.29 458.17 D
 366.6 482.45 346.48 524.04 372.52 536.05 D
2 Z
N
370.12 411.84 368.04 413.47 375.81 419.11 372.21 410.21 4 Y
0 Z
N
370.12 411.84 368.04 413.47 375.81 419.11 372.21 410.21 4 Y
V
349.17 265.85 M
 325.69 310.74 340.23 373.61 369.82 411.44 D
2 Z
N
358.31 345.73 357.76 348.31 367.33 347.66 358.87 343.14 4 Y
0 Z
N
358.31 345.73 357.76 348.31 367.33 347.66 358.87 343.14 4 Y
V
277.81 273.77 M
 277.73 318.76 322.89 338.11 357.83 345.62 D
2 Z
N
(\322Reply #124\323) 0 -90 203.08 547 TF
(\322Reply #999) 0 -90 444.73 529 TF
2 18 Q
(W) 0 -90 134.68 727.88 TF
(orker threads take requests fr) 0 -90 134.68 711.96 TF
(om queue) 0 -90 134.68 458.24 TF
(, e) 0 -90 134.68 373.04 TF
(x) 0 -90 134.68 353.3 TF
(ecute them, then go) 0 -90 134.68 343.47 TF
(bac) 0 -90 116.68 727.88 TF
(k f) 0 -90 116.68 697.22 TF
(or more requests.) 0 -90 116.68 676.58 TF
2 32 Q
(W) 0 -90 509.67 687.88 TF
(orkpile \050Pr) 0 -90 509.67 659.59 TF
(oducer/Consumer\051) 0 -90 509.67 501.96 TF
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "94" 94
%%Page: "95" 95
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(95) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(T&S: Pr) 80.33 732 T
(oducer/Consumer:) 211.63 732 T
(ser) 205.76 684 T
(ver_pc.c) 260.15 684 T
4 12 Q
(/*                server_pc.c                */) 18 614 T
(/* 4567890 234567890 234567890 234567890 234567890 234567890 234567890 2345678*/) 18 600 T
(/*) 18 586 T
(  A simple server program.  It sets up a TCP port for the client) 18 558 T
(  program to connect to.) 18 544 T
(  This version is really just a producer/consumer program that happens) 18 516 T
(  to run across a socket.) 18 502 T
(  This version checks to ensure all replies have been sent out before) 18 474 T
(  closing the socket.) 18 460 T
(  On most errors this programs just aborts.) 18 432 T
(*/) 18 390 T
(#define _POSIX_C_SOURCE 199506L) 18 334 T
(/* Note that you need to define  __EXTENSIONS__ when using sockets. */) 18 320 T
(#define __EXTENSIONS__) 18 306 T
(#include <stdio.h>) 18 250 T
(#include <sys/types.h>) 18 236 T
(#include <sys/socket.h>) 18 222 T
(#include <netinet/in.h>) 18 208 T
(#include <arpa/inet.h>) 18 194 T
(#include <pthread.h>) 18 180 T
(#include <semaphore.h>) 18 166 T
(#include <time.h>) 18 152 T
(#include <limits.h>) 18 138 T
(#include <errno.h>) 18 124 T
(#include \322thread_extensions.h\323) 18 110 T
(/* Constants etc. */) 18 82 T
(#define                 MESSAGE_SIZE 70) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "95" 95
%%Page: "96" 96
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(96) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(const int               MAX_FDS = OPEN_MAX-10;         /* Solaris constant */) 18 720 T
( /* String sent by & to client when done */) 18 706 T
(const char              *END_CLIENT_MSG =) 18 692 T
(  \322End\1340                                                                   \322;) 18 678 T
(/* The structures for clients, and requests */) 18 608 T
(typedef struct client_struct {) 18 580 T
(  int                   socket;                 /* socket fd */) 18 552 T
(  char                  name[30];               /* \322Client_123[T@23]\323 */) 18 538 T
(  int                   outstanding_requests;   /* No. unanswered */) 18 524 T
(  pthread_mutex_t       lock;) 18 496 T
(  pthread_cond_t        cv;) 18 482 T
(} client_t;) 18 468 T
(typedef struct request_struct {) 18 440 T
(  client_t              *client;) 18 426 T
(  char                  data[MESSAGE_SIZE]; /* \322Client_7[T@4] Request: 4\323 */) 18 412 T
(  struct request_struct *next;) 18 398 T
(} request_t;) 18 384 T
(/* Optional command line arguments \050+ defaults\051 */) 18 314 T
(int                     SLEEP = 0, SPIN= 0, N_CONSUMERS=10;) 18 300 T
(int) 18 286 T
(REQUESTED_TCP_PORT = 6500, ACTUAL_TCP_PORT,) 217 286 T
(MAX_PORT_RANGE=100;) 217 272 T
(int                     STOPPER_SLEEP=-1, KILLER_SLEEP=-1;) 18 258 T
(/* Other useful bits */) 18 188 T
(int                     PID;) 18 174 T
(pthread_attr_t          attr;) 18 160 T
(int                     port_socket;) 18 146 T
(int                     n_replies=0;) 18 132 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "96" 96
%%Page: "97" 97
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(97) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(/* A List of REQUESTS with protection and related varaibles. */) 18 650 T
(request_t               *requests =     NULL;) 18 636 T
(int                     length =        0;) 18 622 T
(pthread_mutex_t         requests_lock = PTHREAD_MUTEX_INITIALIZER;) 18 608 T
(pthread_cond_t          producer_cv =   PTHREAD_COND_INITIALIZER;) 18 594 T
(pthread_cond_t          consumer_cv =   PTHREAD_COND_INITIALIZER;) 18 580 T
(/* Some function declarations */) 18 524 T
(client_t *new_client\050int\051;) 18 496 T
(void *producer\050void *\051;) 18 482 T
(request_t *get_request\050client_t *\051;) 18 468 T
(void *process_request\050request_t *\051;) 18 454 T
(/* A bunch of simple helper functions */) 18 412 T
(void set_up_signal_mask\050\051 {) 18 384 T
( sigset_t               s, s1, s2;) 18 370 T
( static struct          sigaction action;) 18 356 T
(/* Block everything first \050in particular SIGPIPE\051 */) 18 328 T
( sigfillset\050&s\051;) 18 314 T
( pthread_sigmask\050SIG_BLOCK, &s, &s2\051;) 18 300 T
( sigemptyset\050&s\051;) 18 286 T
( sigaddset\050&s, SIGINT\051;                 /* For ^C */) 18 258 T
( pthread_sigmask\050SIG_UNBLOCK, &s, &s1\051;) 18 244 T
(}) 18 230 T
(/* Keep track of the current number of clients for stats & fd limit */) 18 188 T
(int client_max_count = 0;) 18 174 T
(int count_clients\050int i\051 {) 18 146 T
(  static pthread_mutex_t counter_lock = PTHREAD_MUTEX_INITIALIZER;) 18 132 T
(  static int             client_count = 0;) 18 118 T
(  int j;) 18 104 T
(  pthread_mutex_lock\050&counter_lock\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "97" 97
%%Page: "98" 98
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(98) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  client_count += i;) 18 748 T
(  if \050client_count > client_max_count\051) 18 734 T
(    client_max_count = client_count;) 18 720 T
(  j = client_count;) 18 706 T
(  pthread_mutex_unlock\050&counter_lock\051;) 18 692 T
(  return\050j\051;) 18 678 T
(}) 18 664 T
(int count_requests\050int i\051 {) 18 468 T
(  static int count=0;) 18 454 T
(  static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 18 440 T
( pthread_mutex_lock\050&count_lock\051;) 18 412 T
( count += i;) 18 398 T
( i = count;) 18 384 T
( pthread_mutex_unlock\050&count_lock\051;) 18 370 T
( return\050i\051;) 18 356 T
(/* Can\325t return count */) 287 356 T
(}) 18 342 T
(void print_requests\050\051) 18 314 T
({request_t              *r = requests;) 18 300 T
( while \050r != NULL\051) 18 272 T
(   {printf\050\322<Request: %d>\134n\323, r->client->socket\051;) 18 258 T
(    r = r->next;) 18 244 T
(  }) 18 230 T
(}) 18 216 T
(/* Synchronize on the number of OUTSTANDING REQUESTS per client. */) 18 174 T
(void wait_for_requests_to_zero\050client_t *client\051 {) 18 146 T
(  pthread_mutex_lock\050&client->lock\051;) 18 132 T
(  while \050client->outstanding_requests > 0\051) 18 118 T
(    pthread_cond_wait\050&client->cv, &client->lock\051;) 18 104 T
(  pthread_mutex_unlock\050&client->lock\051;) 18 90 T
(}) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "98" 98
%%Page: "99" 99
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(99) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(int decrement_requests_for\050client_t *client\051 {) 18 734 T
(  int i;) 18 720 T
(  pthread_mutex_lock\050&client->lock\051;) 18 692 T
(  client->outstanding_requests--;) 18 678 T
(  i = client->outstanding_requests;) 18 664 T
(  if \050client->outstanding_requests == 0\051) 18 650 T
(    pthread_cond_signal\050&client->cv\051;) 18 636 T
(  pthread_mutex_unlock\050&client->lock\051;) 18 622 T
(  return\050i\051;) 18 608 T
(}) 18 594 T
(void increment_requests_for\050client_t *client\051 {) 18 566 T
(  pthread_mutex_lock\050&client->lock\051;) 18 552 T
(  client->outstanding_requests++;) 18 538 T
(  pthread_mutex_unlock\050&client->lock\051;) 18 524 T
(}) 18 510 T
(/* Build a new REQUEST */) 18 468 T
(request_t *new_request\050client_t *client, char *ibuf\051 {) 18 440 T
(  request_t             *request;) 18 426 T
(  pthread_t tid = pthread_self\050\051;) 18 398 T
(  DEBUG\050printf\050\322Server_%d[%s] get_request\050\051 received: \134\323%s\134\323\134n\323,) 18 384 T
(               PID, thread_name\050tid\051, ibuf\051\051;) 18 370 T
(  request = \050request_t *\051 malloc\050sizeof\050request_t\051\051;) 18 356 T
(  request->client = client;) 18 342 T
(  strcpy\050request->data, ibuf\051;) 18 328 T
(  count_requests\0501\051;) 18 314 T
(  increment_requests_for\050client\051;) 18 300 T
(  return\050request\051;) 18 188 T
(}) 18 174 T
(int delete_request\050request_t *request\051 {) 18 132 T
(  int i;) 18 118 T
(  i=decrement_requests_for\050request->client\051;) 18 90 T
(  free\050request\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "99" 99
%%Page: "100" 100
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(100) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  return\050i\051;) 18 748 T
(}) 18 734 T
(/*) 18 678 T
(  Send \322End\323 and close the socket.) 18 664 T
(*/) 18 622 T
(void close_client\050client_t *client\051 {) 18 594 T
(  int j;) 18 580 T
(  DEBUG\050printf\050\322Closing socket %s...\134n\323, client->name\051\051;) 18 552 T
(  pthread_mutex_lock\050&client->lock\051;) 18 524 T
(  if \050client->socket != -1\051 {) 18 510 T
(/* Ensure only close\050\051 once. */) 234 510 T
(    write\050client->socket, END_CLIENT_MSG, MESSAGE_SIZE\051;   /* Ignore errors */) 18 496 T
(    close\050client->socket\051;) 18 482 T
(    client->socket = -1;) 18 468 T
(    j = count_clients\050-1\051;) 18 426 T
(    if \050j == 0\051) 18 412 T
(      DEBUG\050printf\050\322Max open sockets: %d\134n\323, client_max_count\051\051;) 18 398 T
(    DEBUG\050printf\050\322Closed %s. \050%d active clients\051\134n\323,) 18 384 T
(                 client->name, count_clients\0500\051\051\051;) 18 370 T
(  }) 18 356 T
(  pthread_mutex_unlock\050&client->lock\051;) 18 342 T
(}) 18 328 T
(void write_msg\050client_t *client, char *obuf\051 {) 18 244 T
(  int                   nbytes, socket, active;) 18 230 T
(  char                  *cname;) 18 216 T
(  char                  *t_name = thread_name\050pthread_self\050\051\051;) 18 202 T
(  DEBUG\050printf\050\322Server_%d[%s] write_msg\050\051 sending: \134\323%s\134\323\134n\323,) 18 174 T
(               PID, t_name, obuf\051\051;) 18 160 T
(  pthread_mutex_lock\050&client->lock\051;) 18 146 T
(  socket = client->socket;) 18 132 T
(  cname  = client->name;) 18 118 T
(  pthread_mutex_unlock\050&client->lock\051;) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "100" 100
%%Page: "101" 101
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(101) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  retry: nbytes = write\050socket, obuf, MESSAGE_SIZE\051;) 18 734 T
(  if \050nbytes == MESSAGE_SIZE\051 {) 18 706 T
(    return;) 18 692 T
(  }) 18 678 T
(  if \050nbytes > -1\051 {) 18 650 T
(    printf\050\322Only wrote %d bytes to %s. \050Impossible?\051\323, nbytes, cname\051;) 18 636 T
(    abort\050\051;) 18 622 T
(  }) 18 608 T
(  if \050errno == EINTR\051 {) 18 580 T
(    printf\050\322EINTR while trying to write to %s on fd#%d. retrying...\134n\323,) 18 566 T
(   cname, socket\051;) 74 552 T
(    goto retry;) 18 538 T
(  }) 18 524 T
(  if \050\050errno == EPIPE\051 || \050errno == EBADF\051\051 {) 18 496 T
(    printf\050\322Failed trying to write to %s. \134n\323, cname\051;) 18 482 T
(    perror\050\322Closing socket\323\051;) 18 468 T
(    close_client\050client\051;) 18 412 T
(    return;) 18 398 T
(  }) 18 384 T
(  else) 18 370 T
(    perror\050\322Unknown bug \050Impossible?\051\323\051, abort\050\051;) 18 356 T
(}) 18 342 T
(/* Manipulate the requests list. Caller must own requests_lock. */) 18 286 T
(request_t *remove_request\050\051 {) 18 272 T
(  request_t *request;) 18 258 T
(  request = requests;) 18 230 T
(  requests = requests->next;) 18 216 T
(  length--;) 18 202 T
(  return\050request\051;) 18 188 T
(}) 18 174 T
(void add_request\050request_t *request\051 {) 18 146 T
(  request->next = requests;) 18 132 T
(/* Insert at head of list */) 306 132 T
(  requests = request;) 18 118 T
(  length++;) 18 104 T
(}) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "101" 101
%%Page: "102" 102
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(102) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(int open_port\050\051 {) 18 734 T
(  struct sockaddr_in    cli_addr, serv_addr;) 18 720 T
(  int                   port_socket, clilen, i;) 18 706 T
(  /* Open a new port. Try to get requested port. */) 18 678 T
(  if\050\050port_socket = socket\050AF_INET, SOCK_STREAM, 0\051\051 < 0\051) 18 664 T
(    perror\050\322Can\325t create new socket\323\051, abort\050\051;) 18 650 T
(  for \050i=REQUESTED_TCP_PORT; i< REQUESTED_TCP_PORT+MAX_PORT_RANGE; i++\051 {) 18 622 T
(    memset\050\050char *\051 &serv_addr, 0, sizeof\050serv_addr\051\051;) 18 608 T
(    serv_addr.sin_family = AF_INET;) 18 594 T
(    serv_addr.sin_addr.s_addr = htonl\050INADDR_ANY\051;) 18 580 T
(    serv_addr.sin_port = htons\050i\051;) 18 566 T
(    if \050bind\050port_socket, \050struct sockaddr *\051&serv_addr, sizeof\050serv_addr\051\051<0\051) 18 552 T
(      {DEBUG\050printf\050\322Can\325t bind to port %d\134n\323, i\051\051;}) 18 538 T
(    else {) 18 524 T
(      printf\050\322Server bound to port: %d\134n\323, i\051;) 18 510 T
(      ACTUAL_TCP_PORT=i;) 18 496 T
(      listen\050port_socket, 5\051;) 18 482 T
(      return\050port_socket\051;) 18 468 T
(    }) 18 454 T
(  }) 18 440 T
(  printf\050\322Could not find an available port from %d to %d\323,) 18 426 T
( REQUESTED_TCP_PORT, REQUESTED_TCP_PORT+MAX_PORT_RANGE\051;) 74 412 T
(  abort\050\051;) 18 398 T
(}) 18 384 T
(client_t *accept_a_connection\050int port_socket\051 {) 18 328 T
(  int                   new_socket, clilen;) 18 314 T
(  struct sockaddr_in    cli_addr;) 18 300 T
(  clilen = sizeof\050cli_addr\051;) 18 272 T
(  new_socket = accept\050port_socket, \050struct sockaddr *\051 &cli_addr, &clilen\051;) 18 258 T
(  if \050new_socket < 0\051) 18 244 T
(    perror\050\322Accept failed. \050Impossible?\051\323\051, abort\050\051;) 18 230 T
(  return\050new_client\050new_socket\051\051;) 18 202 T
(}) 18 188 T
(void *reporter\050void *arg\051 {) 18 146 T
(  while \050TRUE\051 {) 18 118 T
(    sleep\05030\051;) 18 104 T
(    printf\050\322Server up on port %d. Processed %d requests.\134n\323,) 18 90 T
(   ACTUAL_TCP_PORT, count_requests\0500\051\051;) 74 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "102" 102
%%Page: "103" 103
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(103) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  }) 18 748 T
(}) 18 734 T
(int startup_initialize\050\051 {) 18 692 T
(  int) 18 678 T
(i;) 144 678 T
(  set_up_signal_mask\050\051;) 18 650 T
(  PTHREAD_ATTR_INIT\050&attr\051;) 18 622 T
(  pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 608 T
(  pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 594 T
(}) 18 566 T
(void *acceptor\050void *arg\051 {) 18 524 T
(  client_t *client;) 18 510 T
(  pthread_t tid;) 18 496 T
(  int port_socket = \050int\051 arg;) 18 482 T
(  while \050TRUE\051 {) 18 454 T
(    client = accept_a_connection\050port_socket\051;) 18 440 T
(    PTHREAD_CREATE\050&tid, &attr, producer, \050void *\051 client\051;) 18 426 T
(  }) 18 412 T
(}) 18 398 T
(request_t *get_request\050client_t *client\051 {) 18 342 T
(  request_t) 18 328 T
(*request;) 144 328 T
(  char) 18 314 T
(ibuf[MESSAGE_SIZE];) 144 314 T
(  int) 18 300 T
(nbytes;) 144 300 T
(  nbytes = read\050client->socket, ibuf, MESSAGE_SIZE\051;) 18 272 T
(  if \050nbytes != MESSAGE_SIZE\051 {printf\050\322Read failed!\134n\323\051; abort\050\051;}) 18 258 T
(  if \050strncmp\050ibuf, END_CLIENT_MSG, 3\051 == 0\051 return\050NULL\051;) 18 244 T
(  request = new_request\050client, ibuf\051;) 18 216 T
(  return\050request\051;) 18 202 T
(}) 18 188 T
(client_t *new_client\050int socket\051 {) 18 160 T
(  client_t *client = \050client_t *\051 malloc\050sizeof\050client_t\051\051;) 18 146 T
(  client->socket = socket;) 18 118 T
(  client->outstanding_requests=0;) 18 90 T
(  count_clients\0501\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "103" 103
%%Page: "104" 104
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(104) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  DEBUG\050printf\050\322New Client fd#%d. \050%d active clients\051\134n\323,) 18 748 T
(       socket, count_clients\0500\051\051\051;) 74 734 T
(  return\050client\051;) 18 720 T
(}) 18 706 T
(/* Send a reply back to client */) 18 678 T
(void *process_request\050request_t *request\051 {) 18 664 T
(  client_t              *client = request->client;) 18 650 T
(  char                  *cname;) 18 636 T
(  char                  obuf[MESSAGE_SIZE];) 18 622 T
(  char                  *t_name = thread_name\050pthread_self\050\051\051;) 18 608 T
(  int                   i, nbytes, finishing, socket;) 18 594 T
(  DEBUG\050printf\050\322Server_%d[%s] processing: \134\323%s\134\323\134n\323,) 18 566 T
(       PID, t_name, request->data\051\051;) 74 552 T
(  delay\050SLEEP, SPIN\051;) 18 524 T
(  sprintf\050obuf, \322Server_%d[%s] reply %d to %s\323,) 18 510 T
(  PID, t_name, n_replies++, request->data\051;) 74 496 T
(  write_msg\050client, obuf\051;) 18 482 T
(  delete_request\050request\051;) 18 468 T
(}) 18 454 T
(void *producer\050void *arg\051 {) 18 412 T
(  request_t *request;) 18 398 T
(  client_t *client = \050client_t *\051 arg;) 18 384 T
(  DEBUG\050printf\050\322Producer starting.\134n\323\051\051;) 18 356 T
(  while \050TRUE\051 {) 18 328 T
(    request = get_request\050client\051;) 18 314 T
(    if \050request == NULL\051 {) 18 300 T
(      wait_for_requests_to_zero\050client\051;) 18 286 T
(      close_client\050client\051;) 18 272 T
(      return;) 18 258 T
(    }) 18 244 T
(    pthread_mutex_lock\050&requests_lock\051;) 18 230 T
(    while \050\050length >= 10\051\051) 18 216 T
(      pthread_cond_wait\050&producer_cv, &requests_lock\051;) 18 202 T
(    add_request\050request\051;) 18 188 T
(    pthread_mutex_unlock\050&requests_lock\051;) 18 174 T
(    pthread_cond_signal\050&consumer_cv\051;) 18 160 T
(  }) 18 146 T
(}) 18 132 T
(void *consumer\050void *arg\051 {) 18 90 T
(  request_t *request;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "104" 104
%%Page: "105" 105
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(105) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  DEBUG\050printf\050\322Consumer starting.\134n\323\051\051;) 18 734 T
(  set_up_signal_mask\050\051;) 18 720 T
(  while\050TRUE\051 {) 18 692 T
(    pthread_mutex_lock\050&requests_lock\051;) 18 678 T
(    while \050\050length == 0\051\051) 18 664 T
(      pthread_cond_wait\050&consumer_cv, &requests_lock\051;) 18 650 T
(    request = remove_request\050\051;) 18 636 T
(    pthread_mutex_unlock\050&requests_lock\051;) 18 622 T
(    pthread_cond_signal\050&producer_cv\051;) 18 608 T
(    process_request\050request\051;) 18 594 T
(  }) 18 580 T
(}) 18 566 T
(main\050int argc, char **argv\051 {) 18 510 T
(  int                   i;) 18 496 T
(  pthread_t tid;) 18 482 T
(  PID = getpid\050\051;) 18 454 T
(  if \050argc > 1\051 REQUESTED_TCP_PORT = atoi\050argv[1]\051;) 18 426 T
(  if \050argc > 2\051 SLEEP = atoi\050argv[2]\051;) 18 412 T
(  if \050argc > 3\051 SPIN = atoi\050argv[3]\051;) 18 398 T
(  if \050argc > 4\051 N_CONSUMERS = atoi\050argv[4]\051;) 18 384 T
(  if \050argc > 5\051 STOPPER_SLEEP = atoi\050argv[5]\051;) 18 370 T
(  if \050argc > 6\051 KILLER_SLEEP = atoi\050argv[6]\051;) 18 356 T
(  printf\050\322Server_%d\050TCP_PORT %d SLEEP %dms SPIN %dus N_CONSUMERS \134n\134) 18 342 T
(%d STOPPER %ds KILLER %ds\051\134n\323,) 18 328 T
(         PID, REQUESTED_TCP_PORT, SLEEP, SPIN, N_CONSUMERS,) 18 314 T
(         STOPPER_SLEEP, KILLER_SLEEP\051;) 18 300 T
(  startup_initialize\050\051;) 18 272 T
(  PTHREAD_CREATE\050&tid, &attr, reporter, NULL\051;) 18 244 T
(  for \050i=0; i<N_CONSUMERS; i++\051 {) 18 216 T
(    PTHREAD_CREATE\050&tid, &attr, consumer, \050void *\051 NULL\051;) 18 202 T
(  }) 18 188 T
(  port_socket = open_port\050\051;) 18 160 T
(  if \050KILLER_SLEEP > 0\051) 18 146 T
(    PTHREAD_CREATE\050&tid, &attr, killer, \050void *\051 KILLER_SLEEP\051;) 18 132 T
(  acceptor\050\050void *\051port_socket\051;) 18 104 T
(}) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "105" 105
%%Page: "106" 106
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(106) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 96 591 744 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
530.59 138.87 M
 533.27 145.13 520.41 150.95 512.01 143.26 D
 503.55 135.52 493.19 154.42 478.39 140.33 D
3 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
90 450 1.5 1.5 90 504.95 120.15 GG
504.95 121.65 501.15 121.65 504.95 134.89 508.74 121.65 4 Y
0 Z
N
504.95 121.65 501.15 121.65 504.95 134.89 508.74 121.65 4 Y
V
504.95 120.15 504.95 114 2 L
2 Z
N
459.47 140.31 M
 462.15 146.57 449.29 152.39 440.89 144.7 D
 432.43 136.96 422.07 155.86 407.27 141.77 D
N
90 450 1.5 1.5 90 433.82 121.59 GG
433.82 123.09 430.03 123.09 433.82 136.33 437.62 123.09 4 Y
0 Z
N
433.82 123.09 430.03 123.09 433.82 136.33 437.62 123.09 4 Y
V
433.82 121.59 433.82 115.44 2 L
2 Z
N
394.02 144.63 M
 396.7 150.89 383.85 156.71 375.44 149.02 D
 366.98 141.28 356.63 160.18 341.82 146.09 D
N
90 450 1.5 1.5 90 368.38 125.91 GG
368.38 127.41 364.58 127.41 368.38 140.65 372.18 127.41 4 Y
0 Z
N
368.38 127.41 364.58 127.41 368.38 140.65 372.18 127.41 4 Y
V
368.38 125.91 368.38 119.76 2 L
2 Z
N
328.2 141.75 M
 330.88 148.01 318.02 153.83 309.62 146.14 D
 301.16 138.4 290.81 157.3 276 143.21 D
N
90 450 1.5 1.5 90 302.56 123.03 GG
302.56 124.53 298.76 124.53 302.56 137.77 306.36 124.53 4 Y
0 Z
N
302.56 124.53 298.76 124.53 302.56 137.77 306.36 124.53 4 Y
V
302.56 123.03 302.56 116.88 2 L
2 Z
N
456 681 506.69 727.44 R
0 Z
N
386.12 679.2 438 726 R
N
316 675.96 366 717 R
N
483 315.44 501.45 366 R
1 H
N
501.45 334.7 483 334.7 2 L
2 Z
N
90 450 3.91 3.69 270 492.23 325.97 GG
90 450 3.91 3.69 270 492.23 325.97 AA
3 14 Q
(R1) 0 -90 487.28 360.88 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
483 248.63 501.45 299.19 R
0 Z
N
501.45 267.89 483 267.89 2 L
2 Z
N
90 450 3.91 3.69 270 492.23 259.16 GG
90 450 3.91 3.69 270 492.23 259.16 AA
(R2) 0 -90 487.28 294.07 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
483 177 501.45 227.56 R
0 Z
N
501.45 196.26 483 196.26 2 L
2 Z
N
90 450 3.91 3.69 270 492.23 187.54 GG
90 450 3.91 3.69 270 492.23 187.54 AA
(R3) 0 -90 487.28 222.45 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
492.23 310.83 494.87 310.83 492.23 301.6 489.58 310.83 4 Y
0 Z
N
492.23 310.83 494.87 310.83 492.23 301.6 489.58 310.83 4 Y
V
492.23 323.27 492.23 311.33 2 L
2 Z
N
492.84 241.61 495.49 241.61 492.84 232.39 490.2 241.61 4 Y
0 Z
N
492.84 241.61 495.49 241.61 492.84 232.39 490.2 241.61 4 Y
V
492.84 254.05 492.84 242.11 2 L
2 Z
N
469.96 252.46 468.73 254.79 478.11 256.73 471.18 250.12 4 Y
0 Z
N
469.96 252.46 468.73 254.79 478.11 256.73 471.18 250.12 4 Y
V
436.82 159 M
 400.32 187.78 424.91 228.85 469.51 252.22 D
2 Z
N
463.06 211.59 462.72 214.22 472.2 212.77 463.39 208.97 4 Y
0 Z
N
463.06 211.59 462.72 214.22 472.2 212.77 463.39 208.97 4 Y
V
364.71 159 M
 364.61 192.26 420.64 206.15 462.56 211.53 D
2 Z
N
2 32 Q
(Pr) 0 -90 552.16 677.88 TF
(oducer/Consumer w/) 0 -90 552.16 644.72 TF
4 F
(select\050\051) 0 -90 552.16 328.21 TF
66 105 537 591 R
3 H
0 Z
N
168 455.43 321 480.99 R
1 H
N
291.85 455.43 306.38 480.99 R
N
260.88 455.43 275.42 480.99 R
N
230.87 455.43 245.4 480.99 R
N
198.96 455.43 213.5 480.99 R
N
168 455.43 182.54 480.99 R
N
367.48 483 428.38 591 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
247.2 408.87 M
 249.88 415.13 237.02 420.95 228.62 413.26 D
 220.16 405.52 209.81 424.42 195 410.33 D
3 H
2 Z
N
90 450 1.5 1.5 90 221.56 390.15 GG
221.56 391.65 217.76 391.65 221.56 404.89 225.36 391.65 4 Y
0 Z
N
221.56 391.65 217.76 391.65 221.56 404.89 225.36 391.65 4 Y
V
221.56 390.15 221.56 384 2 L
2 Z
N
249 684.96 299 726 R
0 Z
N
172 681 222 722.04 R
N
6 14 Q
(while \050true\051 {) 0 -90 244.2 364.2 TF
( select\050\051;) 0 -90 230.2 364.2 TF
( if \050stop\051 return;) 0 -90 216.2 364.2 TF
( if \050#1\051 accept\050\051) 0 -90 202.2 364.2 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
3 F
(Clients) 0 -90 150 492 TF
6 F
(Port #6500) 0 -90 413.2 582 TF
(host: Local) 0 -90 399.2 582 TF
407.09 610.3 409.73 611.67 411.87 601.09 404.44 608.93 4 Y
0.5 H
N
407.09 610.3 409.73 611.67 411.87 601.09 404.44 608.93 4 Y
V
411 672 M
 428.61 649.58 398.35 627.14 406.97 610.52 D
2 Z
N
393.21 618.01 396.19 617.95 393.02 607.62 390.23 618.06 4 Y
0 Z
N
393.21 618.01 396.19 617.95 393.02 607.62 390.23 618.06 4 Y
V
339 672 M
 338.53 652.11 359.88 613.2 382.18 641.71 D
 384.46 644.62 396.21 643.5 395.18 634.57 D
 394.55 629.11 393.32 623.71 393.21 618.26 D
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
493.53 660.22 490.69 659.33 490.41 670.13 496.37 661.11 4 Y
0 Z
N
493.53 660.22 490.69 659.33 490.41 670.13 496.37 661.11 4 Y
V
519 159 M
 519.95 316.22 551.36 482.89 501.47 634.57 D
 498.7 642.99 496.26 651.52 493.61 659.98 D
2 Z
N
238.88 493.96 241.77 493.24 236.36 483.88 235.99 494.68 4 Y
0 Z
N
238.88 493.96 241.77 493.24 236.36 483.88 235.99 494.68 4 Y
V
275.17 681 M
 278.21 647.63 304.59 587.57 257.91 577.41 D
 210.33 567.04 246.07 522.73 238.94 494.2 D
2 Z
N
219.4 503.61 222.34 503.99 220.74 493.33 216.45 503.22 4 Y
0 Z
N
219.4 503.61 222.34 503.99 220.74 493.33 216.45 503.22 4 Y
V
195 681 M
 185.15 646.1 223.46 641.19 220.44 613.14 D
 216.66 578.1 214.49 541.19 219.36 503.85 D
2 Z
N
90 450 4.5 4.5 270 312.93 468.21 GG
90 450 4.5 4.5 270 312.93 468.21 AA
90 450 4.5 4.5 270 237.64 468.21 GG
90 450 4.5 4.5 270 237.64 468.21 AA
90 450 4.5 4.5 270 221.79 468.21 GG
90 450 4.5 4.5 270 221.79 468.21 AA
90 450 4.5 4.5 270 205.93 468.21 GG
90 450 4.5 4.5 270 205.93 468.21 AA
(Client_1) 0 -90 513.77 724.71 TF
(Client_2) 0 -90 443.63 732.43 TF
(Client_4) 0 -90 372.05 735.14 TF
(Client_25) 0 -90 304.05 732.86 TF
(Client_6565) 0 -90 229.63 727 TF
(\322Request #123\323) 0 -90 202.27 622.89 TF
(connect\050\051) 0 -90 420.7 674.89 TF
(\322Reply #13\323) 0 -90 507.12 562.03 TF
(\322Request #144\323) 0 -90 292.84 657.03 TF
3 F
(Producer) 0 -90 125.71 343.29 TF
(Consumers) 0 -90 189.85 187.1 TF
262.85 143.37 M
 265.52 149.64 252.67 155.45 244.26 147.76 D
 235.81 140.03 225.45 158.92 210.65 144.84 D
3 H
N
90 450 1.5 1.5 90 237.2 124.65 GG
237.2 126.15 233.4 126.15 237.2 139.4 241 126.15 4 Y
0 Z
N
237.2 126.15 233.4 126.15 237.2 139.4 241 126.15 4 Y
V
237.2 124.65 237.2 118.5 2 L
2 Z
N
465.39 342.91 464.96 345.86 475.68 344.44 465.83 339.96 4 Y
0.5 H
0 Z
N
465.39 342.91 464.96 345.86 475.68 344.44 465.83 339.96 4 Y
V
177.15 237.43 M
 181.95 213.66 204.3 175.05 236.25 193.08 D
 277.75 216.5 326.81 182.4 367.05 203.32 D
 396.45 218.6 432.05 233.14 450.25 263.85 D
 463.48 286.17 435.33 338.46 465.15 342.88 D
2 Z
N
298.82 496.26 301.79 496.04 298.07 485.9 295.85 496.48 4 Y
0 Z
N
298.82 496.26 301.79 496.04 298.07 485.9 295.85 496.48 4 Y
V
396 483 M
 405.15 467.63 391.29 441.06 372 445.68 D
 332.4 455.18 352.46 504.69 325 517.9 D
 305.38 527.33 299.95 511.73 298.84 496.51 D
2 Z
N
90 450 4.5 4.5 270 299.5 467.5 GG
90 450 4.5 4.5 270 299.5 467.5 AA
485.2 440.35 M
 487.88 446.61 475.02 452.43 466.62 444.74 D
 458.16 437 447.81 455.9 433 441.81 D
3 H
N
90 450 1.5 1.5 90 459.56 421.63 GG
459.56 423.13 455.76 423.13 459.56 436.37 463.36 423.13 4 Y
0 Z
N
459.56 423.13 455.76 423.13 459.56 436.37 463.36 423.13 4 Y
V
459.56 421.63 459.56 415.48 2 L
2 Z
N
6 F
(sleep\050delay\051;) 0 -90 432.2 431.2 TF
(stop = true;) 0 -90 418.2 431.2 TF
(write\050int\051;) 0 -90 404.2 431.2 TF
311.17 498.26 314.14 498.48 311.93 487.9 308.19 498.04 4 Y
0.5 H
0 Z
N
311.17 498.26 314.14 498.48 311.93 487.9 308.19 498.04 4 Y
V
405 340 M
 410.98 326.33 394.43 309.95 381 320.99 D
 359.48 338.68 337.47 365.8 333.01 397 D
 328.01 431.9 343.21 486.55 317 500.42 D
 313.49 502.27 310.95 501.14 311.15 498.51 D
2 Z
N
(}) 0 -90 160.2 364.2 TF
( add_request\050\051;) 0 -90 174.2 364.2 TF
( read\050fd\051;) 0 -90 188.2 364.2 TF
196.19 373.46 198.95 372.36 192.34 363.84 193.43 374.57 4 Y
0 Z
N
196.19 373.46 198.95 372.36 192.34 363.84 193.43 374.57 4 Y
V
221 455 M
 232.95 419.4 188.69 435.7 170 428.04 D
 160.45 424.13 157.21 408.09 166 404.46 D
 180.12 398.61 201.76 387.37 196.29 373.7 D
2 Z
N
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "106" 106
%%Page: "107" 107
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(107) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Rob) 30.74 732 T
(ust Ser) 100.01 732 T
(ver Using) 222.41 732 T
4 F
(select\050\051) 396.47 732 T
2 F
(:) 569.27 732 T
(ser) 175.73 684 T
(ver_select.c) 230.13 684 T
4 12 Q
(/*                server_select.c                */) 18 628 T
(/* 4567890 234567890 234567890 234567890 234567890 234567890 234567890 2345678*/) 18 614 T
(/*) 18 600 T
(  This version of the server is designed to be robust under client) 18 572 T
(  failure and implements a complete shutdown, first closing the port,) 18 558 T
(  then shutting down the producer thread, finally closing the Interruptor) 18 544 T
(  pipe. The consumers do not exit, but they continue and empty the queue,) 18 530 T
(  then they sit around waiting for the server to restart. \050This is) 18 516 T
(  trickier than it may seem!\051) 18 502 T
(  This uses a single producer thread which calls select\050\051 on all clients) 18 474 T
(  and on the port socket. When a new connect comes it, it gets accepted) 18 460 T
(  and the new socket added to the select\050\051 list. When a new request) 18 446 T
(  comes in, it is read and returned as a request_t.) 18 432 T
(  Any IO failures are handled by printing out an error message, closing the) 18 390 T
(  socket in question, then ignoring it. The Client program is sent an \322End\323) 18 376 T
(  message then, and left to its own devices to deal with the fact that the) 18 362 T
(  socket has been closed early.) 18 348 T
(  Shutdown is accomplished by setting \322stop\323 variables and then ensuring) 18 320 T
(  that the producer, which may be blocked on select\050\051 is woken up by doing a) 18 306 T
(  sending data on a special \322Interruptor\323 pipe. Both read\050\051 and accept\050\051 are) 18 292 T
(  assumed never to block because they are only called after select\050\051) 18 278 T
(  returns. Calls to write\050\051 are also assumed never to block \050although an) 18 264 T
(  uncooperative client could cause this by never reading replies and letting) 18 250 T
(  the socket fill up \050~64k!\051\051.) 18 236 T
(*/) 18 208 T
(/*                                           replies) 18 180 T
(                                  <-------------------------) 18 166 T
(                 _______     _______     _______            |) 18 152 T
(   Requests     |_______|-->|_______|-->|_______|           |) 18 138 T
(                               ^            |               |) 18 124 T
(                               |            |               |) 18 110 T
(        requests __________    |            |            __________) 18 96 T
(Client1 ------->| PRODUCER |   |             ---------> | CONSUMER |) 18 82 T
(Client2 ------->| select\050\051 |   |                        |          |) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "107" 107
%%Page: "108" 108
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(108) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(Client3 ------->|  read\050\051  |---                         |          |) 18 748 T
(Client4 =======>|  accept\050\051|<-------------------        |__________|) 18 734 T
(        connect |__________|                    |) 18 720 T
(                                 Interruptor    |) 18 706 T
(                                 Pipe           |        __________) 18 692 T
(                 __________                     |       | CONSUMER |) 18 678 T
(                | STOPPER  |                    |       |          |) 18 664 T
(                |          |                    |       |          |) 18 650 T
(                |stop vars |--------------------        |__________|) 18 636 T
(                |__________|            \322STOP\323) 18 622 T
(                                                                ...) 18 608 T
(*/) 18 580 T
(#define _POSIX_C_SOURCE 199506L) 18 524 T
(/* Note that you need to define  __EXTENSIONS__ when using sockets. */) 18 510 T
(#define __EXTENSIONS__) 18 496 T
(#include <stdio.h>) 18 440 T
(#include <sys/types.h>) 18 426 T
(#include <sys/socket.h>) 18 412 T
(#include <netinet/in.h>) 18 398 T
(#include <arpa/inet.h>) 18 384 T
(#include <pthread.h>) 18 370 T
(#include <semaphore.h>) 18 356 T
(#include <time.h>) 18 342 T
(#include <limits.h>) 18 328 T
(#include <errno.h>) 18 314 T
(#include <sys/resource.h>) 18 300 T
(#include \322thread_extensions.h\323) 18 286 T
(/* Constants etc. rlimit set to MAX_FDS in main\050\051 */) 18 258 T
(#define                 MESSAGE_SIZE 70) 18 244 T
(#define                 READ 0) 18 230 T
(#define                 WRITE 1) 18 216 T
(#define                 MAX_FDS  1024) 18 202 T
(int                     ACTUAL_MAX_FDS=MAX_FDS;) 18 188 T
( /* String sent by & to client when done */) 18 160 T
(const char              *END_CLIENT_MSG =) 18 146 T
(  \322End\1340                                                                   \322;) 18 132 T
(/* String used by Stopper thread to wake up Producer */) 18 118 T
(const char              *STOP_MSG =) 18 104 T
(  \322STOP\1340                                                                  \322;) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "108" 108
%%Page: "109" 109
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(109) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(/* The structures for clients, and requests */) 18 748 T
(typedef struct client_struct {) 18 720 T
(  int                   active;                 /* Is the socket valid? */) 18 706 T
(  int                   socket;                 /* socket fd */) 18 692 T
(  char                  name[30];               /* \322Client_123[T@23]\323 */) 18 678 T
(  int                   outstanding_requests;   /* No. unanswered */) 18 664 T
(  int                   finishing;              /* \322End\323 received */) 18 650 T
(  pthread_mutex_t       lock;) 18 636 T
(  pthread_cond_t        cv;) 18 622 T
(} client_t;) 18 608 T
(typedef struct request_struct {) 18 580 T
(  client_t              *client;) 18 566 T
(  char                  data[MESSAGE_SIZE]; /* \322Client_7[T@4] Request: 4\323 */) 18 552 T
(  struct request_struct *next;) 18 538 T
(} request_t;) 18 524 T
(/* Optional command line arguments \050+ defaults\051 */) 18 454 T
(int                     SLEEP = 0, SPIN= 0, N_CONSUMERS=10;) 18 440 T
(int                     REQUESTED_TCP_PORT = 6500, ACTUAL_TCP_PORT,) 18 426 T
(                        MAX_PORT_RANGE=100;) 18 412 T
(int                     STOPPER_SLEEP=-1, KILLER_SLEEP=-1;) 18 398 T
(/* Array of clients */) 18 370 T
(client_t                clients[MAX_FDS];) 18 356 T
(/* Other useful bits */) 18 328 T
(int                     PID;) 18 314 T
(pthread_attr_t          attr;) 18 300 T
(int                     port_socket;) 18 286 T
(int                     interrupter_pipe[2];) 18 272 T
(/* Barriers and variables used for shutting down the server */) 18 230 T
(thread_single_barrier_t producer_barrier;) 18 216 T
(thread_single_barrier_t stopper_barrier;) 18 202 T
(thread_barrier_t        consumer_barrier1, consumer_barrier2;) 18 188 T
(pthread_t               producer_thread;) 18 174 T
(int                     stop_producer = FALSE;) 18 160 T
(int                     stop_consumers= FALSE;) 18 146 T
(/* A List of REQUESTS with protection and related varaibles. */) 18 104 T
(request_t               *requests =     NULL;) 18 90 T
(int                     length =        0;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "109" 109
%%Page: "110" 110
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(1) 297 31.12 T
(10) 302.34 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(pthread_mutex_t         requests_lock = PTHREAD_MUTEX_INITIALIZER;) 18 748 T
(pthread_cond_t          producer_cv =   PTHREAD_COND_INITIALIZER;) 18 734 T
(pthread_cond_t          consumer_cv =   PTHREAD_COND_INITIALIZER;) 18 720 T
(/* Some function declarations */) 18 664 T
(client_t *new_client\050int\051;) 18 636 T
(void *producer\050void *\051;) 18 622 T
(request_t *get_request\050\051;) 18 608 T
(void *process_request\050request_t *\051;) 18 594 T
(/* A bunch of simple helper functions */) 18 552 T
(void set_up_signal_mask\050\051 {) 18 524 T
( sigset_t               s, s1, s2;) 18 510 T
( static struct          sigaction action;) 18 496 T
(/* Block everything first \050in particular SIGPIPE\051 */) 18 468 T
( sigfillset\050&s\051;) 18 454 T
( pthread_sigmask\050SIG_BLOCK, &s, &s2\051;) 18 440 T
( sigemptyset\050&s\051;) 18 426 T
( sigaddset\050&s, SIGINT\051;                 /* For ^C */) 18 398 T
( pthread_sigmask\050SIG_UNBLOCK, &s, &s1\051;) 18 384 T
(}) 18 370 T
(/* Keep track of the current number of clients for stats & fd limit */) 18 328 T
(int client_max_count = 0;) 18 314 T
(int count_clients\050int i\051 {) 18 286 T
(  static pthread_mutex_t counter_lock = PTHREAD_MUTEX_INITIALIZER;) 18 272 T
(  static int             client_count = 0;) 18 258 T
(  int j;) 18 244 T
(  pthread_mutex_lock\050&counter_lock\051;) 18 216 T
(  client_count += i;) 18 202 T
(  if \050client_count > client_max_count\051) 18 188 T
(    client_max_count = client_count;) 18 174 T
(  j = client_count;) 18 160 T
(  pthread_mutex_unlock\050&counter_lock\051;) 18 146 T
(  return\050j\051;) 18 132 T
(}) 18 118 T
(/* Used for debugging */) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "110" 110
%%Page: "111" 111
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(1) 297 31.12 T
(1) 302.34 31.12 T
(1) 307.68 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(void dump_client_data\050\051 {) 18 748 T
(  int i;) 18 734 T
(  for \050i=0; i<ACTUAL_MAX_FDS; i++\051 {) 18 706 T
(    if \050clients[i].active\051) 18 692 T
(      printf\050\322%s on fd#%d\134n\323, clients[i].name, clients[i].socket\051;) 18 678 T
(  }) 18 664 T
(}) 18 650 T
(int count_requests\050int i\051 {) 18 608 T
(  static int count=0;) 18 594 T
(  static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 18 580 T
( pthread_mutex_lock\050&count_lock\051;) 18 552 T
( count += i;) 18 538 T
( i = count;) 18 524 T
( pthread_mutex_unlock\050&count_lock\051;) 18 510 T
( return\050i\051;                             /* Can\325t return count */) 18 496 T
(}) 18 482 T
(void print_requests\050\051) 18 454 T
({request_t              *r = requests;) 18 440 T
( while \050r != NULL\051) 18 412 T
(   {printf\050\322<Request: %d>\134n\323, r->client->socket\051;) 18 398 T
(    r = r->next;) 18 384 T
(  }) 18 370 T
(}) 18 356 T
(/* Synchronize on the number of OUTSTANDING REQUESTS per client. */) 18 314 T
(void wait_for_requests_to_zero\050client_t *client\051 {) 18 286 T
(  pthread_mutex_lock\050&client->lock\051;) 18 272 T
(  while \050client->outstanding_requests > 0\051) 18 258 T
(    pthread_cond_wait\050&client->cv, &client->lock\051;) 18 244 T
(  pthread_mutex_unlock\050&client->lock\051;) 18 230 T
(}) 18 216 T
(int decrement_requests_for\050client_t *client\051 {) 18 188 T
(  int i;) 18 174 T
(  pthread_mutex_lock\050&client->lock\051;) 18 146 T
(  client->outstanding_requests--;) 18 132 T
(  i = client->outstanding_requests;) 18 118 T
(  if \050client->outstanding_requests == 0\051) 18 104 T
(    pthread_cond_signal\050&client->cv\051;) 18 90 T
(  pthread_mutex_unlock\050&client->lock\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "111" 111
%%Page: "112" 112
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(1) 297 31.12 T
(12) 302.34 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  return\050i\051;) 18 748 T
(}) 18 734 T
(void increment_requests_for\050client_t *client\051 {) 18 706 T
(  pthread_mutex_lock\050&client->lock\051;) 18 692 T
(  client->outstanding_requests++;) 18 678 T
(  pthread_mutex_unlock\050&client->lock\051;) 18 664 T
(}) 18 650 T
(/* Build a new REQUEST */) 18 608 T
(request_t *new_request\050client_t *client, char *ibuf\051 {) 18 580 T
(  request_t             *request;) 18 566 T
(  pthread_t tid = pthread_self\050\051;) 18 538 T
(  DEBUG\050printf\050\322Server_%d[%s] get_request\050\051 received: \134\323%s\134\323\134n\323,) 18 524 T
(               PID, thread_name\050tid\051, ibuf\051\051;) 18 510 T
(  request = \050request_t *\051 malloc\050sizeof\050request_t\051\051;) 18 496 T
(  request->client = client;) 18 482 T
(  strcpy\050request->data, ibuf\051;) 18 468 T
(  count_requests\0501\051;) 18 454 T
(  increment_requests_for\050client\051;) 18 440 T
(  pthread_mutex_lock\050&client->lock\051;) 18 412 T
(  if \050client->name[0] == \324 \324\051 {         /* Hack to get a client name! */) 18 398 T
(    strncpy\050client->name, ibuf, 18\051;    /* Runs only on first request */) 18 384 T
(    client->name[18] = 0;) 18 370 T
(  }) 18 356 T
(  pthread_mutex_unlock\050&client->lock\051;) 18 342 T
(  return\050request\051;) 18 328 T
(}) 18 314 T
(int delete_request\050request_t *request\051 {) 18 272 T
(  int i;) 18 258 T
(  i=decrement_requests_for\050request->client\051;) 18 230 T
(  free\050request\051;) 18 216 T
(  return\050i\051;) 18 202 T
(}) 18 188 T
(/*) 18 132 T
(  Send \322End\323 and close the socket.) 18 118 T
(  It\325s OK if the socket has already been closed.) 18 104 T
(  This is only called when outstanding_requests == 0.) 18 90 T
(*/) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "112" 112
%%Page: "113" 113
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(1) 297 31.12 T
(13) 302.34 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(void close_client\050client_t *client\051 {) 18 734 T
(  int j;) 18 720 T
(  DEBUG\050printf\050\322Closing socket %s...\134n\323, client->name\051\051;) 18 692 T
(  pthread_mutex_lock\050&client->lock\051;) 18 664 T
(  if \050client->socket != -1\051 {                   /* Ensure only close\050\051 once. */) 18 650 T
(    write\050client->socket, END_CLIENT_MSG, MESSAGE_SIZE\051;   /* Ignore errors */) 18 636 T
(    close\050client->socket\051;) 18 622 T
(    client->socket = -1;) 18 608 T
(    client->active = FALSE;) 18 594 T
(    client->finishing = FALSE;) 18 580 T
(    j = count_clients\050-1\051;) 18 566 T
(    if \050j == 0\051) 18 552 T
(      DEBUG\050printf\050\322Max open sockets: %d\134n\323, client_max_count\051\051;) 18 538 T
(    DEBUG\050printf\050\322Closed %s. \050%d active clients\051\134n\323,) 18 524 T
(                 client->name, count_clients\0500\051\051\051;) 18 510 T
(  }) 18 496 T
(  pthread_mutex_unlock\050&client->lock\051;) 18 482 T
(}) 18 468 T
(void write_msg\050client_t *client, char *obuf\051 {) 18 384 T
(  int                   nbytes, socket, active;) 18 370 T
(  char                  *cname;) 18 356 T
(  char                  *t_name = thread_name\050pthread_self\050\051\051;) 18 342 T
(  DEBUG\050printf\050\322Server_%d[%s] write_msg\050\051 sending: \134\323%s\134\323\134n\323,) 18 314 T
(               PID, t_name, obuf\051\051;) 18 300 T
(  pthread_mutex_lock\050&client->lock\051;) 18 286 T
(  socket = client->socket;) 18 272 T
(  cname  = client->name;) 18 258 T
(  active = client-> active;) 18 244 T
(  pthread_mutex_unlock\050&client->lock\051;) 18 230 T
(  if \050active\051  { /* Another consumer got an error & closed socket */) 18 202 T
(  retry: nbytes = write\050socket, obuf, MESSAGE_SIZE\051;) 18 188 T
(  if \050nbytes == MESSAGE_SIZE\051 {) 18 160 T
(    return;) 18 146 T
(  }) 18 132 T
(  if \050nbytes > -1\051 {) 18 104 T
(    printf\050\322Only wrote %d bytes to %s. \050Impossible?\051\323, nbytes, cname\051;) 18 90 T
(    abort\050\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "113" 113
%%Page: "114" 114
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(1) 297 31.12 T
(14) 302.34 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  }) 18 748 T
(  if \050errno == EINTR\051 {) 18 720 T
(    printf\050\322EINTR while trying to write to %s on fd#%d. retrying...\134n\323,) 18 706 T
(           cname, socket\051;) 18 692 T
(    goto retry;) 18 678 T
(  }) 18 664 T
(  if \050\050errno == EPIPE\051 || \050errno == EBADF\051\051 {) 18 636 T
(    printf\050\322Failed trying to write to %s. \134n\323, cname\051;) 18 622 T
(    perror\050\322Closing socket\323\051;) 18 608 T
(    pthread_mutex_lock\050&client->lock\051;) 18 594 T
(    client->active = FALSE;) 18 580 T
(    pthread_mutex_unlock\050&client->lock\051;) 18 566 T
(    close_client\050client\051;) 18 552 T
(    return;) 18 538 T
(  }) 18 524 T
(  else) 18 510 T
(    perror\050\322Unknown bug \050Impossible?\051\323\051, abort\050\051;) 18 496 T
(  }) 18 482 T
(}) 18 468 T
(/* Manipulate the requests list. Caller must own requests_lock. */) 18 426 T
(request_t *remove_request\050\051 {) 18 412 T
(  request_t *request;) 18 398 T
(  request = requests;) 18 370 T
(  requests = requests->next;) 18 356 T
(  length--;) 18 342 T
(  return\050request\051;) 18 328 T
(}) 18 314 T
(void add_request\050request_t *request\051 {) 18 286 T
(  request->next = requests;                     /* Insert at head of list */) 18 272 T
(  requests = request;) 18 258 T
(  length++;) 18 244 T
(}) 18 230 T
(int open_port\050\051 {) 18 188 T
(  struct sockaddr_in    cli_addr, serv_addr;) 18 174 T
(  int                   port_socket, clilen, i;) 18 160 T
(  /* Open a new port. Try to get requested port. */) 18 132 T
(  if\050\050port_socket = socket\050AF_INET, SOCK_STREAM, 0\051\051 < 0\051) 18 118 T
(    perror\050\322Can\325t create new socket\323\051, abort\050\051;) 18 104 T
(  for \050i=REQUESTED_TCP_PORT; i< REQUESTED_TCP_PORT+MAX_PORT_RANGE; i++\051 {) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "114" 114
%%Page: "115" 115
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(1) 297 31.12 T
(15) 302.34 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    memset\050\050char *\051 &serv_addr, 0, sizeof\050serv_addr\051\051;) 18 748 T
(    serv_addr.sin_family = AF_INET;) 18 734 T
(    serv_addr.sin_addr.s_addr = htonl\050INADDR_ANY\051;) 18 720 T
(    serv_addr.sin_port = htons\050i\051;) 18 706 T
(    if \050bind\050port_socket, \050struct sockaddr *\051&serv_addr, sizeof\050serv_addr\051\051<0\051) 18 692 T
(      {DEBUG\050printf\050\322Can\325t bind to port %d\134n\323, i\051\051;}) 18 678 T
(    else {) 18 664 T
(      printf\050\322Server bound to port: %d\134n\323, i\051;) 18 650 T
(      ACTUAL_TCP_PORT=i;) 18 636 T
(      listen\050port_socket, 5\051;) 18 622 T
(      return\050port_socket\051;) 18 608 T
(    }) 18 594 T
(  }) 18 580 T
(  printf\050\322Could not find an available port from %d to %d\323,) 18 566 T
(         REQUESTED_TCP_PORT, REQUESTED_TCP_PORT+MAX_PORT_RANGE\051;) 18 552 T
(  abort\050\051;) 18 538 T
(}) 18 524 T
(/* This will never block. Only called when select\050\051 indicates a new client. */) 18 482 T
(client_t *accept_a_connection\050int port_socket\051 {) 18 468 T
(  int                   new_socket, clilen;) 18 454 T
(  struct sockaddr_in    cli_addr;) 18 440 T
(  clilen = sizeof\050cli_addr\051;) 18 412 T
(  new_socket = accept\050port_socket, \050struct sockaddr *\051 &cli_addr, &clilen\051;) 18 398 T
(  if \050new_socket < 0\051) 18 384 T
(    perror\050\322Accept failed. \050Impossible?\051\323\051, abort\050\051;) 18 370 T
(  return\050new_client\050new_socket\051\051;) 18 342 T
(}) 18 328 T
(void *reporter\050void *arg\051 {) 18 286 T
(  while \050TRUE\051 {) 18 258 T
(    sleep\05030\051;) 18 244 T
(    printf\050\322Server up on port %d. Processed %d requests. %d currently connected) 18 230 T
(clients.\134n\323,) 18 216 T
(           ACTUAL_TCP_PORT, count_requests\0500\051, count_clients\0500\051\051;) 18 202 T
(  }) 18 188 T
(}) 18 174 T
(int startup_initialize\050\051 {) 18 132 T
(  int           i;) 18 118 T
(  struct rlimit         r;) 18 104 T
(  set_up_signal_mask\050\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "115" 115
%%Page: "116" 116
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(1) 297 31.12 T
(16) 302.34 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  thread_barrier_init\050&consumer_barrier1, N_CONSUMERS+1\051;) 18 734 T
(  thread_barrier_init\050&consumer_barrier2, N_CONSUMERS+1\051;) 18 720 T
(  thread_single_barrier_init\050&producer_barrier, 1\051;) 18 706 T
(  thread_single_barrier_init\050&stopper_barrier, 1\051;) 18 692 T
(  PTHREAD_ATTR_INIT\050&attr\051;) 18 678 T
(  pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 664 T
(  pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 650 T
(  getrlimit\050RLIMIT_NOFILE, &r\051;) 18 622 T
(  r.rlim_cur=r.rlim_max;) 18 608 T
(  ACTUAL_MAX_FDS = r.rlim_max-10;) 18 594 T
(  setrlimit\050RLIMIT_NOFILE, &r\051;) 18 580 T
(  /*  getrlimit\050RLIMIT_NOFILE, &r\051;) 18 566 T
(      printf\050\322Current limit: %d Max limit: %d\134n\323, r.rlim_cur, r.rlim_max\051; */) 18 552 T
(  for \050i=0; i<ACTUAL_MAX_FDS; i++\051 {) 18 510 T
(    pthread_mutex_init\050&clients[i].lock, NULL\051;) 18 496 T
(  }) 18 482 T
(}) 18 468 T
(int initialize_clients\050\051 {) 18 426 T
(  int i;) 18 412 T
(  client_t *client;) 18 398 T
(  count_clients\050-count_clients\0500\051\051; /* Zero it out */) 18 370 T
(  for \050i=0; i<ACTUAL_MAX_FDS; i++\051 {) 18 356 T
(    client = &clients[i];) 18 342 T
(    pthread_mutex_lock\050&client->lock\051;) 18 328 T
(    close\050client->socket\051;      /* Could be left open by dirty exit */) 18 314 T
(    client->socket = -1;) 18 300 T
(    client->name[0] = \324 \324;) 18 286 T
(    client->active = FALSE;) 18 272 T
(    client->finishing = FALSE;) 18 258 T
(    client->outstanding_requests = 0;) 18 244 T
(    pthread_mutex_unlock\050&client->lock\051;) 18 230 T
(  }) 18 216 T
(  if \050pipe\050interrupter_pipe\051 < 0\051) 18 188 T
(    printf\050\322Can\325t open Interruptor pipe\134n\323\051, abort\050\051;) 18 174 T
(  /* clients[0] is the local socket for announcing new clients. */) 18 146 T
(  clients[0].socket = interrupter_pipe[READ];) 18 132 T
(  strcpy\050clients[0].name, \322Interruptor\323\051;) 18 118 T
(  clients[0].active = TRUE;) 18 104 T
(  port_socket = open_port\050\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "116" 116
%%Page: "117" 117
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(1) 297 31.12 T
(17) 302.34 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  /* clients[1] is the local socket for announcing new clients. */) 18 748 T
(  clients[1].socket = port_socket;) 18 734 T
(  strcpy\050clients[1].name, \322Acceptor\323\051;) 18 720 T
(  clients[1].active = TRUE;) 18 706 T
(}) 18 664 T
(client_t *new_client\050int socket\051 {) 18 580 T
(  int i, c;) 18 566 T
(  client_t *client;) 18 552 T
(  for \050i=0; i<ACTUAL_MAX_FDS; i++\051 { /* Find an open slot in array */) 18 524 T
(    client=&clients[i];) 18 510 T
(    pthread_mutex_lock\050&client->lock\051;) 18 496 T
(    if \050!client->active & \050client->outstanding_requests == 0\051\051 {) 18 468 T
(      /* If client died dirty, there could still be outstanding requests. */) 18 454 T
(      client = &clients[i];) 18 440 T
(      client->socket = socket;) 18 426 T
(      client->active = TRUE;) 18 412 T
(      client->outstanding_requests=0;) 18 398 T
(      client->finishing = FALSE;) 18 384 T
(      client->name[0] = \324 \324;         /* Hack! \050see new_request\050\051\051 */) 18 370 T
(      c =count_clients\0501\051;) 18 356 T
(      DEBUG\050printf\050\322New Client fd#%d. \050%d active clients\051\134n\323,) 18 342 T
(                   socket, c\051\051;) 18 328 T
(      pthread_mutex_unlock\050&client->lock\051;) 18 314 T
(      return\050client\051;) 18 300 T
(    }) 18 286 T
(    pthread_mutex_unlock\050&client->lock\051;) 18 258 T
(  }) 18 244 T
(  pthread_mutex_unlock\050&client->lock\051;) 18 216 T
(  write\050socket, END_CLIENT_MSG, MESSAGE_SIZE\051;             /* Ignore errors */) 18 202 T
(  close\050socket\051;) 18 188 T
(  printf\050\322Too many clients \050max = %d\051. Ignoring new one.\134n\323, ACTUAL_MAX_FDS-2\051;) 18 174 T
(}) 18 160 T
(/* Wait for any client to send a request & return that request. */) 18 118 T
(/* Only one thread may call get_request\050\051. */) 18 104 T
(request_t *get_request\050\051 {) 18 90 T
(  fd_set                readset, errorset;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "117" 117
%%Page: "118" 118
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(1) 297 31.12 T
(18) 302.34 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  int                   i, num_ready, num_now, nbytes, socket;) 18 748 T
(  char                  buf[MESSAGE_SIZE];) 18 734 T
(  request_t             *request;) 18 720 T
(  client_t              *client;) 18 706 T
(  pthread_t             tid = pthread_self\050\051;) 18 692 T
(  while \050TRUE\051 {) 18 650 T
(    /* Reset the bit arrays for select\050\051 */) 18 622 T
(    FD_ZERO\050&readset\051;) 18 608 T
(    FD_ZERO\050&errorset\051;) 18 594 T
(    for \050i = 0; i < ACTUAL_MAX_FDS; i++\051 {) 18 580 T
(      client = &clients[i];) 18 566 T
(      pthread_mutex_lock\050&client->lock\051;) 18 552 T
(      if \050client->active\051 {) 18 538 T
(        FD_SET\050client->socket, &readset\051;) 18 524 T
(        FD_SET\050client->socket, &errorset\051;) 18 510 T
(      }) 18 496 T
(      pthread_mutex_unlock\050&client->lock\051;) 18 482 T
(    }) 18 468 T
(    num_ready = select\050OPEN_MAX, &readset, 0, &errorset, 0\051;) 18 440 T
(    /* Time to exit? */) 18 412 T
(    pthread_mutex_lock\050&requests_lock\051;) 18 398 T
(    if \050stop_producer\051 {) 18 384 T
(      pthread_mutex_unlock\050&requests_lock\051;) 18 370 T
(      return\050NULL\051;           /* Clean exit */) 18 356 T
(    }) 18 342 T
(    pthread_mutex_unlock\050&requests_lock\051;) 18 328 T
(    if \050num_ready < 0\051 {) 18 286 T
(      if \050errno == EBADF\051 goto bottom;  /* An fd was closed, retry */) 18 272 T
(      perror\050\322Error in select\050\051. Impossible\323\051; abort\050\051;) 18 258 T
(    }) 18 244 T
(    /* Find the socket with data ready */) 18 202 T
(    for \050i = 0; i < ACTUAL_MAX_FDS;  i++\051 {) 18 188 T
(      client = &clients[i];) 18 174 T
(      pthread_mutex_lock\050&client->lock\051;) 18 160 T
(      if \050client->active && FD_ISSET\050client->socket, &errorset\051\051 {) 18 132 T
(        /* Error condition pending on this fd. \050What does that mean??\051 */) 18 118 T
(        client->active = FALSE;) 18 104 T
(        pthread_mutex_unlock\050&client->lock\051;) 18 90 T
(        close_client\050client\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "118" 118
%%Page: "119" 119
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(1) 297 31.12 T
(19) 302.34 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(        printf\050\322Error condition on %s, fd#%d from select\050\051. Impossible?\134n\323,) 18 748 T
(               client->name, client->socket\051;) 18 734 T
(        goto bottom;) 18 720 T
(      }) 18 706 T
(      if \050client->active && FD_ISSET\050client->socket, &readset\051\051 {) 18 664 T
(        /* This is the socket with data ready! */) 18 650 T
(        socket = client->socket;) 18 636 T
(        pthread_mutex_unlock\050&client->lock\051;) 18 622 T
(        if \050i == 1\051 {) 18 594 T
(          DEBUG\050printf\050\322Accepting...\134n\323\051\051;) 18 580 T
(          accept_a_connection\050socket\051;) 18 566 T
(          goto bottom;) 18 552 T
(        }) 18 538 T
(        nbytes = read\050socket, buf, MESSAGE_SIZE\051;) 18 524 T
(        if \050\050nbytes == -1\051 || \050nbytes != MESSAGE_SIZE\051\051 {) 18 496 T
(          printf\050\322Read only %d bytes on %s!\134n\323, nbytes, client->name\051;) 18 482 T
(          if \050i == 0\051 {) 18 468 T
(            printf\050\322Interrupt pipe failed. Impossible!\134n\323\051;) 18 454 T
(            abort\050\051;) 18 440 T
(          }) 18 426 T
(          pthread_mutex_lock\050&client->lock\051;) 18 412 T
(          client->active = FALSE;) 18 398 T
(          pthread_mutex_unlock\050&client->lock\051;) 18 384 T
(          close_client\050client\051;) 18 370 T
(          goto bottom;) 18 356 T
(        }) 18 342 T
(        if \050i == 0\051 {    /* Should have exited on stop_producer */) 18 314 T
(          printf\050\322Bogus message on Interruptor. Impossible!\134n\323\051;) 18 300 T
(          abort\050\051;) 18 286 T
(        }) 18 272 T
(        if \050nbytes == MESSAGE_SIZE\051 {/* All is well, return new request_t. */) 18 244 T
(          DEBUG\050printf\050\322Server_%d[%s] get_request\050\051 received: \134\323%s\134\323\134n\323,) 18 230 T
(                       PID, thread_name\050tid\051, buf\051\051;) 18 216 T
(          request = new_request\050client, buf\051;) 18 202 T
(          return\050request\051;) 18 188 T
(        }) 18 174 T
(      }) 18 160 T
(      pthread_mutex_unlock\050&client->lock\051;) 18 146 T
(    }) 18 132 T
(    /* select\050\051 returned 0 ready, or failed to set readset */) 18 104 T
(    if \050num_ready == 0\051) 18 90 T
(      printf\050\322select\050\051 returned 0 ready. Impossible?\134n\323\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "119" 119
%%Page: "120" 120
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(120) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    else) 18 748 T
(      printf\050\322select\050\051 returned %d ready \050readset not set\051 Impossible?\134n\323,) 18 734 T
(             num_ready\051;) 18 720 T
(    abort\050\051;) 18 706 T
(  bottom: {}) 18 678 T
(  }     /* End while\050TRUE\051 */) 18 664 T
(}) 18 650 T
(/* Send a reply back to client */) 18 622 T
(void *process_request\050request_t *request\051 {) 18 608 T
(  client_t              *client = request->client;) 18 594 T
(  char                  *cname;) 18 580 T
(  char                  obuf[MESSAGE_SIZE];) 18 566 T
(  char                  *t_name = thread_name\050pthread_self\050\051\051;) 18 552 T
(  int                   i, nbytes, finishing, socket;) 18 538 T
(  DEBUG\050printf\050\322Server_%d[%s] processing: \134\323%s\134\323\134n\323,) 18 510 T
(               PID, t_name, request->data\051\051;) 18 496 T
(    pthread_mutex_lock\050&client->lock\051;) 18 468 T
(    socket = client->socket;) 18 454 T
(    cname = client->name;) 18 440 T
(    pthread_mutex_unlock\050&client->lock\051;) 18 426 T
(    if \050strncmp\050request->data, END_CLIENT_MSG, 3\051 == 0\051 {) 18 398 T
(      pthread_mutex_lock\050&client->lock\051;) 18 384 T
(      client->finishing = TRUE;) 18 370 T
(      pthread_mutex_unlock\050&client->lock\051;) 18 356 T
(    }) 18 342 T
(    else {) 18 328 T
(      delay\050SLEEP, SPIN\051;) 18 314 T
(      sprintf\050obuf, \322Server_%d[%s] reply %d to %s\323,) 18 300 T
(              PID, t_name, count_requests\0501\051, request->data\051;) 18 286 T
(      write_msg\050client, obuf\051;) 18 272 T
(    }) 18 258 T
(  i = delete_request\050request\051;) 18 244 T
(  if \050i == 0\051 {) 18 230 T
(    pthread_mutex_lock\050&client->lock\051;) 18 216 T
(    finishing = client->finishing;) 18 202 T
(    pthread_mutex_unlock\050&client->lock\051;) 18 188 T
(    if \050finishing\051 close_client\050client\051;) 18 174 T
(  }) 18 160 T
(}) 18 146 T
(void *producer\050void *arg\051 {) 18 132 T
(  request_t *request;) 18 118 T
(  int j;) 18 104 T
(  DEBUG\050printf\050\322Producer starting.\134n\323\051\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "120" 120
%%Page: "121" 121
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(121) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  set_up_signal_mask\050\051;) 18 748 T
(  while \050TRUE\051 {) 18 720 T
(    request = get_request\050\051;) 18 706 T
(    if \050request == NULL\051 {) 18 678 T
(      pthread_mutex_lock\050&requests_lock\051;) 18 664 T
(      if \050!stop_producer\051 {) 18 650 T
(        printf\050\322get_request\050\051 returned NULL w/o stop. Impossible.\323\051;) 18 636 T
(        abort\050\051;) 18 622 T
(      }) 18 608 T
(      pthread_mutex_unlock\050&requests_lock\051;) 18 594 T
(      DEBUG\050printf\050\322Producer exiting via get_request\050\051.\134n\323\051\051;) 18 580 T
(      thread_single_barrier_post\050&producer_barrier\051;) 18 566 T
(      pthread_exit\050NULL\051;) 18 552 T
(    }) 18 538 T
(    pthread_mutex_lock\050&requests_lock\051;) 18 496 T
(    while \050\050length >= 10\051 && \050!stop_producer\051\051) 18 482 T
(      pthread_cond_wait\050&producer_cv, &requests_lock\051;) 18 468 T
(    add_request\050request\051;) 18 454 T
(    if \050stop_producer\051 break;) 18 440 T
(    pthread_mutex_unlock\050&requests_lock\051;) 18 426 T
(    pthread_cond_signal\050&consumer_cv\051;) 18 412 T
(  }) 18 398 T
(  pthread_mutex_unlock\050&requests_lock\051;) 18 356 T
(  DEBUG\050printf\050\322Producer exiting via wait.\134n\323\051\051;) 18 342 T
(  thread_single_barrier_post\050&producer_barrier\051;) 18 328 T
(  pthread_exit\050NULL\051;) 18 314 T
(}) 18 300 T
(void *consumer\050void *arg\051 {) 18 258 T
(  request_t *request;) 18 244 T
(  DEBUG\050printf\050\322Consumer starting.\134n\323\051\051;) 18 216 T
(  set_up_signal_mask\050\051;) 18 202 T
(  while\050TRUE\051 {) 18 174 T
(    pthread_mutex_lock\050&requests_lock\051;) 18 160 T
(    while \050\050length == 0\051 && \050!stop_consumers\051\051) 18 146 T
(      pthread_cond_wait\050&consumer_cv, &requests_lock\051;) 18 132 T
(    if \050\050length == 0\051 && \050stop_consumers\051\051 {) 18 118 T
(      /* Empty the queue first, then indicate done. */) 18 104 T
(      pthread_mutex_unlock\050&requests_lock\051;) 18 90 T
(      thread_barrier_wait\050&consumer_barrier1\051; /* consumers are stopped */) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "121" 121
%%Page: "122" 122
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(122) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(      thread_barrier_wait\050&consumer_barrier2\051; /* consumers may continue */) 18 748 T
(      continue;         /* Continue when everyone is done. */) 18 734 T
(    }) 18 720 T
(    request = remove_request\050\051;) 18 706 T
(    pthread_mutex_unlock\050&requests_lock\051;) 18 692 T
(    pthread_cond_signal\050&producer_cv\051;) 18 678 T
(    process_request\050request\051;) 18 664 T
(  }) 18 650 T
(}) 18 636 T
(void *stopper\050void *arg\051 {) 18 580 T
(  pthread_t waker_thread;) 18 566 T
(  sleep\050STOPPER_SLEEP\051;) 18 538 T
(  printf\050\322Time to stop!\134n\323\051;) 18 524 T
(  /* Wake up producer if blocked in select\050\051 wait\050\051 */) 18 496 T
(  pthread_mutex_lock\050&requests_lock\051;) 18 482 T
(  stop_producer = TRUE;) 18 468 T
(  pthread_mutex_unlock\050&requests_lock\051;) 18 454 T
(  pthread_cond_broadcast\050&producer_cv\051;) 18 440 T
(  /* Wake producer */) 18 426 T
(  write\050interrupter_pipe[WRITE], STOP_MSG, MESSAGE_SIZE\051;) 18 412 T
(  thread_single_barrier_wait\050&producer_barrier\051;) 18 398 T
(  close\050interrupter_pipe[WRITE]\051;) 18 384 T
(  /* Wake up all CV sleepers and stop them last. Otherwise the producer) 18 342 T
(   could still add a request after they all stopped. */) 18 328 T
(  pthread_mutex_lock\050&requests_lock\051;) 18 314 T
(  stop_consumers=TRUE;) 18 300 T
(  pthread_mutex_unlock\050&requests_lock\051;) 18 286 T
(  pthread_cond_broadcast\050&consumer_cv\051;) 18 272 T
(  thread_barrier_wait\050&consumer_barrier1\051;) 18 258 T
(  DEBUG\050printf\050\322Stopper finished.\134n\323\051\051;) 18 230 T
(  thread_single_barrier_post\050&stopper_barrier\051;) 18 216 T
(  pthread_exit\050NULL\051;) 18 202 T
(}) 18 188 T
(main\050int argc, char **argv\051 {) 18 160 T
(  int                   i, j;) 18 146 T
(  pthread_t             tid;) 18 132 T
(  PID = getpid\050\051;) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "122" 122
%%Page: "123" 123
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(123) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  if \050argc > 1\051 REQUESTED_TCP_PORT = atoi\050argv[1]\051;) 18 748 T
(  if \050argc > 2\051 SLEEP = atoi\050argv[2]\051;) 18 734 T
(  if \050argc > 3\051 SPIN = atoi\050argv[3]\051;) 18 720 T
(  if \050argc > 4\051 N_CONSUMERS = atoi\050argv[4]\051;) 18 706 T
(  if \050argc > 5\051 STOPPER_SLEEP = atoi\050argv[5]\051;) 18 692 T
(  if \050argc > 6\051 KILLER_SLEEP = atoi\050argv[6]\051;) 18 678 T
(  printf\050\322Server_%d\050TCP_PORT %d SLEEP %dms SPIN %dus N_CONSUMERS \134) 18 664 T
(%d STOPPER %ds KILLER %ds\051\134n\323,) 18 650 T
(         PID, REQUESTED_TCP_PORT, SLEEP, SPIN, N_CONSUMERS,) 18 636 T
(         STOPPER_SLEEP, KILLER_SLEEP\051;) 18 622 T
(  startup_initialize\050\051;) 18 594 T
(  for \050i=0; i<N_CONSUMERS; i++\051 {) 18 566 T
(    PTHREAD_CREATE\050&tid, &attr, consumer, \050void *\051 NULL\051;) 18 552 T
(  }) 18 538 T
(  PTHREAD_CREATE\050&tid, &attr, reporter, NULL\051;) 18 510 T
(  for \050j=0; j<1000; j++\051 {         /* Start/Stop 1000 times */) 18 482 T
(    printf\050\322Starting up interation %d.\134n\323, j\051;) 18 468 T
(    initialize_clients\050\051;) 18 454 T
(    PTHREAD_CREATE\050&producer_thread, &attr, producer, \050void *\051 NULL\051;) 18 426 T
(    if \050STOPPER_SLEEP > 0\051) 18 412 T
(      PTHREAD_CREATE\050&tid, &attr, stopper, \050void *\051 NULL\051;) 18 398 T
(    if \050KILLER_SLEEP > 0\051) 18 384 T
(      PTHREAD_CREATE\050&tid, &attr, killer, \050void *\051 KILLER_SLEEP\051;) 18 370 T
(    thread_single_barrier_wait\050&stopper_barrier\051;) 18 342 T
(    printf\050\322Shutdown successful. %d replies sent.\134n\134n\134n\323, count_requests\0500\051\051;) 18 328 T
(    pthread_mutex_lock\050&requests_lock\051;) 18 300 T
(    stop_producer=FALSE;) 18 286 T
(    stop_consumers=FALSE;) 18 272 T
(    pthread_mutex_unlock\050&requests_lock\051;) 18 258 T
(    thread_barrier_wait\050&consumer_barrier2\051; /* NOW restart consumers */) 18 244 T
(  }) 18 230 T
(  printf\050\322Exiting Server Normally after 1000 iterations.\134n\323\051;) 18 216 T
(}) 18 202 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "123" 123
%%Page: "124" 124
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(124) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 63 594 756 C
18 130.33 550.91 744 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
450.96 731.36 450.96 197.39 2 L
1 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
443.13 380.61 458.79 704.57 R
7 X
V
0.5 H
0 X
N
443.13 292.92 458.79 380.61 R
7 X
V
0 X
N
2 14 Q
(T@1) 0 -90 446.89 183.86 TF
113.18 605.41 128.84 655.48 R
N
136.08 273.87 140.78 273.87 2 L
0 Z
N
136.33 276.44 140.78 273.87 136.33 271.3 3 L
N
119.39 273.87 136.08 273.87 2 L
2 Z
N
(W) 0 -90 98.85 658.03 TF
(orking) 0 -90 98.85 645.65 TF
(Sleeping) 0 -90 97.47 459.5 TF
(Signal) 0 -90 102.27 294.88 TF
116.63 414.09 125.38 446.57 R
3 X
V
0 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
226.85 728.88 226.85 200.09 2 L
1 H
N
4 F
(settimer\0503,fn,T@1\051) 0 -90 471.23 540.97 TF
(call_device\050\051) 0 -90 424.95 556.33 TF
(handler\050\051) 0 -90 424.87 378.97 TF
201.85 419.5 206.55 419.5 2 L
0.5 H
0 Z
N
202.1 422.06 206.55 419.5 202.1 416.93 3 L
N
185.16 419.5 201.85 419.5 2 L
2 Z
N
219.02 362.33 234.68 419.5 R
7 X
V
0 X
N
2 F
(SIGALRM) 0 -90 164.29 487.49 TF
415.76 380.41 420.46 380.41 2 L
0 Z
N
416.01 382.97 420.46 380.41 416.01 377.84 3 L
N
269.04 380.41 415.76 380.41 2 L
2 Z
N
(SIGUSR1) 0 -90 321.15 373.47 TF
443.13 206.17 458.79 292.92 R
7 X
V
0 X
N
222.48 419.5 231.23 691.14 R
3 X
V
0 X
N
222.48 219.42 231.23 362.33 R
3 X
V
0 X
N
(W) 0 -90 223.37 188.89 TF
(aiter) 0 -90 223.37 176.23 TF
219.02 653.83 234.68 719.62 R
7 X
V
0 X
N
4 F
(fn\050T@1\051) 0 -90 247.11 432.7 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(sigwait\050\051) 0 -90 247.04 665.52 TF
344.2 502.08 368.99 638.16 R
1 H
0 Z
N
368.99 569.83 344.2 569.83 2 L
2 Z
N
90 450 4.95 4.96 270 357.56 514.11 GG
90 450 4.95 4.96 270 357.56 514.11 AA
2 18 Q
(fn T@1 1:10) 0 -90 352.24 632.4 TF
369 612.96 344.2 612.96 2 L
N
4 14 Q
(setjmp\050\051) 0 -90 471.23 674.16 TF
(longjmp\050\051) 0 -90 471.23 373.33 TF
369 528 344.2 528 2 L
N
293.12 588.3 296.09 588.45 293.64 577.95 290.16 588.15 4 Y
0.5 H
0 Z
N
293.12 588.3 296.09 588.45 293.64 577.95 290.16 588.15 4 Y
V
357.48 512.88 M
 363.77 499.32 356.67 472.86 337.69 489.8 D
 307.86 516.43 341.79 570.72 312.3 606.54 D
 306.91 613.08 292.44 601.96 293.11 588.55 D
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
281.88 438 306.68 574.08 R
1 H
0 Z
N
306.68 505.75 281.88 505.75 2 L
2 Z
N
90 450 4.95 4.96 270 295.25 450.03 GG
90 450 4.95 4.96 270 295.25 450.03 AA
2 18 Q
(fb T@2 1:12) 0 -90 289.93 568.32 TF
306.69 548.88 281.89 548.88 2 L
N
306.69 463.92 281.89 463.92 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 14 Q
(PC=x0123) 0 -90 448.86 670.08 TF
(PC=x0123!) 0 -90 448.14 291.25 TF
458.4 556.8 443.28 556.8 2 L
0.5 H
N
2 32 Q
(Signals and Timer) 0 -90 512.08 589.88 TF
(s) 0 -90 512.08 314.71 TF
[6.888 6.888] 0 I
405 699 M
 405 703.97 400.97 708 396 708 D
 391.03 708 387 703.97 387 699 D
 387 694.03 391.03 690 396 690 D
 400.97 690 405 694.03 405 699 D
O
V
1 H
N
J
356.97 661.24 359.93 660.99 356.08 650.9 354 661.5 4 Y
0.5 H
0 Z
N
356.97 661.24 359.93 660.99 356.08 650.9 354 661.5 4 Y
V
396 699 M
 402.43 686.26 392.19 659.23 376 672.62 D
 370.9 676.84 366.02 691.17 359.69 682 D
 355.13 675.41 357.58 668.43 356.99 661.49 D
2 Z
N
4 14 Q
(% callout_tests) 0 -90 45.24 597.6 TF
18 63 594 756 C
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "124" 124
%%Page: "125" 125
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(125) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Creating Thread-Local) 114.97 732 T
(Signals:callout_tests.c) 110.93 684 T
4 12 Q
(   /*                callout_tests.c                */) 18 628 T
(/*) 18 600 T
(================================================================) 18 586 T
(  I want to read from an unreliable device and interrupt it if) 18 572 T
(it should fail to return from the read after some amount of time.) 18 558 T
(So I set a per-thread timer and longjmp\050\051 out of the device) 18 544 T
(driver should it expire.) 18 530 T
(================================================================) 18 516 T
(cc -o callout_tests callout_tests.c -L. -R. -lcallout -g  -lpthread -lthread -) 18 474 T
(pthread_extensions -lposix4) 18 460 T
(*/) 18 446 T
(#define _POSIX_C_SOURCE 199506L) 18 418 T
(#include <signal.h>) 18 390 T
(#include <stdio.h>) 18 376 T
(#include <assert.h>) 18 362 T
(#include <pthread.h>) 18 348 T
(#include <setjmp.h>) 18 334 T
(#include \322callout.h\323) 18 320 T
(#include \322thread_extensions.h\323) 18 306 T
(int                     TIMEOUT = 3, DEVICE_SPEED = 3;) 18 222 T
(pthread_key_t           JMPBUF_KEY;) 18 208 T
(void my_SigHandler\050int signo\051) 18 166 T
({void                   *envp;) 18 152 T
( pthread_t              tid = pthread_self\050\051;) 18 138 T
( char                   *name = thread_name\050tid\051;) 18 124 T
( /*   Note that printf\050\051 and thread_name\050\051 are not signal safe! */) 18 96 T
( printf\050\322Got signal in thread: %s. Signal %d\134n\323, name, signo\051;) 18 82 T
( envp = pthread_getspecific\050JMPBUF_KEY\051;) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "125" 125
%%Page: "126" 126
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(126) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( siglongjmp\050\050int *\051 envp, 1\051;) 18 748 T
(}) 18 734 T
(void slow_device_interrupter\050void *arg\051) 18 706 T
({pthread_t *ptid;) 18 692 T
( ptid = \050pthread_t *\051 arg;) 18 664 T
( printf\050\322Interrupting the device on thread %s...\134n\323, thread_name \050*ptid\051\051;) 18 650 T
( pthread_kill\050*ptid, SIGUSR1\051;   /* Interrupt the device. */) 18 636 T
(}) 18 622 T
(device_read\050int speed\051  /* Fake a read from the actual device */) 18 580 T
({) 18 566 T
(  delay\050speed*1000, 0\051;) 18 552 T
(}) 18 538 T
(void call_device\050int speed, int timeout\051) 18 496 T
({int                    timer_number;) 18 482 T
( pthread_t              tid = pthread_self\050\051;) 18 468 T
( timer_number = thread_settimer\050timeout, slow_device_interrupter,) 18 440 T
(                                 \050void *\051 &tid\051; /* Should not pass tid! */) 18 426 T
( device_read\050speed\051;) 18 412 T
( thread_deletetimer\050timer_number\051;) 18 398 T
( printf\050\322Device responded in time!\134n\323\051;) 18 384 T
(}) 18 370 T
(/* This thread doesn\325t do anything useful for this program.  It does) 18 328 T
(   prove that you can have different threads calling sigwait\050\051 on) 18 314 T
(   different signal sets.) 18 300 T
(*/) 18 286 T
(void *my_sigwaiter\050void *arg\051) 18 272 T
({int            sig, err;) 18 258 T
( sigset_t       s;) 18 244 T
( sigfillset\050&s\051;) 18 216 T
( pthread_sigmask\050SIG_BLOCK, &s, NULL\051;  /* Take no interrupts */) 18 202 T
( sigemptyset \050&s\051;) 18 174 T
( sigaddset \050&s, SIGINT\051;) 18 160 T
( sigaddset \050&s, SIGTSTP\051;) 18 146 T
( sigaddset \050&s, SIGQUIT\051;) 18 132 T
( sigaddset \050&s, SIGHUP\051;) 18 118 T
( /* User program waits for everything EXCEPT USR1 and ALRM */) 18 90 T
( while\0501\051) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "126" 126
%%Page: "127" 127
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(127) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    {err = sigwait\050&s, &sig\051;) 18 748 T
(    if \050err != 0\051 {) 18 734 T
(        printf\050\322%s\134n\323, strerror\050err\051\051;) 18 720 T
(        abort\050\051;) 18 706 T
(     }) 18 692 T
(     switch \050sig\051) 18 678 T
(       {case SIGINT  :  printf\050\322Exit on SIGINT\134n\323\051, exit\0501\051;) 18 664 T
(        case SIGTSTP :  printf\050\322Exit on SIGSTP\134n\323\051, exit\0501\051;) 18 650 T
(        case SIGQUIT :  printf\050\322Exit on SIGQUIT\134n\323\051, exit\0501\051;) 18 636 T
(        default:        printf\050\322Default handler for signal: %d\134n\323, sig\051;) 18 608 T
(      }) 18 594 T
(   }) 18 580 T
(}) 18 566 T
(main\050int argc, char *argv[]\051) 18 524 T
({jmp_buf                        env;) 18 510 T
( sigset_t                       s, s1, s2;) 18 496 T
( static struct sigaction        action;) 18 482 T
( int                            i;) 18 468 T
( pthread_t                      tid;) 18 454 T
( /* Initialize things */) 18 398 T
( action.sa_handler = \050void \050*\051\050void\051\051 my_SigHandler;) 18 384 T
( sigaction\050SIGUSR1, &action, NULL\051;) 18 370 T
( sigfillset\050&s\051;) 18 342 T
( pthread_sigmask\050SIG_BLOCK, &s, &s2\051; /* Block everything, then... */) 18 328 T
( sigemptyset\050&s\051;) 18 314 T
( sigaddset\050&s, SIGUSR1\051;) 18 300 T
( pthread_sigmask\050SIG_UNBLOCK, &s, &s1\051; /* Unblock USR1 */) 18 286 T
( PTHREAD_CREATE\050&tid, NULL, my_sigwaiter, NULL\051;) 18 258 T
( pthread_key_create\050&JMPBUF_KEY, NULL\051;) 18 244 T
(#if !defined\050__sun\051 && !defined\050__alpha\051) 18 216 T
( initialize_thread_timer\050\051;) 18 202 T
(#endif) 18 188 T
( /* The real program begins here. */) 18 160 T
( for \050i=0; i < 4; i++\051) 18 132 T
(   {DEVICE_SPEED = i; TIMEOUT = 4 - i;) 18 104 T
(    printf\050\322DEVICE_SPEED=%d TIMEOUT=%d\134n\323, DEVICE_SPEED, TIMEOUT\051;) 18 90 T
(    if \050sigsetjmp\050env, 1\051 != 0\051) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "127" 127
%%Page: "128" 128
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(128) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(      {printf\050\322Device timed out!\134n\323\051;) 18 748 T
(       continue;) 18 734 T
(     }) 18 720 T
(    pthread_setspecific\050JMPBUF_KEY, \050void *\051env\051;) 18 706 T
(    call_device\050DEVICE_SPEED, TIMEOUT\051;) 18 692 T
(  }) 18 678 T
( printf\050\322Done\134n\323\051;) 18 650 T
( exit\0500\051;) 18 636 T
(}) 18 622 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "128" 128
%%Page: "129" 129
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(129) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Creating Thread-Local Signals:) 39.94 732 T
(callout.c \050librar) 160.78 684 T
(y\051) 419.22 684 T
4 12 Q
(/*                callout.c                */) 18 614 T
(/*) 18 558 T
( The interface to the per-thread alarm package.  This is fully MT-safe) 18 530 T
( and will handle any number of alarms / sleeps.) 18 516 T
(   int thread_settimer\050int delay, void fn\050void *\051, void *arg\051) 18 488 T
(   thread_deletetimer\050int timer_number\051) 18 474 T
(   void thread_sleep\050int t\051) 18 460 T
( typically:) 18 404 T
(   i = thread_settimer\05020, foo, TID\051;) 18 376 T
(   ...) 18 362 T
(   thread_deletetimer\050i\051;) 18 348 T
( \322Run function foo\050TID\051 in 20 seconds.\323) 18 320 T
( If the thread gets to the deletetimer\050\051 line before the alarm expires,) 18 292 T
( only that one alarm will be affected.) 18 278 T
( TID can be any value, and foo\050\051 is allowed to send a signal to specific) 18 250 T
( threads if desired \050eg, TID\051.  That thread would have to install a signal) 18 236 T
( handler in that case \050presumably SIGUSR1\051.) 18 222 T
( thread_sleep\0503\051;) 18 180 T
( \322Put the current thread to sleep for 3 seconds.\323) 18 152 T
( sleep\050\051 uses SIGALRM, so it will not work with other uses of alarm\050\051.) 18 124 T
( thread_sleep\050\051 is based upon thread_settimer\050\051 and works reliably with any) 18 110 T
( number of threads.  Note that the sleeping thread will become RUNNABLE) 18 96 T
( at wake-up time.  When it actually gets a CPU is a scheduling question.) 18 82 T
( \050Yes, nanosleep\050\051 makes more sense, but this is a nice proof-of-concept.\051) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "129" 129
%%Page: "130" 130
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(130) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( The user code must not handle SIGALRM, but that is the only limitation.) 18 720 T
( \050Mask it out & don\325t sigwait\050\051 on it.\051  The user code may install handlers) 18 706 T
( or sigwait\050\051 for any other signal.) 18 692 T
( This library uses alarm\050\051, hence its finest granularity is 1 second.  Higher) 18 664 T
( resolution timers can easily be built on top of this, and are left to the) 18 650 T
( reader as an exercise.) 18 636 T
(  Build a dynamic library:) 18 594 T
(cc  -G -o libcallout.so callout.c -g -lpthread -lthread -lposix4) 18 566 T
(*/) 18 552 T
(#define _POSIX_C_SOURCE 199506L) 18 496 T
(#include <signal.h>) 18 468 T
(#include <stdio.h>) 18 454 T
(#include <pthread.h>) 18 440 T
(#include <semaphore.h>) 18 426 T
(#include <errno.h>) 18 412 T
(#include \322thread_extensions.h\323) 18 398 T
( /*  This runs before main\050\051 and starts up the sigwait\050\051 loop for SIGALRM. */) 18 356 T
(void initialize_thread_timer\050\051;) 18 328 T
(#ifdef __sun) 18 300 T
(#pragma init \050initialize_thread_timer\051) 18 286 T
(#endif) 18 272 T
(#if defined \050__alpha\051 && defined \050__osf__\051) 18 244 T
(__init_thread_timer\050\051) 18 230 T
({initialize_thread_timer\050\051;}) 18 216 T
(#endif) 18 202 T
(typedef struct timer_struct {) 18 160 T
(  int                   expire_time;   /* UTC time */) 18 146 T
(  int                   number;        /* Unique identifier */) 18 132 T
(  void                  \050*fn\051\050void *\051; /* Function to call */) 18 118 T
(  void                  *arg;          /* Argument to fn */) 18 104 T
(  struct timer_struct   *next;         /* Pointer to next */) 18 90 T
(} timer_queue_t;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "130" 130
%%Page: "131" 131
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(131) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(timer_queue_t           *timer_queue;) 18 734 T
(pthread_t               _SIGWAIT_TID;) 18 720 T
(pthread_mutex_t         timer_queue_mutex;) 18 706 T
(sem_t                   timer_sema;) 18 692 T
(int                     timer_number;) 18 678 T
(void UnusedSigHandler\050int signo\051) 18 650 T
({) 18 636 T
(  /* This should never happen.) 18 622 T
(     Note that printf\050\051 and thread_name\050\051 are not signal safe!) 18 608 T
(     */) 18 594 T
(  printf\050\322Got SIGALRM \050%d\051 in handler for thread %d?!\134n\323,) 18 580 T
(         signo, thread_name\050pthread_self\050\051\051\051;) 18 566 T
(  exit\0501\051;) 18 552 T
(}) 18 538 T
( /* To wake up a sleeping thread, just release its semaphore.  The) 18 510 T
(   thread will run as soon as the scheduler decides to schedule it.) 18 496 T
( */) 18 482 T
(void thread_timer_wakeup\050void *s\051) 18 468 T
({) 18 454 T
(  sem_post\050\050sem_t *\051 s\051;) 18 440 T
(}) 18 426 T
( /* Set a sleep time.  This function will set up the ALRM, then sleep) 18 398 T
(   on a semaphore it creates for the purpose. */) 18 384 T
(void thread_sleep\050int t\051) 18 370 T
({sem_t s;) 18 356 T
( if \050t < 1\051 return;) 18 328 T
( SEM_INIT\050&s, 0, NULL\051;) 18 314 T
( thread_settimer\050t, thread_timer_wakeup, &s\051;) 18 300 T
( while\050sem_wait\050&s\051 != 0\051 DEBUG\050printf\050\322Sem Interrupted\134n\323\051;\051) 18 286 T
( sem_destroy\050&s\051;) 18 272 T
(}) 18 258 T
(initialize_timer\050\051) 18 216 T
({) 18 202 T
(  _SIGWAIT_TID = pthread_self\050\051;) 18 188 T
(  timer_queue = \050timer_queue_t *\051 malloc\050sizeof\050timer_queue_t\051\051;) 18 174 T
(  timer_queue->next = NULL;) 18 160 T
(  timer_queue->expire_time = -1;) 18 146 T
(  timer_number = 1;) 18 132 T
(  sem_post\050&timer_sema\051;                /* Used only for initialization */) 18 118 T
(}) 18 104 T
(thread_timer_setalarm\050\051) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "131" 131
%%Page: "132" 132
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(132) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
({int now = time\050NULL\051;) 18 748 T
( int delay;) 18 734 T
( pthread_mutex_lock\050&timer_queue_mutex\051;) 18 706 T
( if \050timer_queue->next == NULL\051) 18 692 T
(   {pthread_mutex_unlock\050&timer_queue_mutex\051;) 18 678 T
(    return;}) 18 664 T
( delay = timer_queue->next->expire_time - now;) 18 650 T
( if \050delay < 1\051 delay = 1;) 18 636 T
(  alarm\050delay\051;) 18 622 T
( pthread_mutex_unlock\050&timer_queue_mutex\051;) 18 608 T
(}) 18 594 T
( /* Delete the node for the 1st matching entry.  Leave the ALRM. */) 18 566 T
(void thread_deletetimer\050int timer_number\051) 18 552 T
({) 18 538 T
(  timer_queue_t         *tq, *tq1, *tq2, *ts;) 18 524 T
(  pthread_mutex_lock\050&timer_queue_mutex\051;) 18 496 T
(  tq2 = timer_queue;) 18 482 T
(  for \050tq = timer_queue, tq1 = timer_queue->next;) 18 468 T
(       tq1 != NULL;) 18 454 T
(       tq1 = tq1->next, tq = tq->next\051) 18 440 T
(    {if \050tq1->number == timer_number\051) 18 426 T
(     {tq->next = tq1->next;) 18 412 T
(      free\050tq1\051;}}) 18 398 T
( pthread_mutex_unlock\050&timer_queue_mutex\051;) 18 384 T
(}) 18 370 T
(int thread_settimer\050int delay, void fn\050void *\051, void *arg\051) 18 328 T
({) 18 314 T
(  timer_queue_t         *tq, *tq1, *tq2, *ts;) 18 300 T
(  int                   expire_time;) 18 286 T
(  int                   killp = 0;) 18 272 T
(  ts  = \050timer_queue_t *\051 malloc\050sizeof\050timer_queue_t\051\051;) 18 244 T
(  expire_time = \050int\051 time\050NULL\051+delay;) 18 230 T
(  ts->expire_time=expire_time;) 18 216 T
(  ts->fn = fn;) 18 202 T
(  ts->arg = arg;) 18 188 T
(  pthread_mutex_lock\050&timer_queue_mutex\051;) 18 160 T
(  timer_number++;) 18 146 T
(  ts->number = timer_number;) 18 132 T
(  tq2 = timer_queue;) 18 118 T
(  DEBUG\050if \050tq2->next == NULL\051 printf\050\322New Timer\134n\323\051;\051) 18 104 T
(  for \050tq = timer_queue, tq1 = timer_queue->next;) 18 90 T
(       1;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "132" 132
%%Page: "133" 133
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(133) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(       tq1 = tq1->next, tq = tq->next\051) 18 748 T
(    {if \050\050tq1 == NULL\051 || \050tq1->expire_time > expire_time\051\051) 18 734 T
(     {tq->next = ts;) 18 720 T
(      ts->next = tq1;) 18 706 T
(      if \050tq2->next == ts\051 killp = 1;) 18 692 T
(      pthread_mutex_unlock\050&timer_queue_mutex\051;) 18 678 T
(      thread_timer_setalarm\050\051;) 18 650 T
(      return\050timer_number\051;}) 18 636 T
(   }) 18 622 T
(}) 18 608 T
(thread_expired_timer\050\051) 18 580 T
({) 18 566 T
(  timer_queue_t         *tq, *tq1;) 18 552 T
(  int                   now = time\050NULL\051;) 18 538 T
(  void                  \050*fn\051 \050void *\051;) 18 524 T
(  void                  *arg;) 18 510 T
(  pthread_mutex_lock\050&timer_queue_mutex\051;) 18 468 T
(  tq = timer_queue->next;) 18 454 T
(  tq1 = tq->next;) 18 440 T
(  while\050tq->expire_time <= now\051) 18 412 T
(    {fn = tq->fn;) 18 398 T
(     arg = tq->arg;) 18 384 T
(     free\050tq\051;) 18 370 T
(     tq = tq1;) 18 356 T
(     timer_queue->next = tq;) 18 342 T
(     pthread_mutex_unlock\050&timer_queue_mutex\051;) 18 314 T
(     fn\050arg\051;) 18 300 T
(     if \050tq1 == NULL\051 {DEBUG\050printf\050\322No timer.\134n\323\051;\051 return;}) 18 272 T
(     pthread_mutex_lock\050&timer_queue_mutex\051;) 18 258 T
(     tq1 = tq1->next;) 18 244 T
(   }) 18 230 T
(  alarm\050tq->expire_time - now\051;) 18 216 T
(  pthread_mutex_unlock\050&timer_queue_mutex\051;) 18 202 T
(}) 18 188 T
(void *sigwaiter\050void *arg\051) 18 160 T
({int                            sig, err;) 18 146 T
( sigset_t                       s;) 18 132 T
( static struct sigaction        action;) 18 118 T
( action.sa_handler = \050void \050*\051\050void\051\051 UnusedSigHandler;) 18 90 T
( sigaction\050SIGALRM, &action, NULL\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "133" 133
%%Page: "134" 134
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(134) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( sigfillset\050&s\051;) 18 748 T
( pthread_sigmask\050SIG_BLOCK, &s, NULL\051;  /* Take no interrupts */) 18 734 T
( initialize_timer\050\051;) 18 720 T
( sigemptyset\050&s\051;) 18 692 T
( sigaddset\050&s, SIGALRM\051;) 18 678 T
( while\0501\051) 18 650 T
(    {err = sigwait\050&s, &sig\051;) 18 636 T
(     if \050err\051 {errno = err; perror\050\322Sigwait error!\323\051;}) 18 622 T
(     switch \050sig\051) 18 608 T
(       {case SIGALRM :          thread_expired_timer\050\051;) 18 594 T
(                                break;) 18 580 T
(       default:                 printf\050\322IMPOSSIBLE! signal: %d\134n\323, sig\051;) 18 566 T
(      }) 18 552 T
(   }) 18 538 T
(}) 18 524 T
(void initialize_thread_timer\050\051) 18 482 T
({ pthread_attr_t        attr;) 18 468 T
(  int                   err;) 18 454 T
(  pthread_t             tid;) 18 440 T
(  SEM_INIT\050&timer_sema, 0, 0\051;) 18 412 T
(  PTHREAD_ATTR_INIT\050&attr\051;) 18 398 T
(  err = pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 384 T
(  pthread_mutex_lock\050&timer_queue_mutex\051;) 18 370 T
(  PTHREAD_CREATE\050&tid, &attr, sigwaiter, NULL\051;) 18 356 T
(  while\050sem_wait\050&timer_sema\051 != 0\051 ;) 18 342 T
(  pthread_mutex_unlock\050&timer_queue_mutex\051;) 18 328 T
(}) 18 314 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "134" 134
%%Page: "135" 135
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(135) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(P) 121.48 732 T
(assing Shared Data:) 144.41 732 T
(matrix_pr) 156.49 684 T
(ob) 319.82 684 T
(lem.c) 363.46 684 T
4 12 Q
(/*                matrix_problem.c                */) 18 614 T
(/*) 18 586 T
(This program illustrates the dangers of inadvertantly using shared) 18 558 T
(data, and the problems which result.) 18 544 T
(What is particularly interesting about this program, is that the) 18 516 T
(thread start times must be considered as random, making this into) 18 502 T
(a big race condition.  It is possible that you will get the correct) 18 488 T
(answer.  It is possible that all the threads will get the same values) 18 474 T
(for {i,j}, it is possible for any combination of values! A very nice) 18 460 T
(program indeed.) 18 446 T
(*/) 18 418 T
(/*) 18 376 T
(cc -o matrix_problem matrix_problem.c -L. -R. -g -lpthread -lthread -pthread -) 18 362 T
(lposix4) 18 348 T
(*/) 18 334 T
(#define _POSIX_C_SOURCE 199506L) 18 292 T
(#include <stdio.h>) 18 264 T
(#include <pthread.h>) 18 250 T
(#include <semaphore.h>) 18 236 T
(#include <errno.h>) 18 222 T
(#include \322thread_extensions.h\323) 18 208 T
(#define SIZE            4) 18 152 T
(pthread_mutex_t         unused_lock = PTHREAD_MUTEX_INITIALIZER;) 18 124 T
(sem_t                   barrier;) 18 110 T
(int                     a[SIZE] [SIZE], b[SIZE] [SIZE], c[SIZE] [SIZE];) 18 96 T
(typedef struct _v) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "135" 135
%%Page: "136" 136
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(136) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
({int    i;) 18 748 T
( int    j;) 18 734 T
(} element_t;) 18 720 T
(void *add_element\050void *arg\051) 18 664 T
({element_t *e = \050element_t *\051 arg;) 18 650 T
( delay\050100, 100\051;) 18 622 T
( c[e->i] [e->j] =  a[e->i] [e->j] +  b[e->i] [e->j];) 18 608 T
( sem_post\050&barrier\051;) 18 594 T
( pthread_exit\050NULL\051;) 18 580 T
(}) 18 566 T
(void fill_matrix\050int m[SIZE][SIZE]\051) 18 524 T
({int i, j, n = 0;) 18 510 T
( for \050i=0; i<SIZE; i++\051) 18 482 T
(   for \050j=0; j<SIZE; j++\051) 18 468 T
(     m[i][j] = n++;) 18 454 T
(}) 18 440 T
(void print_matrix\050int m[SIZE][SIZE]\051) 18 412 T
({int i, j, n = 0;) 18 398 T
( for \050i=0; i<SIZE; i++\051) 18 370 T
(   {printf\050\322\134n\134t| \322\051;) 18 356 T
(    for \050j=0; j<SIZE; j++\051) 18 342 T
(      printf\050\322%2d \322, m[i][j]\051;) 18 328 T
(    printf\050\322|\323\051;) 18 314 T
(  }) 18 300 T
(}) 18 286 T
(main\050int argc, char *argv[]\051) 18 244 T
({int            i, j, n = 0;) 18 230 T
( element_t      element;) 18 216 T
( pthread_attr_t attr;) 18 202 T
( pthread_t      tid;) 18 188 T
( SEM_INIT\050&barrier, NULL, 0\051;) 18 160 T
( PTHREAD_ATTR_INIT\050&attr\051;) 18 146 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 132 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 118 T
( fill_matrix\050a\051;) 18 90 T
( fill_matrix\050b\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "136" 136
%%Page: "137" 137
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(137) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( iobench_start\050\051;) 18 720 T
( for \050i=0; i<SIZE; i++\051) 18 706 T
(   for \050j=0; j<SIZE; j++\051) 18 692 T
(     {element.i = i; element.j = j;) 18 678 T
(      PTHREAD_CREATE\050&tid, &attr, add_element, &element\051;) 18 664 T
(      delay\0500, 40000\051;) 18 650 T
(    }) 18 636 T
( thread_single_barrier\050&barrier, SIZE*SIZE\051;) 18 622 T
( iobench_end\050\051;) 18 608 T
( printf\050\322\134n\134n\134n\323\051;) 18 580 T
( print_matrix\050a\051;) 18 566 T
( printf\050\322\134n\134n\134n\134t       + \134n\323\051;) 18 552 T
( print_matrix\050b\051;) 18 538 T
( printf\050\322\134n\134n\134n\134t       = \134n\323\051;) 18 524 T
( print_matrix\050c\051;) 18 510 T
( printf\050\322\134n\134n\134n\323\051;) 18 496 T
( iobench_report\050\051;) 18 482 T
( printf\050\322Done\134n\323\051;) 18 468 T
( exit\0500\051;) 18 454 T
(}) 18 440 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "137" 137
%%Page: "138" 138
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(138) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Ex) 146.45 732 T
(er) 190.12 732 T
(cise Objective) 223.42 732 T
2 18 Q
-0.2 (Edit the code in) 18 658 P
4 F
-0.44 (matrix_problem.c) 156.22 658 P
2 F
-0.2 ( and \336x it so that the ans) 329.02 658 P
-0.2 (wer is) 538.37 658 P
(correct.) 18 636 T
(Don\325t peek at) 18 570 T
4 F
(matrix_solution.c) 136.03 570 T
2 F
( or) 319.63 570 T
4 F
(matrix_solution2.c) 347.63 570 T
2 F
( until) 542.03 570 T
-0.26 (y) 18 548 P
-0.26 (ou ha) 27.56 548 P
-0.26 (ve \336gured it out on y) 75.04 548 P
-0.26 (our o) 250.34 548 P
-0.26 (wn! \050The objective is not to g) 294.81 548 P
-0.26 (et the) 541.5 548 P
(ans) 18 526 T
(wer) 48.74 526 T
(, the objective is f) 78.68 526 T
(or y) 229.37 526 T
(ou to think about the issue) 261.94 526 T
(, so that) 491.15 526 T
(when y) 18 504 T
(ou encounter something similar in real code) 78.57 504 T
(, y) 456.86 504 T
(ou\325) 476.42 504 T
(ll be ab) 503.06 504 T
(le) 564.91 504 T
(to deal with it!\051) 18 482 T
(There are n) 18 416 T
(umer) 114.86 416 T
(ous simple solutions to the pr) 158.51 416 T
(ob) 414.2 416 T
(lem.) 436.01 416 T
(Wild Guess at Time to Completion:) 18 372 T
(30 min) 198 350 T
(utes think/design time) 254.84 350 T
(.) 445.25 350 T
(30 min) 198 328 T
(utes pr) 254.84 328 T
(ogramming/deb) 314.5 328 T
(ug) 449.15 328 T
(ging) 470.97 328 T
(My solution c) 198 306 T
(hang) 312.84 306 T
(ed 4 lines of code) 356.02 306 T
(.) 507.44 306 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "138" 138
%%Page: "139" 139
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(139) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(P) 134.84 732 T
(assing Stac) 157.77 732 T
(k Data:) 357.14 732 T
(matrix_solution.c) 156.96 684 T
4 12 Q
(/*                matrix_solution.c                */) 18 614 T
(/*) 18 586 T
(This program illustrates the dangers of inadvertantly using shared) 18 558 T
(data, and the problems which result.) 18 544 T
(What is particularly interesting about this program, is that the) 18 516 T
(thread start times must be considered as random, making this into) 18 502 T
(a big race condition.  It is possible that you will get the correct) 18 488 T
(answer.  It is possible that all the threads will get the same values) 18 474 T
(for {i,j}, it is possible for any combination of values! A very nice) 18 460 T
(program indeed.) 18 446 T
(This shows just one of many possible solutions.  You could pass a) 18 418 T
(structure, you could pass a single integer which encoded i and j,) 18 404 T
(you could use a global array, you could make it a producer/consumer) 18 390 T
(program, etc.) 18 376 T
(*/) 18 348 T
(/*) 18 306 T
(cc -o matrix_solution matrix_solution.c -L. -R. -g -lpthread -lthread -pthread -) 18 292 T
(lposix4) 18 278 T
(*/) 18 264 T
(#define _POSIX_C_SOURCE 199506L) 18 222 T
(#include <stdio.h>) 18 194 T
(#include <pthread.h>) 18 180 T
(#include <semaphore.h>) 18 166 T
(#include <errno.h>) 18 152 T
(#include \322thread_extensions.h\323) 18 138 T
(#define SIZE            4) 18 82 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "139" 139
%%Page: "140" 140
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(140) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(pthread_mutex_t         unused_lock = PTHREAD_MUTEX_INITIALIZER;) 18 748 T
(sem_t                   barrier, one_at_a_time;) 18 734 T
(int                     a[SIZE] [SIZE], b[SIZE] [SIZE], c[SIZE] [SIZE];) 18 720 T
(typedef struct _v) 18 692 T
({int    i;) 18 678 T
( int    j;) 18 664 T
(} element_t;) 18 650 T
(void *add_element\050void *arg\051) 18 594 T
({element_t *e = \050element_t *\051 arg;) 18 580 T
( int i = e->i, j = e->j;) 18 566 T
( delay\050100, 100\051;) 18 538 T
( sem_post\050&one_at_a_time\051;) 18 524 T
( c[i] [j] =  a[i] [j] +  b[i] [j];) 18 510 T
( sem_post\050&barrier\051;) 18 496 T
( pthread_exit\050NULL\051;) 18 482 T
(}) 18 468 T
(void fill_matrix\050int m[SIZE][SIZE]\051) 18 426 T
({int i, j, n = 0;) 18 412 T
( for \050i=0; i<SIZE; i++\051) 18 384 T
(   for \050j=0; j<SIZE; j++\051) 18 370 T
(     m[i][j] = n++;) 18 356 T
(}) 18 342 T
(void print_matrix\050int m[SIZE][SIZE]\051) 18 314 T
({int i, j, n = 0;) 18 300 T
( for \050i=0; i<SIZE; i++\051) 18 272 T
(   {printf\050\322\134n\134t| \322\051;) 18 258 T
(    for \050j=0; j<SIZE; j++\051) 18 244 T
(      printf\050\322%2d \322, m[i][j]\051;) 18 230 T
(    printf\050\322|\323\051;) 18 216 T
(  }) 18 202 T
(}) 18 188 T
(main\050int argc, char *argv[]\051) 18 146 T
({int i, j, n = 0;) 18 132 T
( element_t element;) 18 118 T
( pthread_attr_t attr;) 18 104 T
( pthread_t tid;) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "140" 140
%%Page: "141" 141
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(141) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( SEM_INIT\050&barrier, NULL, 0\051;) 18 748 T
( SEM_INIT\050&one_at_a_time, NULL, 0\051;) 18 734 T
( PTHREAD_ATTR_INIT\050&attr\051;) 18 720 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 706 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 692 T
( fill_matrix\050a\051;) 18 664 T
( fill_matrix\050b\051;) 18 650 T
( iobench_start\050\051;) 18 622 T
( for \050i=0; i<SIZE; i++\051) 18 608 T
(   for \050j=0; j<SIZE; j++\051) 18 594 T
(     {element.i = i; element.j = j;) 18 580 T
(      PTHREAD_CREATE\050&tid, &attr, add_element, &element\051;) 18 566 T
(      delay\0500, 40000\051;) 18 552 T
(      SEM_WAIT\050&one_at_a_time\051;) 18 538 T
(    }) 18 524 T
( thread_single_barrier\050&barrier, SIZE*SIZE\051;) 18 510 T
( iobench_end\050\051;) 18 496 T
( printf\050\322\134n\134n\134n\323\051;) 18 468 T
( print_matrix\050a\051;) 18 454 T
( printf\050\322\134n\134n\134n\134t       + \134n\323\051;) 18 440 T
( print_matrix\050b\051;) 18 426 T
( printf\050\322\134n\134n\134n\134t       = \134n\323\051;) 18 412 T
( print_matrix\050c\051;) 18 398 T
( printf\050\322\134n\134n\134n\323\051;) 18 384 T
( iobench_report\050\051;) 18 370 T
( printf\050\322Done\134n\323\051;) 18 356 T
( exit\0500\051;) 18 342 T
(}) 18 328 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "141" 141
%%Page: "142" 142
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(142) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Ex) 146.45 732 T
(er) 190.12 732 T
(cise Objective) 223.42 732 T
2 18 Q
(Look at the code in) 18 701 T
4 F
(test_recursive_mutex.c.) 187.04 701 T
2 F
( It needs a recur-) 435.44 701 T
-0.33 (sive m) 18 679 P
-0.33 (ute) 73.34 679 P
-0.33 (x to function. Unf) 100.07 679 P
-0.33 (or) 246.71 679 P
-0.33 (tunatel) 265.07 679 P
-0.33 (y) 323.81 679 P
-0.33 (, POSIX m) 332.37 679 P
-0.33 (ute) 417.39 679 P
-0.33 (x) 444.12 679 P
-0.33 (es are not recur-) 453.95 679 P
(sive) 18 657 T
(.) 53.39 657 T
(Right no) 18 625 T
(w) 90.72 625 T
(, it runs using the recur) 104 625 T
(sive m) 303.79 625 T
(ute) 359.46 625 T
(x I wr) 386.19 625 T
(ote \050named) 431.86 625 T
4 F
(thread_recursive_mutex) 18 603 T
2 F
(\051, b) 255.6 603 T
(ut I\325m sure y) 282.24 603 T
(ou could b) 387.83 603 T
(uild a better) 478.48 603 T
(one) 18 581 T
(. So do a global replacement of \322) 50.36 581 T
4 F
(thread_recursive_mutex) 330.44 581 T
2 F
(\323) 568.04 581 T
(with \322) 18 559 T
4 F
(my_thread_recursive_mutex) 68 559 T
2 F
(\323 and then implement it.) 338 559 T
(Y) 18 527 T
(ou will need to write three functions and a datatype:) 28.21 527 T
4 14 Q
(typedef struct _rm {...} my_thread_recursive_mutex_t;) 18 497.67 T
(int thread_recursive_mutex_lock \050my_thread_recursive_mutex_t *\051) 18 470.67 T
(int thread_recursive_mutex_unlock \050my_thread_recursive_mutex_t *\051) 18 443.67 T
2 18 Q
(Extra Credit: Write the other tw) 18 382 T
(o functions:) 282.67 382 T
4 14 Q
(int my_thread_recursive_mutex_trylock \050thread_recursive_mutex_t *\051) 18 352.67 T
(int my_thread_recursive_mutex_destroy \050thread_recursive_mutex_t *\051) 18 325.67 T
2 18 Q
-0.08 (There is reall) 18 296 P
-0.08 (y onl) 128.63 296 P
-0.08 (y one simple solution to the pr) 170.29 296 P
-0.08 (ob) 430.49 296 P
-0.08 (lem \050with lots of) 452.31 296 P
(little v) 18 274 T
(ariations\051. Y) 69.66 274 T
(ou ma) 170.89 274 T
(y look at the de\336nition of FIFO m) 223.54 274 T
(ute) 503.23 274 T
(x) 529.96 274 T
(es f) 539.78 274 T
(or) 570.44 274 T
(guidance) 18 252 T
(.) 97.38 252 T
(Wild Guess at Time to Completion:) 18 188 T
(30 min) 198 166 T
(utes think/design time) 254.84 166 T
(.) 445.25 166 T
(30 min) 198 144 T
(utes pr) 254.84 144 T
(ogramming/deb) 314.5 144 T
(ug) 449.15 144 T
(ging) 470.97 144 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "142" 142
%%Page: "143" 143
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(143) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 108 561.67 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
261 466 476.67 682 R
1 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
476.67 574 261 574 2 L
N
368.67 682 368.67 466 2 L
N
440.67 574 440.67 466 2 L
N
2 18 Q
(Loc) 0 -90 435.39 664 TF
(k) 0 -90 435.39 632.36 TF
(CV) 0 -90 381.39 664 TF
(Owner) 0 -90 345.39 664 TF
(Owned) 0 -90 309.39 665.03 TF
(Held? 0) 0 -90 453.39 567.02 TF
(Sleeper) 0 -90 418.74 567.77 TF
(s) 0 -90 418.74 503.01 TF
(Sleeper) 0 -90 381.39 567.77 TF
(s) 0 -90 381.39 503.01 TF
( T@1) 0 -90 345.39 569.1 TF
(1 | 0 | -1) 0 -90 310.74 565 TF
332.67 682 332.67 466 2 L
N
404.67 682 404.67 466 2 L
N
90 450 7 7 270 423.67 478.5 GG
90 450 7 7 270 423.67 478.5 AA
90 450 7 7 270 386.17 478.5 GG
90 450 7 7 270 386.17 478.5 AA
367.92 324 403.92 423 R
7 X
V
0 X
N
403.92 360 367.92 360 2 L
N
(T@4) 0 -90 381.99 414 TF
90 450 7 7 270 385.92 343 GG
90 450 7 7 270 385.92 343 AA
385.67 437.53 388.31 437.53 385.67 428.31 383.02 437.53 4 Y
0 Z
N
385.67 437.53 388.31 437.53 385.67 428.31 383.02 437.53 4 Y
V
385.67 478 385.67 438.03 2 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
367.92 188 403.92 287 R
7 X
V
0 X
N
403.92 224 367.92 224 2 L
N
(T@5) 0 -90 381.99 278 TF
90 450 7 7 270 385.92 207 GG
90 450 7 7 270 385.92 207 AA
385.67 301.53 388.31 301.53 385.67 292.31 383.02 301.53 4 Y
0 Z
N
385.67 301.53 388.31 301.53 385.67 292.31 383.02 301.53 4 Y
V
385.67 342 385.67 302.03 2 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 32 Q
(FIFO Mute) 0 -90 521.83 539.88 TF
(x) 0 -90 521.83 383.91 TF
2 18 Q
(The loc) 0 -90 194.08 736 TF
(k pr) 0 -90 194.08 673.34 TF
(otects the o) 0 -90 194.08 640.69 TF
(wner w) 0 -90 194.08 539.94 TF
(or) 0 -90 194.08 479.28 TF
(d and waiter) 0 -90 194.08 461.64 TF
(s count. If o) 0 -90 194.08 356.88 TF
(wned, then) 0 -90 194.08 256.14 TF
(Owner contains the TID) 0 -90 176.08 736 TF
(. If Owned == 0, it\325) 0 -90 176.08 535.5 TF
(s free) 0 -90 176.08 383.51 TF
(. If Owned == -1, then) 0 -90 176.08 335.12 TF
(it\325) 0 -90 158.08 736 TF
(s being passed to a thread whic) 0 -90 158.08 721.08 TF
(h is presentl) 0 -90 158.08 449.17 TF
(y waking up. W) 0 -90 158.08 343.4 TF
(aiter) 0 -90 158.08 214.09 TF
(s) 0 -90 158.08 176.34 TF
(is the n) 0 -90 140.08 736 TF
(umber of threads on the CV\325) 0 -90 140.08 673.16 TF
(s sleep queue) 0 -90 140.08 433.2 TF
(.) 0 -90 140.08 313.79 TF
297 682 297 466 2 L
N
(W) 0 -90 273.73 666.03 TF
(aiter) 0 -90 273.73 649.76 TF
(s) 0 -90 273.73 612.02 TF
(2) 0 -90 275.08 566.01 TF
(Note that Owner is de\336ned as pthread_t, hence it cannot contain) 0 -90 122.08 736 TF
(an) 0 -90 104.08 736 TF
(ything else \050e) 0 -90 104.08 715.35 TF
(.g., 0 or -1\051. Theref) 0 -90 104.08 599.96 TF
(ore we need the Owner \336eld.) 0 -90 104.08 444.27 TF
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "143" 143
%%Page: "144" 144
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(144) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 105 587 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 32 Q
0 X
0 0 0 1 0 0 0 K
(FIFO Mute) 0 -90 515.16 520.88 TF
(x \050loc) 0 -90 515.16 364.91 TF
(k\051) 0 -90 515.16 281.96 TF
348.28 711.28 405.55 654 348.28 596.72 291 654 4 Y
7 X
V
0.5 H
2 Z
0 X
N
156 577.5 228 730.5 R
7 X
V
0 X
N
4 14 Q
(owned  = 1) 0 -90 208.95 708.6 TF
(owner  = TID) 0 -90 188.42 708.22 TF
(unlock\050\051) 0 -90 167.9 707.58 TF
(owned==0?) 0 -90 344.01 689.1 TF
426 181.5 480 334.5 R
7 X
V
0 X
N
(waiters++) 0 -90 460.95 317.52 TF
(cond_wait\050\051) 0 -90 442.95 317.14 TF
(return) 0 -90 103.99 679.2 TF
282 375 318 492 R
7 X
V
0 X
N
(waiters--) 0 -90 298.95 475.02 TF
156 181.5 192 334.5 R
7 X
V
0 X
N
(cond_wait\050\051) 0 -90 172.95 317.14 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
419.04 654 419.04 651.36 409.81 654 419.04 656.64 4 Y
1 H
0 Z
N
419.04 654 419.04 651.36 409.81 654 419.04 656.64 4 Y
V
462 654 419.54 654 2 L
2 Z
N
248.04 654 248.04 651.36 238.81 654 248.04 656.64 4 Y
0 Z
N
248.04 654 248.04 651.36 238.81 654 248.04 656.64 4 Y
V
291 654 248.54 654 2 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
300 354.96 297.36 354.96 300 364.19 302.64 354.96 4 Y
0 Z
N
300 354.96 297.36 354.96 300 364.19 302.64 354.96 4 Y
V
300 312 300 354.46 2 L
2 Z
N
203.04 258 203.04 255.36 193.81 258 203.04 260.64 4 Y
0 Z
N
203.04 258 203.04 255.36 193.81 258 203.04 260.64 4 Y
V
246 258 203.54 258 2 L
2 Z
N
374.04 258 374.04 255.36 364.81 258 374.04 260.64 4 Y
0 Z
N
374.04 258 374.04 255.36 364.81 258 374.04 260.64 4 Y
V
417 258 374.54 258 2 L
2 Z
N
300 185.97 297.36 185.97 300 195.19 302.64 185.97 4 Y
0 Z
N
300 185.97 297.36 185.97 300 195.19 302.64 185.97 4 Y
V
174 169.14 174 132 300 132 300 185.47 4 L
2 Z
N
219 554.96 216.36 554.96 219 564.19 221.64 554.96 4 Y
0 Z
N
219 554.96 216.36 554.96 219 564.19 221.64 554.96 4 Y
V
300 492 300 516.67 219 516.67 219 554.46 4 L
2 Z
N
471 350.03 473.64 350.03 471 340.81 468.36 350.03 4 Y
0 Z
N
471 350.03 473.64 350.03 471 340.81 468.36 350.03 4 Y
V
348 582 348 492 471 492 471 350.53 4 L
2 Z
N
131.04 654 131.04 651.36 121.81 654 131.04 656.64 4 Y
0 Z
N
131.04 654 131.04 651.36 121.81 654 131.04 656.64 4 Y
V
156 654 131.54 654 2 L
2 Z
N
300 315.28 357.28 258 300 200.72 242.72 258 4 Y
7 X
V
0.5 H
0 X
N
(owned==-1?) 0 -90 295.74 293.1 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
462 586.5 505.78 721.5 R
7 X
V
0 X
N
(lock\050\051) 0 -90 477.72 702.68 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(Yes) 0 -90 266.99 642.6 TF
(Yes) 0 -90 308.99 347.6 TF
(No) 0 -90 220.99 290.4 TF
(No) 0 -90 355.99 552.4 TF
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "144" 144
%%Page: "145" 145
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(145) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 105 586 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 32 Q
0 X
0 0 0 1 0 0 0 K
(FIFO Mute) 0 -90 549.16 520.88 TF
(x \050unloc) 0 -90 549.16 364.91 TF
(k\051) 0 -90 549.16 242.86 TF
382.28 711.28 439.55 654 382.28 596.72 325 654 4 Y
7 X
V
0.5 H
2 Z
0 X
N
190 577.5 262 730.5 R
7 X
V
0 X
N
4 14 Q
(owned  = 0) 0 -90 242.95 708.6 TF
(owner  = NULL) 0 -90 222.42 708.22 TF
(unlock\050\051) 0 -90 201.9 707.58 TF
(waiters>0?) 0 -90 379.01 697.1 TF
338 219.5 421 372.5 R
7 X
V
0 X
N
(owned = -1) 0 -90 402.79 355.52 TF
(cond_signal\050\051) 0 -90 358.43 355.14 TF
(return) 0 -90 137.99 679.2 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
453.04 654 453.04 651.36 443.81 654 453.04 656.64 4 Y
1 H
0 Z
N
453.04 654 453.04 651.36 443.81 654 453.04 656.64 4 Y
V
496 654 453.54 654 2 L
2 Z
N
282.04 654 282.04 651.36 272.81 654 282.04 656.64 4 Y
0 Z
N
282.04 654 282.04 651.36 272.81 654 282.04 656.64 4 Y
V
325 654 282.54 654 2 L
2 Z
N
382 392.04 384.64 392.03 382 382.81 379.36 392.03 4 Y
0 Z
N
382 392.04 384.64 392.03 382 382.81 379.36 392.03 4 Y
V
382 582 382 507.56 382 507.56 382 392.53 4 L
2 Z
N
165.04 654 165.04 651.36 155.81 654 165.04 656.64 4 Y
0 Z
N
165.04 654 165.04 651.36 155.81 654 165.04 656.64 4 Y
V
190 654 165.54 654 2 L
2 Z
N
496 586.5 539.78 721.5 R
7 X
V
0.5 H
0 X
N
(lock\050\051) 0 -90 511.72 702.68 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(No) 0 -90 300.99 638.4 TF
(Yes) 0 -90 389.99 556.6 TF
(unlock\050\051) 0 -90 380.61 355.52 TF
140.5 599.97 137.86 599.97 140.5 609.19 143.14 599.97 4 Y
1 H
0 Z
N
140.5 599.97 137.86 599.97 140.5 609.19 143.14 599.97 4 Y
V
338 302 140.5 302 140.5 599.47 3 L
2 Z
N
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "145" 145
%%Page: "146" 146
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(146) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 142 585 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 32 Q
0 X
0 0 0 1 0 0 0 K
(Recur) 0 -90 539.02 616.94 TF
(sive Mute) 0 -90 539.02 526.74 TF
(x \050loc) 0 -90 539.02 381.39 TF
(k\051) 0 -90 539.02 298.45 TF
158 487.5 230 640.5 R
7 X
V
0.5 H
2 Z
0 X
N
4 14 Q
(owned  = 1) 0 -90 210.95 618.6 TF
(owner  = TID) 0 -90 197.26 618.22 TF
(unlock\050\051) 0 -90 169.9 617.58 TF
(return) 0 -90 105.99 589.2 TF
430.03 564.76 429.97 562.11 420.81 564.96 430.09 567.4 4 Y
1 H
0 Z
N
430.03 564.76 429.97 562.11 420.81 564.96 430.09 567.4 4 Y
V
464 564 430.53 564.74 2 L
2 Z
N
250.04 564 250.04 561.36 240.81 564 250.04 566.64 4 Y
0 Z
N
250.04 564 250.04 561.36 240.81 564 250.04 566.64 4 Y
V
293 564 250.54 564 2 L
2 Z
N
293 333.03 295.64 333.03 293 323.81 290.36 333.03 4 Y
0 Z
N
293 333.03 295.64 333.03 293 323.81 290.36 333.03 4 Y
V
350 492 350 429.04 293 429.04 293 333.53 4 L
2 Z
N
133.04 564 133.04 561.36 123.81 564 133.04 566.64 4 Y
0 Z
N
133.04 564 133.04 561.36 123.81 564 133.04 566.64 4 Y
V
158 564 133.54 564 2 L
2 Z
N
464 496.5 507.78 631.5 R
7 X
V
0.5 H
0 X
N
(lock\050\051) 0 -90 479.72 612.68 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(Yes) 0 -90 258.99 556 TF
(No) 0 -90 357.99 462.4 TF
(count++) 0 -90 183.58 618.22 TF
275 178 318.78 313 R
7 X
V
0 X
N
(cond_wait\050\051) 0 -90 290.72 294.18 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
401 499.97 398.36 499.97 401 509.19 403.64 499.97 4 Y
1 H
0 Z
N
401 499.97 398.36 499.97 401 509.19 403.64 499.97 4 Y
V
320 241 401 241 401 499.47 3 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
347 631.5 414.5 564 347 496.5 279.5 564 4 Y
7 X
V
0.5 H
0 X
N
(owned==0?) 0 -90 358.99 610.2 TF
(    or) 0 -90 344.99 610.2 TF
(owner==TID?) 0 -90 330.99 610.2 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "146" 146
%%Page: "147" 147
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(147) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
18 119 589 754 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 32 Q
0 X
0 0 0 1 0 0 0 K
(Recur) 0 -90 555.49 615.71 TF
(sive Mute) 0 -90 555.49 525.5 TF
(x \050unloc) 0 -90 555.49 380.16 TF
(k\051) 0 -90 555.49 258.11 TF
344.28 673.78 401.55 616.5 344.28 559.22 287 616.5 4 Y
7 X
V
0.5 H
2 Z
0 X
N
179 540 215 693 R
7 X
V
0 X
N
4 14 Q
(unlock\050\051) 0 -90 190.9 670.08 TF
(count==0?) 0 -90 341.01 659.6 TF
300 185.5 383 338.5 R
7 X
V
0 X
N
(owned = 0) 0 -90 364.79 321.52 TF
(cond_signal\050\051) 0 -90 320.43 321.14 TF
(return) 0 -90 126.99 641.7 TF
415.04 616.5 415.04 613.86 405.81 616.5 415.04 619.14 4 Y
1 H
0 Z
N
415.04 616.5 415.04 613.86 405.81 616.5 415.04 619.14 4 Y
V
458 616.5 415.54 616.5 2 L
2 Z
N
244.04 616.5 244.04 613.86 234.81 616.5 244.04 619.14 4 Y
0 Z
N
244.04 616.5 244.04 613.86 234.81 616.5 244.04 619.14 4 Y
V
287 616.5 244.54 616.5 2 L
2 Z
N
344 358.04 346.64 358.03 344 348.81 341.36 358.03 4 Y
0 Z
N
344 358.04 346.64 358.03 344 348.81 341.36 358.03 4 Y
V
344 548 344 473.56 344 473.56 344 358.53 4 L
2 Z
N
154.04 616.5 154.04 613.86 144.81 616.5 154.04 619.14 4 Y
0 Z
N
154.04 616.5 154.04 613.86 144.81 616.5 154.04 619.14 4 Y
V
179 616.5 154.54 616.5 2 L
2 Z
N
458 549 501.78 684 R
7 X
V
0.5 H
0 X
N
(lock\050\051) 0 -90 485.24 658.3 TF
(No) 0 -90 261.99 594 TF
(Yes) 0 -90 351.99 522.6 TF
(unlock\050\051) 0 -90 335.22 321.52 TF
130 565.97 127.36 565.97 130 575.19 132.64 565.97 4 Y
1 H
0 Z
N
130 565.97 127.36 565.97 130 575.19 132.64 565.97 4 Y
V
300 268 130 268 130 565.47 3 L
2 Z
N
(count--) 0 -90 471.24 658.3 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(owner = NULL) 0 -90 350.01 321.52 TF
0 0 612 792 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "147" 147
%%Page: "148" 148
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(148) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(T) 69.73 732 T
(esting Recur) 89.57 732 T
(sive Mute) 307.08 732 T
(x) 470.59 732 T
(es:) 490.25 732 T
(test_recur) 106.81 684 T
(sive_m) 280.33 684 T
(ute) 401.69 684 T
(x.c) 455.15 684 T
4 12 Q
(/*                test_recursive_mutex.c                */) 18 614 T
(/*) 18 586 T
(  Test your recursive mutex.  Replace \322thread_recursive_mutex\323 with) 18 558 T
(  \322my_thread_recursive_mutex\323, then write it!) 18 544 T
(*/) 18 516 T
(/*) 18 474 T
(cc -o test_recursive_mutex test_recursive_mutex.c -L. -R. -g -lpthread -lthread) 18 460 T
(-thread_extensions -lposix4) 18 446 T
(*/) 18 432 T
(#define _POSIX_C_SOURCE 199506L) 18 404 T
(#include <pthread.h>) 18 376 T
(#include <semaphore.h>) 18 362 T
(#include <errno.h>) 18 348 T
(#include <time.h>) 18 334 T
(#include \322thread_extensions.h\323) 18 320 T
(typedef struct {) 18 292 T
(  pthread_mutex_t       lock;           /* lock for structure */) 18 278 T
(  pthread_cond_t        cv;             /* waiting list control */) 18 264 T
(  pthread_t             owner;          /* NULL_TID or TID */) 18 250 T
(} my_thread_recursive_mutex_t;) 18 236 T
(char *s[6] = {\322\322, \322*\323, \322**\323, \322***\323, \322****\323, \322*****\323};) 18 194 T
(thread_recursive_mutex_t m;) 18 152 T
(void *recursive\050void *arg\051) 18 110 T
({int            i = \050int\051 arg;) 18 96 T
( pthread_t      tid = pthread_self\050\051;) 18 82 T
( char           *name = thread_name\050tid\051;) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "148" 148
%%Page: "149" 149
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(149) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( if \050i > 0\051) 18 720 T
(   {printf\050\322%s Trying to enter level %d \134t%s\134n\323, name, 6-i, s[6-i]\051;) 18 706 T
(    thread_recursive_mutex_lock\050&m\051;) 18 692 T
(    printf\050\322%s Entered         level %d \134t%s\134n\323, name, 6-i, s[6-i]\051;) 18 678 T
(    delay\050200, 0\051;) 18 664 T
(    recursive\050\050void *\051\050i-1\051\051;) 18 650 T
(    thread_recursive_mutex_unlock\050&m\051;) 18 636 T
(    printf\050\322%s Leaving         level %d \134t%s\134n\323, name, 6-i, s[6-i]\051;) 18 622 T
(  }) 18 608 T
( return;) 18 594 T
(}) 18 580 T
(main\050int argc, char **argv\051) 18 538 T
({int                    i;) 18 524 T
( pthread_attr_t         attr;) 18 510 T
( pthread_t              tid;) 18 496 T
( thread_recursive_mutex_init\050&m, NULL\051;) 18 468 T
( PTHREAD_ATTR_INIT\050&attr\051;) 18 440 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 426 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 412 T
( PTHREAD_CREATE\050&tid, &attr, recursive, \050void *\051 5\051;) 18 384 T
( PTHREAD_CREATE\050&tid, &attr, recursive, \050void *\051 5\051;) 18 370 T
( PTHREAD_CREATE\050&tid, &attr, recursive, \050void *\051 5\051;) 18 356 T
( pthread_exit\0500\051;) 18 328 T
(}) 18 314 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "149" 149
%%Page: "150" 150
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(150) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Bil\325) 83.84 732 T
(s Extensions \050Librar) 137.7 732 T
(y\051:) 484.16 732 T
(thread_e) 131.22 684 T
(xtensions.h) 280.73 684 T
4 12 Q
(/*) 18 614 T
(        A set of useful functions and macros for pthreads programs.) 18 600 T
(*/) 18 586 T
(#include <pthread.h>) 18 558 T
(#include <semaphore.h>) 18 544 T
(#define _POSIX_C_SOURCE 199506L) 18 502 T
(/* Some useful constants */) 18 474 T
(#ifndef NULL) 18 460 T
(# define NULL           \050\050void*\0510\051) 18 446 T
(#endif) 18 432 T
(#ifndef TRUE) 18 418 T
(# define TRUE           1) 18 404 T
(#endif) 18 390 T
(#ifndef FALSE) 18 376 T
(# define FALSE          0) 18 362 T
(#endif) 18 348 T
(#define DEBUG\050arg\051      {if \050getenv\050\322DEBUG\323\051\051 arg;}) 18 334 T
(/* This NULL_TID may not work on all implementations! */) 18 320 T
(#define NULL_TID        \050pthread_t\051 0L) 18 306 T
(/*) 18 264 T
(   ================================================================) 18 250 T
(                        General List) 18 236 T
(   ================================================================) 18 222 T
(*/) 18 208 T
(typedef struct _list_t {) 18 180 T
(        void            *frst;) 18 166 T
(        struct _list_t  *next;) 18 152 T
(} list_t;) 18 138 T
(extern          list_t  *cons\050void *, void *\051;) 18 110 T
(extern          int     empty\050list_t *\051;) 18 96 T
(extern          void    *first\050list_t *\051;) 18 82 T
(extern          list_t  *rest\050list_t *\051;) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "150" 150
%%Page: "151" 151
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(151) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(/*) 18 734 T
(   ================================================================) 18 720 T
(                        Readers / Writer Lock) 18 706 T
(   ================================================================) 18 692 T
(*/) 18 678 T
(/*) 18 650 T
(   Definitions for rw locks adapted from Sun\325s SPILT package.) 18 636 T
(   RWLocks are  not part of the POSIX threads standard, but) 18 622 T
(   they are part of UNIX98.) 18 608 T
(*/) 18 594 T
(#define THREAD_RWLOCK_INITIALIZER \134) 18 566 T
( {PTHREAD_MUTEX_INITIALIZER, PTHREAD_COND_INITIALIZER, \134) 18 552 T
(    PTHREAD_COND_INITIALIZER, 0, 0}) 18 538 T
(typedef struct {) 18 510 T
(  pthread_mutex_t       lock;           /* lock for structure           */) 18 496 T
(  pthread_cond_t        readers;        /* waiting readers              */) 18 482 T
(  pthread_cond_t        writers;        /* waiting writers              */) 18 468 T
(  int                   state;          /* -1:writer,0:free,>0:readers  */) 18 454 T
(  int                   waiters;        /* number of waiting writers    */) 18 440 T
(} thread_rwlock_t;) 18 426 T
(typedef int thread_rwlock_attr_t;       /* Not implemented */) 18 398 T
(extern  int     thread_rwlock_init\050thread_rwlock_t *,) 18 370 T
(                                        thread_rwlock_attr_t *\051;) 18 356 T
(extern  int     thread_rwlock_destroy\050thread_rwlock_t *\051;) 18 342 T
(extern  int     thread_rw_rdlock\050thread_rwlock_t *\051;) 18 328 T
(extern  int     thread_rw_tryrdlock\050thread_rwlock_t *\051;) 18 314 T
(extern  int     thread_rw_wrlock\050thread_rwlock_t *\051;) 18 300 T
(extern  int     thread_rw_trywrlock\050thread_rwlock_t *\051;) 18 286 T
(extern  int     thread_rw_unlock\050thread_rwlock_t *\051;) 18 272 T
(/*) 18 216 T
(   ================================================================) 18 202 T
(                        Fifo Mutex Lock) 18 188 T
(   ================================================================) 18 174 T
(*/) 18 160 T
(typedef struct _fifo_mutex_queue_t {) 18 132 T
(  pthread_t                     tid;) 18 118 T
(  sem_t                         semaphore;) 18 104 T
(  struct _fifo_mutex_queue_t    *next;) 18 90 T
(} fifo_mutex_queue_t;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "151" 151
%%Page: "152" 152
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(152) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(#define THREAD_FIFO_MUTEX_INITIALIZER \134) 18 720 T
( {PTHREAD_MUTEX_INITIALIZER, NULL, FALSE, NULL_TID}) 18 706 T
(typedef struct  {) 18 664 T
(  pthread_mutex_t       lock;           /* lock for structure           */) 18 650 T
(  fifo_mutex_queue_t    *waitersQueue;  /* queue of waiting writers     */) 18 636 T
(  fifo_mutex_queue_t    *waitersQueueLast; /* last of waiting writers   */) 18 622 T
(  int                   owned;          /* TRUE | FALSE | -1:awaiting   */) 18 608 T
(  pthread_t             owner;          /* tid of owner                 */) 18 594 T
(} thread_fifo_mutex_t;) 18 580 T
(extern  int     thread_fifo_mutex_init\050thread_fifo_mutex_t *,) 18 552 T
(                                            pthread_mutexattr_t *\051;) 18 538 T
(extern  int     thread_fifo_mutex_destroy\050thread_fifo_mutex_t *\051;) 18 524 T
(extern  int     thread_fifo_mutex_lock\050thread_fifo_mutex_t *\051;) 18 510 T
(extern  int     thread_fifo_mutex_trylock\050thread_fifo_mutex_t *\051;) 18 496 T
(extern  int     thread_fifo_mutex_unlock\050thread_fifo_mutex_t *\051;) 18 482 T
(/*) 18 440 T
(   ================================================================) 18 426 T
(                        Debug Mutex Lock) 18 412 T
(   ================================================================) 18 398 T
(*/) 18 384 T
(#define PTHREAD_DMUTEX_INITIALIZER \134) 18 342 T
( {PTHREAD_MUTEX_INITIALIZER, PTHREAD_COND_INITIALIZER, \134) 18 328 T
(    NULL, NULL, 0, 0, FALSE, NULL_TID}) 18 314 T
(typedef struct _sleep_queue_t {) 18 286 T
(  pthread_t                     tid;) 18 272 T
(  struct _sleep_queue_t         *next;) 18 258 T
(} sleep_queue_t;) 18 244 T
(typedef struct _dmutex {) 18 202 T
(  pthread_mutex_t       lock;           /* lock for structure   */) 18 188 T
(  pthread_cond_t        cv;             /* waiting list control */) 18 174 T
(  char                  *name;          /* The declared name    */) 18 160 T
(  sleep_queue_t         *sleepers;      /* List of sleepers     */) 18 146 T
(  int                   n_locked;       /* Number of times locked */) 18 132 T
(  int                   n_failed;       /* Times woken w/o locking */) 18 118 T
(  int                   owned;          /* TRUE | FALSE         */) 18 104 T
(  pthread_t             owner;          /* NULL_TID or TID      */) 18 90 T
(} pthread_dmutex_t;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "152" 152
%%Page: "153" 153
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(153) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(typedef struct _dmutex_queue_t {) 18 734 T
(  struct _dmutex                *mutex;) 18 720 T
(  struct _dmutex_queue_t        *next;) 18 706 T
(} dmutex_queue_t;) 18 692 T
(extern  int     pthread_dmutex_init\050pthread_dmutex_t *, pthread_mutexattr_t *\051;) 18 664 T
(extern  int     pthread_dmutex_destroy\050pthread_dmutex_t *\051;) 18 650 T
(extern  int     pthread_dmutex_lock\050pthread_dmutex_t *\051;) 18 636 T
(extern  int     pthread_dmutex_trylock\050pthread_dmutex_t *\051;) 18 622 T
(extern  int     pthread_dmutex_unlock\050pthread_dmutex_t *\051;) 18 608 T
(#define pthread_dmutex_init\050m, a\051 pthread_dmutex_init1\050m, a, #m\051) 18 580 T
(/*) 18 552 T
(   ================================================================) 18 538 T
(                        Recursive Mutex Lock) 18 524 T
(   ================================================================) 18 510 T
(*/) 18 496 T
(#define THREAD_RECURSIVE_MUTEX_INITIALIZER \134) 18 468 T
( {PTHREAD_MUTEX_INITIALIZER, PTHREAD_COND_INITIALIZER, 0, FALSE, NULL_TID}) 18 454 T
(typedef struct  {) 18 412 T
(  pthread_mutex_t       lock;           /* lock for structure           */) 18 398 T
(  pthread_cond_t        cv;             /* waiting list control         */) 18 384 T
(  int                   count;          /* times locked recursively     */) 18 370 T
(  int                   owned;          /* TRUE | FALSE         */) 18 356 T
(  pthread_t             owner;          /* NULL_TID or TID      */) 18 342 T
(} thread_recursive_mutex_t;) 18 328 T
(extern  int     thread_recursive_mutex_init\050thread_recursive_mutex_t *,) 18 300 T
(                                                 pthread_mutexattr_t *\051;) 18 286 T
(extern  int     thread_recursive_mutex_destroy\050thread_recursive_mutex_t *\051;) 18 272 T
(extern  int     thread_recursive_mutex_lock\050thread_recursive_mutex_t *\051;) 18 258 T
(extern  int     thread_recursive_mutex_trylock\050thread_recursive_mutex_t *\051;) 18 244 T
(extern  int     thread_recursive_mutex_unlock\050thread_recursive_mutex_t *\051;) 18 230 T
(/*) 18 202 T
(   ================================================================) 18 188 T
(                                Barrier) 18 174 T
(   ================================================================) 18 160 T
(*/) 18 146 T
(typedef struct {) 18 90 T
(  pthread_mutex_t       lock;           /* lock for structure           */) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "153" 153
%%Page: "154" 154
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(154) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  pthread_cond_t        cv;             /* waiting list control         */) 18 748 T
(  int                   count;          /* Number of threads to wait for*/) 18 734 T
(  int                   n_sleepers;     /* Number of threads to waiting */) 18 720 T
(  int                   releasing;      /* Still waking up sleepers     */) 18 706 T
(} thread_barrier_t;) 18 692 T
(extern  int     thread_barrier_init\050thread_barrier_t *, int\051;) 18 664 T
(extern  int     thread_barrier_destroy\050thread_barrier_t *\051;) 18 650 T
(extern  int     thread_barrier_wait\050thread_barrier_t *\051;) 18 636 T
(extern  int     thread_barrier_trywait\050thread_barrier_t *\051;) 18 622 T
(/*) 18 580 T
(   ================================================================) 18 566 T
(                                Single Barrier) 18 552 T
(   ================================================================) 18 538 T
(*/) 18 524 T
(typedef struct  {) 18 468 T
(  pthread_mutex_t       lock;           /* lock for structure           */) 18 454 T
(  pthread_cond_t        cv;             /* waiting list control         */) 18 440 T
(  int                   count;          /* Number of threads to post    */) 18 426 T
(  int                   n_posters;      /* Number of threads who posted */) 18 412 T
(  int                   n_waiters;      /* Number of threads waiting    */) 18 398 T
(  int                   releasing;      /* Still waking up sleepers     */) 18 384 T
(} thread_single_barrier_t;) 18 370 T
(extern  int     thread_single_barrier_init\050thread_single_barrier_t *, int\051;) 18 342 T
(extern  int     thread_single_barrier_destroy\050thread_single_barrier_t *\051;) 18 328 T
(extern  int     thread_single_barrier_wait\050thread_single_barrier_t *\051;) 18 314 T
(extern  int     thread_single_barrier_post\050thread_single_barrier_t *\051;) 18 300 T
(/*) 18 272 T
(   ================================================================) 18 258 T
(                        Timed Mutex Lock) 18 244 T
(   ================================================================) 18 230 T
(*/) 18 216 T
(#define THREAD_TIMED_MUTEX_INITIALIZER  \134) 18 188 T
( {PTHREAD_MUTEX_INITIALIZER, PTHREAD_COND_INITIALIZER, FALSE, NULL_TID, 0}) 18 174 T
(typedef struct _timed_mutex {) 18 132 T
(  pthread_mutex_t       lock;           /* lock for structure           */) 18 118 T
(  pthread_cond_t        cv;             /* waiting list control         */) 18 104 T
(  int                   owned;          /* TRUE | FALSE                 */) 18 90 T
(  pthread_t             owner;          /* NULL_TID or TID              */) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "154" 154
%%Page: "155" 155
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(155) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  const struct timespec *abstime;       /* absolute time before timeout */) 18 748 T
(} thread_timed_mutex_t;) 18 734 T
(extern  int     thread_timed_mutex_init\050thread_timed_mutex_t *,) 18 706 T
(                                                 pthread_mutexattr_t *\051;) 18 692 T
(extern  int     thread_timed_mutex_destroy\050thread_timed_mutex_t *\051;) 18 678 T
(extern  int     thread_timed_mutex_lock\050thread_timed_mutex_t *,) 18 664 T
(                                            const struct timespec *\051;) 18 650 T
(extern  int     thread_timed_mutex_trylock\050thread_timed_mutex_t *\051;) 18 636 T
(extern  int     thread_timed_mutex_unlock\050thread_timed_mutex_t *\051;) 18 622 T
(/*) 18 594 T
(   ================================================================) 18 580 T
(                        Assorted Useful Functions) 18 566 T
(   ================================================================) 18 552 T
(*/) 18 538 T
(extern  char    *thread_name\050pthread_t\051;) 18 510 T
(int PTHREAD_CREATE\050pthread_t *new_thread_ID,) 18 468 T
(                   const pthread_attr_t *attr,) 18 454 T
(                   void * \050*start_func\051\050void *\051, void *arg\051;) 18 440 T
(int PTHREAD_ATTR_INIT\050pthread_attr_t *a\051;) 18 412 T
(int PTHREAD_CONDATTR_INIT\050pthread_condattr_t *a\051;) 18 384 T
(int PTHREAD_MUTEXATTR_INIT\050pthread_mutexattr_t *a\051;) 18 356 T
(int SEM_INIT\050sem_t *sem, int pshared, unsigned int value\051;) 18 328 T
(int SEM_WAIT\050sem_t *arg\051;) 18 300 T
(void delay\050int sleep_ms, int cpu_us\051;) 18 272 T
(void *killer\050void *arg\051;) 18 244 T
(/*-----------------------------------------------------------------------------) 18 216 T
( *) 18 202 T
( * Library Name: UTIL) 18 188 T
( * Module Name:  iobench) 18 174 T
( *) 18 160 T
( * Designer:    R. C. Sullivan) 18 146 T
( * Programmer:  R. C. Sullivan) 18 132 T
( * Date:        Sep 22, 1995) 18 118 T
( *) 18 104 T
( * History Of Changes:) 18 90 T
( *      Name         Date            Description) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "155" 155
%%Page: "156" 156
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(156) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( *      ----         ----            -----------) 18 748 T
( *      RCS     Jan 17, 1996     Inital release) 18 734 T
( *) 18 720 T
( * Purpose:) 18 706 T
( *   To report resource usage statistics that will be correct for) 18 692 T
( * programs using threads on a Solaris system.) 18 678 T
( *) 18 664 T
( * Notes:) 18 650 T
( *) 18 636 T
( *-----------------------------------------------------------------------------) 18 622 T
( */) 18 608 T
(extern struct prusage prusagebuf_start, prusagebuf_end;) 18 580 T
(extern int procfd;) 18 566 T
(extern double real_time, user_time, system_time, trap_time, wait_time;) 18 552 T
(extern unsigned long minor_pfs, major_pfs, input_blocks, output_blocks, iochars;) 18 538 T
(void iobench_start\050\051;) 18 510 T
(void iobench_end\050\051;) 18 496 T
(void iobench_report\050\051;) 18 482 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "156" 156
%%Page: "157" 157
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(157) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Bil\325) 83.84 732 T
(s Extensions \050Librar) 137.7 732 T
(y\051:) 484.16 732 T
(thread_e) 132.21 684 T
(xtensions.c) 281.72 684 T
4 12 Q
( /*                thread_extensions.c                */) 18 614 T
(/*) 18 586 T
(  Lots of useful functions for all sorts of neat things.) 18 572 T
(   I changed the names to avoid all conflicts / confusion) 18 544 T
(   with Solaris threads.) 18 530 T
(*/) 18 516 T
(/*) 18 488 T
(cc  -G -o libthread_extensions.so thread_extensions.c -g -lpthread) 18 474 T
(        -lthread -lposix4) 18 460 T
(*/) 18 432 T
(#include <stdio.h>) 18 362 T
(#include <errno.h>) 18 348 T
(#include \322thread_extensions.h\323) 18 334 T
(#define _POSIX_C_SOURCE 199506L) 18 292 T
(pthread_key_t   sleep_queue_key, FIFO_MUTEX_QUEUE_KEY;) 18 250 T
(void dmutex_key_initializer\050\051;) 18 222 T
(#ifdef __sun) 18 194 T
( /*  This runs before main\050\051 and declares the TSD key. */) 18 180 T
(#pragma init\050dmutex_key_initializer\051) 18 166 T
(#pragma init\050fifo_key_initializer\051) 18 152 T
(#endif) 18 138 T
(#if defined\050__alpha\051 && \050__osf__\051) 18 110 T
(void __init_dmutex_key\050\051) 18 96 T
({) 18 82 T
(  dmutex_key_initializer\050\051;) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "157" 157
%%Page: "158" 158
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(158) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  fifo_key_initializer\050\051;) 18 748 T
(}) 18 734 T
(#endif) 18 720 T
(/*) 18 650 T
(   ================================================================) 18 636 T
(                        General List) 18 622 T
(   ================================================================) 18 608 T
(*/) 18 594 T
(list_t *cons\050void *obj, void *lst\051 {) 18 566 T
(  list_t                *l = \050list_t *\051 malloc\050sizeof\050list_t\051\051;) 18 552 T
(  l->frst = obj;) 18 524 T
(  l->next = lst;) 18 510 T
(  return\050l\051;) 18 496 T
(}) 18 482 T
(int empty\050list_t *l\051 {return\050l == NULL\051;}) 18 454 T
(void *first\050list_t *l\051 {return\050l->frst\051;}) 18 440 T
(list_t *rest\050list_t *l\051 {return\050l->next\051;}) 18 426 T
(/*) 18 384 T
(   ================================================================) 18 370 T
(                        Stringify \050for printing\051 TIDs) 18 356 T
(   ================================================================) 18 342 T
(*/) 18 328 T
(typedef struct _pt) 18 286 T
({pthread_t      tid;) 18 272 T
( char           *name;) 18 258 T
( struct _pt     *next;) 18 244 T
(} thread_name_t;) 18 230 T
(#if \050!defined\050__sun\051 && !defined\050__sgi\051\051) 18 202 T
(char *thread_name\050pthread_t tid\051) 18 174 T
({char s[100];) 18 160 T
( thread_name_t *n;) 18 146 T
( static int tid_count = 1000;) 18 132 T
( static pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;) 18 118 T
( static thread_name_t *thread_names = NULL;) 18 104 T
( if \050pthread_equal\050NULL_TID, tid\051\051 tid = pthread_self\050\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "158" 158
%%Page: "159" 159
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(159) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_mutex_lock\050&lock\051;) 18 748 T
(   for \050n = thread_names; n != NULL; n=n->next\051) 18 720 T
(     {if \050pthread_equal\050n->tid, tid\051\051) 18 706 T
(        goto L;) 18 692 T
(    }) 18 678 T
( n = \050thread_name_t *\051 malloc\050sizeof\050thread_name_t\051\051;) 18 664 T
( n->tid = tid;) 18 650 T
(#if defined\050__alpha\051 && defined\050__osf__\051) 18 636 T
( sprintf\050s, \322T@%d\323, pthread_getsequence_np\050tid\051\051;) 18 622 T
(#else) 18 608 T
( sprintf\050s, \322T@%d\323, tid_count\051;) 18 594 T
( tid_count++;) 18 580 T
(#endif) 18 566 T
( n->name = \050char *\051 malloc\050strlen\050s\051+1\051;) 18 552 T
( strcpy\050n->name, s\051;) 18 538 T
( n->next = thread_names;) 18 524 T
( thread_names = n;) 18 510 T
(L:pthread_mutex_unlock\050&lock\051;) 18 482 T
( return\050n->name\051;) 18 468 T
(}) 18 454 T
(#else) 18 426 T
(/* For known implementations, use the underlying TID numbering */) 18 412 T
(char *thread_name\050pthread_t tid\051) 18 384 T
({char s[100];) 18 370 T
( thread_name_t *n;) 18 356 T
( static pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;) 18 328 T
( static thread_name_t *thread_names = NULL;) 18 314 T
( if \050pthread_equal\050NULL_TID, tid\051\051 tid = pthread_self\050\051;) 18 286 T
( pthread_mutex_lock\050&lock\051;) 18 272 T
(   for \050n = thread_names; n != NULL; n=n->next\051) 18 244 T
(     {if \050pthread_equal\050n->tid, tid\051\051) 18 230 T
(        goto L;) 18 216 T
(    }) 18 202 T
( n = \050thread_name_t *\051 malloc\050sizeof\050thread_name_t\051\051;) 18 188 T
( n->tid = tid;) 18 174 T
( sprintf\050s, \322T@%d\323, \050int\051 tid\051;) 18 160 T
( n->name = \050char *\051 malloc\050strlen\050s\051+1\051;) 18 146 T
( strcpy\050n->name, s\051;) 18 132 T
( n->next = thread_names;) 18 118 T
( thread_names = n;) 18 104 T
(L:pthread_mutex_unlock\050&lock\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "159" 159
%%Page: "160" 160
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(160) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( return\050n->name\051;) 18 748 T
(}) 18 734 T
(#endif) 18 720 T
(/*) 18 678 T
(   ================================================================) 18 664 T
(                        Readers / Writer Lock) 18 650 T
(   ================================================================) 18 636 T
(*/) 18 622 T
(int thread_rwlock_init\050thread_rwlock_t *rwp,) 18 594 T
(                           thread_rwlock_attr_t *attr\051) 18 580 T
({int                    ptype;) 18 566 T
( pthread_mutexattr_t    mutex_attr;) 18 552 T
( pthread_condattr_t     cond_attr;) 18 538 T
( pthread_mutexattr_init\050&mutex_attr\051;) 18 510 T
( pthread_condattr_init\050&cond_attr\051;) 18 496 T
(    /* Not Implemented ...) 18 468 T
(    ptype = thread_rwlock_attr_getshared\050&attr\051;) 18 454 T
(    pthread_mutexattr_setpshared\050&mutex_attr, ptype\051;) 18 440 T
(    pthread_condattr_setpshared\050&cond_attr, ptype\051;) 18 426 T
(    */) 18 412 T
( pthread_mutex_init\050&rwp->lock, &mutex_attr\051;) 18 384 T
( pthread_cond_init\050&rwp->readers, &cond_attr\051;) 18 370 T
( pthread_cond_init\050&rwp->writers, &cond_attr\051;) 18 356 T
( rwp->state     = 0;) 18 328 T
( rwp->waiters   = 0;) 18 314 T
( return\0500\051;) 18 286 T
(}) 18 272 T
(int thread_rwlock_destroy\050thread_rwlock_t *rwp\051) 18 230 T
({) 18 216 T
(  pthread_mutex_destroy\050&rwp->lock\051;) 18 202 T
(  pthread_cond_destroy\050&rwp->readers\051;) 18 188 T
(  pthread_cond_destroy\050&rwp->writers\051;) 18 174 T
(  return\0500\051;) 18 146 T
(}) 18 132 T
(int thread_rw_rdlock\050thread_rwlock_t *rwp\051) 18 90 T
({pthread_mutex_t        *lkp    = &rwp->lock;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "160" 160
%%Page: "161" 161
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(161) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_mutex_lock\050lkp\051;) 18 734 T
( pthread_cleanup_push\050pthread_mutex_unlock, lkp\051;) 18 720 T
( /* active or queued writers            */) 18 706 T
( while \050\050rwp->state < 0\051 || rwp->waiters\051) 18 692 T
(   pthread_cond_wait\050&rwp->readers, lkp\051;) 18 678 T
( rwp->state++;) 18 650 T
( pthread_cleanup_pop\0501\051;) 18 636 T
( return\0500\051;) 18 608 T
(}) 18 594 T
(int thread_rw_tryrdlock\050thread_rwlock_t *rwp\051) 18 552 T
({int    status  = EBUSY;) 18 538 T
( pthread_mutex_lock\050&rwp->lock\051;) 18 510 T
( /* available and no writers queued     */) 18 496 T
( if \050\050rwp->state >= 0\051 && !rwp->waiters\051 {) 18 482 T
(   rwp->state++;) 18 468 T
(   status       = 0;) 18 454 T
( }) 18 440 T
( pthread_mutex_unlock\050&rwp->lock\051;) 18 412 T
( return\050status\051;) 18 384 T
(}) 18 370 T
(void thread_rw_wrlock_cleanup\050void *arg\051) 18 328 T
({thread_rwlock_t        *rwp    = \050thread_rwlock_t *\051 arg;) 18 314 T
( /*) 18 286 T
(  * Was the only queued writer and lock is available for readers.) 18 272 T
(  * Called through cancellation clean-up so lock is held at entry.) 18 258 T
(  */) 18 244 T
( if \050\050--rwp->waiters == 0\051 && \050rwp->state >= 0\051\051) 18 230 T
(   pthread_cond_broadcast\050&rwp->readers\051;) 18 216 T
( pthread_mutex_unlock\050&rwp->lock\051;) 18 188 T
( return;) 18 160 T
(}) 18 146 T
(int thread_rw_wrlock\050thread_rwlock_t *rwp\051) 18 104 T
({pthread_mutex_t        *lkp    = &rwp->lock;) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "161" 161
%%Page: "162" 162
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(162) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_mutex_lock\050lkp\051;) 18 748 T
( rwp->waiters++;                /* another writer queued                */) 18 734 T
( pthread_cleanup_push\050thread_rw_wrlock_cleanup, rwp\051;) 18 720 T
( while \050rwp->state\051) 18 692 T
(   pthread_cond_wait\050&rwp->writers, lkp\051;) 18 678 T
( rwp->state     = -1;) 18 650 T
( pthread_cleanup_pop\0501\051;) 18 636 T
( return\0500\051;) 18 608 T
(}) 18 594 T
(int thread_rw_trywrlock\050thread_rwlock_t *rwp\051) 18 552 T
({int    status  = EBUSY;) 18 538 T
( pthread_mutex_lock\050&rwp->lock\051;) 18 510 T
( /* no readers, no writers, no writers queued   */) 18 496 T
( if \050!rwp->state && !rwp->waiters\051 {) 18 482 T
(   rwp->state   = -1;) 18 468 T
(   status               = 0;) 18 454 T
( }) 18 440 T
( pthread_mutex_unlock\050&rwp->lock\051;) 18 412 T
( return\050status\051;) 18 384 T
(}) 18 370 T
(int thread_rw_unlock\050thread_rwlock_t *rwp\051) 18 328 T
({pthread_mutex_lock\050&rwp->lock\051;) 18 314 T
( if \050rwp->state == -1\051 {        /* writer releasing     */) 18 286 T
(   rwp->state   = 0;            /* mark as available    */) 18 272 T
(   if \050rwp->waiters\051            /* writers queued       */) 18 244 T
(     pthread_cond_signal\050&rwp->writers\051;) 18 230 T
(   else) 18 216 T
(     pthread_cond_broadcast\050&rwp->readers\051;) 18 202 T
( } else {) 18 188 T
(   if \050--rwp->state == 0\051       /* no more readers      */) 18 174 T
(     pthread_cond_signal\050&rwp->writers\051;) 18 160 T
( }) 18 146 T
( pthread_mutex_unlock\050&rwp->lock\051;) 18 118 T
( return\0500\051;) 18 90 T
(}) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "162" 162
%%Page: "163" 163
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(163) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(/*) 18 720 T
(   ================================================================) 18 706 T
(                        Fifo Mutex Lock) 18 692 T
(   ================================================================) 18 678 T
(        Guarantees that all sleepers will get the mutex in correct) 18 650 T
(        order.) 18 636 T
(*/) 18 622 T
(int thread_fifo_mutex_init\050thread_fifo_mutex_t *m,) 18 580 T
(                               pthread_mutexattr_t *attr\051) 18 566 T
({) 18 552 T
(  pthread_mutex_init\050&\050m->lock\051, NULL\051;) 18 538 T
(  m->waitersQueue = NULL;) 18 524 T
(  m->owned = FALSE;) 18 510 T
(  m->owner = NULL_TID;) 18 496 T
(}) 18 482 T
(int thread_fifo_mutex_destroy\050thread_fifo_mutex_t *m\051) 18 440 T
({) 18 426 T
(  pthread_mutex_destroy\050&\050m->lock\051\051;) 18 412 T
(}) 18 398 T
(void fifo_queue_destroyer\050void *arg\051) 18 356 T
({) 18 342 T
(  fifo_mutex_queue_t *fifo_mutex_queue = \050fifo_mutex_queue_t *\051 arg;) 18 328 T
(  free\050fifo_mutex_queue\051;) 18 300 T
(}) 18 286 T
(void fifo_key_initializer\050\051) 18 244 T
({) 18 230 T
(  pthread_key_create\050&FIFO_MUTEX_QUEUE_KEY, fifo_queue_destroyer\051;) 18 216 T
(}) 18 202 T
(fifo_mutex_queue_t *get_fifo_mutex_queue\050\051) 18 146 T
({fifo_mutex_queue_t *fifo_mutex_queue =) 18 132 T
-0.4 (                \050fifo_mutex_queue_t *\051 pthread_getspecific\050FIFO_MUTEX_QUEUE_KEY\051;) 18 118 P
(int i;) 18 104 T
( if \050fifo_mutex_queue == NULL\051) 18 90 T
(        {fifo_mutex_queue = \050fifo_mutex_queue_t *\051 mal-) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "163" 163
%%Page: "164" 164
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(164) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(loc\050sizeof\050fifo_mutex_queue_t\051\051;) 18 748 T
(        i++;) 18 734 T
(         fifo_mutex_queue->tid = pthread_self\050\051;) 18 720 T
(         sem_init\050&fifo_mutex_queue->semaphore, FALSE, 0\051;) 18 706 T
(         pthread_setspecific\050FIFO_MUTEX_QUEUE_KEY, fifo_mutex_queue\051;) 18 692 T
(        }) 18 678 T
( return\050fifo_mutex_queue\051;) 18 664 T
(}) 18 650 T
(int thread_fifo_mutex_lock\050thread_fifo_mutex_t *m\051) 18 608 T
({pthread_t self = pthread_self\050\051;) 18 594 T
( fifo_mutex_queue_t *fifo_mutex_queue = get_fifo_mutex_queue\050\051;) 18 580 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 18 552 T
(  if \050!\050m->owned\051\051) 18 538 T
(    {m->owner = self;) 18 524 T
(     m->owned = TRUE;) 18 510 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 18 496 T
(     return\0500\051;}) 18 482 T
(  fifo_mutex_queue->next = NULL;) 18 454 T
(  if \050m->waitersQueue == NULL\051) 18 440 T
(    m->waitersQueue = fifo_mutex_queue;) 18 426 T
(  else) 18 412 T
(    m->waitersQueueLast->next = fifo_mutex_queue;) 18 398 T
(  m->waitersQueueLast = fifo_mutex_queue;) 18 384 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 18 370 T
(  SEM_WAIT\050&\050fifo_mutex_queue->semaphore\051\051;) 18 356 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 18 328 T
(  if \050m->owned != -1\051 {abort\0501\051;}  /* Cannot happen */) 18 314 T
(  m->owner = self;) 18 300 T
(  m->owned = TRUE;) 18 286 T
(  m->waitersQueue = m->waitersQueue->next;) 18 272 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 18 258 T
(  return\0500\051;) 18 244 T
(}) 18 230 T
(int thread_fifo_mutex_trylock\050thread_fifo_mutex_t *m\051) 18 188 T
({) 18 174 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 18 146 T
(  if \050!\050m->owned\051\051) 18 132 T
(    {m->owner = pthread_self\050\051;) 18 118 T
(     m->owned = TRUE;) 18 104 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 18 90 T
(     return\0500\051;}) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "164" 164
%%Page: "165" 165
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(165) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 18 748 T
(  return\050EBUSY\051;) 18 734 T
(}) 18 720 T
(int thread_fifo_mutex_unlock\050thread_fifo_mutex_t *m\051) 18 678 T
({) 18 664 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 18 650 T
(  m->owner = NULL_TID;) 18 636 T
(  if \050m->waitersQueue == NULL\051) 18 608 T
(    {m->owned = FALSE;) 18 594 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 18 580 T
(     return\0500\051;}) 18 566 T
(  m->owned = -1;) 18 538 T
(  sem_post\050&\050m->waitersQueue->semaphore\051\051;) 18 524 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 18 510 T
(  return\0500\051;) 18 496 T
(}) 18 482 T
(/*) 18 426 T
(   ================================================================) 18 412 T
(                        Simple \050wrong\051 Fifo Mutex Lock) 18 398 T
(   ================================================================) 18 384 T
(        Guarantees that a sleeper will get the mutex, even if) 18 356 T
(        some other thread trys first.  But several sleeping threads) 18 342 T
(        will NOT be FIFO.  But the implementation is simple.) 18 328 T
(int thread_fifo_mutex_init\050thread_fifo_mutex_t *m,) 18 272 T
(                               pthread_mutexattr_t *attr\051) 18 258 T
({) 18 244 T
(  pthread_mutex_init\050&\050m->lock\051, NULL\051;) 18 230 T
(  pthread_cond_init\050&\050m->cv\051, NULL\051;) 18 216 T
(  m->waiters = 0;) 18 202 T
(  m->owned = FALSE;) 18 188 T
(  m->owner = NULL_TID;) 18 174 T
(}) 18 160 T
(int thread_fifo_mutex_destroy\050thread_fifo_mutex_t *m\051) 18 118 T
({) 18 104 T
(  pthread_mutex_destroy\050&\050m->lock\051\051;) 18 90 T
(  pthread_cond_destroy\050&\050m->cv\051\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "165" 165
%%Page: "166" 166
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(166) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(}) 18 748 T
(int thread_fifo_mutex_lock\050thread_fifo_mutex_t *m\051) 18 706 T
({) 18 692 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 18 664 T
(  if \050!\050m->owned\051\051) 18 650 T
(    {m->owner = pthread_self\050\051;) 18 636 T
(     m->owned = TRUE;) 18 622 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 18 608 T
(     return\0500\051;}) 18 594 T
(  m->waiters++;) 18 566 T
(  /* Don\325t check for -1 the first time because) 18 552 T
(     that -1 is intended for a sleeper.) 18 538 T
(  pthread_cond_wait\050&\050m->cv\051, &\050m->lock\051\051;) 18 524 T
(  while \050m->owned != -1\051) 18 496 T
(    pthread_cond_wait\050&\050m->cv\051, &\050m->lock\051\051;) 18 482 T
(  /* A spurious wakeup at just the wrong moment will give) 18 468 T
(     ownership to the wrong thread.  So we\325re only 99.999% FIFO.) 18 454 T
(     But NEVER incorrect.) 18 440 T
(  m->owner = pthread_self\050\051;) 18 426 T
(  m->owned = TRUE;) 18 412 T
(  m->waiters--;) 18 398 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 18 384 T
(  return\0500\051;) 18 370 T
(}) 18 356 T
(int thread_fifo_mutex_trylock\050thread_fifo_mutex_t *m\051) 18 314 T
({) 18 300 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 18 272 T
(  if \050!\050m->owned\051\051) 18 258 T
(    {m->owner = pthread_self\050\051;) 18 244 T
(     m->owned = TRUE;) 18 230 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 18 216 T
(     return\0500\051;}) 18 202 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 18 188 T
(  return\050EBUSY\051;) 18 174 T
(}) 18 160 T
(int thread_fifo_mutex_unlock\050thread_fifo_mutex_t *m\051) 18 118 T
({) 18 104 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 18 90 T
(  m->owner = NULL_TID;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "166" 166
%%Page: "167" 167
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(167) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  if \050m->waiters == 0\051) 18 734 T
(    {m->owned = FALSE;) 18 720 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 18 706 T
(     return\0500\051;}) 18 692 T
(  m->owned = -1;) 18 664 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 18 650 T
(  pthread_cond_signal\050&\050m->cv\051\051;) 18 636 T
(  return\0500\051;) 18 622 T
(}) 18 608 T
(*/) 18 580 T
(/*) 18 524 T
(   ================================================================) 18 510 T
(                        Debug Mutex Lock) 18 496 T
(   ================================================================) 18 482 T
(        For debugging programs.  Do a global replace of _mutex_ with) 18 454 T
(        _dmutex_ and then the dmutex will detect self deadlocks,) 18 440 T
(        non-owner unlocks, and record the owner\325s TID for use from) 18 426 T
(        the debugger.) 18 412 T
(        If you call pthread_dmutex_init\050\051, then a macro will place) 18 384 T
(        the dmutex on a global list and record its name.  If you only) 18 370 T
(        use PTHREAD_DMUTEX_INITIALIZER, then no recording.  You may) 18 356 T
(        choose specific names via pthread_dmutex_init1\050\051.) 18 342 T
(        print_dmutexes\050\051 will print out the state \050and sleep queue\051) 18 314 T
(        for all mutexes on the list.  From the debugger:) 18 300 T
(        \050debugger\051 call print_dmutexes\050\051) 18 286 T
(*/) 18 258 T
(pthread_mutex_t dmutex_queue_lock = PTHREAD_MUTEX_INITIALIZER;) 18 230 T
(dmutex_queue_t  *dmutex_queue;) 18 216 T
(void dmutex_key_initializer\050\051) 18 174 T
({) 18 160 T
(  pthread_key_create\050&sleep_queue_key, NULL\051;) 18 146 T
( }) 18 132 T
(void insert_dmutex\050pthread_dmutex_t *m\051) 18 104 T
({dmutex_queue_t *dq;) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "167" 167
%%Page: "168" 168
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(168) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( dq = \050dmutex_queue_t *\051 malloc\050sizeof\050dmutex_queue_t\051\051;) 18 748 T
( dq->mutex = m;) 18 734 T
( pthread_mutex_lock\050&dmutex_queue_lock\051;) 18 720 T
( dq->next = dmutex_queue;) 18 706 T
( dmutex_queue = dq;) 18 692 T
( pthread_mutex_unlock\050&dmutex_queue_lock\051;) 18 678 T
(}) 18 664 T
(void remove_dmutex\050dmutex_queue_t **q, pthread_dmutex_t *m\051) 18 636 T
({dmutex_queue_t *dq, *dq1;) 18 622 T
( pthread_mutex_lock\050&dmutex_queue_lock\051;) 18 594 T
( if \050\050*q\051->mutex == m\051) 18 566 T
(   {dq1 = dmutex_queue->next;) 18 552 T
(    *q = dq1->next;) 18 538 T
(    free\050dq1\051;) 18 524 T
(  }) 18 510 T
( else) 18 496 T
(   for \050dq = *q; dq->next != NULL; dq = dq->next\051) 18 482 T
(     if \050dq->next->mutex == m\051) 18 468 T
(       {dq1 = dq->next;) 18 454 T
(        dq->next = dq1->next;) 18 440 T
(        free\050dq1\051;) 18 426 T
(        break;) 18 412 T
(      }) 18 398 T
( pthread_mutex_unlock\050&dmutex_queue_lock\051;) 18 370 T
(}) 18 356 T
(void remove_sleeper\050sleep_queue_t **q, pthread_t tid\051) 18 328 T
({sleep_queue_t *dq, *dq1;) 18 314 T
( if \050pthread_equal\050\050*q\051->tid, tid\051\051) 18 286 T
(   {) 18 272 T
(     *q = \050*q\051->next;) 18 258 T
(   }) 18 244 T
( else) 18 230 T
(   for \050dq = *q; dq->next != NULL; dq = dq->next\051) 18 216 T
(     if \050pthread_equal\050dq->next->tid, tid\051\051) 18 202 T
(       {dq1 = dq->next;) 18 188 T
(        dq->next = dq1->next;) 18 174 T
(        break;) 18 160 T
(      }) 18 146 T
(}) 18 118 T
(void print_dmutex\050pthread_dmutex_t *m\051) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "168" 168
%%Page: "169" 169
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(169) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
({sleep_queue_t  *sq;) 18 748 T
( pthread_mutex_lock\050&\050m->lock\051\051;) 18 720 T
( flockfile \050stdout\051;) 18 706 T
(   if \050!m->owned\051) 18 692 T
(   printf\050\322%s ---- Times locked: %3d,  failed: %3d.  Sleepers: \050 \322,) 18 678 T
(          m->name, m->n_locked, m->n_failed\051;) 18 664 T
( else) 18 650 T
(   printf\050\322%s %s  Times locked: %3d,  failed: %3d.  Sleepers: \050 \322,) 18 636 T
(          m->name, thread_name\050m->owner\051, m->n_locked, m->n_failed\051;) 18 622 T
( for \050sq = m->sleepers; sq != NULL; sq = sq->next\051) 18 594 T
(   printf\050\322%s \322, thread_name\050sq->tid\051\051;) 18 580 T
( printf\050\322\051\134n\323\051;) 18 566 T
( funlockfile \050stdout\051;) 18 552 T
( pthread_mutex_unlock\050&\050m->lock\051\051;) 18 538 T
(}) 18 524 T
(void print_dmutexes\050\051) 18 468 T
({dmutex_queue_t *dq;) 18 454 T
( pthread_dmutex_t *m;) 18 440 T
( pthread_mutex_lock\050&dmutex_queue_lock\051;) 18 412 T
( for \050dq = dmutex_queue; dq != NULL; dq = dq->next\051) 18 398 T
(   {m = dq->mutex;) 18 384 T
(    print_dmutex\050m\051;) 18 370 T
(  }) 18 356 T
( pthread_mutex_unlock\050&dmutex_queue_lock\051;) 18 342 T
(}) 18 328 T
(int pthread_dmutex_init1\050pthread_dmutex_t *m, pthread_mutexattr_t *attr,) 18 272 T
(                         char *name\051) 18 258 T
({) 18 244 T
(  pthread_mutex_init\050&\050m->lock\051, NULL\051;) 18 230 T
(  pthread_cond_init\050&\050m->cv\051, NULL\051;) 18 216 T
(  m->owned = FALSE;) 18 202 T
(  m->owner = NULL_TID;) 18 188 T
(  m->name = name;) 18 174 T
(  m->sleepers = NULL;) 18 160 T
(  m->n_locked = 0;) 18 146 T
(  m->n_failed = 0;) 18 132 T
(  insert_dmutex\050m\051;) 18 118 T
(}) 18 104 T
(int pthread_dmutex_destroy\050pthread_dmutex_t *m\051) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "169" 169
%%Page: "170" 170
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(170) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
({) 18 748 T
(  pthread_mutex_destroy\050&\050m->lock\051\051;) 18 734 T
(  pthread_cond_destroy\050&\050m->cv\051\051;) 18 720 T
(  remove_dmutex\050&dmutex_queue, m\051;) 18 706 T
(}) 18 692 T
(int pthread_dmutex_lock\050pthread_dmutex_t *m\051) 18 636 T
({pthread_t tid = pthread_self\050\051;) 18 622 T
( sleep_queue_t *dq = \050sleep_queue_t *\051 pthread_getspecific\050sleep_queue_key\051;) 18 608 T
( if \050dq == NULL\051) 18 580 T
(   {dq = \050sleep_queue_t *\051 malloc\050sizeof\050sleep_queue_t\051\051;) 18 566 T
(    pthread_setspecific\050sleep_queue_key, dq\051;) 18 552 T
(    dq->tid = tid;) 18 538 T
(  }) 18 524 T
( pthread_mutex_lock\050&\050m->lock\051\051;) 18 496 T
( if \050pthread_equal\050m->owner, tid\051\051) 18 482 T
(   {if \050m->name\051) 18 468 T
(      printf\050\322Error! %s deadlocking dmutex %s.\134n\323, thread_name\050tid\051, m->name\051;) 18 454 T
(   else) 18 440 T
(     printf\050\322Error! %s deadlocking dmutex x%x.\134n\323, thread_name\050tid\051, m\051;) 18 426 T
(    abort\050\051;    /* I don\325t want it to exit.  I want it to crash. */) 18 412 T
(  }) 18 398 T
( while \050m->owned\051) 18 384 T
(   {dq->next = m->sleepers;) 18 370 T
(    m->sleepers = dq;) 18 356 T
(    m->n_failed++;) 18 342 T
(    pthread_cond_wait\050&\050m->cv\051, &\050m->lock\051\051;) 18 328 T
(    remove_sleeper\050&\050m->sleepers\051, tid\051;) 18 314 T
(   }) 18 300 T
( m->owner = tid;) 18 286 T
( m->owned = TRUE;) 18 272 T
( m->n_locked++;) 18 258 T
( pthread_mutex_unlock\050&\050m->lock\051\051;) 18 244 T
( return\0500\051;) 18 230 T
(}) 18 216 T
(int pthread_dmutex_trylock\050pthread_dmutex_t *m\051) 18 174 T
({pthread_t tid = pthread_self\050\051;) 18 160 T
( pthread_mutex_lock\050&\050m->lock\051\051;) 18 132 T
( if \050!\050m->owned\051\051) 18 118 T
(    {m->owner = tid;) 18 104 T
(     m->owned = TRUE;) 18 90 T
(     m->n_locked++;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "170" 170
%%Page: "171" 171
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(171) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 18 748 T
(     return\0500\051;) 18 734 T
(   }) 18 720 T
( m->n_failed++;) 18 706 T
( pthread_mutex_unlock\050&\050m->lock\051\051;) 18 692 T
( return\050EBUSY\051;) 18 678 T
(}) 18 664 T
(int pthread_dmutex_unlock\050pthread_dmutex_t *m\051) 18 622 T
({pthread_t tid = pthread_self\050\051;) 18 608 T
( pthread_mutex_lock\050&\050m->lock\051\051;) 18 580 T
( if \050!pthread_equal\050m->owner, tid\051\051) 18 566 T
(   {if \050m->name\051) 18 552 T
(      printf\050\322Error! %s unlocking dmutex %s owned by %s\134n\323,) 18 538 T
(             thread_name\050tid\051, m->name, thread_name\050m->owner\051\051;) 18 524 T
(   else) 18 510 T
(     printf\050\322Error! %s unlocking dmutex x%x owned by %s\134n\323,) 18 496 T
(            thread_name\050tid\051, m, thread_name\050m->owner\051\051;) 18 482 T
(    abort\050\051;    /* I don\325t want it to exit.  I want it to crash. */) 18 468 T
(    }) 18 454 T
( m->owned = FALSE;) 18 426 T
( m->owner = NULL_TID;) 18 412 T
( pthread_mutex_unlock\050&\050m->lock\051\051;) 18 398 T
( pthread_cond_signal\050&\050m->cv\051\051;) 18 384 T
( return\0500\051;) 18 370 T
(}) 18 356 T
(/*) 18 286 T
(   ================================================================) 18 272 T
(                        Recursive Mutex Lock) 18 258 T
(   ================================================================) 18 244 T
(        Allow the same thread to lock the mutex recursively) 18 216 T
(        \050requiring the same number of unlocks\051.) 18 202 T
(        Use of these is NOT recommended for any program!  Write) 18 174 T
(        your program better so that you don\325t WANT them.) 18 160 T
(*/) 18 146 T
(int thread_recursive_mutex_init\050thread_recursive_mutex_t *m,) 18 104 T
(                                    pthread_mutexattr_t *attr\051) 18 90 T
({) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "171" 171
%%Page: "172" 172
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(172) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  pthread_mutex_init\050&\050m->lock\051, NULL\051;) 18 748 T
(  pthread_cond_init\050&\050m->cv\051, NULL\051;) 18 734 T
(  m->owned = FALSE;) 18 720 T
(  m->owner = NULL_TID;) 18 706 T
(  m->count = 0;) 18 692 T
(}) 18 678 T
(int thread_recursive_mutex_destroy\050thread_recursive_mutex_t *m\051) 18 636 T
({) 18 622 T
(  pthread_mutex_destroy\050&\050m->lock\051\051;) 18 608 T
(  pthread_cond_destroy\050&\050m->cv\051\051;) 18 594 T
(}) 18 580 T
(int thread_recursive_mutex_lock\050thread_recursive_mutex_t *m\051) 18 524 T
({pthread_t tid = pthread_self\050\051;) 18 510 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 18 482 T
(  while \050m->owned && !pthread_equal\050m->owner, tid\051\051) 18 468 T
(    pthread_cond_wait\050&\050m->cv\051, &\050m->lock\051\051;) 18 454 T
( m->owner = tid;) 18 440 T
( m->owned = TRUE;) 18 426 T
( m->count++;) 18 412 T
( pthread_mutex_unlock\050&\050m->lock\051\051;) 18 398 T
( return\0500\051;) 18 384 T
(}) 18 370 T
(int thread_recursive_mutex_trylock\050thread_recursive_mutex_t *m\051) 18 328 T
({pthread_t tid = pthread_self\050\051;) 18 314 T
( pthread_mutex_lock\050&\050m->lock\051\051;) 18 286 T
( if \050!m->owned || pthread_equal\050m->owner, tid\051\051) 18 272 T
(    {m->owner = tid;) 18 258 T
(     m->owned = TRUE;) 18 244 T
(     m->count++;) 18 230 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 18 216 T
(     return\0500\051;) 18 202 T
(   }) 18 188 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 18 174 T
(  return\050EBUSY\051;) 18 160 T
(}) 18 146 T
(int thread_recursive_mutex_unlock\050thread_recursive_mutex_t *m\051) 18 104 T
({) 18 90 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "172" 172
%%Page: "173" 173
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(173) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  m->count--;) 18 748 T
(  if \050m->count == 0\051) 18 734 T
(    {m->owned = FALSE;) 18 720 T
(     m->owner = NULL_TID;) 18 706 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 18 692 T
(     pthread_cond_signal\050&\050m->cv\051\051;) 18 678 T
(     return\0500\051;) 18 664 T
(   }) 18 650 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 18 636 T
(  return\0500\051;) 18 622 T
(}) 18 608 T
(/*) 18 566 T
(   ================================================================) 18 552 T
(                        Barrier) 18 538 T
(   ================================================================) 18 524 T
(        Full barrier: all threads wait until the last thread arrives) 18 496 T
(        before waking up.) 18 482 T
(*/) 18 468 T
(int thread_barrier_init\050thread_barrier_t *m, int i\051) 18 426 T
({) 18 412 T
(  pthread_mutex_init\050&\050m->lock\051, NULL\051;) 18 398 T
(  pthread_cond_init\050&\050m->cv\051, NULL\051;) 18 384 T
(  m->n_sleepers = 0;) 18 370 T
(  m->releasing = FALSE;) 18 356 T
(  m->count = i;) 18 342 T
(}) 18 328 T
(int thread_barrier_destroy\050thread_barrier_t *m\051) 18 286 T
({) 18 272 T
(  pthread_mutex_destroy\050&\050m->lock\051\051;) 18 258 T
(  pthread_cond_destroy\050&\050m->cv\051\051;) 18 244 T
(}) 18 230 T
(int thread_barrier_wait\050thread_barrier_t *m\051) 18 174 T
({int release = FALSE;) 18 160 T
( pthread_mutex_lock\050&\050m->lock\051\051;) 18 132 T
( while \050m->releasing\051           /* If previous cycle still releasing, wait */) 18 118 T
(   pthread_cond_wait\050&\050m->cv\051, &\050m->lock\051\051;) 18 104 T
( m->n_sleepers++;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "173" 173
%%Page: "174" 174
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(174) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( if \050m->n_sleepers == m->count\051) 18 748 T
(   release = m->releasing = TRUE;) 18 734 T
( else) 18 720 T
(   while \050!m->releasing\051) 18 706 T
(     pthread_cond_wait\050&\050m->cv\051, &\050m->lock\051\051;) 18 692 T
( m->n_sleepers--;) 18 664 T
( if \050m->n_sleepers == 0\051) 18 650 T
(   {m->releasing = FALSE;) 18 636 T
(    release = TRUE;             /* Wake up waiters \050if any\051 for next cycle */) 18 622 T
(  }) 18 608 T
( pthread_mutex_unlock\050&\050m->lock\051\051;) 18 594 T
( if \050release\051) 18 566 T
(   pthread_cond_broadcast\050&m->cv\051;) 18 552 T
( return\0500\051;) 18 538 T
(}) 18 524 T
(/*) 18 482 T
(   ================================================================) 18 468 T
(                        Barrier) 18 454 T
(   ================================================================) 18 440 T
(        Full barrier: all threads wait until the last thread arrives) 18 412 T
(        before waking up.) 18 398 T
(*/) 18 384 T
(int thread_single_barrier_init\050thread_single_barrier_t *b, int i\051) 18 342 T
({) 18 328 T
(  pthread_mutex_init\050&\050b->lock\051, NULL\051;) 18 314 T
(  pthread_cond_init\050&\050b->cv\051, NULL\051;) 18 300 T
(  b->n_posters = 0;) 18 286 T
(  b->n_waiters = 0;) 18 272 T
(  b->releasing = FALSE;) 18 258 T
(  b->count = i;) 18 244 T
(}) 18 230 T
(int thread_single_barrier_destroy\050thread_single_barrier_t *b\051) 18 188 T
({) 18 174 T
(  pthread_mutex_destroy\050&\050b->lock\051\051;) 18 160 T
(  pthread_cond_destroy\050&\050b->cv\051\051;) 18 146 T
(}) 18 132 T
(int thread_single_barrier_wait\050thread_single_barrier_t *b\051 {) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "174" 174
%%Page: "175" 175
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(175) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  int release = FALSE;) 18 748 T
(  b->n_waiters++;) 18 720 T
(  while \050!b->releasing\051) 18 706 T
(    pthread_cond_wait\050&\050b->cv\051, &\050b->lock\051\051;) 18 692 T
(  b->n_waiters--;) 18 664 T
(  if \050b->n_waiters == 0\051 {) 18 650 T
(    b->releasing = FALSE;) 18 636 T
(    release = TRUE;             /* Wake up waiters \050if any\051 for next cycle */) 18 622 T
(    b->n_posters=0;) 18 608 T
(    }) 18 594 T
(  pthread_mutex_unlock\050&\050b->lock\051\051;) 18 580 T
(  if \050release\051) 18 552 T
(    pthread_cond_broadcast\050&b->cv\051;) 18 538 T
(  return\0500\051;) 18 524 T
(}) 18 510 T
(int thread_single_barrier_post\050thread_single_barrier_t *b\051) 18 440 T
({int release = FALSE;) 18 426 T
( pthread_mutex_lock\050&\050b->lock\051\051;) 18 398 T
( while \050b->releasing\051           /* If previous cycle still releasing, wait */) 18 384 T
(   pthread_cond_wait\050&\050b->cv\051, &\050b->lock\051\051;) 18 370 T
( b->n_posters++;) 18 342 T
( if \050b->n_posters == b->count\051) 18 328 T
(   {b->releasing = TRUE;) 18 314 T
(    release = TRUE;             /* Wake up waiters \050if any\051 for next cycle */) 18 300 T
(  }) 18 286 T
( pthread_mutex_unlock\050&\050b->lock\051\051;) 18 272 T
( if \050release\051) 18 244 T
(   pthread_cond_broadcast\050&b->cv\051;) 18 230 T
( return\0500\051;) 18 216 T
(}) 18 202 T
(/*) 18 118 T
(   ================================================================) 18 104 T
(                        Error Detection) 18 90 T
(   ================================================================) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "175" 175
%%Page: "176" 176
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(176) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(        For those functions which can return a \322reasonable\323 runtime) 18 734 T
(        error, go ahead and detect them.  And then abort.) 18 720 T
(*/) 18 706 T
(int PTHREAD_CREATE\050pthread_t *new_thread_ID,) 18 664 T
(                   const pthread_attr_t *attr,) 18 650 T
(                   void * \050*start_func\051\050void *\051, void *arg\051) 18 636 T
({int err;) 18 622 T
( pthread_t tid;) 18 608 T
( if \050!new_thread_ID\051) 18 580 T
(   {printf\050\322TID cannot be NULL.\134n\323\051;) 18 566 T
(    abort\050\051;) 18 552 T
(  }) 18 538 T
( if \050err = pthread_create\050new_thread_ID, attr, start_func, arg\051\051) 18 524 T
(   {printf\050\322%s\134n\323, strerror\050err\051\051;) 18 510 T
(    abort\050\051;) 18 496 T
(  }}) 18 482 T
(int PTHREAD_ATTR_INIT\050pthread_attr_t *a\051) 18 454 T
({int err;) 18 440 T
( if \050err = pthread_attr_init\050a\051\051) 18 426 T
(   {printf\050\322%s\134n\323, strerror\050err\051\051;) 18 412 T
(    abort\050\051;) 18 398 T
(  }}) 18 384 T
(int PTHREAD_CONDATTR_INIT\050pthread_condattr_t *a\051) 18 356 T
({int err;) 18 342 T
( if \050err = pthread_condattr_init\050a\051\051) 18 328 T
(   {printf\050\322%s\134n\323, strerror\050err\051\051;) 18 314 T
(    abort\050\051;) 18 300 T
(  }}) 18 286 T
(int PTHREAD_MUTEXATTR_INIT\050pthread_mutexattr_t *a\051) 18 258 T
({int err;) 18 244 T
( if \050err = pthread_mutexattr_init\050a\051\051) 18 230 T
(   {printf\050\322%s\134n\323, strerror\050err\051\051;) 18 216 T
(    abort\050\051;) 18 202 T
(  }}) 18 188 T
(int SEM_INIT\050sem_t *sem, int pshared, unsigned int value\051) 18 160 T
({int err;) 18 146 T
( if \050err = sem_init\050sem, pshared, value\051\051) 18 132 T
(   {perror\050\322\322\051;) 18 118 T
(    abort\050\051;) 18 104 T
(  }}) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "176" 176
%%Page: "177" 177
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(177) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(int SEM_WAIT\050sem_t *arg\051        /* Ignore signal interruptions */) 18 734 T
({while \050sem_wait\050arg\051 != 0\051 {}}) 18 720 T
(/*) 18 678 T
(   ================================================================) 18 664 T
(                        Random useful functions) 18 650 T
(   ================================================================) 18 636 T
(*/) 18 608 T
(int delay_cycles_per_us = 8;            /* App. number for 110MHz SS4) 18 580 T
(/* sleep time will be quantized at 10ms, CPU time is VERY approximate. */) 18 552 T
(void delay\050int sleep_ms, int cpu_us\051) 18 524 T
({int i, cycles = cpu_us*delay_cycles_per_us;) 18 510 T
( volatile j=0;) 18 496 T
( struct timespec tv;) 18 482 T
( if \050sleep_ms != 0\051) 18 454 T
(   {tv.tv_sec = sleep_ms/1000;) 18 440 T
(    tv.tv_nsec = \050sleep_ms%1000\051 * 1000000;) 18 426 T
(    nanosleep\050&tv, NULL\051;) 18 412 T
(  }) 18 398 T
( if \050cpu_us != 0\051) 18 370 T
(   for \050i=0; i<cycles; i++\051 j++;) 18 356 T
(}) 18 342 T
(int calibrate_delay\050\051) 18 300 T
({) 18 286 T
(  delay_cycles_per_us = 8;) 18 272 T
(  iobench_start\050\051;) 18 258 T
(  delay\0500, 1000000\051;) 18 244 T
(  iobench_end\050\051;) 18 230 T
(  DEBUG\050iobench_report\050\051\051;) 18 216 T
(  DEBUG\050printf\050\322Calibration pass: %d delay cycles -> %f seconds\134n\323,) 18 202 T
(               delay_cycles_per_us, user_time\051\051;) 18 188 T
(  delay_cycles_per_us = \050delay_cycles_per_us * 1.0\051 / user_time;) 18 174 T
(  iobench_start\050\051;) 18 146 T
(  delay\0500, 1000000\051;) 18 132 T
(  iobench_end\050\051;) 18 118 T
(  DEBUG\050iobench_report\050\051\051;) 18 104 T
(  DEBUG\050printf\050\322Verification pass: %d delay cycles -> %f seconds\134n\323,) 18 90 T
(               delay_cycles_per_us, user_time\051\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "177" 177
%%Page: "178" 178
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(178) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(}) 18 748 T
(/* A barrier for one thread to wait for lots of others. */) 18 720 T
(void thread_single_barrier\050sem_t *barrier, int count\051) 18 706 T
({) 18 692 T
(  while \050count > 0\051) 18 678 T
(    {SEM_WAIT\050barrier\051;) 18 664 T
(     count--;) 18 650 T
(    }) 18 636 T
(}) 18 622 T
(/*) 18 580 T
(   ================================================================) 18 566 T
(                        Timed Mutex Lock) 18 552 T
(   ================================================================) 18 538 T
(        Just like a timed CV, only for a mutex!) 18 510 T
(*/) 18 496 T
(int thread_timed_mutex_init\050thread_timed_mutex_t *m,) 18 454 T
(                                    pthread_mutexattr_t *attr\051) 18 440 T
({) 18 426 T
(  pthread_mutex_init\050&\050m->lock\051, NULL\051;) 18 412 T
(  pthread_cond_init\050&\050m->cv\051, NULL\051;) 18 398 T
(  m->owned = FALSE;) 18 384 T
(  m->owner = NULL_TID;) 18 370 T
(  m->abstime = 0;) 18 356 T
(}) 18 342 T
(int thread_timed_mutex_destroy\050thread_timed_mutex_t *m\051) 18 300 T
({) 18 286 T
(  pthread_mutex_destroy\050&\050m->lock\051\051;) 18 272 T
(  pthread_cond_destroy\050&\050m->cv\051\051;) 18 258 T
(}) 18 244 T
(int thread_timed_mutex_lock\050thread_timed_mutex_t *m,) 18 188 T
(                                const struct timespec *abstime\051) 18 174 T
({int err;) 18 160 T
( pthread_t tid = pthread_self\050\051;) 18 146 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 18 118 T
(  while \050m->owned\051) 18 104 T
(    {err=pthread_cond_timedwait\050&\050m->cv\051, &\050m->lock\051, abstime\051;) 18 90 T
(     if \050err\051) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "178" 178
%%Page: "179" 179
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(179) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(       {pthread_mutex_unlock\050&\050m->lock\051\051;) 18 748 T
(        return\050err\051;) 18 734 T
(      }}) 18 720 T
( m->owner = tid;) 18 706 T
( m->owned = TRUE;) 18 692 T
( pthread_mutex_unlock\050&\050m->lock\051\051;) 18 678 T
( return\0500\051;) 18 664 T
(}) 18 650 T
(int thread_timed_mutex_trylock\050thread_timed_mutex_t *m\051) 18 608 T
({pthread_t tid = pthread_self\050\051;) 18 594 T
( pthread_mutex_lock\050&\050m->lock\051\051;) 18 566 T
( if \050!m->owned\051) 18 552 T
(    {m->owner = tid;) 18 538 T
(     m->owned = TRUE;) 18 524 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 18 510 T
(     return\0500\051;) 18 496 T
(   }) 18 482 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 18 468 T
(  return\050EBUSY\051;) 18 454 T
(}) 18 440 T
(int thread_timed_mutex_unlock\050thread_timed_mutex_t *m\051) 18 398 T
({) 18 384 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 18 370 T
(  m->owned = FALSE;) 18 356 T
(  m->owner = NULL_TID;) 18 342 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 18 328 T
(  pthread_cond_signal\050&\050m->cv\051\051;) 18 314 T
(}) 18 300 T
(/*) 18 230 T
(   ================================================================) 18 216 T
(                        Wait before fork\050\051) 18 202 T
(   ================================================================) 18 188 T
(  The idea is that you count the number of threads you have, then have) 18 160 T
(the forker thread wait for them all to reach a fork-safe location \050where) 18 146 T
(they will pause\051.  The forker then forks and wakes up all of the other) 18 132 T
(threads.) 18 118 T
(  The other threads will call thread_wait_for_forker\050\051 whenever they) 18 90 T
(are at a fork-safe location.  If no thread is waiting to fork, they) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "179" 179
%%Page: "180" 180
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(180) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(simply continue.  If there is one, they will then sleep until awaken.) 18 748 T
(  The forker thread \050there can only be one!\051 calls thread_wait_for_others\050\051) 18 720 T
(before forking, and thread_awake_others\050\051 afterwards.  The child does) 18 706 T
(not need to call thread_awake_others\050\051 unless it plans to call fork\050\051) 18 692 T
(also.  \050A bug w/spurious wakeups if child also forks?\051) 18 678 T
(*/) 18 650 T
(struct _fork_waiter) 18 622 T
({) 18 608 T
(  pthread_mutex_t       lock;) 18 594 T
(  pthread_cond_t        forker_cv;) 18 580 T
(  pthread_cond_t        others_cv;) 18 566 T
(  int                   runners;) 18 552 T
(  int                   owned;) 18 538 T
(  pthread_t             owner;) 18 524 T
(};) 18 510 T
(struct _fork_waiter fork_waiter =) 18 482 T
({PTHREAD_MUTEX_INITIALIZER, PTHREAD_COND_INITIALIZER, PTHREAD_COND_INITIALIZER,) 18 468 T
(   0, FALSE, NULL_TID};) 18 454 T
(void thread_wait_for_others\050int i\051) 18 412 T
({) 18 398 T
(  pthread_mutex_lock\050&fork_waiter.lock\051;) 18 384 T
(  if \050fork_waiter.owned\051) 18 370 T
(    {printf\050\322Fatal Error: Multiple calls to thread_wait_for_others!\323\051;) 18 356 T
(     abort\050\051;) 18 342 T
(   }) 18 328 T
(  fork_waiter.owned = TRUE;) 18 314 T
(  fork_waiter.owner = pthread_self\050\051;) 18 300 T
(  fork_waiter.runners=i;) 18 286 T
(  while \050fork_waiter.runners>0\051) 18 272 T
(    pthread_cond_wait\050&fork_waiter.forker_cv, &fork_waiter.lock\051;) 18 258 T
(  pthread_mutex_unlock\050&fork_waiter.lock\051;) 18 244 T
(}) 18 230 T
(void thread_awake_others\050\051) 18 188 T
({) 18 174 T
(  pthread_mutex_lock\050&fork_waiter.lock\051;) 18 160 T
(  fork_waiter.owned = FALSE;) 18 146 T
(  fork_waiter.owner = NULL_TID;) 18 132 T
(  pthread_mutex_unlock\050&fork_waiter.lock\051;) 18 118 T
(  pthread_cond_broadcast\050&fork_waiter.others_cv\051;) 18 104 T
(}) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "180" 180
%%Page: "181" 181
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(181) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(void thread_wait_for_forker\050\051) 18 748 T
({) 18 734 T
(  pthread_mutex_lock\050&fork_waiter.lock\051;) 18 720 T
(  if \050fork_waiter.owned\051) 18 706 T
(    {fork_waiter.runners--;) 18 692 T
(     while \050fork_waiter.owned\051) 18 678 T
(       {if \050fork_waiter.runners == 0\051) 18 664 T
(pthread_cond_signal\050&fork_waiter.forker_cv\051;) 18 650 T
(        pthread_cond_wait\050&fork_waiter.others_cv, &fork_waiter.lock\051;) 18 636 T
(   }}) 18 622 T
(  pthread_mutex_unlock\050&fork_waiter.lock\051;) 18 608 T
(}) 18 594 T
(/*) 18 538 T
(   ================================================================) 18 524 T
(                                Killer) 18 510 T
(   ================================================================) 18 496 T
(   */) 18 482 T
(void *killer\050void *arg\051 {) 18 454 T
(  int time = \050int\051 arg;) 18 440 T
(  sleep\050time\051;) 18 426 T
(  printf\050\322Killer thread timing out. \050Program hung?\051  Die!  Die!  Die!\134n\323\051;) 18 412 T
(  exit\050-1\051;) 18 398 T
(}) 18 384 T
(/*) 18 328 T
(   ================================================================) 18 314 T
(                                Spin locks) 18 300 T
(   ================================================================) 18 286 T
(  Two versions of spin locks.  The good versions \050only defined for) 18 258 T
(  Solaris right now\051 will not flood the memory bus.) 18 244 T
(  The bad version of spin lock will flood the memory bus with ldstub) 18 216 T
(  ops.  Try setting BAD_SPIN_COUNT = 10^9 and then running this on) 18 202 T
(  a couple of CPUs, while trying to get work done on the other CPUs.) 18 188 T
(*/) 18 160 T
(#ifdef __sun2_5) 18 118 T
(const int SPIN_COUNT = 1000;            /* About .1us per loop, SS10 */) 18 104 T
(void spin_lock\050pthread_mutex_t *m\051) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "181" 181
%%Page: "182" 182
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(182) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
({int i;) 18 748 T
( for \050i = 0; i < SPIN_COUNT; i++\051) 18 734 T
(   {if \050m->pthread_mutex_lock.pthread_mutex_owner64 == 0\051 /* Check w/o ldstub */) 18 720 T
(      if \050pthread_mutex_trylock\050m\051 != EBUSY\051) 18 706 T
(        return;                         /* Got it! */) 18 692 T
(    /* Didn\325t get it, continue the loop */) 18 678 T
(    }) 18 664 T
( pthread_mutex_lock\050m\051;                 /* Give up and block */) 18 650 T
(}) 18 636 T
(#else) 18 608 T
(const int BAD_SPIN_COUNT = 100;         /* About 1us  per loop, SS10 */) 18 594 T
(void spin_lock\050pthread_mutex_t *m\051) 18 566 T
({int i;) 18 552 T
( for \050i=0; i < BAD_SPIN_COUNT; i++\051) 18 538 T
(   {if \050pthread_mutex_trylock\050m\051 != EBUSY\051      /* Trash the memory bus! */) 18 524 T
(      return;    }                              /* got the lock! */) 18 510 T
( pthread_mutex_lock\050m\051;                         /* give up and block. */) 18 496 T
-0.31 ( return;                                        /* got the lock after blocking! */) 18 482 P
(}) 18 468 T
(#endif) 18 412 T
(/*-----------------------------------------------------------------------------) 18 342 T
( *) 18 328 T
( * Library Name: UTIL) 18 314 T
( * Module Name:  iobench) 18 300 T
( *) 18 286 T
( * Designer:    R. C. Sullivan) 18 272 T
( * Programmer:  R. C. Sullivan) 18 258 T
( * Date:        Sep 22, 1995) 18 244 T
( *) 18 230 T
( * History Of Changes:) 18 216 T
( *      Name         Date            Description) 18 202 T
( *      ----         ----            -----------) 18 188 T
( *      RCS     Jan 17, 1996     Inital release) 18 174 T
( *) 18 160 T
( * Purpose:) 18 146 T
( *   To report resource usage statistics that will be correct for) 18 132 T
( * programs using threads on a Solaris system.) 18 118 T
( *) 18 104 T
( * Notes:) 18 90 T
( *) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "182" 182
%%Page: "183" 183
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(183) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( *-----------------------------------------------------------------------------) 18 748 T
( */) 18 734 T
(#ifdef __sun) 18 706 T
(#include <stdio.h>) 18 692 T
(#include <unistd.h>) 18 678 T
(#include <fcntl.h>) 18 664 T
(#include <sys/stat.h>) 18 650 T
(#include <sys/procfs.h>) 18 636 T
(struct stat statbuf;) 18 608 T
(struct prusage prusagebuf_start, prusagebuf_end;) 18 594 T
(int procfd;) 18 580 T
(double real_time, total_real_time, user_time, system_time, trap_time, wait_time;) 18 566 T
(unsigned long minor_pfs, major_pfs, input_blocks, output_blocks, iochars;) 18 552 T
(void iobench_start\050\051 {) 18 524 T
(  char pfile[80];) 18 510 T
(  sprintf\050pfile, \322/proc/%ld\323, getpid\050\051\051;) 18 482 T
(  procfd = open\050pfile, O_RDONLY\051;) 18 468 T
(  ioctl\050procfd, PIOCUSAGE, &prusagebuf_start\051;) 18 440 T
(}) 18 426 T
(void iobench_end\050\051 {) 18 398 T
(  ioctl\050procfd, PIOCUSAGE, &prusagebuf_end\051;) 18 384 T
(  close\050procfd\051;) 18 370 T
(  real_time = \050double\051 prusagebuf_start.pr_tstamp.tv_sec +) 18 342 T
(    \050double\051 prusagebuf_start.pr_tstamp.tv_nsec / NANOSEC;) 18 328 T
(  real_time = \050double\051 prusagebuf_end.pr_tstamp.tv_sec +) 18 314 T
(    \050double\051 prusagebuf_end.pr_tstamp.tv_nsec / NANOSEC - real_time;) 18 300 T
(  total_real_time = \050double\051 prusagebuf_start.pr_rtime.tv_sec +) 18 272 T
(    \050double\051 prusagebuf_start.pr_rtime.tv_nsec / NANOSEC;) 18 258 T
(  total_real_time = \050double\051 prusagebuf_end.pr_rtime.tv_sec +) 18 244 T
(    \050double\051 prusagebuf_end.pr_rtime.tv_nsec / NANOSEC - real_time;) 18 230 T
(  user_time = \050double\051 prusagebuf_start.pr_utime.tv_sec +) 18 202 T
(    \050double\051 prusagebuf_start.pr_utime.tv_nsec / NANOSEC;) 18 188 T
(  user_time = \050double\051 prusagebuf_end.pr_utime.tv_sec +) 18 174 T
(    \050double\051 prusagebuf_end.pr_utime.tv_nsec / NANOSEC - user_time;) 18 160 T
(  system_time = \050double\051 prusagebuf_start.pr_stime.tv_sec +) 18 132 T
(    \050double\051 prusagebuf_start.pr_stime.tv_nsec / NANOSEC;) 18 118 T
(  system_time = \050double\051 prusagebuf_end.pr_stime.tv_sec +) 18 104 T
(    \050double\051 prusagebuf_end.pr_stime.tv_nsec / NANOSEC - system_time;) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "183" 183
%%Page: "184" 184
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(184) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  trap_time = \050double\051 prusagebuf_start.pr_ttime.tv_sec +) 18 748 T
(    \050double\051 prusagebuf_start.pr_ttime.tv_nsec / NANOSEC;) 18 734 T
(  trap_time = \050double\051 prusagebuf_end.pr_ttime.tv_sec +) 18 720 T
(    \050double\051 prusagebuf_end.pr_ttime.tv_nsec / NANOSEC - trap_time;) 18 706 T
(  wait_time = \050double\051 prusagebuf_start.pr_wtime.tv_sec +) 18 678 T
(    \050double\051 prusagebuf_start.pr_wtime.tv_nsec / NANOSEC;) 18 664 T
(  wait_time = \050double\051 prusagebuf_end.pr_wtime.tv_sec +) 18 650 T
(    \050double\051 prusagebuf_end.pr_wtime.tv_nsec / NANOSEC - wait_time;) 18 636 T
(  minor_pfs = prusagebuf_end.pr_minf - prusagebuf_start.pr_minf;) 18 608 T
(  major_pfs = prusagebuf_end.pr_majf - prusagebuf_start.pr_majf;) 18 594 T
(  input_blocks = prusagebuf_end.pr_inblk - prusagebuf_start.pr_inblk;) 18 580 T
(  output_blocks = prusagebuf_end.pr_oublk - prusagebuf_start.pr_oublk;) 18 566 T
(  /*  iochars = prusagebuf_end.pr_ioch - prusagebuf_start.pr_ioch;*/) 18 552 T
(}) 18 538 T
(void iobench_report\050\051 {) 18 510 T
(  fprintf\050stderr, \322\134nProcess info:\134n\323\051;) 18 496 T
(  fprintf\050stderr, \322  elapsed time  %g\134n\323, real_time\051;) 18 482 T
(  /*  fprintf\050stderr, \322  total time    %g\134n\323, total_real_time\051;*/) 18 468 T
(  fprintf\050stderr, \322  CPU time      %g\134n\323, user_time + system_time\051;) 18 454 T
(  /*  fprintf\050stderr, \322  user time     %g\134n\323, user_time\051;) 18 440 T
(  fprintf\050stderr, \322  system time   %g\134n\323, system_time\051;) 18 426 T
(  fprintf\050stderr, \322  trap time     %g\134n\323, trap_time\051;) 18 412 T
(  fprintf\050stderr, \322  wait time     %g\134n\323,  wait_time\051;) 18 398 T
(  fprintf\050stderr, \322  pfs    major/minor  %6lu/%6lu\134n\323, major_pfs, minor_pfs\051;) 18 384 T
(  fprintf\050stderr, \322  blocks input/output %6lu/%6lu\134n\323,) 18 370 T
(          input_blocks, output_blocks\051; */) 18 356 T
(  /*  fprintf\050stderr, \322  char inp/out  %lu\134n\323, iochars\051;*/) 18 342 T
(  fprintf\050stderr, \322\134n\323\051;) 18 328 T
(  /*  fprintf\050stderr, \322%2.5g Mbytes/sec \050real time\051\134n\323, iochars /) 18 300 T
(      real_time / 1e6\051;) 18 286 T
(      fprintf\050stderr, \322%2.5g Mbytes/sec \050CPU time\051 \134n\323, iochars /) 18 272 T
(      \050user_time + system_time\051 / 1e6\051;*/) 18 258 T
(  fprintf\050stderr, \322%2.1f%% CPU usage\134n\134n\323, 100 * \050user_time + system_time\051 /) 18 230 T
(          real_time + .05\051;) 18 216 T
(}) 18 202 T
(#else) 18 174 T
(void iobench_start\050\051 {}) 18 160 T
(void iobench_end\050\051 {}) 18 146 T
(void iobench_report\050\051 {}) 18 132 T
(#endif) 18 118 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "184" 184
%%Page: "185" 185
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(185) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Misusing the Cac) 131.15 732 T
(he:) 426.85 732 T
(cac) 175.12 684 T
(he_thrash.c) 234.81 684 T
4 12 Q
(/*                cache_thrash.c                */) 18 628 T
(/*) 18 600 T
(cc -o cache_thrash cache_thrash.c -L. -R. -D__sun -D__sun2_6 -fast -lpthread -) 18 586 T
(lthread -lposix4 -lthread_extensions) 18 572 T
(  Standard deviation < 1% of mean.) 18 544 T
(*/) 18 516 T
(#define _POSIX_C_SOURCE 199506L) 18 474 T
(#include <pthread.h>) 18 446 T
(#include <semaphore.h>) 18 432 T
(#include <errno.h>) 18 418 T
(#include <time.h>) 18 404 T
(#include \322thread_extensions.h\323) 18 390 T
(#define SIZE            1000000) 18 348 T
(int                     INTERATIONS = 30;) 18 306 T
(int                     BLOCK_SIZE = 1;) 18 292 T
(int                     touches = 0;) 18 278 T
(int                     CACHE_RESIDENT = 0;) 18 264 T
(int                     a[SIZE+100];) 18 250 T
(int add_rows\050\051) 18 208 T
({int            sum = 0, i, j;) 18 194 T
( for \050i = 0; i <  BLOCK_SIZE; i++\051) 18 166 T
(   {) 18 152 T
(     DEBUG\050printf\050\322%d %d\134n\323, j, i\051\051;) 18 138 T
(     for \050j = i; j < SIZE; j+= BLOCK_SIZE*2\051) 18 124 T
(       {if \050CACHE_RESIDENT\051) 18 110 T
(         {sum += a[i];) 18 96 T
(         sum += a[i+BLOCK_SIZE];) 18 82 T
(         }) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "185" 185
%%Page: "186" 186
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(186) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(       else) 18 748 T
(         {sum += a[j];) 18 734 T
(         sum += a[j+BLOCK_SIZE];) 18 720 T
(         }) 18 706 T
(       }) 18 692 T
(   }) 18 678 T
( touches += SIZE;) 18 664 T
( return\050sum\051;) 18 650 T
(}) 18 636 T
(main\050int argc, char **argv\051) 18 594 T
({int i, j, k;) 18 580 T
( if \050argc >= 2\051 INTERATIONS    = atoi\050argv[1]\051;) 18 552 T
( if \050argc >= 3\051 CACHE_RESIDENT = atoi\050argv[2]\051;) 18 538 T
( printf\050\322INTERATIONS: %d CACHE_RESIDENT: %d\134n\323,  INTERATIONS, CACHE_RESIDENT\051;) 18 524 T
( j = add_rows\050\051;) 18 496 T
( for \050k = 1; k <= 8; k = k*2\051) 18 468 T
(   {iobench_start\050\051;) 18 454 T
(   touches = 0;) 18 440 T
(   BLOCK_SIZE = k;) 18 426 T
(   for \050i = 0; i <  INTERATIONS; i++\051) 18 412 T
(     j = add_rows\050\051;) 18 398 T
(   iobench_end\050\051;) 18 384 T
(   printf\050\322BLOCK_SIZE: %d.  Total of %dM touches. Sum: %d\134n\323, BLOCK_SIZE,) 18 370 T
(touches/1000000, j\051;) 18 356 T
(   iobench_report\050\051;) 18 342 T
(   }) 18 328 T
( printf\050\322Done\134n\323\051;) 18 300 T
( exit\0500\051;) 18 286 T
(}) 18 272 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "186" 186
%%Page: "187" 187
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(187) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Misusing the Cac) 134.75 732 T
(he:) 430.45 732 T
(false_sharing.c) 174.94 684 T
4 12 Q
(/*                false_sharing.c                */) 18 600 T
(/*) 18 572 T
(  Demonstrates what NOT to do on an MP.  If SEPARATION = 1, then there will be) 18 558 T
(  horrible false sharing and the machine will crawl.  If SEPARATION = 16) 18 544 T
(  then there will be no false sharing and the program will run about 10x) 18 530 T
(  faster.) 18 516 T
(*/) 18 502 T
(#define _POSIX_C_SOURCE 199506L) 18 460 T
(#include <pthread.h>) 18 432 T
(#include <semaphore.h>) 18 418 T
(#include \322thread_extensions.h\323) 18 404 T
(int             AVOCADOS_NUMBER = 6023500;) 18 362 T
(int             N_CPUS = 4;) 18 348 T
-0.29 (int             SEPARATION = 16; /* 8 64-bit words per cache-line on Ultra SPARC) 18 334 P
(*/) 18 320 T
(sem_t           exit_barrier;) 18 306 T
(int             a[128];) 18 292 T
(pthread_attr_t  attr;) 18 278 T
(void *worker\050void *arg\051) 18 236 T
({int            index = \050int\051 arg;) 18 222 T
( int            i;) 18 208 T
( for \050i=0; i<AVOCADOS_NUMBER; i++\051) 18 180 T
(   {a[index]++;}) 18 166 T
( sem_post\050&exit_barrier\051;) 18 138 T
(}) 18 124 T
(main\050int argc, char **argv\051) 18 96 T
({int            i, j;) 18 82 T
( pthread_t      tid;) 18 68 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "187" 187
%%Page: "188" 188
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(188) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( if \050argc >= 2\051 N_CPUS = atoi\050argv[1]\051;) 18 734 T
( printf\050\322N_CPUS = %d \134n \134n\323, N_CPUS\051;) 18 706 T
( PTHREAD_ATTR_INIT\050&attr\051;) 18 678 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 664 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 650 T
( SEM_INIT\050&exit_barrier, 0, 0\051;) 18 636 T
( for \050j=1;j<17;j+=j\051) 18 608 T
(   {) 18 594 T
(     SEPARATION=j;) 18 580 T
(     printf\050\322SEPARATION = %d\134n\323, SEPARATION\051;) 18 566 T
(     iobench_start\050\051;) 18 552 T
(     for \050i=0;i<N_CPUS;i++\051) 18 538 T
(       PTHREAD_CREATE\050&tid, &attr, worker, \050void *\051 \050i * SEPARATION\051\051;) 18 524 T
(     thread_single_barrier\050&exit_barrier, N_CPUS\051;) 18 496 T
(     iobench_end\050\051;) 18 482 T
(     iobench_report\050\051;) 18 468 T
(   }) 18 454 T
(     printf\050\322Done\134n\323\051;) 18 440 T
(     exit\0500\051;) 18 426 T
(}) 18 412 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "188" 188
%%Page: "189" 189
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(189) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 36 Q
0 X
(Timing Disk Access:) 129.94 732 T
(time_disk.c) 207.95 684 T
4 12 Q
(/*                time_disk.c                */) 18 614 T
(/*) 18 586 T
(  This program runs a set of read\050\051 calls against one large file.) 18 572 T
(  It runs with one or more threads so you can see the performance) 18 558 T
(  effect of MT.  Each read\050\051 gets one byte from a random location.) 18 544 T
(  You can run it for a number of iterations & get mean & SD.) 18 530 T
(  Make sure that there are links in /tmp pointing to wherever you) 18 502 T
(  can find room.) 18 488 T
(  lrwxrwxrwx   1 bil other ... time_disk0.tmp -> /disk2/6/temp_disk_test) 18 460 T
(  ln -s /disk2/6/temp_disk_test /tmp/time_disk0.tmp) 18 446 T
(  The file must be much larger than physical memory.  10x would be great,) 18 418 T
(  but 2x will do.  Expect \322performance\323 to improve as the mbuffers get) 18 404 T
(  loaded.  For a file 2x Physical, initial 100/s will improve to 200/s) 18 390 T
(  \050as 50% of the file will become cached\051.  To populate the cache, you) 18 376 T
(  can run this program for a while.) 18 362 T
(  runtime = \050Physical Memory / PAGE_SIZE\051   / READS_PER_SECOND  eg:) 18 334 T
(  160seconds = \050128MB        / \0508KB/PAGE\051\051  / 100) 18 320 T
(  CF: Same program in Java: TimeDisk/Test.java) 18 292 T
(*/) 18 264 T
(#define _POSIX_C_SOURCE 199506L) 18 222 T
(#include <pthread.h>) 18 194 T
(#include <semaphore.h>) 18 180 T
(#include <errno.h>) 18 166 T
(#include <time.h>) 18 152 T
(#include <tnf/probe.h>) 18 138 T
(#include <math.h>) 18 124 T
(#include <unistd.h>) 18 110 T
(#include \322thread_extensions.h\323) 18 96 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "189" 189
%%Page: "190" 190
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(190) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(#define MAX_FILE_SIZE   1024*1024*1024) 18 748 T
(#define PAGE_SIZE       8192) 18 734 T
(#define MAX_PAGES       \050MAX_FILE_SIZE/PAGE_SIZE\051) 18 720 T
(#define MAX_THREADS     512) 18 706 T
(#define MAX_DENSITY     100) 18 692 T
(/*  Hack for early TNF bug */) 18 650 T
(int PTHREAD_CREATE\050pthread_t *new_thread_ID,) 18 636 T
(                   const pthread_attr_t *attr,) 18 622 T
(                   void * \050*start_func\051\050void *\051, void *arg\051) 18 608 T
({) 18 594 T
(     thr_create\0500, NULL, start_func, arg, 0x00000001, new_thread_ID\051;) 18 580 T
(}) 18 566 T
(pthread_attr_t          attr;) 18 510 T
(int                     nProcessed[MAX_THREADS];) 18 496 T
(pthread_t               threads[MAX_THREADS];) 18 482 T
(int                     MAX_READS;) 18 468 T
(int                     density[MAX_DENSITY];) 18 454 T
(int                     hits[MAX_PAGES];) 18 440 T
(int                     fd;) 18 426 T
(char                    *path = \322/tmp/time_disk0.tmp\323;) 18 412 T
(off_t                   length;) 18 398 T
(int                     PID;) 18 384 T
(int                     stop=FALSE;) 18 370 T
(int                     N_THREADS=1, SPIN_TIME=0, RUNTIME=1, ITERATIONS=1;) 18 356 T
(extern double real_time, total_real_time, user_time,) 18 314 T
(  system_time, trap_time, wait_time;) 18 300 T
(void *test\050void *arg\051 {) 18 244 T
(  int    me = \050\050int\051 arg\051 % 1000; /* Hack to get two values in one! */) 18 230 T
(  /* Don\325t reuse seed, even across processes */) 18 202 T
(  long  seed = \050\050int\051 arg\051 + PID*100000;) 18 188 T
(  int   i, fileOffset, s;) 18 160 T
(  char  *thread = thread_name\050pthread_self\050\051\051;) 18 146 T
(  char  buf[10];) 18 132 T
(  for \050i=0; i< MAX_READS; i++\051 {) 18 104 T
(    if \050stop\051 break;) 18 90 T
(    fileOffset = abs\050\050rand_r\050&seed\051*PAGE_SIZE\051 % length\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "190" 190
%%Page: "191" 191
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(191) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    hits[\050int\051 fileOffset/PAGE_SIZE]++;) 18 748 T
(    TNF_PROBE_1\050process_request_start,  \322start\323, \322\322,) 18 734 T
(                tnf_int, location, fileOffset\051;) 18 720 T
(    /* DEBUG\050printf\050\322%s reading at %d\134n\323, thread, fileOffset\051\051; */) 18 706 T
(    s = pread\050fd, &buf, 1, fileOffset\051;) 18 692 T
(    TNF_PROBE_0\050process_request_end, \322end\323, \322\322\051;) 18 678 T
(    if \050s != 1\051 printf\050\322Error! at %d\134n\323, fileOffset\051;) 18 664 T
(    delay\0500, SPIN_TIME*1000\051;) 18 650 T
(    nProcessed[me]++;) 18 636 T
(  }) 18 622 T
(  stop=TRUE;    /* If one thread completes MAX_READS, all quit. */) 18 608 T
(                /* Presumably never get here. */) 18 594 T
(}) 18 580 T
(main\050int argc, char **argv\051 {) 18 510 T
(  int           i, j;) 18 496 T
(  pthread_t     tid;) 18 482 T
(  double        rates[MAX_THREADS], S = 0.0, mean, rate_sum = 0.0;) 18 468 T
(  int           totalProcessed;) 18 454 T
(  PID = getpid\050\051;) 18 412 T
(  PTHREAD_ATTR_INIT\050&attr\051;) 18 398 T
(  pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 18 384 T
(  pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 18 370 T
(  if \050argc > 1\051 N_THREADS       = atoi\050argv[1]\051;) 18 342 T
(  if \050argc > 2\051 SPIN_TIME       = atoi\050argv[2]\051;) 18 328 T
(  if \050argc > 3\051 RUNTIME         = atoi\050argv[3]\051;) 18 314 T
(  if \050argc > 4\051 ITERATIONS      = atoi\050argv[4]\051;) 18 300 T
(  printf\050\322time_disk\050N_THREADS %d SPIN_TIME %dms RUNTIME %ds ITERATIONS %d\051\134n\323,) 18 286 T
(         N_THREADS, SPIN_TIME, RUNTIME, ITERATIONS\051;) 18 272 T
(  if \050N_THREADS>MAX_THREADS\051 {) 18 258 T
(    printf\050\322Too many threads! Max is %d\134n\323, MAX_THREADS\051;) 18 244 T
(    abort\050\051;) 18 230 T
(  }) 18 216 T
(  fd = open\050path, O_RDONLY\051;) 18 188 T
(  if \050fd == -1\051   {printf\050\322Check %s \050see comments\051!\323, path\051; exit\0501\051;}) 18 174 T
(  length = lseek\050fd, 0, SEEK_END\051;) 18 160 T
(  /* Should never be used, except when seed==1 \050to read from mbufs\051*/) 18 132 T
(  MAX_READS=RUNTIME*10000;) 18 118 T
(  if \050SPIN_TIME>0\051  calibrate_delay\050\051;) 18 90 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "191" 191
%%Page: "192" 192
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(192) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  for \050j=0; j<ITERATIONS; j++\051 {) 18 748 T
(    for \050i=0; i<MAX_PAGES; i++\051 hits[i]=0;) 18 720 T
(    for \050i=0; i<MAX_DENSITY; i++\051 density[i]=0;) 18 706 T
(    for \050i=0; i<N_THREADS; i++\051 nProcessed[i]=0;) 18 692 T
(    totalProcessed=0;) 18 678 T
(    for \050i=0; i<N_THREADS; i++\051) 18 650 T
(      PTHREAD_CREATE\050&threads[i], &attr, test, \050void *\051 \050j*1000 + i\051\051;) 18 636 T
(    iobench_start\050\051;) 18 608 T
(    sleep\050RUNTIME\051;) 18 594 T
(    stop = TRUE;) 18 580 T
(    for \050i=0; i<N_THREADS; i++\051 {pthread_join\050threads[i], NULL\051;}) 18 566 T
(    iobench_end\050\051;) 18 552 T
(    for \050i=0; i<N_THREADS; i++\051 {) 18 524 T
(      DEBUG\050printf\050\322%s processed \134t%d\134n\323,) 18 510 T
(                   thread_name\050threads[i]\051, nProcessed[i]\051\051;) 18 496 T
(      totalProcessed += nProcessed[i];) 18 482 T
(    }) 18 468 T
(    for \050i=0; i<MAX_PAGES; i++\051 {) 18 440 T
(      if \050hits[i] < MAX_DENSITY\051) 18 426 T
(        density[hits[i]]++;) 18 412 T
(      else) 18 398 T
(        DEBUG\050printf\050\322Page %d got %d hits\134n\323, i, hits[i]\051\051;) 18 384 T
(    }) 18 370 T
(    DEBUG\050printf\050\322nHits \134t nPages \134n\323\051\051;) 18 342 T
(    for \050i=1; i<MAX_DENSITY; i++\051 {) 18 328 T
(      if \050density[i]>0\051) 18 314 T
(        DEBUG\050printf\050\322%d \134t %d\134n\323, i, density[i]\051\051;) 18 300 T
(    }) 18 286 T
(    if \050ITERATIONS==1\051 iobench_report\050\051;) 18 258 T
(    if \050ITERATIONS==1\051 printf\050\322totalProcessed: %d, rate: %f/sec\134n\323,) 18 244 T
(                              totalProcessed, totalProcessed / real_time\051;) 18 230 T
(    rates[j] =  totalProcessed / real_time;) 18 216 T
(    rate_sum += totalProcessed / real_time;) 18 202 T
(    stop=FALSE;) 18 188 T
(  }) 18 174 T
(  if \050ITERATIONS>1\051 {) 18 146 T
(    mean = rate_sum/ITERATIONS;) 18 132 T
(    for \050i=0; i<ITERATIONS; i++\051 S+=\050mean-rates[i]\051*\050mean-rates[i]\051;) 18 104 T
(    S = sqrt\050S/\050ITERATIONS-1\051\051;) 18 90 T
(    printf\050\322Mean rate: %3.2f/sec, Standard Deviation: %3.2f\134n\323, mean, S\051;) 18 76 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "192" 192
%%Page: "193" 193
612 792 0 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
18 774 594 774 2 L
7 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
18 18 603 39.12 R
7 X
V
0 12 Q
0 X
(Bil Le) 18 31.12 T
(wis) 48.04 31.12 T
1 F
(193) 297 31.12 T
(21 Mar) 517.81 31.12 T
(ch 2000) 554.69 31.12 T
18 54 594 54 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  }) 18 748 T
(}) 18 734 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "193" 193
%%Trailer
%%BoundingBox: 0 0 612 792
%%PageOrder: Ascend
%%Pages: 193
%%DocumentFonts: Times-Roman
%%+ Palatino-Roman
%%+ Helvetica-Bold
%%+ Helvetica
%%+ Courier-Bold
%%+ Helvetica-BoldOblique
%%+ Courier
%%EOF
