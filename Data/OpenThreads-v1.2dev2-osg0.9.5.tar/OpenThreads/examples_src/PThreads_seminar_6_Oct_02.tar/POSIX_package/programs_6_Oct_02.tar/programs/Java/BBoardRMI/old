//              ServerRMI/ServerImpl.java

import java.rmi.*;
import java.rmi.server.*;
import Extensions.*;


public class BBoardMgrImpl extends UnicastRemoteObject implements BBoardMgrOp {
  int nCalls = 0;


public BBoardMgrImpl() throws RemoteException {}


public void subscribe(ClientListenerOp l, String topic) throws RemoteException {
  LinkedList listeners;

  listeners = (LinkedList) topics.get(topic);
  if (listeners == null) {
    listeners = new LinkedList();
    topics.put(topic, listeners);
  }
  listeners.add(l);
}

public void unsubscribe(Listener l, String topic) throws RemoteException {
}


public void publish(String topic, String msg) {
  LinkedList listeners;

  listeners = (LinkedList) topics.get(topic);
  if (listeners == null) {
    return;
  }

  synchronized(listeners) {
    ListIterator i = listeners.listIterator();
    while (i.hasNext()) {
      ClientListenerOp l = (ClientListenerOp) i.next();

      try {l.process(topic, msg);}
      catch (RemoteException re) {System.out.println(re);}
    }
  }
}
  
}
 
