%!PS-Adobe-3.0
%%BoundingBox: (atend)
%%Pages: (atend)
%%PageOrder: (atend)
%%DocumentFonts: (atend)
%%Creator: Frame 4.0
%%DocumentData: Clean7Bit
%%EndComments
%%BeginProlog
%
% Frame ps_prolog 5.0, for use with Frame 5.0 products
% This ps_prolog file is Copyright (c) 1986-1995 Frame Technology
% Corporation.  All rights reserved.  This ps_prolog file may be
% freely copied and distributed in conjunction with documents created
% using FrameMaker, FrameMaker/SGML and FrameViewer as long as this 
% copyright notice is preserved.
%
% FrameMaker users specify the proper paper size for each print job in the
% "Print" dialog's "Printer Paper Size" "Width" and "Height~ fields.  If the
% printer that the PS file is sent to does not support the requested paper
% size, or if there is no paper tray of the proper size currently installed, 
% then the job will not be printed.  The following flag, if set to true, will
% cause the job to print on the default paper in such cases.
/FMAllowPaperSizeMismatch            false def
%
% Frame products normally print colors as their true color on a color printer
% or as shades of gray, based on luminance, on a black-and white printer. The
% following flag, if set to true, forces all non-white colors to print as pure
% black. This has no effect on bitmap images.
/FMPrintAllColorsAsBlack             false def
%
% Frame products can either set their own line screens or use a printer's 
% default settings. Three flags below control this separately for no 
% separations, spot separations and process separations. If a flag
% is true, then the default printer settings will not be changed. If it is
% false, Frame products will use their own settings from a table based on
% the printer's resolution.
/FMUseDefaultNoSeparationScreen      true  def
/FMUseDefaultSpotSeparationScreen    true  def
/FMUseDefaultProcessSeparationScreen false def
%
% For any given PostScript printer resolution, Frame products have two sets of 
% screen angles and frequencies for printing process separations, which are 
% recomended by Adobe. The following variable chooses the higher frequencies
% when set to true or the lower frequencies when set to false. This is only
% effective if the appropriate FMUseDefault...SeparationScreen flag is false.
/FMUseHighFrequencyScreens true def
%
% The following is a set of predefined optimal frequencies and angles for various
% common dpi settings. This is taken from "Advances in Color Separation Using
% PostScript Software Technology," from Adobe Systems (3/13/89 P.N. LPS 0043)
% and corrolated with information which is in various PPD (4.0) files.
%
% The "dpiranges" figure is the minimum dots per inch device resolution which
% can support this setting. The "low" and "high" values are controlled by the
% setting of the FMUseHighFrequencyScreens flag above. The "TDot" flags control
% the use of the "Yellow Triple Dot" feature whereby the frequency id divided by
% three, but the dot function is "trippled" giving a block of 3x3 dots per cell.
%
% PatFreq is a compromise pattern frequency for ps Level 2 printers which is close
% to the ideal WYSIWYG pattern frequency of 9 repetitions/inch but does not beat
% (too badly) against the screen frequencies of any separations for that DPI.
/dpiranges   [  2540    2400    1693     1270    1200     635      600      0      ] def
/CMLowFreqs  [ 100.402  94.8683 89.2289 100.402  94.8683  66.9349  63.2456 47.4342 ] def
/YLowFreqs   [  95.25   90.0    84.65    95.25   90.0     70.5556  66.6667 50.0    ] def
/KLowFreqs   [  89.8026 84.8528 79.8088  89.8026 84.8528  74.8355  70.7107 53.033  ] def
/CLowAngles  [  71.5651 71.5651 71.5651 71.5651  71.5651  71.5651  71.5651 71.5651 ] def
/MLowAngles  [  18.4349 18.4349 18.4349 18.4349  18.4349  18.4349  18.4349 18.4349 ] def
/YLowTDot    [  true    true    false    true    true     false    false   false   ] def
/CMHighFreqs [ 133.87  126.491 133.843  108.503 102.523  100.402   94.8683 63.2456 ] def
/YHighFreqs  [ 127.0   120.0   126.975  115.455 109.091   95.25    90.0    60.0    ] def
/KHighFreqs  [ 119.737 113.137 119.713  128.289 121.218   89.8026  84.8528 63.6395 ] def
/CHighAngles [  71.5651 71.5651 71.5651  70.0169 70.0169  71.5651  71.5651 71.5651 ] def
/MHighAngles [  18.4349 18.4349 18.4349  19.9831 19.9831  18.4349  18.4349 18.4349 ] def
/YHighTDot   [  false   false   true     false   false    true     true    false   ] def
/PatFreq     [	10.5833 10.0     9.4055  10.5833 10.0	  10.5833  10.0	   9.375   ] def
%
% PostScript Level 2 printers contain an "Accurate Screens" feature which can
% improve process separation rendering at the expense of compute time. This 
% flag is ignored by PostScript Level 1 printers.
/FMUseAcccurateScreens true def
%
% The following PostScript procedure defines the spot function that Frame
% products will use for process separations. You may un-comment-out one of
% the alternative functions below, or use your own.
%
% Dot function
/FMSpotFunction {abs exch abs 2 copy add 1 gt 
		{1 sub dup mul exch 1 sub dup mul add 1 sub }
		{dup mul exch dup mul add 1 exch sub }ifelse } def
%
% Line function
% /FMSpotFunction { pop } def
%
% Elipse function
% /FMSpotFunction { dup 5 mul 8 div mul exch dup mul exch add 
%		sqrt 1 exch sub } def
%
%
/FMversion (5.0) def 
/fMLevel1 /languagelevel where {pop languagelevel} {1} ifelse 2 lt def
/FMPColor
	fMLevel1 {
		false
		/colorimage where {pop pop true} if
	} {
		true
	} ifelse
def
/FrameDict 400 dict def 
systemdict /errordict known not {/errordict 10 dict def
		errordict /rangecheck {stop} put} if
% The readline in PS 23.0 doesn't recognize cr's as nl's on AppleTalk
FrameDict /tmprangecheck errordict /rangecheck get put 
errordict /rangecheck {FrameDict /bug true put} put 
FrameDict /bug false put 
mark 
% Some PS machines read past the CR, so keep the following 3 lines together!
currentfile 5 string readline
00
0000000000
cleartomark 
errordict /rangecheck FrameDict /tmprangecheck get put 
FrameDict /bug get { 
	/readline {
		/gstring exch def
		/gfile exch def
		/gindex 0 def
		{
			gfile read pop 
			dup 10 eq {exit} if 
			dup 13 eq {exit} if 
			gstring exch gindex exch put 
			/gindex gindex 1 add def 
		} loop
		pop 
		gstring 0 gindex getinterval true 
		} bind def
	} if
/FMshowpage /showpage load def
/FMquit /quit load def
/FMFAILURE { 
	dup = flush 
	FMshowpage 
	/Helvetica findfont 12 scalefont setfont
	72 200 moveto show
	72 220 moveto show
	FMshowpage 
	FMquit 
	} def 
/FMVERSION {
	FMversion ne {
		(Frame product version does not match ps_prolog!  Check installation;)
		(also check ~/fminit and ./fminit for old versions) FMFAILURE
		} if
	} def 
/FMBADEPSF { 
	(Adobe's PostScript Language Reference Manual, 2nd Edition, section H.2.4)
	(says your EPS file is not valid, as it calls X              )
	dup dup (X) search pop exch pop exch pop length 
	5 -1 roll 
	putinterval 
	FMFAILURE
	} def
/fmConcatProcs
	{
	/proc2 exch cvlit def/proc1 exch cvlit def/newproc proc1 length proc2 length add array def
	newproc 0 proc1 putinterval newproc proc1 length proc2 putinterval newproc cvx
}def
FrameDict begin [
	/ALDsave
	/FMdicttop
	/FMoptop
	/FMpointsize
	/FMsaveobject
	/b
	/bitmapsave
	/blut
	/bpside
	/bs
	/bstring
	/bwidth
	/c
	/cf
	/cs
	/cynu
	/depth
	/edown
	/fh
	/fillvals
	/fw
	/fx
	/fy
	/g
	/gfile
	/gindex
	/grnt
	/gryt
	/gstring
	/height
	/hh
	/i
	/im
	/indx
	/is
	/k
	/kk
	/landscape
	/lb
	/len
	/llx
	/lly
	/m
	/magu
	/manualfeed
	/n
	/offbits
	/onbits
	/organgle
	/orgbangle
	/orgbfreq
	/orgbproc
	/orgbxfer
	/orgfreq
	/orggangle
	/orggfreq
	/orggproc
	/orggxfer
	/orgmatrix
	/orgproc
	/orgrangle
	/orgrfreq
	/orgrproc
	/orgrxfer
	/orgxfer
	/pagesave
	/paperheight
	/papersizedict
	/paperwidth
	/pos
	/pwid
	/r
	/rad
	/redt
	/sl
	/str
	/tran
	/u
	/urx
	/ury
	/val
	/width
	/width
	/ws
	/ww
	/x
	/x1
	/x2
	/xindex
	/xpoint
	/xscale
	/xx
	/y
	/y1
	/y2
	/yelu
	/yindex
	/ypoint
	/yscale
	/yy
] { 0 def } forall
/FmBD {bind def} bind def
systemdict /pdfmark known {
	/fMAcrobat true def
	
	/FmPD /pdfmark load def
	
	
	/FmPT /show load def
	
	
	currentdistillerparams /CoreDistVersion get 2000 ge {
	
		
		/FmPD2 /pdfmark load def
		
		
		
		
		
		/FmPA { mark exch /Dest exch 5 3 roll 
				/View [ /XYZ null 6 -2 roll FmDC exch pop null] /DEST FmPD 
		}FmBD
	} {
		
		/FmPD2 /cleartomark load def
		/FmPA {pop pop pop}FmBD
	} ifelse
} {
	
	/fMAcrobat false def
	/FmPD /cleartomark load def
	/FmPD2 /cleartomark load def
	/FmPT /pop load def
	/FmPA {pop pop pop}FmBD
} ifelse
/FmDC {
	transform fMDefaultMatrix itransform cvi exch cvi exch
}FmBD
/FmBx {
	dup 3 index lt {3 1 roll exch} if 
	1 index 4 index lt {4 -1 roll 3 1 roll exch 4 1 roll} if
}FmBD
/FMnone 0 def
/FMcyan 1 def
/FMmagenta 2 def
/FMyellow 3 def
/FMblack 4 def
/FMcustom 5 def
/fMNegative false def 
/FrameSepIs FMnone def 
/FrameSepBlack 0 def
/FrameSepYellow 0 def
/FrameSepMagenta 0 def
/FrameSepCyan 0 def
/FrameSepRed 1 def
/FrameSepGreen 1 def
/FrameSepBlue 1 def
/FrameCurGray 1 def
/FrameCurPat null def
/FrameCurColors [ 0 0 0 1 0 0 0 ] def 
/FrameColorEpsilon .001 def	
/eqepsilon {		
	sub dup 0 lt {neg} if
	FrameColorEpsilon le
} bind def
/FrameCmpColorsCMYK { 
	2 copy 0 get exch 0 get eqepsilon {
		2 copy 1 get exch 1 get eqepsilon {
			2 copy 2 get exch 2 get eqepsilon {
				3 get exch 3 get eqepsilon
			} {pop pop false} ifelse
		}{pop pop false} ifelse
	} {pop pop false} ifelse
} bind def
/FrameCmpColorsRGB { 
	2 copy 4 get exch 0 get eqepsilon {
		2 copy 5 get exch 1 get eqepsilon {
			6 get exch 2 get eqepsilon
		}{pop pop false} ifelse
	} {pop pop false} ifelse
} bind def
/RGBtoCMYK { 
	1 exch sub 
	3 1 roll 
	1 exch sub 
	3 1 roll 
	1 exch sub 
	3 1 roll 
	3 copy 
	2 copy 
	le { pop } { exch pop } ifelse 
	2 copy 
	le { pop } { exch pop } ifelse 
	dup dup dup 
	6 1 roll 
	4 1 roll 
	7 1 roll 
	sub 
	6 1 roll 
	sub 
	5 1 roll 
	sub 
	4 1 roll 
} bind def
/CMYKtoRGB { 
	dup dup 4 -1 roll add 						  
	5 1 roll 3 -1 roll add 						  
	4 1 roll add 								  
	1 exch sub dup 0 lt {pop 0} if 3 1 roll 	  
	1 exch sub dup 0 lt {pop 0} if exch 	      
	1 exch sub dup 0 lt {pop 0} if exch	  		  
} bind def
/FrameSepInit {
	1.0 RealSetgray
} bind def
/FrameSetSepColor { 
	/FrameSepBlue exch def
	/FrameSepGreen exch def
	/FrameSepRed exch def
	/FrameSepBlack exch def
	/FrameSepYellow exch def
	/FrameSepMagenta exch def
	/FrameSepCyan exch def
	/FrameSepIs FMcustom def
	setCurrentScreen	
} bind def
/FrameSetCyan {
	/FrameSepBlue 1.0 def
	/FrameSepGreen 1.0 def
	/FrameSepRed 0.0 def
	/FrameSepBlack 0.0 def
	/FrameSepYellow 0.0 def
	/FrameSepMagenta 0.0 def
	/FrameSepCyan 1.0 def
	/FrameSepIs FMcyan def
	setCurrentScreen	
} bind def
 
/FrameSetMagenta {
	/FrameSepBlue 1.0 def
	/FrameSepGreen 0.0 def
	/FrameSepRed 1.0 def
	/FrameSepBlack 0.0 def
	/FrameSepYellow 0.0 def
	/FrameSepMagenta 1.0 def
	/FrameSepCyan 0.0 def
	/FrameSepIs FMmagenta def
	setCurrentScreen
} bind def
 
/FrameSetYellow {
	/FrameSepBlue 0.0 def
	/FrameSepGreen 1.0 def
	/FrameSepRed 1.0 def
	/FrameSepBlack 0.0 def
	/FrameSepYellow 1.0 def
	/FrameSepMagenta 0.0 def
	/FrameSepCyan 0.0 def
	/FrameSepIs FMyellow def
	setCurrentScreen
} bind def
 
/FrameSetBlack {
	/FrameSepBlue 0.0 def
	/FrameSepGreen 0.0 def
	/FrameSepRed 0.0 def
	/FrameSepBlack 1.0 def
	/FrameSepYellow 0.0 def
	/FrameSepMagenta 0.0 def
	/FrameSepCyan 0.0 def
	/FrameSepIs FMblack def
	setCurrentScreen
} bind def
 
/FrameNoSep { 
	/FrameSepIs FMnone def
	setCurrentScreen
} bind def
/FrameSetSepColors { 
	FrameDict begin
	[ exch 1 add 1 roll ]
	/FrameSepColors  
	exch def end
	} bind def
/FrameColorInSepListCMYK { 
	FrameSepColors {  
       		exch dup 3 -1 roll 
       		FrameCmpColorsCMYK 
       		{ pop true exit } if
    	} forall 
	dup true ne {pop false} if
	} bind def
/FrameColorInSepListRGB { 
	FrameSepColors {  
       		exch dup 3 -1 roll 
       		FrameCmpColorsRGB 
       		{ pop true exit } if
    	} forall 
	dup true ne {pop false} if
	} bind def
/RealSetgray /setgray load def
/RealSetrgbcolor /setrgbcolor load def
/RealSethsbcolor /sethsbcolor load def
end 
/setgray { 
	FrameDict begin
	FrameSepIs FMnone eq
		{ RealSetgray } 
		{ 
		FrameSepIs FMblack eq 
			{ RealSetgray } 
			{ FrameSepIs FMcustom eq 
			  FrameSepRed 0 eq and
			  FrameSepGreen 0 eq and
			  FrameSepBlue 0 eq and {
			  	RealSetgray
			  } {
				1 RealSetgray pop 
			  } ifelse
			} ifelse
		} ifelse
	end
} bind def
/setrgbcolor { 
	FrameDict begin
	FrameSepIs FMnone eq
	{  RealSetrgbcolor }
	{
		3 copy [ 4 1 roll ] 
		FrameColorInSepListRGB
		{
				FrameSepBlue eq exch 
			 	FrameSepGreen eq and exch 
			 	FrameSepRed eq and
			 	{ 0 } { 1 } ifelse
		}
		{
			FMPColor {
				RealSetrgbcolor
				currentcmykcolor
			} {
				RGBtoCMYK
			} ifelse
			FrameSepIs FMblack eq
			{1.0 exch sub 4 1 roll pop pop pop} {
			FrameSepIs FMyellow eq
			{pop 1.0 exch sub 3 1 roll pop pop} {
			FrameSepIs FMmagenta eq
			{pop pop 1.0 exch sub exch pop } {
			FrameSepIs FMcyan eq
			{pop pop pop 1.0 exch sub } 
			{pop pop pop pop 1} ifelse } ifelse } ifelse } ifelse 
		} ifelse
		RealSetgray
	} 
	ifelse
	end
} bind def
/sethsbcolor {
	FrameDict begin
	FrameSepIs FMnone eq 
	{ RealSethsbcolor } 
	{
		RealSethsbcolor 
		currentrgbcolor  
		setrgbcolor 
	} 
	ifelse
	end
} bind def
FrameDict begin
/setcmykcolor where {
	pop /RealSetcmykcolor /setcmykcolor load def
} {
	/RealSetcmykcolor {
		4 1 roll
		3 { 3 index add 0 max 1 min 1 exch sub 3 1 roll} repeat 
		RealSetrgbcolor pop
	} bind def
} ifelse
userdict /setcmykcolor { 
		FrameDict begin
		FrameSepIs FMnone eq
		{ RealSetcmykcolor } 
		{
			4 copy [ 5 1 roll ]
			FrameColorInSepListCMYK
			{
				FrameSepBlack eq exch 
				FrameSepYellow eq and exch 
				FrameSepMagenta eq and exch 
				FrameSepCyan eq and 
				{ 0 } { 1 } ifelse
			}
			{
				FrameSepIs FMblack eq
				{1.0 exch sub 4 1 roll pop pop pop} {
				FrameSepIs FMyellow eq
				{pop 1.0 exch sub 3 1 roll pop pop} {
				FrameSepIs FMmagenta eq
				{pop pop 1.0 exch sub exch pop } {
				FrameSepIs FMcyan eq
				{pop pop pop 1.0 exch sub } 
				{pop pop pop pop 1} ifelse } ifelse } ifelse } ifelse 
			} ifelse
			RealSetgray
		}
		ifelse
		end
	} bind put
fMLevel1 { 
	
	
	
	/patScreenDict 7 dict dup begin
		<0f1e3c78f0e1c387> [ 45  { pop } {exch pop} 		.5   2 sqrt] FmBD
		<0f87c3e1f0783c1e> [ 135 { pop } {exch pop}			.5   2 sqrt] FmBD
		<cccccccccccccccc> [ 0   { pop } dup				.5   2	   ] FmBD
		<ffff0000ffff0000> [ 90  { pop } dup				.5   2	   ] FmBD
		<8142241818244281> [ 45  { 2 copy lt {exch} if pop}	dup .75  2 sqrt] FmBD
		<03060c183060c081> [ 45  { pop } {exch pop}			.875 2 sqrt] FmBD
		<8040201008040201> [ 135 { pop } {exch pop}			.875 2 sqrt] FmBD
	end def
} { 
	
	/patProcDict 5 dict dup begin
		<0f1e3c78f0e1c387> { 3 setlinewidth -1 -1 moveto 9 9 lineto stroke 
											4 -4 moveto 12 4 lineto stroke
											-4 4 moveto 4 12 lineto stroke} bind def
		<0f87c3e1f0783c1e> { 3 setlinewidth -1 9 moveto 9 -1 lineto stroke 
											-4 4 moveto 4 -4 lineto stroke
											4 12 moveto 12 4 lineto stroke} bind def
		<8142241818244281> { 1 setlinewidth -1 9 moveto 9 -1 lineto stroke
											-1 -1 moveto 9 9 lineto stroke } bind def
		<03060c183060c081> { 1 setlinewidth -1 -1 moveto 9 9 lineto stroke 
											4 -4 moveto 12 4 lineto stroke
											-4 4 moveto 4 12 lineto stroke} bind def
		<8040201008040201> { 1 setlinewidth -1 9 moveto 9 -1 lineto stroke 
											-4 4 moveto 4 -4 lineto stroke
											4 12 moveto 12 4 lineto stroke} bind def
	end def
	/patDict 15 dict dup begin
		/PatternType 1 def		
		/PaintType 2 def		
		/TilingType 3 def		
		/BBox [ 0 0 8 8 ] def 	
		/XStep 8 def			
		/YStep 8 def			
		/PaintProc {
			begin
			patProcDict bstring known {
				patProcDict bstring get exec
			} {
				8 8 true [1 0 0 -1 0 8] bstring imagemask
			} ifelse
			end
		} bind def
	end def
} ifelse
/combineColor {
    FrameSepIs FMnone eq
	{
		graymode fMLevel1 or not {
			
			[/Pattern [/DeviceCMYK]] setcolorspace
			FrameCurColors 0 4 getinterval aload pop FrameCurPat setcolor
		} {
			FrameCurColors 3 get 1.0 ge {
				FrameCurGray RealSetgray
			} {
				fMAcrobat not FMPColor graymode and and {
					0 1 3 { 
						FrameCurColors exch get
						1 FrameCurGray sub mul
					} for
					RealSetcmykcolor
				} {
					4 1 6 {
						FrameCurColors exch get
						graymode {
							1 exch sub 1 FrameCurGray sub mul 1 exch sub
						} {
							1.0 lt {FrameCurGray} {1} ifelse
						} ifelse
					} for
					RealSetrgbcolor
				} ifelse
			} ifelse
		} ifelse
	} { 
		FrameCurColors 0 4 getinterval aload
		FrameColorInSepListCMYK {
			FrameSepBlack eq exch 
			FrameSepYellow eq and exch 
			FrameSepMagenta eq and exch 
			FrameSepCyan eq and
			FrameSepIs FMcustom eq and
			{ FrameCurGray } { 1 } ifelse
		} {
			FrameSepIs FMblack eq
			{FrameCurGray 1.0 exch sub mul 1.0 exch sub 4 1 roll pop pop pop} {
			FrameSepIs FMyellow eq
			{pop FrameCurGray 1.0 exch sub mul 1.0 exch sub 3 1 roll pop pop} {
			FrameSepIs FMmagenta eq
			{pop pop FrameCurGray 1.0 exch sub mul 1.0 exch sub exch pop } {
			FrameSepIs FMcyan eq
			{pop pop pop FrameCurGray 1.0 exch sub mul 1.0 exch sub } 
			{pop pop pop pop 1} ifelse } ifelse } ifelse } ifelse 
		} ifelse
		graymode fMLevel1 or not {
			
			[/Pattern [/DeviceGray]] setcolorspace
			FrameCurPat setcolor
		} { 
			graymode not fMLevel1 and {
				
				dup 1 lt {pop FrameCurGray} if
			} if
			RealSetgray
		} ifelse
	} ifelse
} bind def
/savematrix {
	orgmatrix currentmatrix pop
	} bind def
/restorematrix {
	orgmatrix setmatrix
	} bind def
/fMDefaultMatrix matrix defaultmatrix def
/fMatrix2 matrix def
/dpi    72 0 fMDefaultMatrix dtransform
    dup mul exch   dup mul add   sqrt def
	
/freq dpi dup 72 div round dup 0 eq {pop 1} if 8 mul div def
/sangle 1 0 fMDefaultMatrix dtransform exch atan def
	sangle fMatrix2 rotate 
	fMDefaultMatrix fMatrix2 concatmatrix 
	dup 0 get /sflipx exch def
	    3 get /sflipy exch def
/screenIndex {
	0 1 dpiranges length 1 sub { dup dpiranges exch get 1 sub dpi le {exit} {pop} ifelse } for
} bind def
/getCyanScreen {
	FMUseHighFrequencyScreens { CHighAngles CMHighFreqs} {CLowAngles CMLowFreqs} ifelse
		screenIndex dup 3 1 roll get 3 1 roll get /FMSpotFunction load
} bind def
/getMagentaScreen {
	FMUseHighFrequencyScreens { MHighAngles CMHighFreqs } {MLowAngles CMLowFreqs} ifelse
		screenIndex dup 3 1 roll get 3 1 roll get /FMSpotFunction load
} bind def
/getYellowScreen {
	FMUseHighFrequencyScreens { YHighTDot YHighFreqs} { YLowTDot YLowFreqs } ifelse
		screenIndex dup 3 1 roll get 3 1 roll get { 3 div
			{2 { 1 add 2 div 3 mul dup floor sub 2 mul 1 sub exch} repeat
			FMSpotFunction } } {/FMSpotFunction load } ifelse
			0.0 exch
} bind def
/getBlackScreen  {
	FMUseHighFrequencyScreens { KHighFreqs } { KLowFreqs } ifelse
		screenIndex get 45.0 /FMSpotFunction load 
} bind def
/getSpotScreen {
	getBlackScreen
} bind def
/getCompositeScreen {
	getBlackScreen
} bind def
/FMSetScreen 
	fMLevel1 { /setscreen load 
	}{ {
		8 dict begin
		/HalftoneType 1 def
		/SpotFunction exch def
		/Angle exch def
		/Frequency exch def
		/AccurateScreens FMUseAcccurateScreens def
		currentdict end sethalftone
	} bind } ifelse
def
/setDefaultScreen {
	FMPColor {
		orgrxfer cvx orggxfer cvx orgbxfer cvx orgxfer cvx setcolortransfer
	}
	{
		orgxfer cvx settransfer
	} ifelse
	orgfreq organgle orgproc cvx setscreen
} bind def
/setCurrentScreen {
	FrameSepIs FMnone eq {
		FMUseDefaultNoSeparationScreen {
			setDefaultScreen
		} {
			getCompositeScreen FMSetScreen
		} ifelse
	} {
		FrameSepIs FMcustom eq {
			FMUseDefaultSpotSeparationScreen {
				setDefaultScreen
			} {
				getSpotScreen FMSetScreen
			} ifelse
		} {
			FMUseDefaultProcessSeparationScreen {
				setDefaultScreen
			} {
				FrameSepIs FMcyan eq {
					getCyanScreen FMSetScreen
				} {
					FrameSepIs FMmagenta eq {
						getMagentaScreen FMSetScreen
					} {
						FrameSepIs FMyellow eq {
							getYellowScreen FMSetScreen
						} {
							getBlackScreen FMSetScreen
						} ifelse
					} ifelse
				} ifelse
			} ifelse
		} ifelse
	} ifelse 
} bind def
end
	
/FMDOCUMENT { 
	array /FMfonts exch def 
	/#copies exch def
	FrameDict begin
	0 ne /manualfeed exch def
	/paperheight exch def
	/paperwidth exch def
	0 ne /fMNegative exch def 
	0 ne /edown exch def 
	/yscale exch def
	/xscale exch def
	fMLevel1 {
		manualfeed {setmanualfeed} if
		/FMdicttop countdictstack 1 add def 
		/FMoptop count def 
		setpapername 
		manualfeed {true} {papersize} ifelse 
		{manualpapersize} {false} ifelse 
		{desperatepapersize} {false} ifelse 
		{papersizefailure} if
		count -1 FMoptop {pop pop} for
		countdictstack -1 FMdicttop {pop end} for 
		}
		{2 dict
		 dup /PageSize [paperwidth paperheight] put
		 manualfeed {dup /ManualFeed manualfeed put} if
		 {setpagedevice} stopped {papersizefailure} if
		}
	ifelse 
	
	FMPColor {
		currentcolorscreen
			cvlit /orgproc exch def
				  /organgle exch def 
				  /orgfreq exch def
			cvlit /orgbproc exch def
				  /orgbangle exch def 
				  /orgbfreq exch def
			cvlit /orggproc exch def
				  /orggangle exch def 
				  /orggfreq exch def
			cvlit /orgrproc exch def
				  /orgrangle exch def 
				  /orgrfreq exch def
			currentcolortransfer 
			fMNegative {
				1 1 4 { 
					pop { 1 exch sub } fmConcatProcs 4 1 roll
				} for
				4 copy
				setcolortransfer
			} if
			cvlit /orgxfer exch def
			cvlit /orgbxfer exch def
			cvlit /orggxfer exch def
			cvlit /orgrxfer exch def
	} {
		currentscreen 
			cvlit /orgproc exch def
				  /organgle exch def 
				  /orgfreq exch def
				  
		currenttransfer 
		fMNegative {
			{ 1 exch sub } fmConcatProcs
			dup settransfer
		} if 
		cvlit /orgxfer exch def
	} ifelse
	end 
} def 
/FMBEGINPAGE { 
	FrameDict begin 
	/pagesave save def
	3.86 setmiterlimit
	/landscape exch 0 ne def
	landscape { 
		90 rotate 0 exch dup /pwid exch def neg translate pop 
	}{
		pop /pwid exch def
	} ifelse
	edown { [-1 0 0 1 pwid 0] concat } if
	0 0 moveto paperwidth 0 lineto paperwidth paperheight lineto 
	0 paperheight lineto 0 0 lineto 1 setgray fill
	xscale yscale scale
	/orgmatrix matrix def
	gsave 
} def 
/FMENDPAGE {
	grestore 
	pagesave restore
	end 
	showpage
	} def 
/FMFONTDEFINE { 
	FrameDict begin
	findfont 
	ReEncode 
	1 index exch 
	definefont 
	FMfonts 3 1 roll 
	put
	end 
	} def 
/FMFILLS {
	FrameDict begin dup
	array /fillvals exch def
	dict /patCache exch def
	end 
	} def 
/FMFILL {
	FrameDict begin
	 fillvals 3 1 roll put
	end 
	} def 
/FMNORMALIZEGRAPHICS { 
	newpath
	1 setlinewidth
	0 setlinecap
	0 0 0 sethsbcolor
	0 setgray 
	} bind def
/FMBEGINEPSF { 
	end 
	/FMEPSF save def 
	/showpage {} def 
% See Adobe's "PostScript Language Reference Manual, 2nd Edition", page 714.
% "...the following operators MUST NOT be used in an EPS file:" (emphasis ours)
	/banddevice {(banddevice) FMBADEPSF} def
	/clear {(clear) FMBADEPSF} def
	/cleardictstack {(cleardictstack) FMBADEPSF} def 
	/copypage {(copypage) FMBADEPSF} def
	/erasepage {(erasepage) FMBADEPSF} def
	/exitserver {(exitserver) FMBADEPSF} def
	/framedevice {(framedevice) FMBADEPSF} def
	/grestoreall {(grestoreall) FMBADEPSF} def
	/initclip {(initclip) FMBADEPSF} def
	/initgraphics {(initgraphics) FMBADEPSF} def
	/quit {(quit) FMBADEPSF} def
	/renderbands {(renderbands) FMBADEPSF} def
	/setglobal {(setglobal) FMBADEPSF} def
	/setpagedevice {(setpagedevice) FMBADEPSF} def
	/setshared {(setshared) FMBADEPSF} def
	/startjob {(startjob) FMBADEPSF} def
	/lettertray {(lettertray) FMBADEPSF} def
	/letter {(letter) FMBADEPSF} def
	/lettersmall {(lettersmall) FMBADEPSF} def
	/11x17tray {(11x17tray) FMBADEPSF} def
	/11x17 {(11x17) FMBADEPSF} def
	/ledgertray {(ledgertray) FMBADEPSF} def
	/ledger {(ledger) FMBADEPSF} def
	/legaltray {(legaltray) FMBADEPSF} def
	/legal {(legal) FMBADEPSF} def
	/statementtray {(statementtray) FMBADEPSF} def
	/statement {(statement) FMBADEPSF} def
	/executivetray {(executivetray) FMBADEPSF} def
	/executive {(executive) FMBADEPSF} def
	/a3tray {(a3tray) FMBADEPSF} def
	/a3 {(a3) FMBADEPSF} def
	/a4tray {(a4tray) FMBADEPSF} def
	/a4 {(a4) FMBADEPSF} def
	/a4small {(a4small) FMBADEPSF} def
	/b4tray {(b4tray) FMBADEPSF} def
	/b4 {(b4) FMBADEPSF} def
	/b5tray {(b5tray) FMBADEPSF} def
	/b5 {(b5) FMBADEPSF} def
	FMNORMALIZEGRAPHICS 
	[/fy /fx /fh /fw /ury /urx /lly /llx] {exch def} forall 
	fx fw 2 div add fy fh 2 div add  translate
	rotate
	fw 2 div neg fh 2 div neg translate
	fw urx llx sub div fh ury lly sub div scale 
	llx neg lly neg translate 
	/FMdicttop countdictstack 1 add def 
	/FMoptop count def 
	} bind def
/FMENDEPSF {
	count -1 FMoptop {pop pop} for 
	countdictstack -1 FMdicttop {pop end} for 
	FMEPSF restore
	FrameDict begin 
	} bind def
FrameDict begin 
/setmanualfeed {
%%BeginFeature *ManualFeed True
	 statusdict /manualfeed true put
%%EndFeature
	} bind def
/max {2 copy lt {exch} if pop} bind def
/min {2 copy gt {exch} if pop} bind def
/inch {72 mul} def
/pagedimen { 
	paperheight sub abs 16 lt exch 
	paperwidth sub abs 16 lt and
	{/papername exch def} {pop} ifelse
	} bind def
/setpapername { 
	/papersizedict 14 dict def 
	papersizedict begin
	/papername /unknown def 
		/Letter 8.5 inch 11.0 inch pagedimen
		/LetterSmall 7.68 inch 10.16 inch pagedimen
		/Tabloid 11.0 inch 17.0 inch pagedimen
		/Ledger 17.0 inch 11.0 inch pagedimen
		/Legal 8.5 inch 14.0 inch pagedimen
		/Statement 5.5 inch 8.5 inch pagedimen
		/Executive 7.5 inch 10.0 inch pagedimen
		/A3 11.69 inch 16.5 inch pagedimen
		/A4 8.26 inch 11.69 inch pagedimen
		/A4Small 7.47 inch 10.85 inch pagedimen
		/B4 10.125 inch 14.33 inch pagedimen
		/B5 7.16 inch 10.125 inch pagedimen
	end
	} bind def
/papersize {
	papersizedict begin
		/Letter {lettertray letter} def
		/LetterSmall {lettertray lettersmall} def
		/Tabloid {11x17tray 11x17} def
		/Ledger {ledgertray ledger} def
		/Legal {legaltray legal} def
		/Statement {statementtray statement} def
		/Executive {executivetray executive} def
		/A3 {a3tray a3} def
		/A4 {a4tray a4} def
		/A4Small {a4tray a4small} def
		/B4 {b4tray b4} def
		/B5 {b5tray b5} def
		/unknown {unknown} def
	papersizedict dup papername known {papername} {/unknown} ifelse get
	end
	statusdict begin stopped end 
	} bind def
/manualpapersize {
	papersizedict begin
		/Letter {letter} def
		/LetterSmall {lettersmall} def
		/Tabloid {11x17} def
		/Ledger {ledger} def
		/Legal {legal} def
		/Statement {statement} def
		/Executive {executive} def
		/A3 {a3} def
		/A4 {a4} def
		/A4Small {a4small} def
		/B4 {b4} def
		/B5 {b5} def
		/unknown {unknown} def
	papersizedict dup papername known {papername} {/unknown} ifelse get
	end
	stopped 
	} bind def
/desperatepapersize {
	statusdict /setpageparams known
		{
		paperwidth paperheight 0 1 
		statusdict begin
		{setpageparams} stopped 
		end
		} {true} ifelse 
	} bind def
/papersizefailure {
	FMAllowPaperSizeMismatch not
		{
(The requested paper size is not available in any currently-installed tray)
(Edit the PS file to "FMAllowPaperSizeMismatch true" to use default tray)
		 FMFAILURE } if
	} def
/DiacriticEncoding [
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /space /exclam /quotedbl
/numbersign /dollar /percent /ampersand /quotesingle /parenleft
/parenright /asterisk /plus /comma /hyphen /period /slash /zero /one
/two /three /four /five /six /seven /eight /nine /colon /semicolon
/less /equal /greater /question /at /A /B /C /D /E /F /G /H /I /J /K
/L /M /N /O /P /Q /R /S /T /U /V /W /X /Y /Z /bracketleft /backslash
/bracketright /asciicircum /underscore /grave /a /b /c /d /e /f /g /h
/i /j /k /l /m /n /o /p /q /r /s /t /u /v /w /x /y /z /braceleft /bar
/braceright /asciitilde /.notdef /Adieresis /Aring /Ccedilla /Eacute
/Ntilde /Odieresis /Udieresis /aacute /agrave /acircumflex /adieresis
/atilde /aring /ccedilla /eacute /egrave /ecircumflex /edieresis
/iacute /igrave /icircumflex /idieresis /ntilde /oacute /ograve
/ocircumflex /odieresis /otilde /uacute /ugrave /ucircumflex
/udieresis /dagger /.notdef /cent /sterling /section /bullet
/paragraph /germandbls /registered /copyright /trademark /acute
/dieresis /.notdef /AE /Oslash /.notdef /.notdef /.notdef /.notdef
/yen /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/ordfeminine /ordmasculine /.notdef /ae /oslash /questiondown
/exclamdown /logicalnot /.notdef /florin /.notdef /.notdef
/guillemotleft /guillemotright /ellipsis /.notdef /Agrave /Atilde
/Otilde /OE /oe /endash /emdash /quotedblleft /quotedblright
/quoteleft /quoteright /.notdef /.notdef /ydieresis /Ydieresis
/fraction /currency /guilsinglleft /guilsinglright /fi /fl /daggerdbl
/periodcentered /quotesinglbase /quotedblbase /perthousand
/Acircumflex /Ecircumflex /Aacute /Edieresis /Egrave /Iacute
/Icircumflex /Idieresis /Igrave /Oacute /Ocircumflex /.notdef /Ograve
/Uacute /Ucircumflex /Ugrave /dotlessi /circumflex /tilde /macron
/breve /dotaccent /ring /cedilla /hungarumlaut /ogonek /caron
] def
/ReEncode { 
	dup 
	length 
	dict begin 
	{
	1 index /FID ne 
		{def} 
		{pop pop} ifelse 
	} forall 
	0 eq {/Encoding DiacriticEncoding def} if 
	currentdict 
	end 
	} bind def
FMPColor 
	
	{
	/BEGINBITMAPCOLOR { 
		BITMAPCOLOR} def
	/BEGINBITMAPCOLORc { 
		BITMAPCOLORc} def
	/BEGINBITMAPTRUECOLOR { 
		BITMAPTRUECOLOR } def
	/BEGINBITMAPTRUECOLORc { 
		BITMAPTRUECOLORc } def
	/BEGINBITMAPCMYK { 
		BITMAPCMYK } def
	/BEGINBITMAPCMYKc { 
		BITMAPCMYKc } def
	}
	
	{
	/BEGINBITMAPCOLOR { 
		BITMAPGRAY} def
	/BEGINBITMAPCOLORc { 
		BITMAPGRAYc} def
	/BEGINBITMAPTRUECOLOR { 
		BITMAPTRUEGRAY } def
	/BEGINBITMAPTRUECOLORc { 
		BITMAPTRUEGRAYc } def
	/BEGINBITMAPCMYK { 
		BITMAPCMYKGRAY } def
	/BEGINBITMAPCMYKc { 
		BITMAPCMYKGRAYc } def
	}
ifelse
/K { 
	FMPrintAllColorsAsBlack {
		dup 1 eq 2 index 1 eq and 3 index 1 eq and not
			{7 {pop} repeat 0 0 0 1 0 0 0} if
	} if 
	FrameCurColors astore 
	pop combineColor
} bind def
/graymode true def
fMLevel1 {
	/fmGetFlip {
		fMatrix2 exch get mul 0 lt { -1 } { 1 } ifelse
	} FmBD
} if
/setPatternMode {
	fMLevel1 {
		2 index patScreenDict exch known {
			pop pop
			patScreenDict exch get aload pop 
			freq 								
			mul									
			5 2 roll							
			fMatrix2 currentmatrix 1 get 0 ne {
				3 -1 roll 90 add 3 1 roll 		
				sflipx 1 fmGetFlip sflipy 2 fmGetFlip neg mul
			} {  								
				sflipx 0 fmGetFlip sflipy 3 fmGetFlip mul 
			} ifelse
			0 lt {exch pop} {pop} ifelse 		
			fMNegative { 
				{neg} fmConcatProcs 			
			} if
			bind
			
			
			
			systemdict /setscreen get exec		
			/FrameCurGray exch def
		} {
			/bwidth  exch def
			/bpside  exch def
			/bstring exch def
			/onbits 0 def  /offbits 0 def
			freq sangle landscape {90 add} if 
				{/ypoint exch def
				 /xpoint exch def
				 /xindex xpoint 1 add 2 div bpside mul cvi def
				 /yindex ypoint 1 add 2 div bpside mul cvi def
				 bstring yindex bwidth mul xindex 8 idiv add get
				 1 7 xindex 8 mod sub bitshift and 0 ne fMNegative {not} if
				 {/onbits  onbits  1 add def 1}
				 {/offbits offbits 1 add def 0}
				 ifelse
				}
				setscreen
			offbits offbits onbits add div fMNegative {1.0 exch sub} if
			/FrameCurGray exch def
		} ifelse
	} { 
		pop pop
		dup patCache exch known {
			patCache exch get
		} { 
			dup
			patDict /bstring 3 -1 roll put
			patDict 
			9 PatFreq screenIndex get div dup matrix scale
			makepattern
			dup 
			patCache 4 -1 roll 3 -1 roll put
		} ifelse
		/FrameCurGray 0 def
		/FrameCurPat exch def
	} ifelse
	/graymode false def
	combineColor
} bind def
/setGrayScaleMode {
	graymode not {
		/graymode true def
		fMLevel1 {
			setCurrentScreen
		} if
	} if
	/FrameCurGray exch def
	combineColor
} bind def
/normalize {
	transform round exch round exch itransform
	} bind def
/dnormalize {
	dtransform round exch round exch idtransform
	} bind def
/lnormalize { 
	0 dtransform exch cvi 2 idiv 2 mul 1 add exch idtransform pop
	} bind def
/H { 
	lnormalize setlinewidth
	} bind def
/Z {
	setlinecap
	} bind def
	
/PFill {
	graymode fMLevel1 or not {
		gsave 1 setgray eofill grestore
	} if
} bind def
/PStroke {
	graymode fMLevel1 or not {
		gsave 1 setgray stroke grestore
	} if
	stroke
} bind def
/X { 
	fillvals exch get
	dup type /stringtype eq
	{8 1 setPatternMode} 
	{setGrayScaleMode}
	ifelse
	} bind def
/V { 
	PFill gsave eofill grestore
	} bind def
/Vclip {
	clip
	} bind def
/Vstrk {
	currentlinewidth exch setlinewidth PStroke setlinewidth
	} bind def
/N { 
	PStroke
	} bind def
/Nclip {
	strokepath clip newpath
	} bind def
/Nstrk {
	currentlinewidth exch setlinewidth PStroke setlinewidth
	} bind def
/M {newpath moveto} bind def
/E {lineto} bind def
/D {curveto} bind def
/O {closepath} bind def
/L { 
 	/n exch def
	newpath
	normalize
	moveto 
	2 1 n {pop normalize lineto} for
	} bind def
/Y { 
	L 
	closepath
	} bind def
/R { 
	/y2 exch def
	/x2 exch def
	/y1 exch def
	/x1 exch def
	x1 y1
	x2 y1
	x2 y2
	x1 y2
	4 Y 
	} bind def
/rarc 
	{rad 
	 arcto
	} bind def
/RR { 
	/rad exch def
	normalize
	/y2 exch def
	/x2 exch def
	normalize
	/y1 exch def
	/x1 exch def
	mark
	newpath
	{
	x1 y1 rad add moveto
	x1 y2 x2 y2 rarc
	x2 y2 x2 y1 rarc
	x2 y1 x1 y1 rarc
	x1 y1 x1 y2 rarc
	closepath
	} stopped {x1 y1 x2 y2 R} if 
	cleartomark
	} bind def
/RRR { 
	/rad exch def
	normalize /y4 exch def /x4 exch def
	normalize /y3 exch def /x3 exch def
	normalize /y2 exch def /x2 exch def
	normalize /y1 exch def /x1 exch def
	newpath
	normalize moveto 
	mark
	{
	x2 y2 x3 y3 rarc
	x3 y3 x4 y4 rarc
	x4 y4 x1 y1 rarc
	x1 y1 x2 y2 rarc
	closepath
	} stopped
	 {x1 y1 x2 y2 x3 y3 x4 y4 newpath moveto lineto lineto lineto closepath} if
	cleartomark
	} bind def
/C { 
	grestore
	gsave
	R 
	clip
	setCurrentScreen
} bind def
/CP { 
	grestore
	gsave
	Y 
	clip
	setCurrentScreen
} bind def
/F { 
	FMfonts exch get
	FMpointsize scalefont
	setfont
	} bind def
/Q { 
	/FMpointsize exch def
	F 
	} bind def
/T { 
	moveto show
	} bind def
/RF { 
	rotate
	0 ne {-1 1 scale} if
	} bind def
/TF { 
	gsave
	moveto 
	RF
	show
	grestore
	} bind def
/P { 
	moveto
	0 32 3 2 roll widthshow
	} bind def
/PF { 
	gsave
	moveto 
	RF
	0 32 3 2 roll widthshow
	grestore
	} bind def
/S { 
	moveto
	0 exch ashow
	} bind def
/SF { 
	gsave
	moveto
	RF
	0 exch ashow
	grestore
	} bind def
/B { 
	moveto
	0 32 4 2 roll 0 exch awidthshow
	} bind def
/BF { 
	gsave
	moveto
	RF
	0 32 4 2 roll 0 exch awidthshow
	grestore
	} bind def
/G { 
	gsave
	newpath
	normalize translate 0.0 0.0 moveto 
	dnormalize scale 
	0.0 0.0 1.0 5 3 roll arc 
	closepath 
	PFill fill
	grestore
	} bind def
/Gstrk {
	savematrix
    newpath
    2 index 2 div add exch 3 index 2 div sub exch 
    normalize 2 index 2 div sub exch 3 index 2 div add exch 
    translate
    scale 
    0.0 0.0 1.0 5 3 roll arc 
    restorematrix
    currentlinewidth exch setlinewidth PStroke setlinewidth
    } bind def
/Gclip { 
	newpath
	savematrix
	normalize translate 0.0 0.0 moveto 
	dnormalize scale 
	0.0 0.0 1.0 5 3 roll arc 
	closepath 
	clip newpath
	restorematrix
	} bind def
/GG { 
	gsave
	newpath
	normalize translate 0.0 0.0 moveto 
	rotate 
	dnormalize scale 
	0.0 0.0 1.0 5 3 roll arc 
	closepath
	PFill
	fill
	grestore
	} bind def
/GGclip { 
	savematrix
	newpath
    normalize translate 0.0 0.0 moveto 
    rotate 
    dnormalize scale 
    0.0 0.0 1.0 5 3 roll arc 
    closepath
	clip newpath
	restorematrix
	} bind def
/GGstrk { 
	savematrix
    newpath
    normalize translate 0.0 0.0 moveto 
    rotate 
    dnormalize scale 
    0.0 0.0 1.0 5 3 roll arc 
    closepath 
	restorematrix
    currentlinewidth exch setlinewidth PStroke setlinewidth
	} bind def
/A { 
	gsave
	savematrix
	newpath
	2 index 2 div add exch 3 index 2 div sub exch 
	normalize 2 index 2 div sub exch 3 index 2 div add exch 
	translate 
	scale 
	0.0 0.0 1.0 5 3 roll arc 
	restorematrix
	PStroke
	grestore
	} bind def
/Aclip {
	newpath
	savematrix
	normalize translate 0.0 0.0 moveto 
	dnormalize scale 
	0.0 0.0 1.0 5 3 roll arc 
	closepath 
	strokepath clip newpath
	restorematrix
} bind def
/Astrk {
	Gstrk
} bind def
/AA { 
	gsave
	savematrix
	newpath
	
	3 index 2 div add exch 4 index 2 div sub exch 
	
	normalize 3 index 2 div sub exch 4 index 2 div add exch
	translate 
	rotate 
	scale 
	0.0 0.0 1.0 5 3 roll arc 
	restorematrix
	PStroke
	grestore
	} bind def
/AAclip {
	savematrix
	newpath
    normalize translate 0.0 0.0 moveto 
    rotate 
    dnormalize scale 
    0.0 0.0 1.0 5 3 roll arc 
    closepath
	strokepath clip newpath
	restorematrix
} bind def
/AAstrk {
	GGstrk
} bind def
/BEGINPRINTCODE { 
	/FMdicttop countdictstack 1 add def 
	/FMoptop count 7 sub def 
	/FMsaveobject save def
	userdict begin 
	/showpage {} def 
	FMNORMALIZEGRAPHICS 
	3 index neg 3 index neg translate
	} bind def
/ENDPRINTCODE {
	count -1 FMoptop {pop pop} for 
	countdictstack -1 FMdicttop {pop end} for 
	FMsaveobject restore 
	} bind def
/gn { 
	0 
	{	46 mul 
		cf read pop 
		32 sub 
		dup 46 lt {exit} if 
		46 sub add 
		} loop
	add 
	} bind def
/cfs { 
	/str sl string def 
	0 1 sl 1 sub {str exch val put} for 
	str def 
	} bind def
/ic [ 
	0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0223
	0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0223
	0
	{0 hx} {1 hx} {2 hx} {3 hx} {4 hx} {5 hx} {6 hx} {7 hx} {8 hx} {9 hx}
	{10 hx} {11 hx} {12 hx} {13 hx} {14 hx} {15 hx} {16 hx} {17 hx} {18 hx}
	{19 hx} {gn hx} {0} {1} {2} {3} {4} {5} {6} {7} {8} {9} {10} {11} {12}
	{13} {14} {15} {16} {17} {18} {19} {gn} {0 wh} {1 wh} {2 wh} {3 wh}
	{4 wh} {5 wh} {6 wh} {7 wh} {8 wh} {9 wh} {10 wh} {11 wh} {12 wh}
	{13 wh} {14 wh} {gn wh} {0 bl} {1 bl} {2 bl} {3 bl} {4 bl} {5 bl} {6 bl}
	{7 bl} {8 bl} {9 bl} {10 bl} {11 bl} {12 bl} {13 bl} {14 bl} {gn bl}
	{0 fl} {1 fl} {2 fl} {3 fl} {4 fl} {5 fl} {6 fl} {7 fl} {8 fl} {9 fl}
	{10 fl} {11 fl} {12 fl} {13 fl} {14 fl} {gn fl}
	] def
/ms { 
	/sl exch def 
	/val 255 def 
	/ws cfs 
	/im cfs 
	/val 0 def 
	/bs cfs 
	/cs cfs 
	} bind def
400 ms 
/ip { 
	is 
	0 
	cf cs readline pop 
	{	ic exch get exec 
		add 
		} forall 
	pop 
	
	} bind def
/rip { 
	   
	  
	  bis ris copy pop 
      is
      0
      cf cs readline pop 
      {       ic exch get exec 
              add 
              } forall 
	  pop pop 
	  ris gis copy pop 
	  dup is exch 
	  
      cf cs readline pop 
      {       ic exch get exec 
              add 
              } forall 
	  pop pop
	  gis bis copy pop 
	  dup add is exch 
	  
      cf cs readline pop 
      {       ic exch get exec 
              add 
              } forall 
      pop 
      
      } bind def
/rip4 { 
	   
	  
	  kis cis copy pop 
      is
      0
      cf cs readline pop 
      {       ic exch get exec 
              add 
              } forall 
	  pop pop 
	  cis mis copy pop 
	  dup is exch 
	  
      cf cs readline pop 
      {       ic exch get exec 
              add 
              } forall 
	  pop pop
	  mis yis copy pop 
	  dup dup add is exch 
	  
      cf cs readline pop 
      {       ic exch get exec 
              add 
              } forall 
	  pop pop
	  yis kis copy pop 
	  3 mul is exch 
	  
      cf cs readline pop 
      {       ic exch get exec 
              add 
              } forall 
      pop 
      
      } bind def
/wh { 
	/len exch def 
	/pos exch def 
	ws 0 len getinterval im pos len getinterval copy pop
	pos len 
	} bind def
/bl { 
	/len exch def 
	/pos exch def 
	bs 0 len getinterval im pos len getinterval copy pop
	pos len 
	} bind def
/s1 1 string def
/fl { 
	/len exch def 
	/pos exch def 
	/val cf s1 readhexstring pop 0 get def
	pos 1 pos len add 1 sub {im exch val put} for
	pos len 
	} bind def
/hx { 
	3 copy getinterval 
	cf exch readhexstring pop pop 
	} bind def
/wbytes { 
      dup dup
      8 gt { pop 8 idiv mul }
      { 8 eq {pop} {1 eq {7 add 8 idiv} {3 add 4 idiv} ifelse} ifelse } ifelse
	} bind def
/BEGINBITMAPBWc { 
	1 {} COMMONBITMAPc
	} bind def
/BEGINBITMAPGRAYc { 
	8 {} COMMONBITMAPc
	} bind def
/BEGINBITMAP2BITc { 
	2 {} COMMONBITMAPc
	} bind def
/COMMONBITMAPc { 
		 
	/cvtProc exch def
	/depth exch def
	gsave
	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/lb width depth wbytes def 
	sl lb lt {lb ms} if 
	/bitmapsave save def 
	cvtProc                
	/is im 0 lb getinterval def 
	ws 0 lb getinterval is copy pop 
	/cf currentfile def 
	width height depth [width 0 0 height neg 0 height] 
	{ip} image 
	bitmapsave restore 
	grestore
	} bind def
/BEGINBITMAPBW { 
	1 {} COMMONBITMAP
	} bind def
/BEGINBITMAPGRAY { 
	8 {} COMMONBITMAP
	} bind def
/BEGINBITMAP2BIT { 
	2 {} COMMONBITMAP
	} bind def
/COMMONBITMAP { 
	/cvtProc exch def
	/depth exch def
	gsave
	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/bitmapsave save def 
	cvtProc              
	/is width depth wbytes string def
	/cf currentfile def 
	width height depth [width 0 0 height neg 0 height] 
	{cf is readhexstring pop} image
	bitmapsave restore 
	grestore
	} bind def
/ngrayt 256 array def
/nredt 256 array def
/nbluet 256 array def
/ngreent 256 array def
fMLevel1 {
/colorsetup {
	currentcolortransfer
	/gryt exch def
	/blut exch def
	/grnt exch def
	/redt exch def
	0 1 255 {
		/indx exch def
		/cynu 1 red indx get 255 div sub def
		/magu 1 green indx get 255 div sub def
		/yelu 1 blue indx get 255 div sub def
		/kk cynu magu min yelu min def
		/u kk currentundercolorremoval exec def
%		/u 0 def
		nredt indx 1 0 cynu u sub max sub redt exec put
		ngreent indx 1 0 magu u sub max sub grnt exec put
		nbluet indx 1 0 yelu u sub max sub blut exec put
		ngrayt indx 1 kk currentblackgeneration exec sub gryt exec put
	} for
	{255 mul cvi nredt exch get}
	{255 mul cvi ngreent exch get}
	{255 mul cvi nbluet exch get}
	{255 mul cvi ngrayt exch get}
	setcolortransfer
	{pop 0} setundercolorremoval
	{} setblackgeneration
	} bind def
}
{
/colorSetup2 {
	[ /Indexed /DeviceRGB 255 
		{dup red exch get 255 div 
		 exch dup green exch get 255 div 
		 exch blue exch get 255 div}
	] setcolorspace
} bind def
} ifelse
/fakecolorsetup {
	/tran 256 string def
	0 1 255 {/indx exch def 
		tran indx
		red indx get 77 mul
		green indx get 151 mul
		blue indx get 28 mul
		add add 256 idiv put} for
	currenttransfer
	{255 mul cvi tran exch get 255.0 div}
	exch fmConcatProcs settransfer
} bind def
/BITMAPCOLOR { 
	/depth 8 def
	gsave
	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/bitmapsave save def
	fMLevel1 {	
		colorsetup
		/is width depth wbytes string def
		/cf currentfile def 
		width height depth [width 0 0 height neg 0 height] 
		{cf is readhexstring pop} {is} {is} true 3 colorimage 
	} {
		colorSetup2
		/is width depth wbytes string def
		/cf currentfile def 
		7 dict dup begin
			/ImageType 1 def
			/Width width def
			/Height height def
			/ImageMatrix [width 0 0 height neg 0 height] def
			/DataSource {cf is readhexstring pop} bind def
			/BitsPerComponent depth def
			/Decode [0 255] def
		end image	
	} ifelse
	bitmapsave restore 
	grestore
	} bind def
/BITMAPCOLORc { 
	/depth 8 def
	gsave
	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/lb width depth wbytes def 
	sl lb lt {lb ms} if 
	/bitmapsave save def 
	fMLevel1 {	
		colorsetup
		/is im 0 lb getinterval def 
		ws 0 lb getinterval is copy pop 
		/cf currentfile def 
		width height depth [width 0 0 height neg 0 height] 
		{ip} {is} {is} true 3 colorimage
	} {
		colorSetup2
		/is im 0 lb getinterval def 
		ws 0 lb getinterval is copy pop 
		/cf currentfile def 
		7 dict dup begin
			/ImageType 1 def
			/Width width def
			/Height height def
			/ImageMatrix [width 0 0 height neg 0 height] def
			/DataSource {ip} bind def
			/BitsPerComponent depth def
			/Decode [0 255] def
		end image	
	} ifelse
	bitmapsave restore 
	grestore
	} bind def
/BITMAPTRUECOLORc { 
	/depth 24 def
        gsave
 	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/lb width depth wbytes def 
	sl lb lt {lb ms} if 
	/bitmapsave save def 
        
	/is im 0 lb getinterval def	
	/ris im 0 width getinterval def	
	/gis im width width getinterval def	
	/bis im width 2 mul width getinterval def 
        
	ws 0 lb getinterval is copy pop 
	/cf currentfile def 
	width height 8 [width 0 0 height neg 0 height] 
	{width rip pop ris} {gis} {bis} true 3 colorimage
	bitmapsave restore 
	grestore
	} bind def
/BITMAPCMYKc { 
	/depth 32 def
        gsave
 	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/lb width depth wbytes def 
	sl lb lt {lb ms} if 
	/bitmapsave save def 
        
	/is im 0 lb getinterval def	
	/cis im 0 width getinterval def	
	/mis im width width getinterval def	
	/yis im width 2 mul width getinterval def 
	/kis im width 3 mul width getinterval def 
        
	ws 0 lb getinterval is copy pop 
	/cf currentfile def 
	width height 8 [width 0 0 height neg 0 height] 
	{width rip4 pop cis} {mis} {yis} {kis} true 4 colorimage
	bitmapsave restore 
	grestore
	} bind def
/BITMAPTRUECOLOR { 
        gsave
		
		3 index 2 div add exch	
		4 index 2 div add exch	
		translate		
		rotate			
		1 index 2 div neg	
		1 index 2 div neg	
		translate		
		scale			
		/height exch def /width exch def
        /bitmapsave save def 
        /is width string def
        /gis width string def
        /bis width string def
        /cf currentfile def 
        width height 8 [width 0 0 height neg 0 height] 
        { cf is readhexstring pop } 
        { cf gis readhexstring pop } 
        { cf bis readhexstring pop } 
        true 3 colorimage 
        bitmapsave restore 
        grestore
        } bind def
/BITMAPCMYK { 
        gsave
		
		3 index 2 div add exch	
		4 index 2 div add exch	
		translate		
		rotate			
		1 index 2 div neg	
		1 index 2 div neg	
		translate		
		scale			
		/height exch def /width exch def
        /bitmapsave save def 
        /is width string def
        /mis width string def
        /yis width string def
        /kis width string def
        /cf currentfile def 
        width height 8 [width 0 0 height neg 0 height] 
        { cf is readhexstring pop } 
        { cf mis readhexstring pop } 
        { cf yis readhexstring pop } 
        { cf kis readhexstring pop } 
        true 4 colorimage 
        bitmapsave restore 
        grestore
        } bind def
/BITMAPTRUEGRAYc { 
	/depth 24 def
        gsave
	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/lb width depth wbytes def 
	sl lb lt {lb ms} if 
        /bitmapsave save def 
        
	/is im 0 lb getinterval def	
	/ris im 0 width getinterval def	
	/gis im width width getinterval def	
	/bis im width 2 mul width getinterval def 
        ws 0 lb getinterval is copy pop 
        /cf currentfile def 
        width height 8 [width 0 0 height neg 0 height] 
        {width rip pop ris gis bis width gray} image
        bitmapsave restore 
        grestore
        } bind def
/BITMAPCMYKGRAYc { 
	/depth 32 def
        gsave
	
	3 index 2 div add exch	
	4 index 2 div add exch	
	translate		
	rotate			
	1 index 2 div neg	
	1 index 2 div neg	
	translate		
	scale			
	/height exch def /width exch def
	/lb width depth wbytes def 
	sl lb lt {lb ms} if 
        /bitmapsave save def 
        
	/is im 0 lb getinterval def	
	/cis im 0 width getinterval def	
	/mis im width width getinterval def	
	/yis im width 2 mul width getinterval def 
	/kis im width 3 mul width getinterval def 
        ws 0 lb getinterval is copy pop 
        /cf currentfile def 
        width height 8 [width 0 0 height neg 0 height] 
        {width rip pop cis mis yis kis width cgray} image
        bitmapsave restore 
        grestore
        } bind def
/cgray { 
        /ww exch def
        /k exch def
        /y exch def
        /m exch def
        /c exch def
        0 1 ww 1 sub { /i exch def c i get m i get y i get k i get CMYKtoRGB
				.144 mul 3 1 roll .587 mul 3 1 roll .299 mul add add
				c i 3 -1 roll floor cvi put } for
        c
 		} bind def
/gray { 
        /ww exch def
        /b exch def
        /g exch def
        /r exch def
        0 1 ww 1 sub { /i exch def r i get .299 mul g i get .587 mul
			b i get .114 mul add add r i 3 -1 roll floor cvi put } for
        r
        } bind def
/BITMAPTRUEGRAY { 
        gsave
		
		3 index 2 div add exch	
		4 index 2 div add exch	
		translate		
		rotate			
		1 index 2 div neg	
		1 index 2 div neg	
		translate		
		scale			
		/height exch def /width exch def
        /bitmapsave save def 
        /is width string def
        /gis width string def
        /bis width string def
        /cf currentfile def 
        width height 8 [width 0 0 height neg 0 height] 
        { cf is readhexstring pop 
          cf gis readhexstring pop 
          cf bis readhexstring pop width gray}  image
        bitmapsave restore 
        grestore
        } bind def
/BITMAPCMYKGRAY { 
        gsave
		
		3 index 2 div add exch	
		4 index 2 div add exch	
		translate		
		rotate			
		1 index 2 div neg	
		1 index 2 div neg	
		translate		
		scale			
		/height exch def /width exch def
        /bitmapsave save def 
        /is width string def
        /yis width string def
        /mis width string def
        /kis width string def
        /cf currentfile def 
        width height 8 [width 0 0 height neg 0 height] 
        { cf is readhexstring pop 
          cf mis readhexstring pop 
          cf yis readhexstring pop 
          cf kis readhexstring pop width cgray}  image
        bitmapsave restore 
        grestore
        } bind def
/BITMAPGRAY { 
	8 {fakecolorsetup} COMMONBITMAP
	} bind def
/BITMAPGRAYc { 
	8 {fakecolorsetup} COMMONBITMAPc
	} bind def
/ENDBITMAP {
	} bind def
end 
	/ALDmatrix matrix def ALDmatrix currentmatrix pop
/StartALD {
	/ALDsave save def
	 savematrix
	 ALDmatrix setmatrix
	} bind def
/InALD {
	 restorematrix
	} bind def
/DoneALD {
	 ALDsave restore
	} bind def
/I { setdash } bind def
/J { [] 0 setdash } bind def
%%EndProlog
%%BeginSetup
(5.0) FMVERSION
1 1 0 0 612 792 0 1 19 FMDOCUMENT
0 0 /Times-Roman FMFONTDEFINE
1 0 /Palatino-Roman FMFONTDEFINE
2 0 /Helvetica-Bold FMFONTDEFINE
3 0 /Helvetica FMFONTDEFINE
4 0 /Courier-Bold FMFONTDEFINE
5 0 /Helvetica-BoldOblique FMFONTDEFINE
6 0 /Courier FMFONTDEFINE
32 FMFILLS
0 0 FMFILL
1 0.1 FMFILL
2 0.3 FMFILL
3 0.5 FMFILL
4 0.7 FMFILL
5 0.9 FMFILL
6 0.97 FMFILL
7 1 FMFILL
8 <0f1e3c78f0e1c387> FMFILL
9 <0f87c3e1f0783c1e> FMFILL
10 <cccccccccccccccc> FMFILL
11 <ffff0000ffff0000> FMFILL
12 <8142241818244281> FMFILL
13 <03060c183060c081> FMFILL
14 <8040201008040201> FMFILL
16 1 FMFILL
17 0.9 FMFILL
18 0.7 FMFILL
19 0.5 FMFILL
20 0.3 FMFILL
21 0.1 FMFILL
22 0.03 FMFILL
23 0 FMFILL
24 <f0e1c3870f1e3c78> FMFILL
25 <f0783c1e0f87c3e1> FMFILL
26 <3333333333333333> FMFILL
27 <0000ffff0000ffff> FMFILL
28 <7ebddbe7e7dbbd7e> FMFILL
29 <fcf9f3e7cf9f3f7e> FMFILL
30 <7fbfdfeff7fbfdfe> FMFILL
%%EndSetup
%%Page: "mini" 1
%%BeginPaperSize: Letter
%%EndPaperSize
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
0 0 0 1 0 0 0 K
J
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(1) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(POSIX) 176.48 532.45 T
(Example Code) 135.38 506.85 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(2) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(T) 493.18 686.11 T
(ab) 504.57 686.11 T
(le of Contents) 529.37 686.11 T
3 10.72 Q
(\322Creating & Joining Threads: m) 411.22 650.38 T
(ulti_thr) 559.47 650.38 T
(.c\323) 591.1 650.38 T
(4) 748.32 650.38 T
(\322Classic Producer/Consumer) 411.22 637.28 T
(: one_queue_prob) 548.55 637.28 T
(lem.c\323) 635.35 637.28 T
(10) 742.36 637.28 T
(\322Classic Producer/Consumer) 411.22 624.17 T
(: one_queue_solution.c\323) 548.55 624.17 T
(15) 742.36 624.17 T
(\322Using a Single Length Counter\323) 411.22 611.07 T
(19) 742.36 611.07 T
(\322Cancellation: cancellation.c\323) 411.22 597.97 T
(21) 742.36 597.97 T
(\322Threads and X11: ThreadWin.c\323) 411.22 584.87 T
(32) 742.36 584.87 T
(\322Link) 411.22 571.76 T
(ed Lists) 434.24 571.76 T
(, Global Mute) 471.02 571.76 T
(x: list_global_loc) 534.45 571.76 T
(k.c\323) 612.89 571.76 T
(37) 742.36 571.76 T
(\322Link) 411.22 558.66 T
(ed Lists) 434.24 558.66 T
(, Global R) 471.02 558.66 T
(WLoc) 518.36 558.66 T
(k+: list_global_rw2.c\323) 545.55 558.66 T
(45) 742.36 558.66 T
(\322Link) 411.22 545.56 T
(ed Lists) 434.24 545.56 T
(, 2 Local Mute) 471.02 545.56 T
(x) 538.03 545.56 T
(es: list_2local_loc) 543.07 545.56 T
(ks) 626.86 545.56 T
(.c\323) 637.42 545.56 T
(55) 742.36 545.56 T
(\322Stoppab) 411.22 532.45 T
(le Queue: stop_queue_prob) 454.51 532.45 T
(lem.c\323) 587.2 532.45 T
(65) 742.36 532.45 T
(\322Stoppab) 411.22 519.35 T
(le Queue: stop_queue_solution.c\323) 454.51 519.35 T
(70) 742.36 519.35 T
(\322Threads and Soc) 411.22 506.25 T
(k) 496.21 506.25 T
(ets: client.c\323) 501.36 506.25 T
(76) 742.36 506.25 T
(\322T&S: No Threads: ser) 411.22 493.15 T
(v) 518.78 493.15 T
(er) 523.87 493.15 T
(.c\323) 532.87 493.15 T
(81) 742.36 493.15 T
(\322T&S: Producer/Consumer) 411.22 480.04 T
(: ser) 537.84 480.04 T
(v) 559.02 480.04 T
(er_pc.c\323) 564.11 480.04 T
(95) 742.36 480.04 T
(\322Rob) 411.22 466.94 T
(ust Ser) 434.24 466.94 T
(v) 468.52 466.94 T
(er Using select\050\051: ser) 473.62 466.94 T
(v) 572.82 466.94 T
(er_select.c\323) 577.91 466.94 T
(107) 736.4 466.94 T
(\322Creating Thread-Local Signals:callout_tests) 411.22 453.84 T
(.c\323) 621.98 453.84 T
(125) 736.4 453.84 T
(\322Creating Thread-Local Signals: callout.c \050libr) 411.22 440.74 T
(ar) 625.59 440.74 T
(y\051\323) 635.44 440.74 T
(129) 736.4 440.74 T
(\322P) 411.22 427.63 T
(assing Shared Data: matr) 421.51 427.63 T
(ix_prob) 543.22 427.63 T
(lem.c\323) 578.16 427.63 T
(135) 736.4 427.63 T
(\322P) 411.22 414.53 T
(assing Stac) 421.51 414.53 T
(k Data: matr) 476.71 414.53 T
(ix_solution.c\323) 535.26 414.53 T
(139) 736.4 414.53 T
(\322T) 411.22 401.43 T
(esting Recursiv) 420.06 401.43 T
(e Mute) 493.06 401.43 T
(x) 525.51 401.43 T
(es: test_recursiv) 530.55 401.43 T
(e_m) 608.33 401.43 T
(ute) 629.07 401.43 T
(x.c\323) 643.65 401.43 T
(148) 736.4 401.43 T
(\322Bil\325) 411.22 388.33 T
(s Extensions \050Libr) 428.55 388.33 T
(ar) 513.64 388.33 T
(y\051: thread_e) 523.49 388.33 T
(xtensions) 580.37 388.33 T
(.h\323) 625.49 388.33 T
(150) 736.4 388.33 T
(\322Bil\325) 411.22 375.22 T
(s Extensions \050Libr) 428.55 375.22 T
(ar) 513.64 375.22 T
(y\051: thread_e) 523.49 375.22 T
(xtensions) 580.37 375.22 T
(.c\323) 625.49 375.22 T
(157) 736.4 375.22 T
(\322Misusing the Cache: cache_thr) 411.22 362.12 T
(ash.c\323) 561.86 362.12 T
(185) 736.4 362.12 T
(\322Misusing the Cache: f) 411.22 349.02 T
(alse_shar) 517.55 349.02 T
(ing.c\323) 564.18 349.02 T
(187) 736.4 349.02 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 1
%%Page: "mini" 2
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(3) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
37.72 287.67 380.78 700.41 C
37.72 338.2 357.42 696.24 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
153.41 400.77 157.06 465.12 R
0 X
0 0 0 1 0 0 0 K
V
0.3 H
2 Z
N
273.74 417.09 277.38 590.79 R
V
N
243.73 546.16 247.37 572.78 R
V
N
289.42 610.48 289.42 612.25 295.61 610.48 289.42 608.71 4 Y
0 Z
N
289.42 610.48 289.42 612.25 295.61 610.48 289.42 608.71 4 Y
V
289.28 610.48 271.54 610.48 2 L
2 Z
N
263.2 631.92 263.2 633.69 269.38 631.92 263.2 630.15 4 Y
0 Z
N
263.2 631.92 263.2 633.69 269.38 631.92 263.2 630.15 4 Y
V
263.05 631.92 245.32 631.92 2 L
2 Z
N
232.74 653.79 232.74 655.56 238.92 653.79 232.74 652.02 4 Y
0 Z
N
232.74 653.79 232.74 655.56 238.92 653.79 232.74 652.02 4 Y
V
232.59 653.79 214.86 653.79 2 L
2 Z
N
186.59 685.97 186.59 376.35 2 L
0.6 H
N
2 8.34 Q
(C) 0 -90 185.28 369.93 TF
184.52 538.87 190.3 615.2 R
3 X
V
0.3 H
0 X
N
303.58 685.97 303.58 376.35 2 L
0.6 H
N
(E) 0 -90 300.59 369.92 TF
300.69 455.25 306.47 528.58 R
3 X
V
0.3 H
0 X
N
200.12 632.35 200.12 630.58 193.94 632.35 200.12 634.12 4 Y
0 Z
N
200.12 632.35 200.12 630.58 193.94 632.35 200.12 634.12 4 Y
V
218 632.35 200.27 632.35 2 L
2 Z
N
J
200.93 567.17 200.93 565.4 194.75 567.17 200.93 568.94 4 Y
0 Z
N
200.93 567.17 200.93 565.4 194.75 567.17 200.93 568.94 4 Y
V
J
218.81 567.17 201.08 567.17 2 L
J
218.81 567.17 218.36 567.17 2 L
2 Z
N
[0.886 2.659] 0.886 I
218.36 567.17 201.52 567.17 2 L
N
J
201.52 567.17 201.08 567.17 2 L
N
J
245.55 685.97 245.55 376.35 2 L
0.6 H
N
(A) 0 -90 242.56 369.93 TF
275.56 685.97 275.56 376.35 2 L
N
(D) 0 -90 272.57 369.93 TF
270.4 589.47 280.73 632.78 R
7 X
V
0.3 H
0 X
N
J
289.25 460.39 289.25 462.17 295.43 460.39 289.25 458.62 4 Y
0 Z
N
289.25 460.39 289.25 462.17 295.43 460.39 289.25 458.62 4 Y
V
J
189.35 460.39 289.1 460.39 2 L
J
189.35 460.39 189.79 460.39 2 L
2 Z
N
[0.891 2.672] 0.891 I
189.79 460.39 288.65 460.39 2 L
N
J
288.65 460.39 289.1 460.39 2 L
N
J
102.19 576.36 113.13 603.7 R
N
(W) 0 -90 92.45 606.46 TF
(orking) 0 -90 92.45 599.09 TF
(Sleeping) 0 -90 93.9 540.11 TF
107.02 513.87 113.13 531.6 R
3 X
V
0 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(Zombie) 0 -90 93.9 672.15 TF
107.02 648.46 113.13 666.2 R
V
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
101.33 457.36 101.33 455.59 95.15 457.36 101.33 459.13 4 Y
0 Z
N
101.33 457.36 101.33 455.59 95.15 457.36 101.33 459.13 4 Y
V
120.67 457.36 101.48 457.36 2 L
2 Z
N
J
101.57 373.92 101.57 372.15 95.39 373.92 101.57 375.69 4 Y
0 Z
N
101.57 373.92 101.57 372.15 95.39 373.92 101.57 375.69 4 Y
V
J
120.91 373.92 101.72 373.92 2 L
J
120.91 373.92 120.46 373.92 2 L
2 Z
N
[0.795 2.386] 0.795 I
120.46 373.92 102.17 373.92 2 L
N
J
102.17 373.92 101.72 373.92 2 L
N
J
(create) 0 -90 82.57 469.83 TF
(join) 0 -90 82.33 378.02 TF
J
289.52 546.96 289.51 548.73 295.7 547.01 289.54 545.18 4 Y
0 Z
N
289.52 546.96 289.51 548.73 295.7 547.01 289.54 545.18 4 Y
V
J
246.31 546.59 289.37 546.96 2 L
J
246.31 546.59 246.76 546.59 2 L
2 Z
N
[0.897 2.692] 0.897 I
246.76 546.59 288.92 546.95 2 L
N
J
288.92 546.95 289.37 546.96 2 L
N
J
155.24 685.95 155.24 376.33 2 L
0.6 H
N
(B) 0 -90 152.24 369.91 TF
150.07 464.66 160.4 550.42 R
7 X
V
0.3 H
0 X
N
J
289.52 417.08 289.52 418.86 295.7 417.08 289.52 415.31 4 Y
0 Z
N
289.52 417.08 289.52 418.86 295.7 417.08 289.52 415.31 4 Y
V
J
275.46 417.08 289.37 417.08 2 L
J
275.46 417.08 275.91 417.08 2 L
2 Z
N
[0.868 2.603] 0.868 I
275.91 417.08 288.92 417.08 2 L
N
J
288.92 417.08 289.37 417.08 2 L
N
J
168.63 545.73 168.63 543.96 162.45 545.73 168.63 547.5 4 Y
0 Z
N
168.63 545.73 168.63 543.96 162.45 545.73 168.63 547.5 4 Y
V
186.51 545.73 168.78 545.73 2 L
2 Z
N
240.39 567.17 250.71 653.79 R
7 X
V
0 X
N
298.42 502.42 308.74 610.48 R
7 X
V
0 X
N
182.25 460.39 192.57 567.17 R
7 X
V
0 X
N
298.42 396.5 308.74 461.68 R
7 X
V
0 X
N
182.25 588.18 192.57 632.35 R
7 X
V
0 X
N
J
263.2 589.9 263.2 591.67 269.38 589.9 263.2 588.12 4 Y
0 Z
N
263.2 589.9 263.2 591.67 269.38 589.9 263.2 588.12 4 Y
V
J
263.05 589.9 219.71 589.9 2 L
J
263.05 589.9 258.44 589.9 2 L
2 Z
N
[8.458 5.73] 8.458 I
258.44 589.9 224.33 589.9 2 L
N
J
224.33 589.9 219.71 589.9 2 L
N
J
215.54 685.97 215.54 376.35 2 L
0.6 H
N
(main) 0 -90 212.59 371.37 TF
210.37 567.17 220.7 675.66 R
7 X
V
0.3 H
0 X
N
(cancel\050D\051) 0 -90 213.53 627 TF
(join\050main\051) 0 -90 185.6 629.31 TF
(join\050D\051) 0 -90 301.46 445.2 TF
(join\050C\051) 0 -90 301.46 530.1 TF
(join\050A\051) 0 -90 301.46 573.84 TF
J
101.33 417.42 101.33 415.65 95.15 417.42 101.33 419.19 4 Y
0 Z
N
101.33 417.42 101.33 415.65 95.15 417.42 101.33 419.19 4 Y
V
J
120.67 417.42 101.48 417.42 2 L
J
120.67 417.42 116.05 417.42 2 L
2 Z
N
[14.697 9.956] 14.697 I
116.05 417.42 106.1 417.42 2 L
N
J
106.1 417.42 101.48 417.42 2 L
N
J
(cancel) 0 -90 82.57 431.29 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 19.06 Q
(POSIX Thread Create and Join) 0 -90 331.94 659.31 TF
37.72 287.67 380.78 700.41 C
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(4) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Creating & Joining Threads:) 439.19 686.11 T
(m) 528.8 657.53 T
(ulti_thr) 547.44 657.53 T
(.c) 618.81 657.53 T
4 7.15 Q
(/*                multi_thr.c                */) 411.22 615.84 T
(/*) 411.22 599.16 T
(  Simple program that just illustrates thread creation, thread exiting,) 411.22 590.82 T
(  waiting for threads, and returning status from threads.) 411.22 582.48 T
(*/) 411.22 574.15 T
(/*) 411.22 557.47 T
(cc -o multi_thr multi_thr.c -L. -R. -g -lpthread -lthread -pthread_extensions -) 411.22 549.13 T
(lposix4) 411.22 540.79 T
(*/) 411.22 532.45 T
(#define _POSIX_C_SOURCE 199506L) 411.22 515.78 T
(#include <stdio.h>) 411.22 499.1 T
(#include <stdlib.h>) 411.22 490.77 T
(#include <pthread.h>) 411.22 482.43 T
(#include <time.h>) 411.22 474.09 T
(#include \322thread_extensions.h\323) 411.22 465.75 T
(/* Function prototypes for thread routines */) 411.22 440.74 T
(void *sub_a\050void *\051;) 411.22 432.4 T
(void *sub_b\050void *\051;) 411.22 424.06 T
(void *sub_c\050void *\051;) 411.22 415.72 T
(void *sub_d\050void *\051;) 411.22 407.38 T
(void *sub_e\050void *\051;) 411.22 399.05 T
(pthread_t               tid_a, tid_b, tid_c, tid_d, tid_e, tid_main;) 411.22 382.37 T
(pthread_attr_t          attr;) 411.22 374.03 T
(int                     zero;) 411.22 365.69 T
(float                   f;) 411.22 357.35 T
(int time1\050\051) 411.22 332.34 T
({return\050time\050NULL\051-zero\051;}) 411.22 324 T
(void *sub_a\050void *arg\051) 411.22 298.99 T
({int            err, i;) 411.22 290.65 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 2
%%Page: "mini" 3
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(5) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_t      tid = pthread_self\050\051;) 37.72 695.65 T
( printf\050\322[%2d] A: \134t In thread A [%s]\134n\323, time1\050\051, thread_name\050tid\051\051;) 37.72 678.97 T
( sleep\0501\051;) 37.72 670.63 T
( PTHREAD_CREATE\050&tid_d, &attr, sub_d, NULL\051;) 37.72 662.29 T
( printf\050\322[%2d] A: \134t Created thread D [%s]\134n\323, time1\050\051, thread_name\050tid_d\051\051;) 37.72 653.95 T
( sleep\0503\051;) 37.72 637.28 T
( printf\050\322[%2d] A: \134t Thread exiting...\134n\323, time1\050\051\051;) 37.72 628.94 T
( return\050\050void *\05177\051;            /* Same as pthread_exit\050\050void *\05177\051 */) 37.72 620.6 T
(}) 37.72 612.26 T
(void *sub_b\050void *arg\051) 37.72 587.25 T
({pthread_t      tid = pthread_self\050\051;) 37.72 578.91 T
( printf\050\322[%2d] B: \134t In thread B [%s]\134n\323, time1\050\051, thread_name\050tid\051\051;) 37.72 570.57 T
( sleep\0504\051;) 37.72 553.9 T
( printf\050\322[%2d] B: \134t Thread exiting...\134n\323, time1\050\051\051;) 37.72 537.22 T
( pthread_exit\050NULL\051;) 37.72 528.88 T
(}) 37.72 520.54 T
(void *sub_c\050void *arg\051) 37.72 495.53 T
({void           *status;) 37.72 487.19 T
( int            err, i;) 37.72 478.85 T
( pthread_t tid = pthread_self\050\051;) 37.72 462.18 T
( pthread_t      *ptid = \050pthread_t *\051 arg; /* Passing a POINTER to the TID */) 37.72 453.84 T
( char           *name = thread_name\050tid\051;) 37.72 445.5 T
( printf\050\322[%2d] C: \134t In thread C [%s]\134n\323, time1\050\051, name\051;) 37.72 428.82 T
( sleep\0502\051;) 37.72 420.49 T
( printf\050\322[%2d] C: \134t Joining main thread...\134n\323, time1\050\051\051;) 37.72 403.81 T
( if \050err=pthread_join\050*ptid, &status\051\051) 37.72 395.47 T
(   printf\050\322pthread_join Error. %s\323, strerror\050err\051\051, exit\0501\051;) 37.72 387.13 T
( printf\050\322[%2d] C: \134t Main thread [%s] returning status: %d\134n\323,) 37.72 378.8 T
(        time1\050\051, thread_name\050*ptid\051, \050int\051 status\051;) 37.72 370.46 T
( sleep\0501\051;) 37.72 353.78 T
( PTHREAD_CREATE\050&tid_b, &attr, sub_b, NULL\051;) 37.72 337.11 T
( printf\050\322[%2d] C: \134t Created thread B [%s]\134n\323, time1\050\051, thread_name\050tid_b\051\051;) 37.72 328.77 T
( sleep\0504\051;) 37.72 312.09 T
( printf\050\322[%2d] C: \134t Thread exiting...\134n\323, time1\050\051\051;) 37.72 303.75 T
( f = 88.8;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(6) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_exit\050\050void *\051 &f\051;) 411.22 695.65 T
(}) 411.22 687.31 T
(void *cleanup\050void *arg\051) 411.22 670.63 T
({pthread_t tid = pthread_self\050\051;) 411.22 662.29 T
( char *name = thread_name\050tid\051;) 411.22 653.95 T
(  printf\050\322[%2d] D: \134t %s cancelled! \134n\323, time1\050\051, name\051;) 411.22 637.28 T
(}) 411.22 628.94 T
(void * sub_d\050void *arg\051) 411.22 595.59 T
({int            err, i;) 411.22 587.25 T
( pthread_t      tid_e;) 411.22 578.91 T
( void           *status;) 411.22 570.57 T
( pthread_t      tid = pthread_self\050\051;) 411.22 562.23 T
( printf\050\322[%2d] D: \134t In thread D [%s]\134n\323, time1\050\051, thread_name\050tid\051\051;) 411.22 545.56 T
( pthread_cleanup_push\050cleanup, NULL\051;) 411.22 528.88 T
( pthread_setcanceltype\050PTHREAD_CANCEL_ASYNCHRONOUS, NULL\051;) 411.22 520.54 T
( pthread_setcancelstate\050PTHREAD_CANCEL_ENABLE, NULL\051;) 411.22 512.21 T
( sleep\0501\051;) 411.22 495.53 T
( PTHREAD_CREATE\050&tid_e, &attr, sub_e, NULL\051;) 411.22 487.19 T
( printf\050\322[%2d] D: \134t Created thread E [%s]\134n\323, time1\050\051, thread_name\050tid_e\051\051;) 411.22 478.85 T
( sleep\0505\051;) 411.22 462.18 T
(        /* D should get cancelled before this runs. */) 411.22 445.5 T
( printf\050\322[%2d] D: \134t Thread exiting...\134n\323, time1\050\051\051;) 411.22 437.16 T
( pthread_cleanup_pop\0500\051;) 411.22 428.82 T
( return\050\050void *\05155\051;) 411.22 420.49 T
(}) 411.22 412.15 T
(void * sub_e\050void *arg\051) 411.22 387.13 T
({int            err, i;) 411.22 378.8 T
( void           *status;) 411.22 370.46 T
( pthread_t      tid = pthread_self\050\051;) 411.22 362.12 T
( printf\050\322[%2d] E: \134t In thread E [%s]\134n\323, time1\050\051, thread_name\050tid\051\051;) 411.22 345.44 T
( sleep\0503\051;) 411.22 328.77 T
( printf\050\322[%2d] E: \134t Joining thread A...\134n\323, time1\050\051\051;) 411.22 320.43 T
( if \050err=pthread_join\050tid_a, &status\051\051) 411.22 312.09 T
(   printf\050\322pthread_join Error. %s\323, strerror\050err\051\051, exit\0501\051;) 411.22 303.75 T
( printf\050\322[%2d] E: \134t Thread A [%s] returning status: %d\134n\323,) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 3
%%Page: "mini" 4
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(7) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(        time1\050\051, thread_name\050tid_a\051, \050int\051 status\051;) 37.72 695.65 T
( sleep\0502\051;) 37.72 678.97 T
( printf\050\322[%2d] E: \134t Joining thread C...\134n\323, time1\050\051\051;) 37.72 662.29 T
( if \050err=pthread_join\050tid_c, &status\051\051) 37.72 653.95 T
(   printf\050\322pthread_join Error. %s\323, strerror\050err\051\051, exit\0501\051;) 37.72 645.62 T
( printf\050\322[%2d] E: \134t Thread C [%s] returning status: %f\134n\323,) 37.72 637.28 T
(        time1\050\051, thread_name\050tid_c\051, *\050\050float *\051 status\051\051;) 37.72 628.94 T
( sleep\0502\051;) 37.72 612.26 T
( printf\050\322[%2d] E: \134t Joining thread D...\134n\323, time1\050\051\051;) 37.72 603.92 T
( if \050err=pthread_join\050tid_d, &status\051\051) 37.72 595.59 T
(   printf\050\322pthread_join Error. %s\323, strerror\050err\051\051, exit\0501\051;) 37.72 587.25 T
( if \050\050void*\051 status == \050void*\051 PTHREAD_CANCELED\051) 37.72 578.91 T
(   printf\050\322[%2d] E: \134t Thread D [%s] returning status: PTHREAD_CANCELED\134n\323,) 37.72 570.57 T
(          time1\050\051, thread_name\050tid_d\051\051;) 37.72 562.23 T
( else) 37.72 553.9 T
(   printf\050\322[%2d] E: \134t Thread D [%s] returning status: %d\134n\323,) 37.72 545.56 T
(          time1\050\051, thread_name\050tid_d\051, \050int\051 status\051;) 37.72 537.22 T
( sleep\0501\051;) 37.72 520.54 T
( printf\050\322[%2d] E: \134t Thread exiting...\134n\323, time1\050\051\051;) 37.72 512.21 T
( pthread_exit\050\050void *\05144\051;) 37.72 503.87 T
(}) 37.72 495.53 T
(main\050\051) 37.72 462.18 T
({int            err;) 37.72 453.84 T
( zero = time\050NULL\051;) 37.72 437.16 T
( tid_main = pthread_self\050\051;) 37.72 428.82 T
( printf\050\322Time Thread \134t Event\134n\323\051;) 37.72 420.49 T
( printf\050\322==== ====== \134t =====\134n\323\051;) 37.72 412.15 T
( printf\050\322[%2d] Main: \134t Started [%s]\134n\323, time1\050\051, thread_name\050tid_main\051\051;) 37.72 403.81 T
( PTHREAD_ATTR_INIT\050&attr\051;) 37.72 387.13 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 37.72 378.8 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_JOINABLE\051; /* Also default */) 37.72 370.46 T
( sleep\0501\051;) 37.72 353.78 T
( PTHREAD_CREATE\050&tid_a, &attr, sub_a, NULL\051;) 37.72 345.44 T
( printf\050\322[%2d] Main: \134t Created thread A [%s]\134n\323, time1\050\051, thread_name\050tid_a\051\051;) 37.72 337.11 T
( sleep\0501\051;) 37.72 320.43 T
( PTHREAD_CREATE\050&tid_c, &attr, sub_c, \050void *\051 &tid_main\051;) 37.72 312.09 T
( printf\050\322[%2d] Main: \134t Created thread C [%s]\134n\323, time1\050\051, thread_name\050tid_c\051\051;) 37.72 303.75 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(8) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( sleep\0502\051;) 411.22 695.65 T
( printf\050\322[%2d] Main: \134t Cancelling thread D [%s]\134n\323,) 411.22 687.31 T
(        time1\050\051, thread_name\050tid_d\051\051;) 411.22 678.97 T
( pthread_cancel\050tid_d\051;) 411.22 670.63 T
( sleep\0501\051;) 411.22 653.95 T
( printf\050\322[%2d] Main: \134t Thread exiting...\134n\323, time1\050\051\051;) 411.22 645.62 T
( pthread_exit\050\050void *\051 NULL\051;) 411.22 637.28 T
(}) 411.22 628.94 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 4
%%Page: "mini" 5
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(9) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
37.72 340.77 353.49 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 10.72 Q
0 X
0 0 0 1 0 0 0 K
(Output: J) 0 -90 296.04 431.21 TF
(une) 0 -90 296.04 383.79 TF
(...) 0 -90 296.04 364.51 TF
311.17 575.64 M
 312.62 579.88 305.66 583.83 301.1 578.61 D
 296.52 573.36 290.91 586.19 282.88 576.63 D
1.79 H
2 Z
N
90 450 0.89 0.89 90 297.28 564.6 GG
297.27 565.5 295.01 565.5 297.27 573.39 299.54 565.5 4 Y
0 Z
N
297.27 565.5 295.01 565.5 297.27 573.39 299.54 565.5 4 Y
V
297.27 564.6 297.27 558.76 2 L
2 Z
N
135.54 602.04 M
 136.99 606.28 130.02 610.23 125.47 605.01 D
 120.89 599.76 115.27 612.59 107.25 603.03 D
N
90 450 0.89 0.89 90 121.64 591 GG
121.64 591.9 119.38 591.9 121.64 599.79 123.9 591.9 4 Y
0 Z
N
121.64 591.9 119.38 591.9 121.64 599.79 123.9 591.9 4 Y
V
121.64 591 121.64 585.16 2 L
2 Z
N
208.05 593.73 229.92 637.47 R
0.6 H
N
90 450 5.22 4.93 270 218.99 604.16 GG
90 450 5.22 4.93 270 218.99 604.16 AA
229.49 611.39 208.05 611.39 2 L
N
(Jan) 0 -90 216.2 633.46 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
208.05 529.41 229.92 573.15 R
N
90 450 5.22 4.93 270 218.99 539.84 GG
90 450 5.22 4.93 270 218.99 539.84 AA
229.49 547.07 208.05 547.07 2 L
N
(Jon) 0 -90 216.2 569.14 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
216.09 581.84 217.62 582.73 219.21 576.52 214.57 580.94 4 Y
0.3 H
0 Z
N
216.09 581.84 217.62 582.73 219.21 576.52 214.57 580.94 4 Y
V
219.63 604.02 M
 215.5 597.66 212.18 588.51 216.02 581.96 D
2 Z
N
214.91 656.43 236.78 695.36 R
0.6 H
N
90 450 4.64 4.93 270 225.85 665.72 GG
90 450 4.64 4.93 270 225.85 665.72 AA
219.01 646.58 220.58 646.72 219.5 641.12 217.45 646.44 4 Y
0 Z
N
219.01 646.58 220.58 646.72 219.5 641.12 217.45 646.44 4 Y
V
228.52 663.93 M
 231.95 656.24 227.84 653.05 221.48 651.02 D
 219.66 650.44 218.81 648.84 218.99 646.88 D
2 Z
N
236.36 672.15 214.91 672.15 2 L
N
(T1) 0 -90 223.06 691.79 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
152.49 575.45 174.36 619.19 R
N
90 450 5.22 4.93 270 163.42 585.88 GG
90 450 5.22 4.93 270 163.42 585.88 AA
173.93 593.1 152.49 593.1 2 L
N
(Jim) 0 -90 160.64 615.17 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
204.08 660.82 203.68 662.54 210.1 662.22 204.48 659.09 4 Y
0.3 H
0 Z
N
204.08 660.82 203.68 662.54 210.1 662.22 204.48 659.09 4 Y
V
165.62 626.38 M
 171.31 643.85 186.52 653.45 201.94 659.96 D
 202.6 660.24 203.24 660.62 203.93 660.78 D
2 Z
N
293.3 608.78 295.07 608.8 293.35 602.6 291.52 608.76 4 Y
0 Z
N
293.3 608.78 295.07 608.8 293.35 602.6 291.52 608.76 4 Y
V
241.5 663.2 M
 298.1 649.43 293.11 628.46 293.3 608.93 D
2 Z
N
307.67 442.08 309.3 441.36 305.18 436.39 306.04 442.79 4 Y
0 Z
N
307.67 442.08 309.3 441.36 305.18 436.39 306.04 442.79 4 Y
V
288.6 553.73 M
 283.5 510.36 325.37 482.49 307.73 442.21 D
2 Z
N
(Pr) 0 -90 90.98 626.05 TF
(oducer) 0 -90 90.98 614.95 TF
(Consumer) 0 -90 266.62 596.99 TF
142.27 612.89 142.52 614.44 147.68 612 142.01 611.34 4 Y
0.6 H
0 Z
N
142.27 612.89 142.52 614.44 147.68 612 142.01 611.34 4 Y
V
115.28 611.82 M
 107.86 621.19 112.7 645.32 128.19 639.13 D
 139.72 634.53 130.73 620.72 138.23 614.78 D
 139.41 613.84 140.65 613.16 141.98 612.94 D
2 Z
N
2 19.06 Q
(Classic Pr) 0 -90 326.19 647.33 TF
(oducer/Consumer) 0 -90 326.19 555.54 TF
281.9 469.62 M
 283.36 473.87 276.39 477.82 271.83 472.6 D
 267.25 467.35 261.64 480.17 253.61 470.61 D
1.79 H
N
90 450 0.89 0.89 90 268.01 458.59 GG
268.01 459.48 265.74 459.48 268.01 467.37 270.27 459.48 4 Y
0 Z
N
268.01 459.48 265.74 459.48 268.01 467.37 270.27 459.48 4 Y
V
268.01 458.59 268.01 452.75 2 L
2 Z
N
2 10.72 Q
(Consumer) 0 -90 237.35 490.98 TF
263.14 488.52 264.92 488.54 263.18 482.3 261.35 488.51 4 Y
0.3 H
0 Z
N
263.14 488.52 264.92 488.54 263.18 482.3 261.35 488.51 4 Y
V
237.42 650.09 M
 267.65 609.34 262.73 545.65 263.14 488.67 D
2 Z
N
279.71 407.79 279.68 409.37 285.21 407.89 279.73 406.22 4 Y
0.6 H
0 Z
N
279.71 407.79 279.68 409.37 285.21 407.89 279.73 406.22 4 Y
V
257.7 459.13 M
 248.52 443.71 253.71 420.62 270.21 409.94 D
 272.61 408.38 275.93 407.73 279.41 407.79 D
2 Z
N
138.52 497.96 M
 139.97 502.21 133 506.16 128.45 500.94 D
 123.86 495.69 118.25 508.52 110.23 498.96 D
1.79 H
N
90 450 0.89 0.89 90 124.62 486.94 GG
124.62 487.83 122.36 487.83 124.62 495.72 126.88 487.83 4 Y
0 Z
N
124.62 487.83 122.36 487.83 124.62 495.72 126.88 487.83 4 Y
V
124.62 486.93 124.62 481.09 2 L
2 Z
N
155.47 471.38 177.34 515.12 R
0.6 H
N
90 450 5.22 4.93 270 166.4 481.81 GG
90 450 5.22 4.93 270 166.4 481.81 AA
176.91 489.04 155.47 489.04 2 L
N
(Jac) 0 -90 163.62 511.11 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(Pr) 0 -90 93.96 521.98 TF
(oducer) 0 -90 93.96 510.88 TF
145.25 508.82 145.5 510.37 150.66 507.93 144.99 507.27 4 Y
0 Z
N
145.25 508.82 145.5 510.37 150.66 507.93 144.99 507.27 4 Y
V
118.26 507.75 M
 110.84 517.12 115.68 541.26 131.17 535.06 D
 142.7 530.46 133.71 516.65 141.21 510.71 D
 142.39 509.77 143.62 509.09 144.95 508.87 D
2 Z
N
201.67 652.38 201.02 653.82 206.69 654.63 202.31 650.94 4 Y
0 Z
N
201.67 652.38 201.02 653.82 206.69 654.63 202.31 650.94 4 Y
V
168.36 518.09 M
 191.78 541.04 196.96 573.41 192.56 604.45 D
 190.35 619.97 185.9 645.31 201.4 652.26 D
2 Z
N
206.27 465.68 228.14 509.42 R
N
90 450 5.22 4.93 270 217.2 476.12 GG
90 450 5.22 4.93 270 217.2 476.12 AA
227.71 483.34 206.27 483.34 2 L
N
(Joe) 0 -90 214.41 505.41 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
214.3 518.11 215.83 519.01 217.43 512.79 212.78 517.21 4 Y
0.3 H
0 Z
N
214.3 518.11 215.83 519.01 217.43 512.79 212.78 517.21 4 Y
V
217.85 540.29 M
 213.71 533.94 210.39 524.79 214.23 518.24 D
2 Z
N
206.27 401.57 228.14 445.31 R
0.6 H
N
90 450 5.22 4.93 270 217.2 412 GG
90 450 5.22 4.93 270 217.2 412 AA
227.71 419.23 206.27 419.23 2 L
N
(Ja) 0 -90 214.41 441.3 TF
(y) 0 -90 214.41 429.59 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
214.3 454 215.83 454.89 217.43 448.68 212.78 453.1 4 Y
0.3 H
0 Z
N
214.3 454 215.83 454.89 217.43 448.68 212.78 453.1 4 Y
V
217.84 476.18 M
 213.71 469.83 210.39 460.67 214.23 454.12 D
2 Z
N
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(10) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Classic Pr) 435.82 686.11 T
(oducer/Consumer:) 539.08 686.11 T
(one_queue_pr) 469.29 657.53 T
(ob) 615.4 657.53 T
(lem.c) 641.39 657.53 T
4 7.15 Q
(/*                one_queue_problem.c                */) 411.22 615.84 T
(/*) 411.22 599.16 T
(  This is the prototypical producer/consumer example done by) 411.22 590.82 T
(  building a singly linked list.  Note the use of the semaphore) 411.22 582.48 T
(  to prevent the consumers from running when the list is empty.) 411.22 574.15 T
(  Unfortunately, there\325s nothing to prevent the list from getting) 411.22 565.81 T
(  infinitely long...) 411.22 557.47 T
(  Delays are inserted to simulate disk I/O \050and to make things) 411.22 540.79 T
(  run slower!\051.) 411.22 532.45 T
(*/) 411.22 524.12 T
(/*) 411.22 499.1 T
(cc -o one_queue_problem one_queue_problem.c -L. -R. -g -lpthread -lthread -) 411.22 490.77 T
(pthread_extensions -lposix4) 411.22 482.43 T
(*/) 411.22 474.09 T
(#define _POSIX_C_SOURCE 199506L) 411.22 457.41 T
(#include <pthread.h>) 411.22 440.74 T
(#include <semaphore.h>) 411.22 432.4 T
(#include <errno.h>) 411.22 424.06 T
(#include <time.h>) 411.22 415.72 T
(#include \322thread_extensions.h\323) 411.22 407.38 T
(typedef struct request_struct) 411.22 382.37 T
({int                    client;) 411.22 374.03 T
( char                   *buf;) 411.22 365.69 T
( pthread_t              tid;) 411.22 357.35 T
( struct request_struct  *next;) 411.22 349.02 T
(} request_t;) 411.22 340.68 T
(request_t               *requests = NULL;) 411.22 324 T
(pthread_mutex_t         requests_lock = PTHREAD_MUTEX_INITIALIZER;) 411.22 315.66 T
(pthread_attr_t          attr;) 411.22 307.33 T
(sem_t                   requests_length;) 411.22 298.99 T
(int) 411.22 290.65 T
(max_length_empirical = 0, sval;) 529.74 290.65 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 5
%%Page: "mini" 6
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(1) 203.89 268.68 T
(1) 207.07 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(int                     GET_DELAY = 100, PROCESS_DELAY = 250;) 37.72 695.65 T
(int                     N_PROD = 2, N_CONS = 2;) 37.72 687.31 T
(void print_requests\050\051) 37.72 653.95 T
({request_t *r = requests;) 37.72 645.62 T
( while \050r != NULL\051) 37.72 628.94 T
(   {printf\050\322<Request: %d>\134n\323, r->client\051;) 37.72 620.6 T
(    r = r->next;) 37.72 612.26 T
(  }) 37.72 603.92 T
(}) 37.72 595.59 T
(request_t *get_request\050\051) 37.72 570.57 T
({static int count = 0;) 37.72 562.23 T
( static pthread_mutex_t mr  = PTHREAD_MUTEX_INITIALIZER;) 37.72 553.9 T
( int c;) 37.72 545.56 T
( request_t *request;) 37.72 537.22 T
( pthread_t tid = pthread_self\050\051;) 37.72 528.88 T
( delay\050GET_DELAY, 0\051;) 37.72 512.21 T
( pthread_mutex_lock\050&mr\051;) 37.72 503.87 T
( c=count++;) 37.72 495.53 T
( pthread_mutex_unlock\050&mr\051;) 37.72 487.19 T
( request = \050request_t *\051 malloc\050sizeof\050request_t\051\051;) 37.72 470.52 T
( request->client = c;                        /* Cannot use count here! */) 37.72 462.18 T
( request->tid = pthread_self\050\051;) 37.72 453.84 T
( DEBUG\050printf\050\322[%s] Creating request  %4d\134n\323, thread_name\050tid\051, c\051\051;) 37.72 437.16 T
( return\050request\051;) 37.72 428.82 T
(}) 37.72 420.49 T
(void process_request\050request_t *request\051) 37.72 395.47 T
({pthread_t tid = pthread_self\050\051;) 37.72 387.13 T
(  delay\050PROCESS_DELAY, 0\051;) 37.72 378.8 T
(  DEBUG\050printf\050\322[%s] Processed request %4d [%s]\134n\323, thread_name\050tid\051,) 37.72 370.46 T
(               request->client, thread_name\050request->tid\051\051\051;) 37.72 362.12 T
(  free\050request\051;) 37.72 353.78 T
(}) 37.72 345.44 T
(request_t *remove_request\050\051) 37.72 320.43 T
({request_t *request;) 37.72 312.09 T
( pthread_mutex_lock\050&requests_lock\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(12) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( request = requests;) 411.22 695.65 T
( requests = requests->next;) 411.22 687.31 T
( pthread_mutex_unlock\050&requests_lock\051;) 411.22 678.97 T
( return\050request\051;) 411.22 670.63 T
(}) 411.22 662.29 T
(void add_request\050request_t *request\051) 411.22 637.28 T
({) 411.22 628.94 T
( pthread_mutex_lock\050&requests_lock\051;) 411.22 620.6 T
( request->next = requests;                      /* Insert at head of list */) 411.22 612.26 T
( requests = request;) 411.22 603.92 T
( sem_getvalue\050&requests_length, &sval\051;) 411.22 595.59 T
( if \050sval+1 > max_length_empirical\051) 411.22 587.25 T
(   max_length_empirical = sval+1;) 411.22 578.91 T
( pthread_mutex_unlock\050&requests_lock\051;) 411.22 570.57 T
(}) 411.22 562.23 T
(void *producer\050void *arg\051) 411.22 537.22 T
({request_t      *request;) 411.22 528.88 T
( while\050TRUE\051) 411.22 512.21 T
(   {) 411.22 503.87 T
(     request = get_request\050\051;) 411.22 495.53 T
(     add_request\050request\051;) 411.22 487.19 T
(     sem_post\050&requests_length\051;) 411.22 478.85 T
(   }) 411.22 470.52 T
(}) 411.22 462.18 T
(void *consumer\050void *arg\051) 411.22 437.16 T
({request_t      *request;) 411.22 428.82 T
( while\050TRUE\051) 411.22 412.15 T
(   {) 411.22 403.81 T
(     SEM_WAIT\050&requests_length\051;) 411.22 395.47 T
(     request = remove_request\050\051;) 411.22 387.13 T
(     process_request\050request\051;) 411.22 378.8 T
(   }) 411.22 370.46 T
(}) 411.22 362.12 T
(main\050int argc, char **argv\051) 411.22 337.11 T
({int i;) 411.22 328.77 T
(pthread_t tid;) 411.22 320.43 T
( SEM_INIT\050&requests_length, NULL,  0\051;) 411.22 303.75 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 6
%%Page: "mini" 7
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(13) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( PTHREAD_ATTR_INIT\050&attr\051;) 37.72 695.65 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 37.72 687.31 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 37.72 678.97 T
( if \050argc >= 2\051 GET_DELAY = atoi\050argv[1]\051;) 37.72 662.29 T
( if \050argc >= 3\051 PROCESS_DELAY = atoi\050argv[2]\051;) 37.72 653.95 T
( if \050argc >= 4\051 N_PROD        = atoi\050argv[3]\051;) 37.72 645.62 T
( if \050argc >= 5\051 N_CONS        = atoi\050argv[4]\051;) 37.72 637.28 T
( printf\050\322GET_DELAY \050ms\051 = %d PROCESS_DELAY \050ms\051 = %d N_PROD = %d N_CONS = %d\134n\323,) 37.72 628.94 T
(        GET_DELAY, PROCESS_DELAY, N_PROD, N_CONS\051;) 37.72 620.6 T
( for \050i=0; i<N_CONS; i++\051) 37.72 603.92 T
(   PTHREAD_CREATE\050&tid, &attr, consumer, NULL\051;) 37.72 595.59 T
( for \050i=0; i<N_PROD; i++\051) 37.72 587.25 T
(   PTHREAD_CREATE\050&tid, &attr, producer, NULL\051;) 37.72 578.91 T
( sleep\05020\051;) 37.72 562.23 T
( sem_getvalue\050&requests_length, &sval\051;) 37.72 553.9 T
( printf\050\322Done.\134nCurrent List length: %d Max length was: %d\134n\323,) 37.72 545.56 T
(sval, max_length_empirical\051;) 71.07 537.22 T
( exit\0500\051;) 37.72 528.88 T
(}) 37.72 520.54 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(14) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Ex) 487.72 686.11 T
(er) 513.73 686.11 T
(cise Objective) 533.57 686.11 T
2 10.72 Q
-0.36 (Edit the code in) 411.22 642.04 P
4 F
-0.78 (one_queue_problem.c) 492.58 642.04 P
2 F
-0.36 ( and \336x it so that the length) 614.8 642.04 P
(of the list ne) 411.22 628.94 T
(ver e) 474.2 628.94 T
(xceeds some n) 499.08 628.94 T
(umber \050sa) 575.84 628.94 T
(y 10\051.) 626.85 628.94 T
(Hint: Using) 411.22 589.63 T
4 F
(sem_getvalue\050\051) 471.38 589.63 T
2 F
( will not help!) 561.43 589.63 T
-0.2 (Don\325t peek at) 411.22 563.43 P
4 F
-0.43 (one_queue_solution.c) 480.92 563.43 P
2 F
-0.2 ( until y) 609.56 563.43 P
-0.2 (ou ha) 643.45 563.43 P
-0.2 (ve \336gured it out) 671.68 563.43 P
(on y) 411.22 550.32 T
(our o) 433 550.32 T
(wn! \050The objective is not to g) 459.64 550.32 T
(et the ans) 607.47 550.32 T
(wer) 657.35 550.32 T
(, the objective) 675.18 550.32 T
(is f) 411.22 537.22 T
(or y) 426.5 537.22 T
(ou to think about the issue) 445.89 537.22 T
(, so that when y) 582.41 537.22 T
(ou encounter) 662.56 537.22 T
(something similar in real code) 411.22 524.12 T
(, y) 565.64 524.12 T
(ou\325) 577.29 524.12 T
(ll be ab) 593.16 524.12 T
(le to deal with it!\051) 629.99 524.12 T
(There is reall) 411.22 484.81 T
(y onl) 477.21 484.81 T
(y one simple solution to the pr) 502.07 484.81 T
(ob) 657.33 484.81 T
(lem.) 670.33 484.81 T
(Wild Guess at Time to Completion:) 411.22 458.6 T
(30 min) 518.43 445.5 T
(utes think/design time) 552.28 445.5 T
(.) 665.68 445.5 T
(2 min) 518.43 432.4 T
(utes pr) 546.32 432.4 T
(ogramming/deb) 581.85 432.4 T
(ug) 662.05 432.4 T
(ging) 675.04 432.4 T
(My solution c) 518.43 419.3 T
(hang) 586.82 419.3 T
(ed 4 lines of code) 612.54 419.3 T
(.) 702.72 419.3 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 7
%%Page: "mini" 8
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(15) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Classic Pr) 62.31 686.11 T
(oducer/Consumer:) 165.57 686.11 T
(one_queue_) 96.06 657.53 T
5 F
(solution) 221.17 657.53 T
2 F
(.c) 304.55 657.53 T
4 7.15 Q
(/*                one_queue_solution.c                */) 37.72 624.17 T
(/*) 37.72 607.5 T
(  This is the prototypical producer/consumer example done by) 37.72 599.16 T
(  building a singly linked list.  Note the use of the semaphore) 37.72 590.82 T
(  to prevent the consumers from running when the list is empty.) 37.72 582.48 T
(  The second semaphore prevents the list from getting) 37.72 574.15 T
(  infinitely long.) 37.72 565.81 T
(  Delays are inserted to simulate disk I/O \050and to make things) 37.72 549.13 T
(  run slower!\051.) 37.72 540.79 T
(*/) 37.72 532.45 T
(/*) 37.72 515.78 T
(cc -o one_queue_solution one_queue_solution.c -L. -R. -g -lpthread -lthread -) 37.72 507.44 T
(pthread_extensions -lposix4) 37.72 499.1 T
(*/) 37.72 490.77 T
(#define _POSIX_C_SOURCE 199506L) 37.72 474.09 T
(#include <pthread.h>) 37.72 457.41 T
(#include <semaphore.h>) 37.72 449.07 T
(#include <errno.h>) 37.72 440.74 T
(#include <time.h>) 37.72 432.4 T
(#include \322thread_extensions.h\323) 37.72 424.06 T
(struct request_struct) 37.72 390.71 T
({int                    client;) 37.72 382.37 T
( char                   *buf;) 37.72 374.03 T
( pthread_t              tid;) 37.72 365.69 T
( struct request_struct  *next;) 37.72 357.35 T
(};) 37.72 349.02 T
(typedef struct request_struct request_t;) 37.72 340.68 T
(request_t               *requests = NULL;) 37.72 324 T
(pthread_mutex_t         requests_lock = PTHREAD_MUTEX_INITIALIZER;) 37.72 315.66 T
(pthread_attr_t          attr;) 37.72 307.33 T
(sem_t                   requests_slots, requests_length;) 37.72 298.99 T
(int) 37.72 290.65 T
(max_length_empirical = 0, sval;) 230.69 290.65 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(16) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(int                     GET_DELAY = 200, PROCESS_DELAY = 250;) 411.22 695.65 T
(int                     N_PROD = 2, N_CONS = 2;) 411.22 687.31 T
(void print_requests\050\051) 411.22 653.95 T
({request_t *r = requests;) 411.22 645.62 T
( while \050r != NULL\051) 411.22 628.94 T
(   {printf\050\322<Request: %d>\134n\323, r->client\051;) 411.22 620.6 T
(    r = r->next;) 411.22 612.26 T
(  }) 411.22 603.92 T
(}) 411.22 595.59 T
(request_t *get_request\050\051) 411.22 570.57 T
({static int count = 0;) 411.22 562.23 T
( static pthread_mutex_t mr  = PTHREAD_MUTEX_INITIALIZER;) 411.22 553.9 T
( int c;) 411.22 545.56 T
( request_t *request;) 411.22 537.22 T
( pthread_t tid = pthread_self\050\051;) 411.22 528.88 T
( delay\050GET_DELAY, 0\051;) 411.22 512.21 T
( pthread_mutex_lock\050&mr\051;) 411.22 503.87 T
( c=count++;) 411.22 495.53 T
( pthread_mutex_unlock\050&mr\051;) 411.22 487.19 T
( request = \050request_t *\051 malloc\050sizeof\050request_t\051\051;) 411.22 470.52 T
( request->client = c;                        /* Cannot use count here! */) 411.22 462.18 T
( request->tid = pthread_self\050\051;) 411.22 453.84 T
( DEBUG\050printf\050\322[%s] Creating request  %4d\134n\323, thread_name\050tid\051, c\051\051;) 411.22 437.16 T
( return\050request\051;) 411.22 428.82 T
(}) 411.22 420.49 T
(void process_request\050request_t *request\051) 411.22 395.47 T
({pthread_t tid = pthread_self\050\051;) 411.22 387.13 T
(  delay\050PROCESS_DELAY, 0\051;) 411.22 370.46 T
(  DEBUG\050printf\050\322[%s] Processed request %4d [%s]\134n\323, thread_name\050tid\051,) 411.22 362.12 T
(               request->client, thread_name\050request->tid\051\051\051;) 411.22 353.78 T
(  free\050request\051;) 411.22 345.44 T
(}) 411.22 337.11 T
(request_t *remove_request\050\051) 411.22 312.09 T
({request_t *request;) 411.22 303.75 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 8
%%Page: "mini" 9
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(17) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_mutex_lock\050&requests_lock\051;) 37.72 695.65 T
( request = requests;) 37.72 687.31 T
( requests = requests->next;) 37.72 678.97 T
( pthread_mutex_unlock\050&requests_lock\051;) 37.72 670.63 T
( return\050request\051;) 37.72 662.29 T
(}) 37.72 653.95 T
(void add_request\050request_t *request\051) 37.72 628.94 T
({) 37.72 620.6 T
( pthread_mutex_lock\050&requests_lock\051;) 37.72 612.26 T
( request->next = requests;                      /* Insert at head of list */) 37.72 603.92 T
( requests = request;) 37.72 595.59 T
( sem_getvalue\050&requests_length, &sval\051;) 37.72 587.25 T
( if \050sval+1 > max_length_empirical\051) 37.72 578.91 T
(   max_length_empirical = sval+1;) 37.72 570.57 T
( pthread_mutex_unlock\050&requests_lock\051;) 37.72 562.23 T
(}) 37.72 553.9 T
(void *producer\050void *arg\051) 37.72 520.54 T
({request_t      *request;) 37.72 512.21 T
( while\050TRUE\051) 37.72 495.53 T
(   {) 37.72 487.19 T
(     SEM_WAIT\050&requests_slots\051;) 37.72 478.85 T
(     request = get_request\050\051;) 37.72 470.52 T
(     add_request\050request\051;) 37.72 462.18 T
(     sem_post\050&requests_length\051;) 37.72 453.84 T
(   }) 37.72 445.5 T
(}) 37.72 437.16 T
(void *consumer\050void *arg\051) 37.72 412.15 T
({request_t      *request;) 37.72 403.81 T
( while\050TRUE\051) 37.72 387.13 T
(   {) 37.72 378.8 T
(     SEM_WAIT\050&requests_length\051;) 37.72 370.46 T
(     request = remove_request\050\051;) 37.72 362.12 T
(     process_request\050request\051;) 37.72 353.78 T
(     sem_post\050&requests_slots\051;) 37.72 345.44 T
(   }) 37.72 337.11 T
(}) 37.72 328.77 T
(main\050int argc, char **argv\051) 37.72 303.75 T
({int i;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(18) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_t tid;) 411.22 695.65 T
( SEM_INIT\050&requests_length, NULL,  0\051;) 411.22 678.97 T
( SEM_INIT\050&requests_slots, NULL, 10\051;) 411.22 670.63 T
( PTHREAD_ATTR_INIT\050&attr\051;) 411.22 653.95 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 411.22 645.62 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 411.22 637.28 T
( if \050argc >= 2\051 GET_DELAY = atoi\050argv[1]\051;) 411.22 620.6 T
( if \050argc >= 3\051 PROCESS_DELAY = atoi\050argv[2]\051;) 411.22 612.26 T
( if \050argc >= 4\051 N_PROD        = atoi\050argv[3]\051;) 411.22 603.92 T
( if \050argc >= 5\051 N_CONS        = atoi\050argv[4]\051;) 411.22 595.59 T
( printf\050\322GET_DELAY \050ms\051 = %d PROCESS_DELAY \050ms\051 = %d N_PROD = %d N_CONS = %d\134n\323,) 411.22 587.25 T
(        GET_DELAY, PROCESS_DELAY, N_PROD, N_CONS\051;) 411.22 578.91 T
( for \050i=0; i<N_CONS; i++\051) 411.22 562.23 T
(   PTHREAD_CREATE\050&tid, &attr, consumer, NULL\051;) 411.22 553.9 T
( for \050i=0; i<N_PROD; i++\051) 411.22 545.56 T
(   PTHREAD_CREATE\050&tid, &attr, producer, NULL\051;) 411.22 537.22 T
( sleep\05020\051;) 411.22 520.54 T
( sem_getvalue\050&requests_length, &sval\051;) 411.22 512.21 T
( printf\050\322Done.\134nCurrent List length: %d Max length was: %d\134n\323,) 411.22 503.87 T
(sval, max_length_empirical\051;) 518.43 495.53 T
( exit\0500\051;) 411.22 487.19 T
(}) 411.22 478.85 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 9
%%Page: "mini" 10
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(19) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Using a Single Length Counter) 52.59 686.11 T
4 8.34 Q
(producer\050\051) 37.72 638.87 T
({while\050TRUE\051) 37.72 628.74 T
( {request = get_request\050\051;) 37.72 618.62 T
(  pthread_mutex_lock\050&m\051;) 37.72 608.49 T
(  while \050length>10\051) 37.72 598.37 T
(    pthread_cond_wait\050&producer_cv, &m\051;) 37.72 588.24 T
(  add\050request\051;) 37.72 578.12 T
(  length++;) 37.72 567.99 T
(  pthread_mutex_unlock\050&m\051;) 37.72 557.87 T
(  pthread_cond_signal\050&consumer_cv\051;) 37.72 547.74 T
(}}) 37.72 537.62 T
(consumer\050\051) 37.72 497.12 T
({while\050TRUE\051) 37.72 486.99 T
( {pthread_mutex_lock\050&m\051;) 37.72 476.87 T
(  while \050length==0\051) 37.72 466.74 T
(    pthread_cond_wait\050&consumer_cv, &m\051;) 37.72 456.62 T
(  request = remove\050\051;) 37.72 446.49 T
(  length--;) 37.72 436.37 T
(  pthread_mutex_unlock\050&m\051;) 37.72 426.24 T
(  pthread_cond_signal\050&producer_cv\051;) 37.72 416.12 T
(  process\050request\051;) 37.72 405.99 T
(}}) 37.72 395.87 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(20) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
411.22 329.36 727.48 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
580.16 655.27 M
 581.61 659.52 574.65 663.47 570.09 658.25 D
 565.51 653 559.89 665.82 551.87 656.26 D
1.79 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
90 450 0.89 0.89 90 566.26 644.24 GG
566.26 645.13 564 645.13 566.26 653.02 568.53 645.13 4 Y
0 Z
N
566.26 645.13 564 645.13 566.26 653.02 568.53 645.13 4 Y
V
566.26 644.24 566.26 638.4 2 L
2 Z
N
655.47 539.09 M
 656.92 543.34 649.95 547.29 645.4 542.07 D
 640.81 536.82 635.2 549.64 627.17 540.08 D
N
90 450 0.89 0.89 90 641.57 528.06 GG
641.57 528.95 639.31 528.95 641.57 536.84 643.83 528.95 4 Y
0 Z
N
641.57 528.95 639.31 528.95 641.57 536.84 643.83 528.95 4 Y
V
641.57 528.06 641.57 522.21 2 L
2 Z
N
2 10.72 Q
(if \050\336nd_pid\050\051\051) 0 -90 646.21 502.92 TF
(pthread_cancel\050...\051) 0 -90 635.56 495.59 TF
603.74 542.07 M
 605.2 546.31 598.23 550.26 593.67 545.04 D
 589.09 539.79 583.48 552.62 575.46 543.06 D
N
90 450 0.89 0.89 90 589.85 531.03 GG
589.85 531.93 587.59 531.93 589.85 539.82 592.11 531.93 4 Y
0 Z
N
589.85 531.93 587.59 531.93 589.85 539.82 592.11 531.93 4 Y
V
589.85 531.04 589.85 525.19 2 L
2 Z
N
(if \050\336nd_pid\050\051\051) 0 -90 594.49 505.89 TF
(pthread_cancel\050...\051) 0 -90 583.84 498.56 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
543.28 541.66 M
 544.73 545.91 537.77 549.86 533.21 544.64 D
 528.63 539.39 523.02 552.21 514.99 542.65 D
N
90 450 0.89 0.89 90 529.39 530.63 GG
529.39 531.53 527.12 531.53 529.39 539.41 531.65 531.53 4 Y
0 Z
N
529.39 531.53 527.12 531.53 529.39 539.41 531.65 531.53 4 Y
V
529.39 530.63 529.39 524.79 2 L
2 Z
N
(if \050\336nd_pid\050\051\051) 0 -90 534.03 505.49 TF
(pthread_cancel\050...\051) 0 -90 523.38 498.16 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
487.37 538.23 M
 488.83 542.48 481.86 546.43 477.3 541.21 D
 472.72 535.96 467.11 548.78 459.08 539.22 D
N
90 450 0.89 0.89 90 473.48 527.2 GG
473.48 528.09 471.21 528.09 473.48 535.98 475.74 528.09 4 Y
0 Z
N
473.48 528.09 471.21 528.09 473.48 535.98 475.74 528.09 4 Y
V
473.48 527.2 473.48 521.36 2 L
2 Z
N
(if \050\336nd_pid\050\051\051) 0 -90 478.11 502.06 TF
(pthread_cancel\050...\051) 0 -90 467.47 494.73 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
627.11 514.37 625.6 514.83 628.7 519.64 628.62 513.92 4 Y
0.6 H
0 Z
N
627.11 514.37 625.6 514.83 628.7 519.64 628.62 513.92 4 Y
V
587.46 412.44 M
 622.45 432.76 616.41 479.05 627.02 514.09 D
2 Z
N
555.22 525.95 554.1 524.84 551.36 529.83 556.33 527.05 4 Y
0 Z
N
555.22 525.95 554.1 524.84 551.36 529.83 556.33 527.05 4 Y
V
582.74 411.15 M
 546.09 436.17 585.8 495.17 555.43 525.73 D
2 Z
N
494.44 523.71 493.03 523.01 492.01 528.63 495.85 524.41 4 Y
0 Z
N
494.44 523.71 493.03 523.01 492.01 528.63 495.85 524.41 4 Y
V
584.03 409.44 M
 557.51 397.33 529.54 361.22 514.82 390.63 D
 497.52 425.21 506.56 464.31 497.53 500.82 D
 495.8 507.81 497.96 516.58 494.57 523.44 D
2 Z
N
625.5 574.7 627.03 575.06 626.78 569.37 623.97 574.33 4 Y
0 Z
N
625.5 574.7 627.03 575.06 626.78 569.37 623.97 574.33 4 Y
V
575.03 638.42 M
 601.69 627.23 618.88 602.21 625.43 574.99 D
2 Z
N
587.11 557.78 588.63 558.19 588.53 552.48 585.59 557.37 4 Y
0 Z
N
587.11 557.78 588.63 558.19 588.53 552.48 585.59 557.37 4 Y
V
568.59 635.85 M
 571.9 618.09 581.23 579.66 587.03 558.07 D
2 Z
N
530.9 559.48 532.47 559.57 531.18 554.01 529.33 559.4 4 Y
0 Z
N
530.9 559.48 532.47 559.57 531.18 554.01 529.33 559.4 4 Y
V
559.59 635.85 M
 531.48 620.65 529.38 588.23 530.88 559.78 D
2 Z
N
472.53 558.98 474.1 559.13 473.07 553.51 470.96 558.83 4 Y
0 Z
N
472.53 558.98 474.1 559.13 473.07 553.51 470.96 558.83 4 Y
V
556.59 642.71 M
 510.02 642.08 467.97 605.77 472.5 559.27 D
2 Z
N
2 19.06 Q
(Cancellation) 0 -90 699.52 555.23 TF
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 10
%%Page: "mini" 11
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(21) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Cancellation:) 141.94 686.11 T
(cancellation.c) 138.35 657.53 T
4 7.15 Q
(/*                cancellation.c                */) 37.72 615.84 T
(/*) 37.72 599.16 T
(   This program does a heuristic search for an integer, then cancels) 37.72 590.82 T
(   all threads that didn\325t find it.  The actual heuristic is silly) 37.72 582.48 T
(   \050it calls rand_r\050\051\051, but the technique is valid.) 37.72 574.15 T
(   All of the calls to delay\050\051 are there to slow things down and) 37.72 557.47 T
(   make different contention situations more likely.) 37.72 549.13 T
(   A couple of simple cleanup handlers are included.  In a real) 37.72 532.45 T
(   program, these would be even more complex.) 37.72 524.12 T
(   NB: sem_trywait\050\051 EBUSY in 2.5 is a bug.) 37.72 507.44 T
(   It *should* be EAGAIN \050fixed in 2.6\051.) 37.72 499.1 T
(*/) 37.72 490.77 T
(/*) 37.72 474.09 T
(cc -o cancellation cancellation.c -L. -R. -g -lpthread -lthread -) 37.72 465.75 T
(pthread_extensions -lposix4) 37.72 457.41 T
(*/) 37.72 449.07 T
(#define _POSIX_C_SOURCE 199506L) 37.72 432.4 T
(#include <stdio.h>) 37.72 424.06 T
(#include <stdlib.h>) 37.72 415.72 T
(#include <unistd.h>) 37.72 407.38 T
(#include <pthread.h>) 37.72 399.05 T
(#include <semaphore.h>) 37.72 390.71 T
(#include <errno.h>) 37.72 382.37 T
(#include \322thread_extensions.h\323) 37.72 374.03 T
(#ifdef __sun2_5                 /* This is a bug in Solaris 2.5 */) 37.72 357.35 T
(#define MY_EAGAIN EBUSY) 37.72 349.02 T
(#else) 37.72 340.68 T
(#define MY_EAGAIN EAGAIN        /* Correct errno value from trywait\050\051 */) 37.72 332.34 T
(#endif) 37.72 324 T
(#define NUM_THREADS 25          /* the number of searching threads */) 37.72 307.33 T
(pthread_attr_t  attr;) 37.72 290.65 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(22) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(pthread_t       threads[NUM_THREADS];) 411.22 695.65 T
(pthread_mutex_t threads_lock = PTHREAD_MUTEX_INITIALIZER;) 411.22 687.31 T
(pthread_mutex_t wait_lock    = PTHREAD_MUTEX_INITIALIZER;) 411.22 678.97 T
(pthread_mutex_t rand_lock    = PTHREAD_MUTEX_INITIALIZER;) 411.22 670.63 T
(sem_t           death_lock;     /* I\325m using it like a lock */) 411.22 662.29 T
(pthread_mutex_t count_lock   = PTHREAD_MUTEX_INITIALIZER;) 411.22 653.95 T
(pthread_cond_t  wait_cv      = PTHREAD_COND_INITIALIZER;) 411.22 645.62 T
(sem_t           cancel_barrier;) 411.22 637.28 T
(int answer;             /* Protected by death_lock */) 411.22 628.94 T
(void count_tries\050int i\051         /* Note the encapsulation */) 411.22 603.92 T
({static int count=0, old_count=0, max_count = 0;) 411.22 595.59 T
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 411.22 587.25 T
( pthread_mutex_lock\050&count_lock\051;) 411.22 570.57 T
( count += i;) 411.22 562.23 T
( if \050i == -1\051 printf\050\322\134n\134nTotal attempt count: %d\134n\323, max_count\051;) 411.22 553.9 T
( if \050count > max_count\051) 411.22 545.56 T
(   max_count = count;) 411.22 537.22 T
( pthread_mutex_unlock\050&count_lock\051;) 411.22 528.88 T
(}) 411.22 520.54 T
(void cleanup_count\050void *arg\051) 411.22 495.53 T
({int *ip = \050int *\051 arg;) 411.22 487.19 T
( int i = *ip;) 411.22 478.85 T
( pthread_t tid = pthread_self\050\051;) 411.22 470.52 T
( char *name = thread_name\050tid\051;) 411.22 462.18 T
( count_tries\050i\051;) 411.22 445.5 T
( printf\050\322%s exited \050maybe cancelled\051 on its %d try.\134n\323, name, i\051;) 411.22 437.16 T
( /* Note that you can\325t tell if the thread exited, or was cancelled. */) 411.22 428.82 T
(}) 411.22 420.49 T
(void cleanup_lock\050void *arg\051) 411.22 395.47 T
({pthread_t tid = pthread_self\050\051;) 411.22 387.13 T
( char *name = thread_name\050tid\051;) 411.22 378.8 T
(  printf\050\322Freeing & releasing: %s\134n\323, name\051;) 411.22 362.12 T
(  free\050arg\051;) 411.22 353.78 T
(  pthread_mutex_unlock\050&rand_lock\051;) 411.22 345.44 T
(        /* This would be hard to do in a real program. */) 411.22 337.11 T
(}) 411.22 328.77 T
(void *search\050void *arg\051) 411.22 303.75 T
({char *p;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 11
%%Page: "mini" 12
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(23) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( unsigned int seed;) 37.72 695.65 T
( int i=0, j, err, guess, target = \050int\051 arg;) 37.72 687.31 T
( pthread_t tid = pthread_self\050\051;) 37.72 678.97 T
( char *name = thread_name\050tid\051;) 37.72 670.63 T
( seed = \050unsigned int\051 tid;) 37.72 653.95 T
( pthread_cleanup_push\050cleanup_count, \050void *\051 &i\051; /* Q: Why &i ? */) 37.72 637.28 T
( pthread_setcanceltype\050PTHREAD_CANCEL_DEFERRED, NULL\051;) 37.72 628.94 T
( pthread_setcancelstate\050PTHREAD_CANCEL_ENABLE, NULL\051;) 37.72 620.6 T
( sem_post\050&cancel_barrier\051;     /* Don\325t start cancelling before here!   8 */) 37.72 612.26 T
( while \0501\051) 37.72 595.59 T
(   {i++;) 37.72 587.25 T
(        /* Extra stuff to make it more realistic and complex. */) 37.72 570.57 T
(    pthread_mutex_lock\050&rand_lock\051;) 37.72 562.23 T
(    p = \050char *\051 malloc\05010\051;            /* Must free this up! */) 37.72 553.9 T
(        /* Q:  What if you allow cancellation here? */) 37.72 545.56 T
(    pthread_cleanup_push\050cleanup_lock, \050void *\051 p\051;     /*  4 */) 37.72 537.22 T
(    guess = rand_r\050&seed\051;) 37.72 528.88 T
(    delay\0500, 10\051;) 37.72 520.54 T
(    pthread_testcancel\050\051;                               /*  5 */) 37.72 512.21 T
(    pthread_cleanup_pop\0500\051;) 37.72 503.87 T
(    /* Q:  What if you allow cancellation here? */      /*  6 */) 37.72 495.53 T
(    free\050p\051;) 37.72 487.19 T
(    pthread_mutex_unlock\050&rand_lock\051;) 37.72 478.85 T
(    delay\0500, 10\051;) 37.72 462.18 T
(    if \050target == guess\051) 37.72 445.5 T
(      {printf\050\322%s found the number on try %d!\134n\323, name, i\051; /*  7 */) 37.72 437.16 T
(       /* I could also simply do a sem_wait\050\051 and let cancellation work. */) 37.72 428.82 T
(       while \050\050\050err = sem_trywait\050&death_lock\051\051 == -1\051 && \050errno == EINTR\051\051 ;) 37.72 420.49 T
(       if \050\050err == -1\051 && \050errno == MY_EAGAIN\051\051) 37.72 412.15 T
(         /*  1 */) 37.72 403.81 T
(         {printf\050\322%s Exiting...\134n\323, name\051;) 37.72 395.47 T
(           pthread_exit\050NULL\051;                  /*  3 */) 37.72 387.13 T
(         }) 37.72 378.8 T
(       answer = guess;) 37.72 370.46 T
(       delay\0505000, 0\051;  /* Encourage a few more threads to find it. */) 37.72 362.12 T
(       /* Make sure all threads have gotten to #8 before cancelling */) 37.72 345.44 T
(       thread_single_barrier\050&cancel_barrier, NUM_THREADS\051;) 37.72 337.11 T
(       pthread_mutex_lock\050&threads_lock\051;) 37.72 328.77 T
(       for \050j=0;j<NUM_THREADS;j++\051) 37.72 320.43 T
(         if \050!pthread_equal\050threads[j], tid\051\051) 37.72 312.09 T
(           if \050pthread_cancel\050threads[j]\051 == ESRCH\051     /*  2 */) 37.72 303.75 T
(             printf\050\322Missed thread %s\134n\323, thread_name\050threads[j]\051\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(24) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(       pthread_mutex_unlock\050&threads_lock\051;) 411.22 695.65 T
(       break;                   /* Cannot release death_lock yet! */) 411.22 687.31 T
(     }) 411.22 678.97 T
(    pthread_testcancel\050\051;       /* Insert a known cancellation point */) 411.22 670.63 T
(  }) 411.22 662.29 T
( pthread_cleanup_pop\0501\051;) 411.22 653.95 T
( pthread_exit\050NULL\051;) 411.22 645.62 T
(}) 411.22 637.28 T
(start_searches\050\051) 411.22 612.26 T
({int i, pid, n_cancelled=0, status;) 411.22 603.92 T
( pthread_t tid;) 411.22 595.59 T
( pid = getpid\050\051;) 411.22 578.91 T
( while \050pid > RAND_MAX\051) 411.22 562.23 T
(     pid /= 2;) 411.22 553.9 T
( printf\050\322\134n\134nSearching for the number = %d...\134n\323, pid\051;) 411.22 537.22 T
( pthread_mutex_lock\050&threads_lock\051;   /* Q: Why do we need threads_lock ? */) 411.22 520.54 T
( for \050i=0;i<NUM_THREADS;i++\051) 411.22 512.21 T
(   PTHREAD_CREATE\050&threads[i], &attr, search, \050void *\051pid\051;) 411.22 503.87 T
( pthread_mutex_unlock\050&threads_lock\051;) 411.22 495.53 T
( for \050i=0;i<NUM_THREADS;i++\051) 411.22 478.85 T
(   {pthread_mutex_lock\050&threads_lock\051;) 411.22 470.52 T
(    tid = threads[i];                      /* Actually a constant now */) 411.22 462.18 T
(    pthread_mutex_unlock\050&threads_lock\051;   /* Q: Why like this? */) 411.22 453.84 T
(    pthread_join\050tid, \050void **\051 &status\051;) 411.22 445.5 T
(    if \050\050void *\051status == \050void *\051PTHREAD_CANCELED\051 n_cancelled++;) 411.22 437.16 T
(  }) 411.22 428.82 T
( sem_post\050&death_lock\051;         /* Cannot release any earlier! */) 411.22 420.49 T
( count_tries\050-1\051;) 411.22 412.15 T
( printf\050\322%d of the threads were cancelled.\134n\323, n_cancelled\051;) 411.22 403.81 T
( printf\050\322The answer was: %d\134n\323, answer\051;) 411.22 395.47 T
(}) 411.22 387.13 T
(main\050\051) 411.22 362.12 T
({int i;) 411.22 353.78 T
( PTHREAD_ATTR_INIT\050&attr\051;) 411.22 337.11 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 411.22 328.77 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_JOINABLE\051;/* Also default */) 411.22 320.43 T
( SEM_INIT\050&death_lock, NULL, 1\051;) 411.22 312.09 T
( SEM_INIT\050&cancel_barrier, NULL, 0\051;) 411.22 303.75 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 12
%%Page: "mini" 13
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(25) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( for \050i=0; i<2; i++\051) 37.72 695.65 T
(   start_searches\050\051;) 37.72 687.31 T
( printf\050\322Done\134n\323\051;) 37.72 670.63 T
( exit\0500\051;) 37.72 662.29 T
(}) 37.72 653.95 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(26) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Cancellation:) 515.44 686.11 T
(cancellation_not.c) 489.21 657.53 T
4 7.15 Q
(/*                cancellation_not.c                */) 411.22 624.17 T
(/*) 411.22 607.5 T
(   This program does a heuristic search for an integer, then cancels) 411.22 599.16 T
(   all threads that didn\325t find it.  The actual heuristic is silly) 411.22 590.82 T
(   \050it calls rand_r\050\051\051, but the technique is valid.) 411.22 582.48 T
(   All of the calls to delay\050\051 are there to slow things down and) 411.22 565.81 T
(   make different contention situations more likely.) 411.22 557.47 T
(   A couple of simple cleanup handlers are included.  In a real) 411.22 540.79 T
(   program, these would be even more complex.) 411.22 532.45 T
(   NB: sem_trywait\050\051 EBUSY in 2.5 is a bug.) 411.22 515.78 T
(   It *should* be EAGAIN \050fixed in 2.6\051.) 411.22 507.44 T
(*/) 411.22 499.1 T
(/*) 411.22 482.43 T
(cc -o cancellation cancellation.c -L. -R. -g -lpthread -lthread -) 411.22 474.09 T
(pthread_extensions -lposix4) 411.22 465.75 T
(*/) 411.22 457.41 T
(#define _POSIX_C_SOURCE 199506L) 411.22 440.74 T
(#include <stdio.h>) 411.22 432.4 T
(#include <stdlib.h>) 411.22 424.06 T
(#include <unistd.h>) 411.22 415.72 T
(#include <pthread.h>) 411.22 407.38 T
(#include <semaphore.h>) 411.22 399.05 T
(#include <errno.h>) 411.22 390.71 T
(#include \322thread_extensions.h\323) 411.22 382.37 T
(#ifdef __sun2_5                 /* This is a bug in Solaris 2.5 */) 411.22 365.69 T
(#define MY_EBUSY EBUSY) 411.22 357.35 T
(#else) 411.22 349.02 T
(#define MY_EBUSY EAGAIN         /* Correct errno value from trywait\050\051 */) 411.22 340.68 T
(#endif) 411.22 332.34 T
(#define NUM_THREADS 25          /* the number of searching threads */) 411.22 315.66 T
(pthread_attr_t  attr;) 411.22 298.99 T
(pthread_t       threads[NUM_THREADS];) 411.22 290.65 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 13
%%Page: "mini" 14
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(27) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(pthread_mutex_t threads_lock = PTHREAD_MUTEX_INITIALIZER;) 37.72 695.65 T
(pthread_mutex_t wait_lock    = PTHREAD_MUTEX_INITIALIZER;) 37.72 687.31 T
(pthread_mutex_t rand_lock    = PTHREAD_MUTEX_INITIALIZER;) 37.72 678.97 T
(sem_t           death_lock;     /* I\325m using it like a lock */) 37.72 670.63 T
(pthread_mutex_t count_lock   = PTHREAD_MUTEX_INITIALIZER;) 37.72 662.29 T
(pthread_cond_t  wait_cv      = PTHREAD_COND_INITIALIZER;) 37.72 653.95 T
(pthread_mutex_t cancel_lock   = PTHREAD_MUTEX_INITIALIZER;) 37.72 637.28 T
(int             time_to_die;) 37.72 628.94 T
(int answer;             /* Protected by death_lock */) 37.72 612.26 T
(void my_testcancel\050\051) 37.72 587.25 T
({int die;) 37.72 578.91 T
( if \050time_to_die\051       /* Quick test w/o mutex.  Might be TRUE in error. */) 37.72 562.23 T
(   {pthread_mutex_lock\050&cancel_lock\051;) 37.72 553.9 T
(    die = time_to_die;) 37.72 545.56 T
(    pthread_mutex_unlock\050&cancel_lock\051;) 37.72 537.22 T
(    /* NB: This will run the cleanup handlers. */) 37.72 528.88 T
(    if \050die\051 pthread_exit\050\050void *\051PTHREAD_CANCELED\051;) 37.72 520.54 T
(  }) 37.72 512.21 T
(}) 37.72 503.87 T
(void count_tries\050int i\051         /* Note the encapsulation */) 37.72 487.19 T
({static int count=0, old_count=0, max_count = 0;) 37.72 478.85 T
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 37.72 470.52 T
( pthread_mutex_lock\050&count_lock\051;) 37.72 453.84 T
( count += i;) 37.72 445.5 T
( if \050i == -1\051 printf\050\322\134n\134nTotal attempt count: %d\134n\323, max_count\051;) 37.72 437.16 T
( if \050count > max_count\051) 37.72 428.82 T
(   max_count = count;) 37.72 420.49 T
( pthread_mutex_unlock\050&count_lock\051;) 37.72 412.15 T
(}) 37.72 403.81 T
(void cleanup_count\050void *arg\051) 37.72 378.8 T
({int *ip = \050int *\051 arg;) 37.72 370.46 T
( int i = *ip;) 37.72 362.12 T
( pthread_t tid = pthread_self\050\051;) 37.72 353.78 T
( char *name = thread_name\050tid\051;) 37.72 345.44 T
( count_tries\050i\051;) 37.72 328.77 T
( printf\050\322%s exited \050maybe cancelled\051 on its %d try.\134n\323, name, i\051;) 37.72 320.43 T
( /* Note that you can\325t tell if the thread exited, or was cancelled. */) 37.72 312.09 T
(}) 37.72 303.75 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(28) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(void cleanup_lock\050void *arg\051) 411.22 687.31 T
({pthread_t tid = pthread_self\050\051;) 411.22 678.97 T
( char *name = thread_name\050tid\051;) 411.22 670.63 T
(  printf\050\322Freeing & releasing: %s\134n\323, name\051;) 411.22 653.95 T
(  free\050arg\051;) 411.22 645.62 T
(  pthread_mutex_unlock\050&rand_lock\051;) 411.22 637.28 T
(        /* This would be hard to do in a real program. */) 411.22 628.94 T
(}) 411.22 620.6 T
(void *search\050void *arg\051) 411.22 595.59 T
({char *p;) 411.22 587.25 T
( unsigned int seed;) 411.22 578.91 T
( int i=0, j, err, guess, target = \050int\051 arg;) 411.22 570.57 T
( pthread_t tid = pthread_self\050\051;) 411.22 562.23 T
( char *name = thread_name\050tid\051;) 411.22 553.9 T
( seed = \050unsigned int\051 tid;) 411.22 537.22 T
( pthread_setcanceltype\050PTHREAD_CANCEL_DEFERRED, NULL\051;) 411.22 520.54 T
( pthread_setcancelstate\050PTHREAD_CANCEL_ENABLE, NULL\051;) 411.22 512.21 T
( pthread_cleanup_push\050cleanup_count, \050void *\051 &i\051; /* Q: Why &i ? */) 411.22 503.87 T
( while \0501\051) 411.22 487.19 T
(   {i++;) 411.22 478.85 T
(        /* Extra stuff to make it more realistic and complex. */) 411.22 462.18 T
(    pthread_mutex_lock\050&rand_lock\051;) 411.22 453.84 T
(    p = \050char *\051 malloc\05010\051;            /* Must free this up! */) 411.22 445.5 T
(        /* Q:  What if you allow cancellation here? */) 411.22 437.16 T
(    pthread_cleanup_push\050cleanup_lock, \050void *\051 p\051;     /*   4 */) 411.22 428.82 T
(    guess = rand_r\050&seed\051;) 411.22 420.49 T
(    delay\0500, 10\051;) 411.22 412.15 T
(    my_testcancel\050\051;                            /*   5 */) 411.22 403.81 T
(    pthread_cleanup_pop\0500\051;) 411.22 395.47 T
(    /* Q:  What if you allow cancellation here? */      /*   6 */) 411.22 387.13 T
(    free\050p\051;) 411.22 378.8 T
(    pthread_mutex_unlock\050&rand_lock\051;) 411.22 370.46 T
(    delay\0500, 10\051;) 411.22 353.78 T
(    if \050target == guess\051) 411.22 337.11 T
(      {printf\050\322%s found the number on try %d!\134n\323, name, i\051; /*   7 */) 411.22 328.77 T
(       /* I could also simply do a sem_wait\050\051 and let cancellation work. */) 411.22 320.43 T
(       while \050\050\050err = sem_trywait\050&death_lock\051\051 == -1\051 && \050errno == EINTR\051\051 ;) 411.22 312.09 T
(       if \050\050err == -1\051 && \050errno == MY_EBUSY\051\051   /*  1 */) 411.22 303.75 T
(         {printf\050\322%s Exiting...\134n\323, name\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 14
%%Page: "mini" 15
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(29) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(           pthread_exit\050NULL\051;                  /*   3 */) 37.72 695.65 T
(         }) 37.72 687.31 T
(       delay\0505000, 0\051;  /* Encourage a few more threads to find it. */) 37.72 678.97 T
(       answer = guess;) 37.72 670.63 T
(       pthread_mutex_lock\050&cancel_lock\051;) 37.72 662.29 T
(       time_to_die = TRUE;) 37.72 653.95 T
(       pthread_mutex_unlock\050&cancel_lock\051;) 37.72 645.62 T
(       break;                   /* Cannot release death_lock yet! */) 37.72 637.28 T
(     }) 37.72 628.94 T
(    my_testcancel\050\051;    /* Insert a known cancellation point */) 37.72 620.6 T
(  }) 37.72 612.26 T
( pthread_cleanup_pop\0501\051;) 37.72 603.92 T
( pthread_exit\050NULL\051;) 37.72 595.59 T
(}) 37.72 587.25 T
(start_searches\050\051) 37.72 562.23 T
({int i, pid, n_cancelled=0, status;) 37.72 553.9 T
( pthread_t tid;) 37.72 545.56 T
( pid = getpid\050\051;) 37.72 528.88 T
( while \050pid > RAND_MAX\051) 37.72 512.21 T
(     pid /= 2;) 37.72 503.87 T
( pthread_mutex_lock\050&cancel_lock\051;) 37.72 495.53 T
( time_to_die = FALSE;) 37.72 487.19 T
( pthread_mutex_unlock\050&cancel_lock\051;) 37.72 478.85 T
( printf\050\322\134n\134nSearching for the number = %d...\134n\323, pid\051;) 37.72 453.84 T
( pthread_mutex_lock\050&threads_lock\051;   /* Q: Why do we need threads_lock ? */) 37.72 437.16 T
( for \050i=0;i<NUM_THREADS;i++\051) 37.72 428.82 T
(   PTHREAD_CREATE\050&threads[i], &attr, search, \050void *\051pid\051;) 37.72 420.49 T
( pthread_mutex_unlock\050&threads_lock\051;) 37.72 412.15 T
( for \050i=0;i<NUM_THREADS;i++\051) 37.72 395.47 T
(   {pthread_mutex_lock\050&threads_lock\051;) 37.72 387.13 T
(    tid = threads[i];                      /* Actually a constant now */) 37.72 378.8 T
(    pthread_mutex_unlock\050&threads_lock\051;   /* Q: Why like this? */) 37.72 370.46 T
(    pthread_join\050tid, \050void **\051 &status\051;) 37.72 362.12 T
(    if \050\050void *\051status == \050void *\051PTHREAD_CANCELED\051 n_cancelled++;) 37.72 353.78 T
(  }) 37.72 345.44 T
( sem_post\050&death_lock\051;         /* Cannot release any earlier! */) 37.72 337.11 T
( count_tries\050-1\051;) 37.72 328.77 T
( printf\050\322%d of the threads were cancelled.\134n\323, n_cancelled\051;) 37.72 320.43 T
( printf\050\322The answer was: %d\134n\323, answer\051;) 37.72 312.09 T
(}) 37.72 303.75 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(30) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(main\050\051) 411.22 687.31 T
({int i;) 411.22 678.97 T
( PTHREAD_ATTR_INIT\050&attr\051;) 411.22 662.29 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 411.22 653.95 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_JOINABLE\051;/* Also default */) 411.22 645.62 T
( SEM_INIT\050&death_lock, NULL, 1\051;) 411.22 637.28 T
( for \050i=0; i<2; i++\051) 411.22 620.6 T
(   start_searches\050\051;) 411.22 612.26 T
( printf\050\322Done\134n\323\051;) 411.22 595.59 T
( exit\0500\051;) 411.22 587.25 T
(}) 411.22 578.91 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 15
%%Page: "mini" 16
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(31) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
37.72 287.67 380.78 700.41 C
37.72 309.11 380.78 689.69 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
1.79 H
0 Z
0 X
0 0 0 1 0 0 0 K
90 450 33.06 44.98 270 163.53 436.63 AA
154.86 446.33 173.18 484.49 R
7 X
V
0.3 H
0 X
N
154.86 392.06 173.18 421.66 R
7 X
V
0 X
N
2 8.34 Q
(Read) 0 -90 161.27 416.06 TF
(Ex) 0 -90 161.27 481.8 TF
(ecute) 0 -90 161.27 471.69 TF
90 450 0.89 0.89 190.68 182.23 406.86 GG
181.35 406.69 181.6 405.36 176.69 405.82 181.1 408.03 4 Y
1.79 H
N
181.35 406.69 181.6 405.36 176.69 405.82 181.1 408.03 4 Y
V
183.97 407.19 182.23 406.86 2 L
7 X
V
2 Z
0 X
N
90 450 0.89 0.89 16.27 146.08 466.89 GG
146.94 467.14 146.57 468.42 151.42 468.45 147.32 465.85 4 Y
0 Z
N
146.94 467.14 146.57 468.42 151.42 468.45 147.32 465.85 4 Y
V
144.39 466.39 146.08 466.89 2 L
7 X
V
2 Z
0 X
N
4 F
(WorkComplete\050\051) 0 -90 127.84 625.02 TF
({... revert button ...}) 0 -90 119.66 625.02 TF
(ButtonPushed\050\051) 0 -90 199.62 636.27 TF
({.. invert button ...) 0 -90 191.45 636.27 TF
178.37 502.29 177.13 503.27 181.78 506.59 179.6 501.31 4 Y
0.6 H
0 Z
N
178.37 502.29 177.13 503.27 181.78 506.59 179.6 501.31 4 Y
V
165.09 485.55 178.18 502.06 2 L
7 X
V
2 Z
0 X
N
137.51 505.1 136.6 503.82 133.03 508.27 138.42 506.38 4 Y
0 Z
N
137.51 505.1 136.6 503.82 133.03 508.27 138.42 506.38 4 Y
V
165.09 485.55 137.75 504.93 2 L
7 X
V
2 Z
0 X
N
2 F
(Pipe) 0 -90 109.91 362.96 TF
(Mouse) 0 -90 200.62 407.88 TF
144.46 393.2 143.4 394.36 148.5 396.92 145.53 392.04 4 Y
0 Z
N
144.46 393.2 143.4 394.36 148.5 396.92 145.53 392.04 4 Y
V
118.55 358.18 137.2 376.6 126.4 376.6 144.24 393 4 L
2 Z
N
182.32 398.38 182.5 396.81 176.87 397.77 182.15 399.94 4 Y
0 Z
N
182.32 398.38 182.5 396.81 176.87 397.77 182.15 399.94 4 Y
V
195.75 391.07 184.95 391.07 187.57 398.96 182.62 398.41 4 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
(DoWork\050\051) 0 -90 272.54 459.56 TF
({sleep\0506\051;) 0 -90 261.81 459.56 TF
(write\050Pipe\051;) 0 -90 251.47 459.56 TF
(}) 0 -90 240.37 459.56 TF
( pthread_create\050DoWork\051;}) 0 -90 183.11 636.27 TF
2 21.44 Q
(Windo) 0 -90 343.94 573.91 TF
(w T) 0 -90 343.94 508.73 TF
(oolkits) 0 -90 343.94 474.7 TF
4 8.34 Q
(% ThreadWin [MT]) 0 -90 295.15 646.45 TF
37.72 287.67 380.78 700.41 C
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(32) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Threads and X11:) 493.38 686.11 T
(ThreadWin.c) 518.42 657.53 T
4 7.15 Q
( /*                ThreadWin.c                */) 411.22 615.84 T
(/*) 411.22 599.16 T
(  Simple window program that inverts the colour of each button for) 411.22 590.82 T
(  6 seconds.) 411.22 582.48 T
(  In the non-threaded version, it hangs for 6 seconds with the GUI) 411.22 565.81 T
(  inactive \050tho events are queued\051.  In the MT version, it spawns off) 411.22 557.47 T
(  a new thread to do that long \322calculation\323, hence the GUI remains) 411.22 549.13 T
(  active.  Upon completion, the thread writes to a pipe.  The X) 411.22 540.79 T
(  notifier reads from that pipe and inverts the colour back to the) 411.22 532.45 T
(  original colour.) 411.22 524.12 T
(*/) 411.22 515.78 T
(/*) 411.22 507.44 T
(cc -o ThreadWin ThreadWin.c -L. -R. -g -lpthread -lthread -pthread_extensions -) 411.22 499.1 T
(lposix4 -I/usr/dt/include -I/usr/openwin/include -L/usr/openwin/lib -L/usr/dt/) 411.22 490.77 T
(lib -R/usr/openwin/lib -R/usr/dt/lib -lXm -lXt -lX11 -lm) 411.22 482.43 T
(*/) 411.22 465.75 T
(#define _POSIX_C_SOURCE 199506L) 411.22 449.07 T
(#include <stdio.h>) 411.22 440.74 T
(#include <unistd.h>) 411.22 432.4 T
(#include <stdlib.h>) 411.22 424.06 T
(#include <math.h>) 411.22 415.72 T
(#include <X11/Intrinsic.h>) 411.22 407.38 T
(#include <X11/X.h>) 411.22 399.05 T
(#include <X11/StringDefs.h>) 411.22 390.71 T
(#include <Xm/Xm.h>) 411.22 382.37 T
(#include <Xm/RowColumn.h>) 411.22 374.03 T
(#include <Xm/PushB.h>) 411.22 365.69 T
(#include <pthread.h>) 411.22 357.35 T
(#include \322thread_extensions.h\323) 411.22 349.02 T
(#define READ 0) 411.22 332.34 T
(#define WRITE 1) 411.22 324 T
(/* function prototypes */) 411.22 298.99 T
(int                     ButtonPushed\050Widget, XtPointer\051;) 411.22 290.65 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 16
%%Page: "mini" 17
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(33) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(void                    *DoWork\050void *\051;) 37.72 695.65 T
(XtAppContext            _XtDefaultAppContext\050\051;) 37.72 687.31 T
(XtInputCallbackProc     WorkComplete\050\051;) 37.72 678.97 T
(static int              message[2];) 37.72 670.63 T
(pthread_attr_t          attr;) 37.72 662.29 T
(main\050int argc, char **argv\051) 37.72 637.28 T
({Widget                 toplevel, base, button[200];) 37.72 628.94 T
( Arg                    wargs[10];) 37.72 620.6 T
( int                    i, MT=0, N_BUTTONS=25;) 37.72 612.26 T
( char                   but_label[5];) 37.72 603.92 T
( XEvent                 event, fake;) 37.72 595.59 T
( Display                *disp;) 37.72 587.25 T
( Window                 win;) 37.72 578.91 T
( XtAppContext           app;) 37.72 570.57 T
( pthread_t              tid;) 37.72 562.23 T
( /* check arguments */) 37.72 545.56 T
( if \050argc > 2\051) 37.72 537.22 T
(   printf\050\322Usage: %s [MT]\134n\323, argv[0]\051, exit\0500\051;) 37.72 528.88 T
( if \050argc == 2 && strcmp\050argv[1], \322MT\323\051 == 0\051 MT = 1;) 37.72 512.21 T
( if \050pipe\050message\051 < 0\051) 37.72 495.53 T
(   {fprintf\050stderr, \322Can\325t open pipe\134n\323\051;) 37.72 487.19 T
(    exit\0501\051;) 37.72 478.85 T
(  }) 37.72 470.52 T
( PTHREAD_ATTR_INIT\050&attr\051;) 37.72 462.18 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 37.72 453.84 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 37.72 445.5 T
( PTHREAD_CREATE\050&tid, &attr, killer, \050void *\051 60\051;) 37.72 437.16 T
( /* setup our main window */) 37.72 420.49 T
( toplevel=XtInitialize\050argv[0], \322ThreadWin\323, NULL, 0, &argc, argv\051;) 37.72 412.15 T
( /* set some arguments for our Row/Column Widget */) 37.72 395.47 T
( XtSetArg\050wargs[0], XmNorientation, XmHORIZONTAL\051;) 37.72 387.13 T
( XtSetArg\050wargs[1], XmNentryAlignment, XmALIGNMENT_CENTER\051;) 37.72 378.8 T
( XtSetArg\050wargs[2], XmNisAligned, True\051;) 37.72 370.46 T
( XtSetArg\050wargs[3], XmNnumColumns, \050int\051floor\050sqrt\050\050double\051N_BUTTONS\051\051\051;) 37.72 362.12 T
( XtSetArg\050wargs[4], XmNpacking, XmPACK_COLUMN\051;) 37.72 353.78 T
( /* create the Row/Column Widget */) 37.72 337.11 T
( base=XtCreateManagedWidget\050\322base\323, xmRowColumnWidgetClass,) 37.72 328.77 T
(                            toplevel, wargs, 5\051;) 37.72 320.43 T
( /* create the button widgets with the button number as it label */) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(34) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( for \050i=0;i<N_BUTTONS;i++\051) 411.22 695.65 T
(   {sprintf\050but_label, \322 %d \322, i\051;) 411.22 687.31 T
(    XtSetArg\050wargs[0], XmNlabelString,) 411.22 678.97 T
(             XmStringCreate\050but_label, XmSTRING_DEFAULT_CHARSET\051\051;) 411.22 670.63 T
(    button[i] = XmCreatePushButton\050base, \322button\323, wargs, 1\051;) 411.22 662.29 T
(    /* tell the button to call ButtonPushed\050\051 when pushed */) 411.22 645.62 T
(    XtAddCallback\050button[i], XmNactivateCallback,) 411.22 637.28 T
(                  \050XtCallbackProc\051 ButtonPushed, \050void *\051MT\051;) 411.22 628.94 T
(  }) 411.22 620.6 T
( /* manage the buttons and go into the X event loop */) 411.22 603.92 T
( XtManageChildren\050button, N_BUTTONS\051;) 411.22 595.59 T
( XtRealizeWidget\050toplevel\051;) 411.22 587.25 T
( app = _XtDefaultAppContext\050\051;) 411.22 578.91 T
( XtAppAddInput\050app, message[READ], \050void *\051XtInputReadMask,) 411.22 570.57 T
(               \050XtInputCallbackProc\051WorkComplete, NULL\051;) 411.22 562.23 T
( XtMainLoop\050\051;) 411.22 553.9 T
(}) 411.22 545.56 T
(XtInputCallbackProc WorkComplete\050\051) 411.22 520.54 T
({Pixel          fg, bg;) 411.22 512.21 T
( Arg            warg[2];) 411.22 503.87 T
( Widget         w;) 411.22 495.53 T
( if \050read\050message[READ], &w, sizeof\050w\051\051 != sizeof\050w\051\051) 411.22 478.85 T
(   {fprintf\050stderr, \322Read error\134n\323\051;) 411.22 470.52 T
(   exit\0501\051;) 411.22 462.18 T
( }) 411.22 453.84 T
( /* get the buttons foreground and background colors */) 411.22 437.16 T
( XtSetArg\050warg[0], XmNforeground, &fg\051;) 411.22 428.82 T
( XtSetArg\050warg[1], XmNbackground, &bg\051;) 411.22 420.49 T
( XtGetValues\050w, warg, 2\051;) 411.22 412.15 T
( /* swap the buttons foreground and background colors */) 411.22 395.47 T
( XtSetArg\050warg[0], XmNforeground, bg\051;) 411.22 387.13 T
( XtSetArg\050warg[1], XmNbackground, fg\051;) 411.22 378.8 T
( XtSetValues\050w, warg, 2\051;) 411.22 370.46 T
( XtSetSensitive\050w, True\051;) 411.22 353.78 T
( return\050\050XtInputCallbackProc\0510\051;) 411.22 345.44 T
(}) 411.22 337.11 T
(/*) 411.22 320.43 T
(        Button callback routine -- Called when a button is pushed) 411.22 312.09 T
(*/) 411.22 303.75 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 17
%%Page: "mini" 18
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(35) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(int ButtonPushed\050Widget w, XtPointer MT\051) 37.72 695.65 T
({int            mt = \050int\051 MT;) 37.72 687.31 T
( Pixel          fg, bg;) 37.72 678.97 T
( Arg            warg[2];) 37.72 670.63 T
( pthread_t      tid;) 37.72 662.29 T
( XtSetSensitive\050w, False\051;) 37.72 645.62 T
( /* get the buttons foreground and background colors */) 37.72 628.94 T
( XtSetArg\050warg[0], XmNforeground, &fg\051;) 37.72 620.6 T
( XtSetArg\050warg[1], XmNbackground, &bg\051;) 37.72 612.26 T
( XtGetValues\050w, warg, 2\051;) 37.72 603.92 T
( /* swap the buttons foreground and background colors */) 37.72 587.25 T
( XtSetArg\050warg[0], XmNforeground, bg\051;) 37.72 578.91 T
( XtSetArg\050warg[1], XmNbackground, fg\051;) 37.72 570.57 T
( XtSetValues\050w, warg, 2\051;) 37.72 562.23 T
( if \050MT\051) 37.72 545.56 T
(   PTHREAD_CREATE\050&tid, &attr, DoWork, \050void *\051w\051;) 37.72 537.22 T
( else) 37.72 528.88 T
(   DoWork\050\050void *\051w\051;) 37.72 520.54 T
( return\0500\051;) 37.72 495.53 T
(}) 37.72 487.19 T
(void *DoWork\050void *arg\051) 37.72 462.18 T
({Widget                 w = \050Widget\051 arg;) 37.72 453.84 T
( pthread_t              tid = pthread_self\050\051;) 37.72 445.5 T
( char                   *name = thread_name\050tid\051;) 37.72 437.16 T
( printf\050\322Thread %s: Start Processing...\134n\323, name\051;) 37.72 420.49 T
( sleep\0506\051;) 37.72 412.15 T
( printf\050\322Thread %s: Processing done...\134n\323, name\051;) 37.72 403.81 T
( if \050write\050message[WRITE], &w, sizeof\050w\051\051 != sizeof\050w\051\051) 37.72 387.13 T
(   {fprintf\050stderr, \322Write error\134n\323\051;) 37.72 378.8 T
(    exit\0501\051;) 37.72 370.46 T
(  }) 37.72 362.12 T
( return\050\050void *\0510\051;) 37.72 353.78 T
(}) 37.72 345.44 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(36) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
411.22 340.77 728.11 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
665.89 631.47 687.76 678.21 R
0.6 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
607.57 619.46 647.43 681.21 R
N
644.88 450.51 669.32 579.15 R
N
644.88 480.1 669.32 537.56 R
N
2 10.72 Q
(Jan) 0 -90 655.19 571.56 TF
($15000) 0 -90 654.76 524.92 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 657.1 464.66 GG
90 450 5.57 4.93 270 657.1 464.66 AA
588.7 424.35 613.14 552.99 R
N
588.7 453.94 613.14 511.4 R
N
(Kim) 0 -90 599.01 545.4 TF
($18000) 0 -90 598.59 498.76 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 600.92 438.5 GG
90 450 5.57 4.93 270 600.92 438.5 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
530.38 381.9 554.83 510.54 R
N
530.38 411.49 554.83 468.95 R
N
(Mari) 0 -90 540.7 502.95 TF
($64000) 0 -90 540.27 456.31 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 542.6 396.05 GG
90 450 5.57 4.93 270 542.6 396.05 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
542.07 529.68 543.64 529.7 542.13 524.2 540.49 529.66 4 Y
0 Z
N
542.07 529.68 543.64 529.7 542.13 524.2 540.49 529.66 4 Y
V
601.14 438.07 M
 607.06 428.85 608.34 407.62 592.44 416.54 D
 551.82 439.33 581.76 500.97 561.47 540.98 D
 558.23 547.37 546.04 547.69 542.9 538.67 D
 541.93 535.86 542.03 532.93 542.06 529.98 D
2 Z
N
598.02 567.07 599.59 567 597.78 561.59 596.45 567.14 4 Y
0 Z
N
598.02 567.07 599.59 567 597.78 561.59 596.45 567.14 4 Y
V
656.88 463.37 M
 662.18 452.74 656.27 433.61 642.07 445.09 D
 608.88 471.92 637.29 530.37 626.22 574.73 D
 623.87 584.11 608.18 585.9 602.64 579.04 D
 599.77 575.48 598.21 571.48 598.03 567.36 D
2 Z
N
90 450 5.57 4.93 270 676.82 642.61 GG
90 450 5.57 4.93 270 676.82 642.61 AA
653.11 591 654.67 591.21 653.84 585.57 651.55 590.79 4 Y
0 Z
N
653.11 591 654.67 591.21 653.84 585.57 651.55 590.79 4 Y
V
677.46 640.47 M
 686.49 622.45 675.69 614.98 658.95 610.21 D
 651.21 608.01 651.96 599.6 653.07 591.29 D
2 Z
N
627.02 681.21 627.02 619.46 2 L
N
647.54 640.47 607.68 640.47 2 L
N
687.33 650.33 665.89 650.33 2 L
N
(list) 0 -90 674.03 673.92 TF
(m) 0 -90 635.67 676.92 TF
(ute) 0 -90 635.67 667.6 TF
(x) 0 -90 635.67 651.68 TF
(sleep) 0 -90 614.77 676.92 TF
90 450 5.57 5.59 270 618.02 631.47 GG
90 450 5.57 5.59 270 618.02 631.47 AA
573.78 552.73 574.73 553.98 578.16 549.41 572.83 551.47 4 Y
0 Z
N
573.78 552.73 574.73 553.98 578.16 549.41 572.83 551.47 4 Y
V
556.21 654.19 M
 552.77 621.12 544.53 574.9 573.54 552.91 D
2 Z
N
546.77 643.47 568.64 690.21 R
N
90 450 5.57 4.93 270 557.71 654.62 GG
90 450 5.57 4.93 270 557.71 654.62 AA
568.22 662.34 546.77 662.34 2 L
N
(ptr) 0 -90 554.92 685.92 TF
566.5 614.31 538.2 587.3 2 L
2.38 H
N
567.79 586.87 537.34 616.46 2 L
N
(NO!) 0 -90 574.72 609.6 TF
(1) 0 -90 635.36 634.42 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 19.06 Q
(Linked Lists: Global Loc) 0 -90 709.15 636.01 TF
(k) 0 -90 709.15 415.05 TF
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 18
%%Page: "mini" 19
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(37) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Linked Lists, Global Mute) 70.01 686.11 T
(x:) 329.43 686.11 T
(list_global_loc) 120.09 657.53 T
(k.c) 268.61 657.53 T
4 7.15 Q
( /*                list_global_lock.c                */) 37.72 615.84 T
(/*) 37.72 599.16 T
(  Make a list of people \050with names like \322Jan_1234\323\051 and their salaries.) 37.72 582.48 T
(  Then spawn some threads to run down that list and give raises to all) 37.72 574.15 T
(  the people I like.  Spawn some more threads to delete from the list) 37.72 565.81 T
(  the people you don\325t like.  \050Some people I like might also be people) 37.72 557.47 T
(  you don\325t like.\051) 37.72 549.13 T
(  Insert delays during the raising and deleting functions to simulate disk) 37.72 532.45 T
(  I/O and make the program more interesting.) 37.72 524.12 T
(  Now consider the following parameters:) 37.72 507.44 T
(        o  Raise delay) 37.72 499.1 T
(        o  Liquidation delay) 37.72 490.77 T
(        o  Time for average search) 37.72 482.43 T
(  Which of the various locking designs works fastest for which combination) 37.72 465.75 T
(  of the above?) 37.72 457.41 T
(  This program allocates one global mutex to protect everything.) 37.72 424.06 T
(  GLOBAL_LOCK) 37.72 407.38 T
(         __________________________________) 37.72 390.71 T
(        |    Name      |  salary  |  next  |) 37.72 382.37 T
(        |  \322Jan_123\323   |  100000  |    o---|------>) 37.72 374.03 T
(        |______________|__________|________|) 37.72 365.69 T
(*/) 37.72 349.02 T
(/*) 37.72 332.34 T
(cc -o list_global_lock list_global_lock.c -L. -R. -g -lpthread -lthread -) 37.72 324 T
(pthread_extensions -lposix4) 37.72 315.66 T
(*/) 37.72 307.33 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(38) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(#define _POSIX_C_SOURCE 199506L) 411.22 695.65 T
(#include <signal.h>) 411.22 678.97 T
(#include <stdio.h>) 411.22 670.63 T
(#include <pthread.h>) 411.22 662.29 T
(#include <semaphore.h>) 411.22 653.95 T
(#include <errno.h>) 411.22 645.62 T
(#include <time.h>) 411.22 637.28 T
(#include <sys/time.h>) 411.22 628.94 T
(#include <stdlib.h>) 411.22 620.6 T
(#include \322thread_extensions.h\323) 411.22 612.26 T
(typedef struct person_struct) 411.22 587.25 T
({char *                 name;) 411.22 578.91 T
( int                    salary;) 411.22 570.57 T
( struct person_struct * next;) 411.22 562.23 T
(} person_t;) 411.22 553.9 T
(sem_t           barrier;) 411.22 512.21 T
(pthread_mutex_t people_lock = PTHREAD_MUTEX_INITIALIZER;) 411.22 503.87 T
(person_t        people;) 411.22 495.53 T
(int             E_THREADS = 1;         /* # threads running liquidate */) 411.22 478.85 T
(int             F_THREADS = 10;        /* # threads running raise */) 411.22 470.52 T
(int             N_PEOPLE = 1000;       /* # of people in initial list */) 411.22 462.18 T
(int             N_FRIENDS = 100;       /* # of people to give raises */) 411.22 453.84 T
(int             LIQUIDATE_DELAY = 100; /* sleep time during liquidation */) 411.22 445.5 T
(int             RAISE_DELAY = 100;     /* sleep time during raise giving */) 411.22 437.16 T
(void count_conflicts\050int i\051             /* Note the encapsulation */) 411.22 403.81 T
({static int             count=0, old_count=0, max_count = 0;) 411.22 395.47 T
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 411.22 387.13 T
( pthread_mutex_lock\050&count_lock\051;) 411.22 370.46 T
( count += i;) 411.22 362.12 T
( if \050i == -1\051 printf\050\322Conflicts: %d\134n\323, max_count\051;) 411.22 353.78 T
( if \050count > max_count\051) 411.22 345.44 T
(   max_count = count;) 411.22 337.11 T
( pthread_mutex_unlock\050&count_lock\051;) 411.22 328.77 T
(}) 411.22 320.43 T
(void count_finds\050int i\051         /* Note the encapsulation */) 411.22 303.75 T
({static int count=0, old_count=0, max_count = 0;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 19
%%Page: "mini" 20
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(39) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 37.72 695.65 T
( pthread_mutex_lock\050&count_lock\051;) 37.72 678.97 T
( count += i;) 37.72 670.63 T
( if \050i == -1\051 printf\050\322Total raises + liquidations: %d\134n\323, max_count\051;) 37.72 662.29 T
( if \050count > max_count\051) 37.72 653.95 T
(   max_count = count;) 37.72 645.62 T
( pthread_mutex_unlock\050&count_lock\051;) 37.72 637.28 T
(}) 37.72 628.94 T
(void print_people\050person_t *p\051  /* Debugging function. Not 100% MT safe */) 37.72 603.92 T
({int i = 0;) 37.72 595.59 T
( pthread_mutex_lock\050&people_lock\051;) 37.72 578.91 T
( while\050p != NULL\051) 37.72 570.57 T
(   {printf\050\322\050%s  %d\051 \322, p->name, p->salary\051;) 37.72 562.23 T
(    p = p->next;) 37.72 553.9 T
(    i++;) 37.72 545.56 T
(    if \050\050i % 5\051 == 0\051 printf\050\322\134n\323\051;) 37.72 537.22 T
(  }) 37.72 528.88 T
( pthread_mutex_unlock\050&people_lock\051;) 37.72 520.54 T
(}) 37.72 512.21 T
(person_t *find_person\050char *name\051) 37.72 487.19 T
({person_t *p = &people, *p1, *p2;) 37.72 478.85 T
( p1 = p->next;) 37.72 462.18 T
( while\050p1 != NULL\051) 37.72 453.84 T
(   {if \050strcmp\050p1->name, name\051 == 0\051) 37.72 445.5 T
(      /* Found! Return previous, Still holding p->lock ! */) 37.72 437.16 T
(      {count_finds\0501\051; return\050p\051;}) 37.72 428.82 T
(    p = p1;) 37.72 420.49 T
(    p1 = p->next;) 37.72 412.15 T
(  }) 37.72 403.81 T
( return\050NULL\051;                           /* Couldn\325t find \324em!  Too bad. */) 37.72 395.47 T
(}) 37.72 387.13 T
(void give_raise\050person_t *p\051) 37.72 362.12 T
({) 37.72 353.78 T
(  if \050p == NULL\051 return;) 37.72 345.44 T
(  p->next->salary++;) 37.72 337.11 T
(  delay\050RAISE_DELAY, 0\051;) 37.72 328.77 T
(}) 37.72 320.43 T
(pthread_mutex_lock_conflicts\050pthread_mutex_t *people_lock\051) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(40) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
({if \050pthread_mutex_trylock\050people_lock\051 == EBUSY\051) 411.22 695.65 T
(      {count_conflicts\0501\051;) 411.22 687.31 T
(       pthread_mutex_lock\050people_lock\051;) 411.22 678.97 T
(  }) 411.22 670.63 T
(}) 411.22 662.29 T
(void *give_friends_raise\050void *arg\051) 411.22 645.62 T
({person_t *p, *friends = \050person_t *\051 arg;) 411.22 637.28 T
(  while\050friends != NULL\051) 411.22 620.6 T
(    {pthread_mutex_lock_conflicts\050&people_lock\051;) 411.22 612.26 T
(     p = find_person\050friends->name\051;) 411.22 603.92 T
(     give_raise\050p\051;) 411.22 595.59 T
(     pthread_mutex_unlock\050&people_lock\051;) 411.22 587.25 T
(     friends = friends->next;) 411.22 578.91 T
(     delay\0500, 0\051;) 411.22 570.57 T
(   }) 411.22 562.23 T
(  sem_post\050&barrier\051;) 411.22 553.9 T
(}) 411.22 545.56 T
(void liquidate_person\050person_t *p\051) 411.22 520.54 T
({person_t  *p1;) 411.22 512.21 T
( p1 = p->next;) 411.22 495.53 T
( p->next = p1->next;) 411.22 487.19 T
( DEBUG\050printf\050\322Killing: \050%s %d\051\134n\323, p1->name, p1->salary\051\051;) 411.22 470.52 T
( free\050p1->name\051;) 411.22 462.18 T
( free\050p1\051;) 411.22 453.84 T
( delay\050LIQUIDATE_DELAY, 0\051;) 411.22 445.5 T
( return;) 411.22 437.16 T
(}) 411.22 428.82 T
(void *liquidate_enemies\050void *arg\051) 411.22 403.81 T
({person_t *p, *enemies = \050person_t *\051 arg;) 411.22 395.47 T
(  while\050enemies != NULL\051) 411.22 378.8 T
(    {pthread_mutex_lock_conflicts\050&people_lock\051;) 411.22 370.46 T
(     p = find_person\050enemies->name\051;) 411.22 362.12 T
(     if \050p\051 liquidate_person\050p\051;) 411.22 353.78 T
(     pthread_mutex_unlock\050&people_lock\051;) 411.22 345.44 T
(     enemies = enemies->next;) 411.22 337.11 T
(     delay\0500, 0\051;) 411.22 328.77 T
(   }) 411.22 320.43 T
( DEBUG\050{printf\050\322\134nAfter the purge...\134n\323\051; print_people\050people.next\051;}\051;) 411.22 312.09 T
( sem_post\050&barrier\051;) 411.22 303.75 T
(}) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 20
%%Page: "mini" 21
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(41) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(person_t *make_list_of_friends\050int seed1\051) 37.72 678.97 T
({int i, r;) 37.72 670.63 T
( unsigned int seed = \050int\051 seed1;) 37.72 662.29 T
( char s[20], *s1;) 37.72 653.95 T
( person_t *p, friends;) 37.72 645.62 T
( friends.next = NULL;) 37.72 628.94 T
( for \050i=0; i<N_FRIENDS; i++\051) 37.72 612.26 T
(   {r = rand_r\050&seed\051 % N_PEOPLE;) 37.72 603.92 T
(    sprintf\050s, \322Jan_%d\323, r\051;) 37.72 595.59 T
(    s1 = \050char *\051 malloc\050strlen\050s\051+1\051;) 37.72 587.25 T
(    strcpy\050s1, s\051;) 37.72 578.91 T
(    p = \050person_t *\051 malloc\050sizeof\050person_t\051\051;) 37.72 570.57 T
(    p->name = s1;) 37.72 562.23 T
(    p->next = friends.next;) 37.72 553.9 T
(    friends.next = p;) 37.72 545.56 T
(  }) 37.72 537.22 T
( return\050friends.next\051;) 37.72 528.88 T
(}) 37.72 520.54 T
(person_t *make_list_of_enemies\050int s\051) 37.72 495.53 T
({) 37.72 487.19 T
(  return\050make_list_of_friends\050s\051\051;) 37.72 478.85 T
(}) 37.72 470.52 T
(void add_to_people\050char *name\051) 37.72 445.5 T
({person_t *p;) 37.72 437.16 T
( p = \050person_t *\051 malloc\050sizeof\050person_t\051\051;) 37.72 420.49 T
( p->name = name;) 37.72 412.15 T
( pthread_mutex_lock\050&people_lock\051;) 37.72 403.81 T
( p->next = people.next;) 37.72 395.47 T
( people.next = p;) 37.72 387.13 T
( pthread_mutex_unlock\050&people_lock\051;) 37.72 378.8 T
(}) 37.72 370.46 T
(void make_list_of_people\050\051) 37.72 345.44 T
({int i, n;) 37.72 337.11 T
( char s[20], *s1;) 37.72 328.77 T
( for \050i=0; i<N_PEOPLE; i++\051) 37.72 312.09 T
(   {sprintf\050s, \322Jan_%d\323, i\051;) 37.72 303.75 T
(    s1 = \050char *\051 malloc\050strlen\050s\051+1\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(42) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    strcpy\050s1, s\051;) 411.22 695.65 T
(    add_to_people\050s1\051;) 411.22 687.31 T
(  }) 411.22 678.97 T
(}) 411.22 670.63 T
(main\050int argc, char *argv[]\051) 411.22 645.62 T
({int i;) 411.22 637.28 T
( pthread_attr_t attr;) 411.22 628.94 T
(  pthread_t tid;) 411.22 620.6 T
( SEM_INIT\050&barrier, NULL, 0\051;) 411.22 603.92 T
( PTHREAD_ATTR_INIT\050&attr\051;) 411.22 595.59 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 411.22 587.25 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 411.22 578.91 T
( people.next = NULL;) 411.22 570.57 T
( people.name = \050char *\051 -1;                     /* SEGV if you touch this ! */) 411.22 562.23 T
( if \050argc >= 2\051 LIQUIDATE_DELAY = atoi\050argv[1]\051;) 411.22 545.56 T
( if \050argc >= 3\051 RAISE_DELAY     = atoi\050argv[2]\051;) 411.22 537.22 T
( if \050argc >= 4\051 N_PEOPLE        = atoi\050argv[3]\051;) 411.22 528.88 T
( if \050argc >= 5\051 N_FRIENDS       = atoi\050argv[4]\051;) 411.22 520.54 T
( if \050argc >= 6\051 E_THREADS       = atoi\050argv[5]\051;) 411.22 512.21 T
( if \050argc >= 7\051 F_THREADS       = atoi\050argv[6]\051;) 411.22 503.87 T
( printf\050) 411.22 487.19 T
( \322list_global_lock\050LIQUIDATE: %d RAISE: %d N_PEOPLE: %d\134n N_FRIENDS: %d) 411.22 478.85 T
(E_THREADS: %d F_THREADS: %d\051\134n\323,) 411.22 470.52 T
( LIQUIDATE_DELAY, RAISE_DELAY, N_PEOPLE, N_FRIENDS, E_THREADS, F_THREADS \051;) 411.22 462.18 T
( make_list_of_people\050\051;) 411.22 445.5 T
( iobench_start\050\051;) 411.22 437.16 T
( for \050i=0; i<F_THREADS; i++\051) 411.22 428.82 T
(   PTHREAD_CREATE\050&tid, &attr, give_friends_raise, make_list_of_friends\050i*10\051\051;) 411.22 420.49 T
( for \050i=0; i<E_THREADS; i++\051) 411.22 412.15 T
(   PTHREAD_CREATE\050&tid, &attr, liquidate_enemies, make_list_of_enemies\050i\051\051;) 411.22 403.81 T
( thread_single_barrier\050&barrier, F_THREADS + E_THREADS\051;/* Instead of join\050\051! */) 411.22 387.13 T
( iobench_end\050\051;) 411.22 378.8 T
( count_finds\050-1\051;) 411.22 370.46 T
( count_conflicts\050-1\051;) 411.22 362.12 T
( iobench_report\050\051;) 411.22 353.78 T
( printf\050\322Done\134n\323\051;) 411.22 345.44 T
( exit\0500\051;) 411.22 337.11 T
(}) 411.22 328.77 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 21
%%Page: "mini" 22
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(43) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 1.19 Q
0 X
(/) 209.08 699.61 T
37.72 333.62 362.6 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
303.94 631.47 325.81 678.21 R
0.6 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
222.56 610.88 298.04 681.21 R
N
282.93 450.51 307.37 579.15 R
N
282.93 480.1 307.37 537.56 R
N
2 10.72 Q
(Jan) 0 -90 293.24 571.56 TF
($15000) 0 -90 292.81 524.92 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 295.15 464.66 GG
90 450 5.57 4.93 270 295.15 464.66 AA
226.76 424.35 251.2 552.99 R
N
226.76 453.94 251.2 511.4 R
N
(Kim) 0 -90 237.07 545.4 TF
($18000) 0 -90 236.64 498.76 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 238.98 438.5 GG
90 450 5.57 4.93 270 238.98 438.5 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
168.44 381.9 192.88 510.54 R
N
168.44 411.49 192.88 468.95 R
N
(Mari) 0 -90 178.75 502.95 TF
($64000) 0 -90 178.32 456.31 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 180.66 396.05 GG
90 450 5.57 4.93 270 180.66 396.05 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
180.12 529.68 181.69 529.7 180.18 524.2 178.55 529.66 4 Y
0 Z
N
180.12 529.68 181.69 529.7 180.18 524.2 178.55 529.66 4 Y
V
239.19 438.07 M
 245.11 428.85 246.39 407.62 230.49 416.54 D
 189.87 439.33 219.81 500.97 199.53 540.98 D
 196.29 547.37 184.1 547.69 180.96 538.67 D
 179.98 535.86 180.08 532.93 180.12 529.98 D
2 Z
N
236.07 567.07 237.65 567 235.83 561.59 234.5 567.14 4 Y
0 Z
N
236.07 567.07 237.65 567 235.83 561.59 234.5 567.14 4 Y
V
294.94 463.37 M
 300.23 452.74 294.32 433.61 280.12 445.09 D
 246.94 471.92 275.34 530.37 264.27 574.73 D
 261.93 584.11 246.24 585.9 240.69 579.04 D
 237.82 575.48 236.27 571.48 236.09 567.36 D
2 Z
N
90 450 5.57 4.93 270 314.88 642.61 GG
90 450 5.57 4.93 270 314.88 642.61 AA
294.86 587.4 296.43 587.57 295.46 581.94 293.3 587.23 4 Y
0 Z
N
294.86 587.4 296.43 587.57 295.46 581.94 293.3 587.23 4 Y
V
315.95 640.47 M
 323.78 621.28 314.41 613.33 299.88 608.25 D
 293.07 605.86 293.86 596.66 294.83 587.69 D
2 Z
N
262.77 681.21 262.77 610.88 2 L
N
298.04 631.47 222.99 631.47 2 L
N
325.38 650.33 303.94 650.33 2 L
N
(list) 0 -90 312.09 673.92 TF
(writer) 0 -90 270.09 676.49 TF
(w_sleep) 0 -90 251.65 676.49 TF
90 450 5.57 4.93 270 254.36 621.17 GG
90 450 5.57 4.93 270 254.36 621.17 AA
211.84 552.73 212.79 553.98 216.21 549.41 210.89 551.47 4 Y
0 Z
N
211.84 552.73 212.79 553.98 216.21 549.41 210.89 551.47 4 Y
V
194.26 654.19 M
 190.82 621.12 182.58 574.9 211.6 552.91 D
2 Z
N
184.83 643.47 206.7 690.21 R
N
90 450 5.57 4.93 270 195.76 654.62 GG
90 450 5.57 4.93 270 195.76 654.62 AA
206.27 662.34 184.83 662.34 2 L
N
(ptr) 0 -90 192.98 685.92 TF
204.55 614.31 176.25 587.3 2 L
2.38 H
N
205.84 586.87 175.4 616.46 2 L
N
(NO!) 0 -90 208.43 580.36 TF
281.31 681.21 281.31 610.88 2 L
0.6 H
N
243.15 681.21 243.15 611.31 2 L
N
(reader) 0 -90 285.62 676.49 TF
(s) 0 -90 285.62 643.88 TF
(r_sleep) 0 -90 229.5 676.49 TF
90 450 5.57 4.93 270 232.21 620.75 GG
90 450 5.57 4.93 270 232.21 620.75 AA
(0) 0 -90 269.38 624.6 TF
(3) 0 -90 286.05 624.56 TF
270.59 350.6 305.75 412.34 R
N
287.74 412.34 287.74 350.6 2 L
N
305.85 371.61 270.69 371.61 2 L
N
(m) 0 -90 295.05 408.06 TF
(ute) 0 -90 295.05 398.74 TF
(x) 0 -90 295.05 382.82 TF
(sleep) 0 -90 276.62 408.06 TF
90 450 5.57 4.93 270 279.81 362.6 GG
90 450 5.57 4.93 270 279.81 362.6 AA
(1) 0 -90 294.78 365.56 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(Salar) 0 -90 315.69 410.63 TF
(y_Loc) 0 -90 315.69 384.3 TF
(k) 0 -90 315.69 353.53 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(With one R) 0 -90 133.39 684.26 TF
(W Loc) 0 -90 133.39 628.7 TF
(k pr) 0 -90 133.39 596.76 TF
(otecting the) 0 -90 133.39 577.31 TF
5 F
(entire) 0 -90 133.39 513.58 TF
2 F
( list & one m) 0 -90 133.39 484.38 TF
(ute) 0 -90 133.39 420.85 TF
(x f) 0 -90 133.39 404.93 TF
(or salar) 0 -90 133.39 392.64 TF
(y) 0 -90 133.39 353.8 TF
(No outside pointer) 0 -90 122.67 684.26 TF
(s allo) 0 -90 122.67 589.71 TF
(wed without holding the R) 0 -90 122.67 562.46 TF
(W Loc) 0 -90 122.67 429.47 TF
(k.) 0 -90 122.67 397.53 TF
(Could y) 0 -90 111.95 684.26 TF
(ou sear) 0 -90 111.95 645.21 TF
(c) 0 -90 111.95 607.29 TF
(h do) 0 -90 111.95 601.44 TF
(wn the list with a read loc) 0 -90 111.95 578.97 TF
(k and then ask f) 0 -90 111.95 449.31 TF
(or a) 0 -90 111.95 368.49 TF
(write loc) 0 -90 101.23 684.26 TF
(k?) 0 -90 101.23 640.98 TF
2 19.06 Q
(Linked Lists: Global R) 0 -90 343.63 651.5 TF
(WLoc) 0 -90 343.63 451.04 TF
(k) 0 -90 343.63 399.54 TF
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(44) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
411.22 314.47 748.92 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
645.28 450.51 669.72 579.15 R
0.6 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
645.28 480.1 669.72 537.56 R
N
2 10.72 Q
(Jan) 0 -90 655.59 571.56 TF
($15000) 0 -90 655.16 524.92 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 657.5 464.66 GG
90 450 5.57 4.93 270 657.5 464.66 AA
598.77 537.01 600.33 536.86 598.24 531.56 597.21 537.16 4 Y
0 Z
N
598.77 537.01 600.33 536.86 598.24 531.56 597.21 537.16 4 Y
V
657.29 457.88 M
 662.58 449.93 656.67 435.63 642.47 444.21 D
 609.29 464.27 637.69 507.95 626.62 541.11 D
 624.28 548.13 608.59 549.46 603.04 544.33 D
 600.71 542.17 599.04 539.84 598.8 537.31 D
2 Z
N
653.57 591.02 655.14 591.21 654.25 585.57 652.01 590.83 4 Y
0 Z
N
653.57 591.02 655.14 591.21 654.25 585.57 652.01 590.83 4 Y
V
677.87 644.33 M
 686.9 625.07 676.09 617.09 659.35 611.98 D
 651.49 609.59 652.41 600.33 653.53 591.32 D
2 Z
N
566.66 534.69 568.03 535.47 569.37 529.92 565.29 533.91 4 Y
0 Z
N
566.66 534.69 568.03 535.47 569.37 529.92 565.29 533.91 4 Y
V
557.93 654.19 M
 556.14 615.4 550.84 562.52 566.51 534.95 D
2 Z
N
547.18 643.47 569.05 690.21 R
N
90 450 5.57 4.93 270 558.11 654.62 GG
90 450 5.57 4.93 270 558.11 654.62 AA
568.62 662.34 547.18 662.34 2 L
N
(ptr) 0 -90 555.33 685.92 TF
(OK) 0 -90 575.13 609.6 TF
669.82 450.51 694.26 579.15 R
N
669.82 480.1 694.26 537.56 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
675.38 492.1 689.96 516.97 R
N
682.66 516.97 682.66 492.53 2 L
N
689.96 501.1 675.8 501.1 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 5.96 Q
(1) 0 -90 684.39 498.41 TF
90 450 2.36 2.14 270 678.81 496.6 GG
90 450 2.36 2.14 270 678.81 496.6 AA
561.76 395.19 586.2 523.83 R
N
561.76 424.78 586.2 482.24 R
N
2 10.72 Q
(Kim) 0 -90 572.07 516.24 TF
($99000) 0 -90 571.64 469.6 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 573.98 409.34 GG
90 450 5.57 4.93 270 573.98 409.34 AA
586.3 395.19 610.74 523.83 R
N
586.3 424.78 610.74 482.24 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
593.47 438.5 608.05 463.37 R
N
600.76 463.37 600.76 438.93 2 L
N
608.05 447.5 593.9 447.5 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 5.96 Q
(0) 0 -90 602.49 444.81 TF
90 450 2.36 2.14 270 596.9 443 GG
90 450 2.36 2.14 270 596.9 443 AA
666.82 636.18 688.69 682.92 R
N
90 450 5.57 4.93 270 677.75 647.33 GG
90 450 5.57 4.93 270 677.75 647.33 AA
688.26 655.05 666.82 655.05 2 L
N
2 10.72 Q
(list) 0 -90 674.96 678.64 TF
500.01 366.03 524.45 494.68 R
N
500.01 395.62 524.45 453.08 R
N
(Kari) 0 -90 510.32 487.09 TF
($80000) 0 -90 509.89 440.44 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 512.23 380.18 GG
90 450 5.57 4.93 270 512.23 380.18 AA
524.55 366.03 548.99 494.68 R
N
524.55 395.62 548.99 453.08 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
530.65 406.34 545.23 431.21 R
N
537.94 431.21 537.94 406.76 2 L
N
545.23 415.34 531.08 415.34 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 5.96 Q
(0) 0 -90 539.67 412.65 TF
90 450 2.36 2.14 270 534.08 410.84 GG
90 450 2.36 2.14 270 534.08 410.84 AA
539.23 503.48 540.8 503.43 539.07 497.99 537.66 503.53 4 Y
0 Z
N
539.23 503.48 540.8 503.43 539.07 497.99 537.66 503.53 4 Y
V
573.51 405.41 M
 576.59 395.39 573.15 377.37 564.87 388.19 D
 545.53 413.46 562.09 468.52 555.63 510.32 D
 554.27 519.15 545.12 520.84 541.89 514.37 D
 540.28 511.14 539.35 507.5 539.24 503.78 D
2 Z
N
2 10.72 Q
(With one m) 0 -90 479.07 677.11 TF
(ute) 0 -90 479.07 619.55 TF
(x pr) 0 -90 479.07 603.63 TF
(otecting the  list and a local salar) 0 -90 479.07 584.18 TF
(y loc) 0 -90 479.07 415.46 TF
(k.) 0 -90 479.07 391.25 TF
(Outside pointer) 0 -90 468.35 677.11 TF
(s m) 0 -90 468.35 598.04 TF
(ust hold the) 0 -90 468.35 579.79 TF
5 F
(appr) 0 -90 468.35 516.05 TF
(opriate) 0 -90 468.35 493.04 TF
2 F
( m) 0 -90 468.35 457.3 TF
(ute) 0 -90 468.35 445 TF
(x.) 0 -90 468.35 429.08 TF
2 19.06 Q
(Linked Lists: Global Loc) 0 -90 708.96 634.82 TF
(k + local) 0 -90 708.96 413.86 TF
2 10.72 Q
(\050cf: Ref) 0 -90 457.62 677.11 TF
(erence counting\051) 0 -90 457.62 640.29 TF
582.32 618.17 657.79 688.5 R
N
622.53 688.5 622.53 618.17 2 L
N
657.79 638.76 582.75 638.76 2 L
N
(writer) 0 -90 629.84 683.78 TF
(w_sleep) 0 -90 611.41 683.78 TF
90 450 5.57 4.93 270 614.12 628.46 GG
90 450 5.57 4.93 270 614.12 628.46 AA
641.07 688.5 641.07 618.17 2 L
N
602.91 688.5 602.91 618.6 2 L
N
(reader) 0 -90 645.38 683.78 TF
(s) 0 -90 645.38 651.17 TF
(r_sleep) 0 -90 589.26 683.78 TF
90 450 5.57 4.93 270 591.97 628.04 GG
90 450 5.57 4.93 270 591.97 628.04 AA
(0) 0 -90 629.14 631.9 TF
(3) 0 -90 645.81 631.85 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 22
%%Page: "mini" 23
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(45) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Linked Lists, Global R) 52.32 686.11 T
(WLoc) 276.66 686.11 T
(k+:) 334.59 686.11 T
(list_global_rw2.c) 122.85 657.53 T
4 7.15 Q
(/*                list_global_rw2.c                */) 37.72 615.84 T
(/*) 37.72 599.16 T
(  Make a list of people \050with names like \322Jan_1234\323\051 and their salaries.) 37.72 582.48 T
(  Then spawn some threads to run down that list and give raises to all) 37.72 574.15 T
(  the people I like.  Spawn some more threads to delete from the list) 37.72 565.81 T
(  the people you don\325t like.  \050Some people I like might also be people) 37.72 557.47 T
(  you don\325t like.\051) 37.72 549.13 T
(  Insert delays during the raising and deleting functions to simulate disk) 37.72 532.45 T
(  I/O and make the program more interesting.) 37.72 524.12 T
(  Now consider the following parameters:) 37.72 507.44 T
(        o  Raise delay) 37.72 499.1 T
(        o  Liquidation delay) 37.72 490.77 T
(        o  Time for average search) 37.72 482.43 T
(  Which of the various locking designs works fastest for which combination) 37.72 465.75 T
(  of the above?) 37.72 457.41 T
(  This program allocates one global rwlock to protect the list itself, and) 37.72 424.06 T
(  one mutex to protect each salary.  It is *vital* that you know exactly) 37.72 415.72 T
(  what each lock is going to protect.) 37.72 407.38 T
(  GLOBAL_RWLOCK) 37.72 390.71 T
(         __________________________________) 37.72 374.03 T
(        |              |  salary  |        |) 37.72 365.69 T
(        |              |  lock    |        |) 37.72 357.35 T
(        |--------------|----------|--------|) 37.72 349.02 T
(        |    Name      |  salary  |  next  |) 37.72 340.68 T
(        |  \322Jan_123\323   |  100000  |    o---|------>) 37.72 332.34 T
(        |______________|__________|________|) 37.72 324 T
(*/) 37.72 298.99 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(46) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(/*) 411.22 695.65 T
(cc -o list_global_rw2 list_global_rw2.c -L. -R. -g -lpthread -lthread -) 411.22 687.31 T
(pthread_extensions -lposix4) 411.22 678.97 T
(*/) 411.22 670.63 T
(#define _POSIX_C_SOURCE 199506L) 411.22 645.62 T
(#include <signal.h>) 411.22 628.94 T
(#include <stdio.h>) 411.22 620.6 T
(#include <pthread.h>) 411.22 612.26 T
(#include <semaphore.h>) 411.22 603.92 T
(#include <errno.h>) 411.22 595.59 T
(#include <time.h>) 411.22 587.25 T
(#include <stdlib.h>) 411.22 578.91 T
(#include \322thread_extensions.h\323) 411.22 570.57 T
(typedef struct person_struct) 411.22 545.56 T
({char *                 name;) 411.22 537.22 T
( int                    salary;) 411.22 528.88 T
( pthread_mutex_t        salary_lock;) 411.22 520.54 T
( struct person_struct * next;) 411.22 512.21 T
(} person_t;) 411.22 503.87 T
(sem_t           barrier;) 411.22 478.85 T
(thread_rwlock_t people_lock;) 411.22 470.52 T
(person_t        people;) 411.22 462.18 T
(int             E_THREADS = 1;         /* # threads running liquidate */) 411.22 445.5 T
(int             F_THREADS = 10;        /* # threads running raise */) 411.22 437.16 T
(int             N_PEOPLE = 1000;       /* # of people in initial list */) 411.22 428.82 T
(int             N_FRIENDS = 100;       /* # of people to give raises */) 411.22 420.49 T
(int             LIQUIDATE_DELAY = 100; /* sleep time during liquidation */) 411.22 412.15 T
(int             RAISE_DELAY = 100;     /* sleep time during raise giving */) 411.22 403.81 T
(void count_conflicts\050int i\051             /* Note the encapsulation */) 411.22 370.46 T
({static int count=0, old_count=0, max_count = 0;) 411.22 362.12 T
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 411.22 353.78 T
( pthread_mutex_lock\050&count_lock\051;) 411.22 337.11 T
( count += i;) 411.22 328.77 T
( if \050i == -1\051 printf\050\322Conflicts: %d\134n\323, max_count\051;) 411.22 320.43 T
( if \050count > max_count\051) 411.22 312.09 T
(   max_count = count;) 411.22 303.75 T
( pthread_mutex_unlock\050&count_lock\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 23
%%Page: "mini" 24
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(47) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(}) 37.72 695.65 T
(void count_finds\050int i\051         /* Note the encapsulation */) 37.72 678.97 T
({static int count=0, old_count=0, max_count = 0;) 37.72 670.63 T
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 37.72 662.29 T
( pthread_mutex_lock\050&count_lock\051;) 37.72 645.62 T
( count += i;) 37.72 637.28 T
( if \050i == -1\051 printf\050\322Total raises + liquidations: %d\134n\323, max_count\051;) 37.72 628.94 T
( if \050count > max_count\051) 37.72 620.6 T
(   max_count = count;) 37.72 612.26 T
( pthread_mutex_unlock\050&count_lock\051;) 37.72 603.92 T
(}) 37.72 595.59 T
(void print_people\050person_t *p\051  /* Debugging function. Not 100% MT safe */) 37.72 570.57 T
({int i = 0;) 37.72 562.23 T
( printf\050\322\050\322\051;) 37.72 545.56 T
( thread_rw_rdlock\050&people_lock\051;) 37.72 537.22 T
( while\050p != NULL\051) 37.72 528.88 T
(   {pthread_mutex_lock\050&\050p->salary_lock\051\051;) 37.72 520.54 T
(    printf\050\322\050%s  %d\051 \322, p->name, p->salary\051;) 37.72 512.21 T
(    pthread_mutex_unlock\050&\050p->salary_lock\051\051;) 37.72 503.87 T
(    p = p->next;) 37.72 495.53 T
(    i++;) 37.72 487.19 T
(    if \050\050i % 5\051 == 0\051 printf\050\322\134n \322\051;) 37.72 478.85 T
(  }) 37.72 470.52 T
( thread_rw_unlock\050&people_lock\051;) 37.72 462.18 T
( printf\050\322\051\134n\323\051;) 37.72 453.84 T
(}) 37.72 445.5 T
(person_t *find_person\050char *name\051) 37.72 412.15 T
({person_t *p = &people, *p1, *p2;) 37.72 403.81 T
( p1 = p->next;) 37.72 387.13 T
( while\050p1 != NULL\051) 37.72 378.8 T
(   {if \050strcmp\050p1->name, name\051 == 0\051) 37.72 370.46 T
(      /* Found! Return previous */) 37.72 362.12 T
(      {count_finds\0501\051; return\050p\051;}) 37.72 353.78 T
(    p = p1;) 37.72 345.44 T
(    p1 = p->next;) 37.72 337.11 T
(  }) 37.72 328.77 T
( return\050NULL\051;                   /* Couldn\325t find \324em!  Too bad. */) 37.72 320.43 T
(}) 37.72 312.09 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(48) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(void give_raise\050person_t *p\051) 411.22 695.65 T
({person_t *p1;) 411.22 687.31 T
(  if \050p != NULL\051) 411.22 670.63 T
(    {p1 = p->next;) 411.22 662.29 T
(     DEBUG\050printf\050\322Giving raise to: \050%s %d\051\134n\323, p1->name, p1->salary\051\051) 411.22 653.95 T
(     pthread_mutex_lock\050&\050p1->salary_lock\051\051;) 411.22 645.62 T
(     thread_rw_unlock\050&people_lock\051;            /* Unlock here */) 411.22 637.28 T
(     p1->salary++;) 411.22 628.94 T
(     delay\050RAISE_DELAY, 0\051;      /* If the delay is outside the lock? */) 411.22 620.6 T
(     pthread_mutex_unlock\050&\050p1->salary_lock\051\051;) 411.22 612.26 T
(   }) 411.22 603.92 T
( else) 411.22 595.59 T
(     thread_rw_unlock\050&people_lock\051;            /* Unlock here */) 411.22 587.25 T
(}) 411.22 578.91 T
(thread_rw_rdlock_conflicts\050thread_rwlock_t *people_lock\051) 411.22 562.23 T
({if \050thread_rw_tryrdlock\050people_lock\051 == EBUSY\051) 411.22 553.9 T
(   {count_conflicts\0501\051;) 411.22 545.56 T
(    thread_rw_rdlock\050people_lock\051;) 411.22 537.22 T
(  }) 411.22 528.88 T
(}) 411.22 520.54 T
(thread_rw_wrlock_conflicts\050thread_rwlock_t *people_lock\051) 411.22 495.53 T
({if \050thread_rw_trywrlock\050people_lock\051 == EBUSY\051) 411.22 487.19 T
(   {count_conflicts\0501\051;) 411.22 478.85 T
(    thread_rw_wrlock\050people_lock\051;) 411.22 470.52 T
(  }) 411.22 462.18 T
(}) 411.22 453.84 T
(void *give_friends_raise\050void *arg\051) 411.22 437.16 T
({person_t *p, *friends = \050person_t *\051 arg;) 411.22 428.82 T
(  while\050friends != NULL\051) 411.22 412.15 T
(    {thread_rw_rdlock_conflicts\050&people_lock\051;) 411.22 403.81 T
(     p = find_person\050friends->name\051;) 411.22 395.47 T
(     give_raise\050p\051;) 411.22 387.13 T
(     friends = friends->next;) 411.22 378.8 T
(   }) 411.22 370.46 T
(  sem_post\050&barrier\051;) 411.22 362.12 T
(}) 411.22 353.78 T
(void liquidate_person\050person_t *p\051) 411.22 320.43 T
({person_t  *p1;) 411.22 312.09 T
( if \050p\051) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 24
%%Page: "mini" 25
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(49) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(   {p1 = p->next;) 37.72 695.65 T
(    p->next = p1->next;) 37.72 687.31 T
(    thread_rw_unlock\050&people_lock\051;) 37.72 678.97 T
(    pthread_mutex_lock\050&\050p1->salary_lock\051\051;) 37.72 662.29 T
(    pthread_mutex_unlock\050 &\050p1->salary_lock\051\051;) 37.72 653.95 T
(    pthread_mutex_destroy\050&\050p1->salary_lock\051\051;) 37.72 645.62 T
(    DEBUG\050printf\050\322Killing: \050%s %d\051\134n\323, p1->name, p1->salary\051\051) 37.72 637.28 T
(    free\050p1->name\051;) 37.72 628.94 T
(    free\050p1\051;) 37.72 620.6 T
(    delay\050LIQUIDATE_DELAY, 0\051;) 37.72 612.26 T
(  }) 37.72 603.92 T
( else) 37.72 595.59 T
(   thread_rw_unlock\050&people_lock\051;) 37.72 587.25 T
( return;) 37.72 570.57 T
(}) 37.72 562.23 T
(void *liquidate_enemies\050void *arg\051) 37.72 528.88 T
({person_t *p, *enemies = \050person_t *\051 arg;) 37.72 520.54 T
(  while\050enemies != NULL\051) 37.72 503.87 T
(    {thread_rw_wrlock_conflicts\050&people_lock\051;) 37.72 495.53 T
(     p = find_person\050enemies->name\051;) 37.72 487.19 T
(     liquidate_person\050p\051;) 37.72 478.85 T
(     enemies = enemies->next;) 37.72 470.52 T
(   }) 37.72 462.18 T
( DEBUG\050{printf\050\322\134nAfter the purge...\134n\323\051; print_people\050people.next\051;}\051) 37.72 453.84 T
( sem_post\050&barrier\051;) 37.72 445.5 T
(}) 37.72 437.16 T
(person_t *make_list_of_friends\050int seed1\051) 37.72 412.15 T
({int i, r;) 37.72 403.81 T
( unsigned int seed = \050int\051 seed1;) 37.72 395.47 T
( char s[20], *s1;) 37.72 387.13 T
( person_t *p, friends;) 37.72 378.8 T
( friends.next = NULL;) 37.72 362.12 T
( for \050i=0; i<N_FRIENDS; i++\051) 37.72 345.44 T
(   {r = rand_r\050&seed\051 % N_PEOPLE;) 37.72 337.11 T
(    sprintf\050s, \322Jan_%d\323, r\051;) 37.72 328.77 T
(    s1 = \050char *\051 malloc\050strlen\050s\051+1\051;) 37.72 320.43 T
(    strcpy\050s1, s\051;) 37.72 312.09 T
(    p = \050person_t *\051 malloc\050sizeof\050person_t\051\051;) 37.72 303.75 T
(    p->name = s1;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(50) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    p->next = friends.next;) 411.22 695.65 T
(    friends.next = p;) 411.22 687.31 T
(  }) 411.22 678.97 T
( return\050friends.next\051;) 411.22 670.63 T
(}) 411.22 662.29 T
(person_t *make_list_of_enemies\050int s\051) 411.22 637.28 T
({) 411.22 628.94 T
(  return\050make_list_of_friends\050s\051\051;) 411.22 620.6 T
(}) 411.22 612.26 T
(void add_to_people\050char *name\051) 411.22 587.25 T
({person_t *p;) 411.22 578.91 T
( p = \050person_t *\051 malloc\050sizeof\050person_t\051\051;) 411.22 562.23 T
( p->name = name;) 411.22 553.9 T
( pthread_mutex_init\050&\050p->salary_lock\051, NULL\051;) 411.22 545.56 T
( thread_rw_wrlock\050&people_lock\051;) 411.22 537.22 T
( p->next = people.next;) 411.22 528.88 T
( people.next = p;) 411.22 520.54 T
( thread_rw_unlock\050&people_lock\051;) 411.22 512.21 T
(}) 411.22 503.87 T
(void make_list_of_people\050\051) 411.22 478.85 T
({int i, n;) 411.22 470.52 T
( char s[20], *s1;) 411.22 462.18 T
( for \050i=0; i<N_PEOPLE; i++\051) 411.22 445.5 T
(   {sprintf\050s, \322Jan_%d\323, i\051;) 411.22 437.16 T
(    s1 = \050char *\051 malloc\050strlen\050s\051+1\051;) 411.22 428.82 T
(    strcpy\050s1, s\051;) 411.22 420.49 T
(    add_to_people\050s1\051;) 411.22 412.15 T
(  }) 411.22 403.81 T
(}) 411.22 395.47 T
(main\050int argc, char *argv[]\051) 411.22 370.46 T
({int i;) 411.22 362.12 T
( pthread_attr_t attr;) 411.22 353.78 T
(  pthread_t tid;) 411.22 345.44 T
( SEM_INIT\050&barrier, NULL, 0\051;) 411.22 328.77 T
( PTHREAD_ATTR_INIT\050&attr\051;) 411.22 320.43 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 411.22 312.09 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 411.22 303.75 T
( thread_rwlock_init\050&people_lock, NULL\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 25
%%Page: "mini" 26
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(51) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( people.next = NULL;) 37.72 695.65 T
( people.name = \050char *\051 -1;                     /* SEGV if you touch this ! */) 37.72 687.31 T
( if \050argc >= 2\051 LIQUIDATE_DELAY = atoi\050argv[1]\051;) 37.72 670.63 T
( if \050argc >= 3\051 RAISE_DELAY     = atoi\050argv[2]\051;) 37.72 662.29 T
( if \050argc >= 4\051 N_PEOPLE        = atoi\050argv[3]\051;) 37.72 653.95 T
( if \050argc >= 5\051 N_FRIENDS       = atoi\050argv[4]\051;) 37.72 645.62 T
( if \050argc >= 6\051 E_THREADS       = atoi\050argv[5]\051;) 37.72 637.28 T
( if \050argc >= 7\051 F_THREADS       = atoi\050argv[6]\051;) 37.72 628.94 T
( printf\050) 37.72 612.26 T
( \322list_global_rw2\050LIQUIDATE: %d RAISE: %d N_PEOPLE: %d\134n N_FRIENDS: %d) 37.72 603.92 T
(E_THREADS: %d F_THREADS: %d\051\134n\323,) 37.72 595.59 T
( LIQUIDATE_DELAY, RAISE_DELAY, N_PEOPLE, N_FRIENDS, E_THREADS, F_THREADS \051;) 37.72 587.25 T
( make_list_of_people\050\051;) 37.72 570.57 T
( iobench_start\050\051;) 37.72 562.23 T
( for \050i=0; i<F_THREADS; i++\051) 37.72 553.9 T
(   PTHREAD_CREATE\050&tid, &attr, give_friends_raise, make_list_of_friends\050i*10\051\051;) 37.72 545.56 T
( for \050i=0; i<E_THREADS; i++\051) 37.72 537.22 T
(   PTHREAD_CREATE\050&tid, &attr, liquidate_enemies, make_list_of_enemies\050i\051\051;) 37.72 528.88 T
( thread_single_barrier\050&barrier, F_THREADS + E_THREADS\051;) 37.72 512.21 T
( iobench_end\050\051;) 37.72 503.87 T
( count_finds\050-1\051;) 37.72 495.53 T
( count_conflicts\050-1\051;) 37.72 487.19 T
( iobench_report\050\051;) 37.72 478.85 T
( printf\050\322Done\134n\323\051;) 37.72 470.52 T
( exit\0500\051;) 37.72 462.18 T
(}) 37.72 445.5 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(52) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Ex) 489.87 686.11 T
(er) 515.88 686.11 T
(cise Objective) 535.71 686.11 T
2 10.72 Q
(Examine the code in eac) 411.22 642.04 T
(h of the diff) 535.64 642.04 T
(erent list implementations and) 593.9 642.04 T
-0.51 (under) 411.22 628.94 P
-0.51 (stand it. Estimate whic) 440.84 628.94 P
-0.51 (h design should be faster with diff) 554.79 628.94 P
-0.51 (erent) 725.59 628.94 P
(dela) 411.22 615.84 T
(y times. T) 432.46 615.84 T
(est. Fill out the tab) 481.27 615.84 T
(le belo) 575.88 615.84 T
(w) 609.68 615.84 T
(.) 617.59 615.84 T
(No) 411.22 589.63 T
(w \336gure out wh) 425.35 589.63 T
(y y) 503.76 589.63 T
(ou g) 518.4 589.63 T
(et some od) 541.13 589.63 T
(d looking n) 597.62 589.63 T
(umber of con\337icts.) 654.7 589.63 T
(What should the eff) 411.22 576.53 T
(ect be of replacing simple m) 510.58 576.53 T
(ute) 654.54 576.53 T
(x) 670.47 576.53 T
(es with FIFO) 676.32 576.53 T
(m) 411.22 563.43 T
(ute) 420.54 563.43 T
(x) 436.46 563.43 T
(es?) 442.31 563.43 T
-0.14 (What is the time of e) 411.22 537.22 P
-0.14 (x) 514.59 537.22 P
-0.14 (ecution f) 520.44 537.22 P
-0.14 (or eac) 564.76 537.22 P
-0.14 (h of these designs? Figure out) 596.09 537.22 P
(the appr) 411.22 524.12 T
(opriate n) 453.3 524.12 T
(umber) 498.47 524.12 T
(s to \336ll in f) 531.07 524.12 T
(or eac) 584.47 524.12 T
(h of the three parameter) 615.94 524.12 T
(s) 738.5 524.12 T
(whic) 411.22 511.01 T
(h will give y) 434.95 511.01 T
(ou the most useful data.) 494.86 511.01 T
(Hint: Star) 411.22 484.81 T
(t b) 459.68 484.81 T
(y \336guring out ho) 472.57 484.81 T
(w long it takes to compare eac) 556.98 484.81 T
(h mem-) 712.37 484.81 T
(ber of the list with no dela) 411.22 471.71 T
(ys. And ho) 543.26 471.71 T
(w long it takes to loc) 597.9 471.71 T
(k local) 703.13 471.71 T
(loc) 411.22 458.6 T
(ks.  Then y) 426.5 458.6 T
(ou should be ab) 481.64 458.6 T
(le to \336ll in the data f) 563.74 458.6 T
(or the rest of the) 664.2 458.6 T
(entries fr) 411.22 445.5 T
(om theor) 456.88 445.5 T
(y onl) 502.85 445.5 T
(y) 527.71 445.5 T
(.) 532.81 445.5 T
2 8.34 Q
-1.16 (Default Dela) 510.63 413.74 P
-1.16 (ys) 557.49 413.74 P
-1.16 (Zer) 635.45 413.74 P
-1.16 (o Dela) 648.26 413.74 P
-1.16 (y) 671.96 413.74 P
-0.77 (\050use 10,000 people\051) 618.14 403.61 P
(Global Mute) 411.22 373.24 T
(x) 458.82 373.24 T
(Global R) 411.22 342.86 T
(W +) 445.18 342.86 T
(Local Mute) 411.22 332.74 T
(x) 454.65 332.74 T
(T) 411.22 302.36 T
(w) 415.82 302.36 T
(o Local Mute) 422.14 302.36 T
(x) 472.98 302.36 T
(es) 477.53 302.36 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 26
%%Page: "mini" 27
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(53) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
37.72 340.77 352.64 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
271.78 450.51 296.22 579.15 R
0.6 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
271.78 480.1 296.22 537.56 R
N
2 10.72 Q
(Jan) 0 -90 282.09 571.56 TF
($15000) 0 -90 281.66 524.92 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 284 464.66 GG
90 450 5.57 4.93 270 284 464.66 AA
225.27 537.01 226.83 536.86 224.74 531.56 223.71 537.16 4 Y
0 Z
N
225.27 537.01 226.83 536.86 224.74 531.56 223.71 537.16 4 Y
V
283.79 457.88 M
 289.08 449.93 283.17 435.63 268.97 444.21 D
 235.79 464.27 264.19 507.95 253.12 541.11 D
 250.78 548.13 235.09 549.46 229.54 544.33 D
 227.21 542.17 225.54 539.84 225.3 537.31 D
2 Z
N
280.07 591.02 281.64 591.21 280.75 585.57 278.51 590.83 4 Y
0 Z
N
280.07 591.02 281.64 591.21 280.75 585.57 278.51 590.83 4 Y
V
304.37 644.33 M
 313.4 625.07 302.59 617.09 285.85 611.98 D
 277.99 609.59 278.91 600.33 280.04 591.32 D
2 Z
N
193.16 534.69 194.53 535.47 195.87 529.92 191.79 533.91 4 Y
0 Z
N
193.16 534.69 194.53 535.47 195.87 529.92 191.79 533.91 4 Y
V
184.43 654.19 M
 182.64 615.4 177.34 562.52 193.01 534.95 D
2 Z
N
173.68 643.47 195.55 690.21 R
N
90 450 5.57 4.93 270 184.61 654.62 GG
90 450 5.57 4.93 270 184.61 654.62 AA
195.12 662.34 173.68 662.34 2 L
N
(ptr) 0 -90 181.83 685.92 TF
(OK) 0 -90 201.63 609.6 TF
296.32 450.51 320.76 579.15 R
N
296.32 480.1 320.76 537.56 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
301.89 452.65 316.47 477.52 R
N
309.18 477.52 309.18 453.08 2 L
N
316.47 461.66 302.32 461.66 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 5.96 Q
(1) 0 -90 310.91 458.96 TF
90 450 2.36 2.14 270 305.32 457.15 GG
90 450 2.36 2.14 270 305.32 457.15 AA
188.26 395.19 212.7 523.83 R
N
188.26 424.78 212.7 482.24 R
N
2 10.72 Q
(Kim) 0 -90 198.57 516.24 TF
($99000) 0 -90 198.14 469.6 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 200.48 409.34 GG
90 450 5.57 4.93 270 200.48 409.34 AA
212.8 395.19 237.24 523.83 R
N
212.8 424.78 237.24 482.24 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
218.37 397.34 232.95 422.21 R
N
225.66 422.21 225.66 397.77 2 L
N
232.95 406.34 218.8 406.34 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 5.96 Q
(0) 0 -90 227.39 403.65 TF
90 450 2.36 2.14 270 221.8 401.84 GG
90 450 2.36 2.14 270 221.8 401.84 AA
293.32 636.18 315.19 682.92 R
N
90 450 5.57 4.93 270 304.25 647.33 GG
90 450 5.57 4.93 270 304.25 647.33 AA
314.76 655.05 293.32 655.05 2 L
N
2 10.72 Q
(list) 0 -90 301.46 678.64 TF
126.51 366.03 150.95 494.68 R
N
126.51 395.62 150.95 453.08 R
N
(Kari) 0 -90 136.82 487.09 TF
($80000) 0 -90 136.39 440.44 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 138.73 380.18 GG
90 450 5.57 4.93 270 138.73 380.18 AA
151.05 366.03 175.49 494.68 R
N
151.05 395.62 175.49 453.08 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
156.62 368.18 171.2 393.05 R
N
163.91 393.05 163.91 368.61 2 L
N
171.2 377.18 157.05 377.18 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 5.96 Q
(0) 0 -90 165.64 374.49 TF
90 450 2.36 2.14 270 160.05 372.68 GG
90 450 2.36 2.14 270 160.05 372.68 AA
165.73 503.48 167.3 503.43 165.57 497.99 164.16 503.53 4 Y
0 Z
N
165.73 503.48 167.3 503.43 165.57 497.99 164.16 503.53 4 Y
V
200.01 405.41 M
 203.09 395.39 199.65 377.37 191.37 388.19 D
 172.03 413.46 188.59 468.52 182.13 510.32 D
 180.77 519.15 171.62 520.84 168.39 514.37 D
 166.78 511.14 165.85 507.5 165.74 503.78 D
2 Z
N
238 627.18 273.16 688.93 R
N
255.15 688.93 255.15 627.18 2 L
N
273.26 648.19 238.1 648.19 2 L
N
2 10.72 Q
(m) 0 -90 262.46 684.64 TF
(ute) 0 -90 262.46 675.32 TF
(x) 0 -90 262.46 659.4 TF
(sleep) 0 -90 244.02 684.64 TF
90 450 5.57 4.93 270 247.22 639.18 GG
90 450 5.57 4.93 270 247.22 639.18 AA
(1) 0 -90 262.19 642.14 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(With one m) 0 -90 105.57 677.11 TF
(ute) 0 -90 105.57 619.55 TF
(x pr) 0 -90 105.57 603.63 TF
(otecting eac) 0 -90 105.57 584.18 TF
(h element in the list.) 0 -90 105.57 521.74 TF
(Outside pointer) 0 -90 94.85 677.11 TF
(s m) 0 -90 94.85 598.04 TF
(ust hold the) 0 -90 94.85 579.79 TF
5 F
(appr) 0 -90 94.85 516.05 TF
(opriate) 0 -90 94.85 493.04 TF
2 F
( m) 0 -90 94.85 457.3 TF
(ute) 0 -90 94.85 445 TF
(x.) 0 -90 94.85 429.08 TF
2 19.06 Q
(Linked Lists: Single Loc) 0 -90 335.46 634.82 TF
(k) 0 -90 335.46 415.97 TF
2 10.72 Q
(\050cf: Ref) 0 -90 84.12 677.11 TF
(erence counting\051) 0 -90 84.12 640.29 TF
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(54) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
411.22 331.24 727.33 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
641.11 450.51 665.55 579.15 R
0.6 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
641.11 480.1 665.55 537.56 R
N
2 10.72 Q
(Jan) 0 -90 651.42 571.56 TF
($15000) 0 -90 650.99 524.92 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 653.33 464.66 GG
90 450 5.57 4.93 270 653.33 464.66 AA
594.6 537.01 596.16 536.86 594.07 531.56 593.04 537.16 4 Y
0 Z
N
594.6 537.01 596.16 536.86 594.07 531.56 593.04 537.16 4 Y
V
653.12 457.88 M
 658.41 449.93 652.5 435.63 638.3 444.21 D
 605.12 464.27 633.52 507.95 622.45 541.11 D
 620.11 548.13 604.42 549.46 598.87 544.33 D
 596.54 542.17 594.88 539.84 594.63 537.31 D
2 Z
N
649.35 591 650.91 591.21 650.07 585.57 647.79 590.79 4 Y
0 Z
N
649.35 591 650.91 591.21 650.07 585.57 647.79 590.79 4 Y
V
673.7 640.47 M
 682.73 622.45 671.92 614.98 655.18 610.21 D
 647.45 608.01 648.2 599.6 649.31 591.29 D
2 Z
N
560.06 536.2 561.48 536.86 562.37 531.25 558.64 535.53 4 Y
0 Z
N
560.06 536.2 561.48 536.86 562.37 531.25 558.64 535.53 4 Y
V
553.01 654.62 M
 551.55 616.21 547.05 564.13 559.94 536.46 D
2 Z
N
543.01 643.47 564.88 690.21 R
N
90 450 5.57 4.93 270 553.94 654.62 GG
90 450 5.57 4.93 270 553.94 654.62 AA
564.45 662.34 543.01 662.34 2 L
N
(ptr) 0 -90 551.16 685.92 TF
(OK) 0 -90 570.96 609.6 TF
665.65 450.51 690.09 579.15 R
N
665.65 480.1 690.09 537.56 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
671.22 452.65 685.8 477.52 R
N
678.51 477.52 678.51 453.08 2 L
N
685.8 461.66 671.65 461.66 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 5.96 Q
(0) 0 -90 680.24 458.96 TF
90 450 2.36 2.14 270 674.65 457.15 GG
90 450 2.36 2.14 270 674.65 457.15 AA
557.59 395.19 582.03 523.83 R
N
557.59 424.78 582.03 482.24 R
N
2 10.72 Q
(Kim) 0 -90 567.9 516.24 TF
($99000) 0 -90 567.47 469.6 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 569.81 409.34 GG
90 450 5.57 4.93 270 569.81 409.34 AA
582.13 395.19 606.57 523.83 R
N
582.13 424.78 606.57 482.24 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
587.7 397.34 602.28 422.21 R
N
594.99 422.21 594.99 397.77 2 L
N
602.28 406.34 588.13 406.34 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 5.96 Q
(0) 0 -90 596.72 403.65 TF
90 450 2.36 2.14 270 591.13 401.84 GG
90 450 2.36 2.14 270 591.13 401.84 AA
662.65 636.18 684.52 682.92 R
N
90 450 5.57 4.93 270 673.58 647.33 GG
90 450 5.57 4.93 270 673.58 647.33 AA
684.09 655.05 662.65 655.05 2 L
N
2 10.72 Q
(list) 0 -90 670.79 678.64 TF
495.84 366.03 520.28 494.68 R
N
495.84 395.62 520.28 453.08 R
N
(Kari) 0 -90 506.15 487.09 TF
($80000) 0 -90 505.73 440.44 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 508.06 380.18 GG
90 450 5.57 4.93 270 508.06 380.18 AA
520.38 366.03 544.82 494.68 R
N
520.38 395.62 544.82 453.08 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
525.96 368.18 540.54 393.05 R
N
533.24 393.05 533.24 368.61 2 L
N
540.53 377.18 526.38 377.18 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 5.96 Q
(0) 0 -90 534.97 374.49 TF
90 450 2.36 2.14 270 529.39 372.68 GG
90 450 2.36 2.14 270 529.39 372.68 AA
535.06 503.48 536.64 503.43 534.9 497.99 533.49 503.53 4 Y
0 Z
N
535.06 503.48 536.64 503.43 534.9 497.99 533.49 503.53 4 Y
V
569.34 405.41 M
 572.42 395.39 568.98 377.37 560.7 388.19 D
 541.36 413.46 557.92 468.52 551.46 510.32 D
 550.1 519.15 540.96 520.84 537.72 514.37 D
 536.11 511.14 535.18 507.5 535.07 503.78 D
2 Z
N
671.22 497.68 685.8 522.55 R
N
678.51 522.55 678.51 498.11 2 L
N
685.8 506.68 671.65 506.68 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(0) 0 -90 680.24 503.99 TF
90 450 2.36 2.14 270 674.65 502.18 GG
90 450 2.36 2.14 270 674.65 502.18 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
588.46 443.22 603.04 468.09 R
N
595.75 468.09 595.75 443.65 2 L
N
603.04 452.22 588.89 452.22 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(1) 0 -90 597.48 449.53 TF
90 450 2.36 2.14 270 591.89 447.72 GG
90 450 2.36 2.14 270 591.89 447.72 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
526.72 414.92 541.3 439.79 R
N
534.01 439.79 534.01 415.35 2 L
N
541.29 423.92 527.14 423.92 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(0) 0 -90 535.73 421.23 TF
90 450 2.36 2.14 270 530.15 419.42 GG
90 450 2.36 2.14 270 530.15 419.42 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
608.52 621.6 643.68 683.35 R
N
625.67 683.35 625.67 621.6 2 L
N
643.78 642.61 608.62 642.61 2 L
N
2 10.72 Q
(m) 0 -90 632.98 679.06 TF
(ute) 0 -90 632.98 669.75 TF
(x) 0 -90 632.98 653.83 TF
(sleep) 0 -90 614.55 679.06 TF
90 450 5.57 4.93 270 617.74 633.61 GG
90 450 5.57 4.93 270 617.74 633.61 AA
(1) 0 -90 632.71 636.57 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(One m) 0 -90 467.15 691.4 TF
(ute) 0 -90 467.15 658.26 TF
(x pr) 0 -90 467.15 642.34 TF
(otecting the structure) 0 -90 467.15 622.89 TF
(, and one pr) 0 -90 467.15 512.58 TF
(otecting the data.) 0 -90 467.15 452.04 TF
(Outside pointer) 0 -90 456.43 691.4 TF
(s m) 0 -90 456.43 612.34 TF
(ust hold the) 0 -90 456.43 594.08 TF
5 F
(appr) 0 -90 456.43 530.35 TF
(opriate) 0 -90 456.43 507.33 TF
2 F
( m) 0 -90 456.43 471.59 TF
(ute) 0 -90 456.43 459.29 TF
(x.) 0 -90 456.43 443.37 TF
2 19.06 Q
(Linked Lists: T) 0 -90 707.17 628.27 TF
(w) 0 -90 707.17 494.92 TF
(o Loc) 0 -90 707.17 480.47 TF
(ks) 0 -90 707.17 430.02 TF
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 27
%%Page: "mini" 28
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(55) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Linked Lists, 2 Local Mute) 54.62 686.11 T
(x) 321.19 686.11 T
(es:) 332.9 686.11 T
(list_2local_loc) 115.31 657.53 T
(ks.c) 261.47 657.53 T
4 7.15 Q
( /*                list_2local_locks.c                */) 37.72 615.84 T
(/*) 37.72 599.16 T
(  Make a list of people \050with names like \322Jan_1234\323\051 and their salaries.) 37.72 582.48 T
(  Then spawn some threads to run down that list and give raises to all) 37.72 574.15 T
(  the people I like.  Spawn some more threads to delete from the list) 37.72 565.81 T
(  the people you don\325t like.  \050Some people I like might also be people) 37.72 557.47 T
(  you don\325t like.\051) 37.72 549.13 T
(  Insert delays during the raising and deleting functions to simulate disk) 37.72 532.45 T
(  I/O and make the program more interesting.) 37.72 524.12 T
(  Now consider the following parameters:) 37.72 507.44 T
(        o  Raise delay) 37.72 499.1 T
(        o  Liquidation delay) 37.72 490.77 T
(        o  Time for average search) 37.72 482.43 T
(  Which of the various locking designs works fastest for which combination) 37.72 465.75 T
(  of the above?) 37.72 457.41 T
(  This program allocates two mutexes per element, one to protect the) 37.72 424.06 T
(  next-pointer and following member, the other to protect the salary of) 37.72 415.72 T
(  the current member.  It is *vital* that you know exactly what each) 37.72 407.38 T
(  lock is going to protect.) 37.72 399.05 T
(         __________________________________) 37.72 382.37 T
(        |              |  salary  |  next  |) 37.72 374.03 T
(        |              |  lock    |  lock  |) 37.72 365.69 T
(        |--------------|----------|--------|) 37.72 357.35 T
(        |    Name      |  salary  |  next  |) 37.72 349.02 T
(        |  \322Jan_123\323   |  100000  |    o---|------>) 37.72 340.68 T
(        |______________|__________|________|) 37.72 332.34 T
(*/) 37.72 315.66 T
(/*) 37.72 298.99 T
(cc -o list_2local_locks list_2local_locks.c -L. -R. -g -lpthread -lthread -) 37.72 290.65 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(56) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(pthread_extensions -lposix4) 411.22 695.65 T
(*/) 411.22 687.31 T
(#define _POSIX_C_SOURCE 199506L) 411.22 662.29 T
(#include <signal.h>) 411.22 645.62 T
(#include <stdio.h>) 411.22 637.28 T
(#include <pthread.h>) 411.22 628.94 T
(#include <semaphore.h>) 411.22 620.6 T
(#include <errno.h>) 411.22 612.26 T
(#include <time.h>) 411.22 603.92 T
(#include <stdlib.h>) 411.22 595.59 T
(#include \322thread_extensions.h\323) 411.22 587.25 T
(typedef struct person_struct) 411.22 562.23 T
({char *                 name;) 411.22 553.9 T
( int                    salary;) 411.22 545.56 T
( struct person_struct * next;) 411.22 537.22 T
( pthread_mutex_t        next_lock;) 411.22 528.88 T
( pthread_mutex_t        salary_lock;) 411.22 520.54 T
(} person_t;) 411.22 512.21 T
(sem_t          barrier;) 411.22 495.53 T
(person_t        people;) 411.22 487.19 T
(int             E_THREADS = 1;         /* # threads running liquidate */) 411.22 470.52 T
(int             F_THREADS = 10;        /* # threads running raise */) 411.22 462.18 T
(int             N_PEOPLE = 1000;       /* # of people in initial list */) 411.22 453.84 T
(int             N_FRIENDS = 100;       /* # of people to give raises */) 411.22 445.5 T
(int             LIQUIDATE_DELAY = 100; /* sleep time during liquidation */) 411.22 437.16 T
(int             RAISE_DELAY = 100;     /* sleep time during raise giving */) 411.22 428.82 T
(void count_conflicts\050int i\051             /* Note the encapsulation */) 411.22 403.81 T
({static int count=0, old_count=0, max_count = 0;) 411.22 395.47 T
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 411.22 387.13 T
( pthread_mutex_lock\050&count_lock\051;) 411.22 370.46 T
( count += i;) 411.22 362.12 T
( if \050i == -1\051 printf\050\322Conflicts: %d\134n\323, max_count\051;) 411.22 353.78 T
( if \050count > max_count\051) 411.22 345.44 T
(   max_count = count;) 411.22 337.11 T
( pthread_mutex_unlock\050&count_lock\051;) 411.22 328.77 T
(}) 411.22 320.43 T
(void count_finds\050int i\051         /* Note the encapsulation */) 411.22 303.75 T
({static int count=0, old_count=0, max_count = 0;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 28
%%Page: "mini" 29
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(57) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 37.72 695.65 T
( pthread_mutex_lock\050&count_lock\051;) 37.72 678.97 T
( count += i;) 37.72 670.63 T
( if \050i == -1\051 printf\050\322Total raises + liquidations: %d\134n\323, max_count\051;) 37.72 662.29 T
( if \050count > max_count\051) 37.72 653.95 T
(   max_count = count;) 37.72 645.62 T
( pthread_mutex_unlock\050&count_lock\051;) 37.72 637.28 T
(}) 37.72 628.94 T
(void print_people\050person_t *p\051  /* Debugging function. Not 100% MT safe */) 37.72 603.92 T
({int i = 0;) 37.72 595.59 T
(  while\050p != NULL\051) 37.72 578.91 T
(    {printf\050\322\050%s  %d\051 \322, p->name, p->salary\051;) 37.72 570.57 T
(     p = p->next;) 37.72 562.23 T
(     i++;) 37.72 553.9 T
(     if \050\050i % 5\051 == 0\051 printf\050\322\134n\323\051;) 37.72 545.56 T
(   }) 37.72 537.22 T
(}) 37.72 528.88 T
(void add_to_people\050char *name\051) 37.72 503.87 T
({person_t *p;) 37.72 495.53 T
( p = \050person_t *\051 malloc\050sizeof\050person_t\051\051;) 37.72 478.85 T
( p->name = name;) 37.72 470.52 T
( pthread_mutex_init\050&\050p->next_lock\051, NULL\051;) 37.72 462.18 T
( pthread_mutex_init\050&\050p->salary_lock\051, NULL\051;) 37.72 453.84 T
( pthread_mutex_lock\050&\050people.next_lock\051\051;) 37.72 445.5 T
( p->next = people.next;) 37.72 437.16 T
( people.next = p;) 37.72 428.82 T
( pthread_mutex_unlock\050&\050people.next_lock\051\051;) 37.72 420.49 T
(}) 37.72 412.15 T
(pthread_mutex_lock_conflicts\050pthread_mutex_t *people_lock\051) 37.72 395.47 T
({if \050pthread_mutex_trylock\050people_lock\051 == EBUSY\051) 37.72 387.13 T
(      {count_conflicts\0501\051;) 37.72 378.8 T
(       pthread_mutex_lock\050people_lock\051;) 37.72 370.46 T
(  }) 37.72 362.12 T
(}) 37.72 353.78 T
(person_t *find_person\050char *name\051) 37.72 337.11 T
({person_t *p = &people, *p1, *p2;) 37.72 328.77 T
( pthread_mutex_lock\050&\050p->next_lock\051\051;) 37.72 312.09 T
( p1 = p->next;) 37.72 303.75 T
( while\050p1 != NULL\051) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(58) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(   {if \050strcmp\050p1->name, name\051 == 0\051) 411.22 695.65 T
(      /* Found! Return *previous* person, Still holding p->lock ! */) 411.22 687.31 T
(      {count_finds\0501\051; return\050p\051;}) 411.22 678.97 T
(    pthread_mutex_lock_conflicts\050&\050p1->next_lock\051\051;) 411.22 670.63 T
(    pthread_mutex_unlock\050&\050p->next_lock\051\051;) 411.22 662.29 T
(    p = p1;) 411.22 653.95 T
(    p1 = p->next;) 411.22 645.62 T
(  }) 411.22 637.28 T
( pthread_mutex_unlock\050&\050p->next_lock\051\051;) 411.22 628.94 T
( return\050NULL\051;   /* Couldn\325t find \324em!  Too bad. No Locks held */) 411.22 620.6 T
(}) 411.22 612.26 T
(void give_raise\050person_t *p\051) 411.22 587.25 T
({person_t *p1;) 411.22 578.91 T
( if \050p == NULL\051  return;) 411.22 562.23 T
( p1 = p->next;) 411.22 553.9 T
( pthread_mutex_lock\050&\050p1->salary_lock\051\051;) 411.22 545.56 T
( pthread_mutex_unlock\050&\050p->next_lock\051\051; /* Unlock here!! */) 411.22 537.22 T
( p1->salary++;) 411.22 528.88 T
( delay\050RAISE_DELAY, 0\051;) 411.22 520.54 T
( pthread_mutex_unlock\050&\050p1->salary_lock\051\051;) 411.22 512.21 T
(}) 411.22 503.87 T
(void *give_friends_raise\050void *arg\051) 411.22 478.85 T
({person_t *p, *friends = \050person_t *\051 arg;) 411.22 470.52 T
(  while\050friends != NULL\051) 411.22 453.84 T
(    {p = find_person\050friends->name\051;) 411.22 445.5 T
(     give_raise\050p\051;) 411.22 437.16 T
(     friends = friends->next;) 411.22 428.82 T
(   }) 411.22 420.49 T
(  sem_post\050&barrier\051;) 411.22 412.15 T
(}) 411.22 403.81 T
(void liquidate_person\050person_t *p\051) 411.22 370.46 T
({person_t  *p1;) 411.22 362.12 T
( p1 = p->next;) 411.22 345.44 T
( pthread_mutex_lock\050&\050p1->next_lock\051\051;) 411.22 337.11 T
( p->next = p1->next;) 411.22 328.77 T
( pthread_mutex_unlock\050&\050p->next_lock\051\051;) 411.22 320.43 T
( DEBUG\050printf\050\322Killing: \050%s %d\051\134n\323, p1->name, p1->salary\051\051) 411.22 303.75 T
( pthread_mutex_lock\050&\050p1->salary_lock\051\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 29
%%Page: "mini" 30
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(59) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_mutex_unlock\050 &\050p1->next_lock\051\051;) 37.72 695.65 T
( pthread_mutex_destroy\050&\050p1->next_lock\051\051;) 37.72 687.31 T
( pthread_mutex_unlock\050 &\050p1->salary_lock\051\051;) 37.72 678.97 T
( pthread_mutex_destroy\050&\050p1->salary_lock\051\051;) 37.72 670.63 T
( free\050p1->name\051;) 37.72 662.29 T
( free\050p1\051;) 37.72 653.95 T
( delay\050LIQUIDATE_DELAY, 0\051;) 37.72 645.62 T
( return;) 37.72 637.28 T
(}) 37.72 628.94 T
(void *liquidate_enemies\050void *arg\051) 37.72 603.92 T
({person_t *p, *enemies = \050person_t *\051 arg;) 37.72 595.59 T
(  while\050enemies != NULL\051) 37.72 578.91 T
(    {p = find_person\050enemies->name\051;) 37.72 570.57 T
(     if \050p\051) 37.72 562.23 T
(       liquidate_person\050p\051;) 37.72 553.9 T
(     enemies = enemies->next;) 37.72 545.56 T
(   }) 37.72 537.22 T
( DEBUG\050{printf\050\322\134nAfter the purge...\134n\323\051; print_people\050people.next\051;}\051) 37.72 528.88 T
( sem_post\050&barrier\051;) 37.72 520.54 T
(}) 37.72 512.21 T
(person_t *make_list_of_friends\050int seed1\051) 37.72 487.19 T
({int i, r;) 37.72 478.85 T
( unsigned int seed = \050int\051 seed1;) 37.72 470.52 T
( char s[20], *s1;) 37.72 462.18 T
( person_t *p, friends;) 37.72 453.84 T
( friends.next = NULL;) 37.72 437.16 T
( for \050i=0; i<N_FRIENDS; i++\051) 37.72 420.49 T
(   {r = rand_r\050&seed\051 % N_PEOPLE;) 37.72 412.15 T
(    sprintf\050s, \322Jan_%d\323, r\051;) 37.72 403.81 T
(    s1 = \050char *\051 malloc\050strlen\050s\051+1\051;) 37.72 395.47 T
(    strcpy\050s1, s\051;) 37.72 387.13 T
(    p = \050person_t *\051 malloc\050sizeof\050person_t\051\051;) 37.72 378.8 T
(    p->name = s1;) 37.72 370.46 T
(    p->next = friends.next;) 37.72 362.12 T
(    friends.next = p;) 37.72 353.78 T
(  }) 37.72 345.44 T
( return\050friends.next\051;) 37.72 337.11 T
(}) 37.72 328.77 T
(person_t *make_list_of_enemies\050int s\051) 37.72 303.75 T
({) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(60) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  return\050make_list_of_friends\050s\051\051;) 411.22 695.65 T
(}) 411.22 687.31 T
(void *make_list_of_people\050\051) 411.22 653.95 T
({int i, n;) 411.22 645.62 T
( char s[20], *s1;) 411.22 637.28 T
( for \050i=0; i<N_PEOPLE; i++\051) 411.22 620.6 T
(   {sprintf\050s, \322Jan_%d\323, i\051;) 411.22 612.26 T
(    s1 = \050char *\051 malloc\050strlen\050s\051+1\051;) 411.22 603.92 T
(    strcpy\050s1, s\051;) 411.22 595.59 T
(    add_to_people\050s1\051;) 411.22 587.25 T
(  }) 411.22 578.91 T
(}) 411.22 570.57 T
(main\050int argc, char *argv[]\051) 411.22 545.56 T
({int i;) 411.22 537.22 T
( pthread_attr_t attr;) 411.22 528.88 T
(  pthread_t tid;) 411.22 520.54 T
( SEM_INIT\050&barrier, NULL, 0\051;) 411.22 503.87 T
( PTHREAD_ATTR_INIT\050&attr\051;) 411.22 495.53 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 411.22 487.19 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 411.22 478.85 T
( people.next = NULL;) 411.22 470.52 T
( people.name = \050char *\051 -1;             /* SEGV if you touch this ! */) 411.22 462.18 T
( pthread_mutex_init\050&\050people.next_lock\051, NULL\051;) 411.22 453.84 T
( if \050argc >= 2\051 LIQUIDATE_DELAY = atoi\050argv[1]\051;) 411.22 428.82 T
( if \050argc >= 3\051 RAISE_DELAY     = atoi\050argv[2]\051;) 411.22 420.49 T
( if \050argc >= 4\051 N_PEOPLE        = atoi\050argv[3]\051;) 411.22 412.15 T
( if \050argc >= 5\051 N_FRIENDS       = atoi\050argv[4]\051;) 411.22 403.81 T
( if \050argc >= 6\051 E_THREADS       = atoi\050argv[5]\051;) 411.22 395.47 T
( if \050argc >= 7\051 F_THREADS       = atoi\050argv[6]\051;) 411.22 387.13 T
( printf\050) 411.22 370.46 T
( \322list_2local_locks\050LIQUIDATE: %d RAISE: %d N_PEOPLE: %d\134n N_FRIENDS: %d) 411.22 362.12 T
(E_THREADS: %d F_THREADS: %d\051\134n\323,) 411.22 353.78 T
( LIQUIDATE_DELAY, RAISE_DELAY, N_PEOPLE, N_FRIENDS, E_THREADS, F_THREADS \051;) 411.22 345.44 T
( make_list_of_people\050\051;) 411.22 320.43 T
( iobench_start\050\051;) 411.22 312.09 T
( for \050i=0; i<F_THREADS; i++\051) 411.22 303.75 T
(   PTHREAD_CREATE\050&tid, &attr, give_friends_raise, make_list_of_friends\050i*10\051\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 30
%%Page: "mini" 31
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(61) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( for \050i=0; i<E_THREADS; i++\051) 37.72 695.65 T
(   PTHREAD_CREATE\050&tid, &attr, liquidate_enemies, make_list_of_enemies\050i\051\051;) 37.72 687.31 T
( thread_single_barrier\050&barrier, F_THREADS + E_THREADS\051;) 37.72 670.63 T
( iobench_end\050\051;) 37.72 662.29 T
( count_finds\050-1\051;) 37.72 653.95 T
( count_conflicts\050-1\051;) 37.72 645.62 T
( iobench_report\050\051;) 37.72 637.28 T
( printf\050\322Done\134n\323\051;) 37.72 628.94 T
( exit\0500\051;) 37.72 620.6 T
(}) 37.72 603.92 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(62) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
411.22 328.86 723.75 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
639.32 450.51 663.77 579.15 R
0.6 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
639.32 480.1 663.77 537.56 R
N
2 10.72 Q
(Jan) 0 -90 649.64 571.56 TF
($15000) 0 -90 649.21 524.92 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 651.54 464.66 GG
90 450 5.57 4.93 270 651.54 464.66 AA
592.84 537.21 594.41 537.05 592.29 531.74 591.27 537.36 4 Y
0 Z
N
592.84 537.21 594.41 537.05 592.29 531.74 591.27 537.36 4 Y
V
651.64 458.88 M
 656.97 451.02 651.03 436.88 636.75 445.37 D
 603.39 465.2 631.95 508.4 620.82 541.19 D
 618.46 548.12 602.69 549.44 597.11 544.36 D
 594.79 542.25 593.12 539.99 592.87 537.5 D
2 Z
N
647.56 591 649.12 591.21 648.29 585.57 646 590.79 4 Y
0 Z
N
647.56 591 649.12 591.21 648.29 585.57 646 590.79 4 Y
V
671.91 640.47 M
 680.94 622.45 670.14 614.98 653.39 610.21 D
 645.66 608.01 646.41 599.6 647.52 591.29 D
2 Z
N
560.6 534.67 561.97 535.48 563.4 529.91 559.23 533.87 4 Y
0 Z
N
560.6 534.67 561.97 535.48 563.4 529.91 559.23 533.87 4 Y
V
551.6 653.76 M
 549.76 615.1 544.32 562.35 560.45 534.93 D
2 Z
N
541.22 643.47 563.09 690.21 R
N
90 450 5.57 4.93 270 552.16 654.62 GG
90 450 5.57 4.93 270 552.16 654.62 AA
562.66 662.34 541.22 662.34 2 L
N
(ptr) 0 -90 549.37 685.92 TF
(OK) 0 -90 529.72 596.09 TF
663.86 450.51 688.3 579.15 R
N
663.86 480.1 688.3 537.56 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
672.31 453.08 686.59 477.95 R
N
679.45 477.95 679.45 453.51 2 L
N
686.59 462.09 666.44 462.09 2 L
N
2 5.96 Q
(2) 0 -90 681.11 459.39 TF
90 450 2.36 2.1 270 669.38 457.15 GG
90 450 2.36 2.1 270 669.38 457.15 AA
555.8 395.19 580.24 523.83 R
N
555.8 424.78 580.24 482.24 R
N
2 10.72 Q
(Kim) 0 -90 566.12 516.24 TF
($99000) 0 -90 565.69 469.6 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 568.02 409.34 GG
90 450 5.57 4.93 270 568.02 409.34 AA
580.34 395.19 604.78 523.83 R
N
580.34 424.78 604.78 482.24 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
660.86 636.18 682.73 682.92 R
N
90 450 5.57 4.93 270 671.8 647.33 GG
90 450 5.57 4.93 270 671.8 647.33 AA
682.3 655.05 660.86 655.05 2 L
N
(list) 0 -90 669.01 678.64 TF
494.05 366.03 518.5 494.68 R
N
494.05 395.62 518.5 453.08 R
N
(Kari) 0 -90 504.37 487.09 TF
($80000) 0 -90 503.94 440.44 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
90 450 5.57 4.93 270 506.28 380.18 GG
90 450 5.57 4.93 270 506.28 380.18 AA
518.59 366.03 543.04 494.68 R
N
518.59 395.62 543.04 453.08 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
533.28 503.48 534.85 503.43 533.11 497.99 531.7 503.53 4 Y
0 Z
N
533.28 503.48 534.85 503.43 533.11 497.99 531.7 503.53 4 Y
V
567.55 405.41 M
 570.64 395.39 567.19 377.37 558.92 388.19 D
 539.58 413.46 556.13 468.52 549.68 510.32 D
 548.31 519.15 539.17 520.84 535.93 514.37 D
 534.32 511.14 533.4 507.5 533.28 503.78 D
2 Z
N
669.44 497.68 684.02 522.55 R
N
676.73 522.55 676.73 498.11 2 L
N
684.02 506.68 669.87 506.68 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 5.96 Q
(0) 0 -90 678.45 503.99 TF
90 450 2.36 2.14 270 672.87 502.18 GG
90 450 2.36 2.14 270 672.87 502.18 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
586.68 443.22 601.26 468.09 R
N
593.97 468.09 593.97 443.65 2 L
N
601.26 452.22 587.11 452.22 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(1) 0 -90 595.69 449.53 TF
90 450 2.36 2.14 270 590.11 447.72 GG
90 450 2.36 2.14 270 590.11 447.72 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
524.93 414.92 539.51 439.79 R
N
532.22 439.79 532.22 415.35 2 L
N
539.51 423.92 525.36 423.92 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(0) 0 -90 533.95 421.23 TF
90 450 2.36 2.14 270 528.36 419.42 GG
90 450 2.36 2.14 270 528.36 419.42 AA
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
666.44 453.08 672.32 477.95 R
N
(0) 0 -90 673.49 459.51 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
588.7 398.62 602.97 423.49 R
N
595.83 423.49 595.83 399.05 2 L
N
602.97 407.63 582.82 407.63 2 L
N
(1) 0 -90 597.49 404.93 TF
90 450 2.36 2.1 270 585.76 402.7 GG
90 450 2.36 2.1 270 585.76 402.7 AA
582.82 398.62 588.7 423.49 R
N
(0) 0 -90 589.87 405.05 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
526.52 369.03 540.79 393.9 R
N
533.66 393.9 533.66 369.46 2 L
N
540.79 378.04 520.64 378.04 2 L
N
(0) 0 -90 535.32 375.35 TF
90 450 2.36 2.1 270 523.58 373.11 GG
90 450 2.36 2.1 270 523.58 373.11 AA
520.64 369.03 526.52 393.9 R
N
(0) 0 -90 527.69 375.47 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
578.96 620.32 654.43 690.64 R
N
619.17 690.64 619.17 620.32 2 L
N
654.43 640.9 579.39 640.9 2 L
N
2 10.72 Q
(writer) 0 -90 626.48 685.92 TF
(w_sleep) 0 -90 608.04 685.92 TF
90 450 5.57 4.93 270 610.75 630.61 GG
90 450 5.57 4.93 270 610.75 630.61 AA
637.71 690.64 637.71 620.32 2 L
N
599.54 690.64 599.54 620.75 2 L
N
(reader) 0 -90 642.02 685.92 TF
(s) 0 -90 642.02 653.31 TF
(r_sleep) 0 -90 585.9 685.92 TF
90 450 5.57 4.93 270 588.61 630.18 GG
90 450 5.57 4.93 270 588.61 630.18 AA
(0) 0 -90 625.77 634.04 TF
(3) 0 -90 642.44 634 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(R/W loc) 0 -90 471.32 691.4 TF
(k pr) 0 -90 471.32 652.3 TF
(otecting the structure) 0 -90 471.32 632.86 TF
(, and m) 0 -90 471.32 522.55 TF
(ute) 0 -90 471.32 485.24 TF
(x pr) 0 -90 471.32 469.32 TF
(otecting the data.) 0 -90 471.32 449.87 TF
(Outside pointer) 0 -90 460.6 691.4 TF
(s m) 0 -90 460.6 612.34 TF
(ust hold the) 0 -90 460.6 594.08 TF
5 F
(appr) 0 -90 460.6 530.35 TF
(opriate) 0 -90 460.6 507.33 TF
2 F
( m) 0 -90 460.6 471.59 TF
(ute) 0 -90 460.6 459.29 TF
(x/loc) 0 -90 460.6 443.37 TF
(k.) 0 -90 460.6 419.16 TF
2 19.06 Q
(Linked Lists: R/W Loc) 0 -90 703.6 659.84 TF
(k & Loc) 0 -90 703.6 461.13 TF
(k) 0 -90 703.6 392.67 TF
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 31
%%Page: "mini" 32
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(63) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
37.72 340.77 359.45 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 10.72 Q
0 X
0 0 0 1 0 0 0 K
(Output: J) 0 -90 306.76 431.21 TF
(une) 0 -90 306.76 383.79 TF
(...) 0 -90 306.76 364.51 TF
305.81 513.7 M
 307.27 517.94 300.3 521.89 295.74 516.67 D
 291.16 511.42 285.55 524.24 277.52 514.69 D
1.79 H
2 Z
N
90 450 0.89 0.89 90 291.92 502.66 GG
291.92 503.56 289.65 503.56 291.92 511.45 294.18 503.56 4 Y
0 Z
N
291.92 503.56 289.65 503.56 291.92 511.45 294.18 503.56 4 Y
V
291.92 502.66 291.92 496.82 2 L
2 Z
N
146.26 602.04 M
 147.71 606.28 140.74 610.23 136.19 605.01 D
 131.61 599.76 125.99 612.59 117.97 603.03 D
N
90 450 0.89 0.89 90 132.36 591 GG
132.36 591.9 130.1 591.9 132.36 599.79 134.62 591.9 4 Y
0 Z
N
132.36 591.9 130.1 591.9 132.36 599.79 134.62 591.9 4 Y
V
132.36 591 132.36 585.16 2 L
2 Z
N
218.77 593.73 240.64 637.47 R
0.6 H
N
90 450 5.22 4.93 270 229.71 604.16 GG
90 450 5.22 4.93 270 229.71 604.16 AA
240.21 611.39 218.77 611.39 2 L
N
(Jan) 0 -90 226.92 633.46 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
218.77 529.41 240.64 573.15 R
N
90 450 5.22 4.93 270 229.71 539.84 GG
90 450 5.22 4.93 270 229.71 539.84 AA
240.21 547.07 218.77 547.07 2 L
N
(Jon) 0 -90 226.92 569.14 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
226.81 581.84 228.34 582.73 229.93 576.52 225.29 580.94 4 Y
0.3 H
0 Z
N
226.81 581.84 228.34 582.73 229.93 576.52 225.29 580.94 4 Y
V
230.35 604.02 M
 226.22 597.66 222.9 588.51 226.74 581.96 D
2 Z
N
225.64 656.43 247.51 695.36 R
0.6 H
N
90 450 4.64 4.93 270 236.57 665.72 GG
90 450 4.64 4.93 270 236.57 665.72 AA
229.73 646.58 231.3 646.72 230.22 641.12 228.17 646.44 4 Y
0 Z
N
229.73 646.58 231.3 646.72 230.22 641.12 228.17 646.44 4 Y
V
239.24 663.93 M
 242.67 656.24 238.56 653.05 232.2 651.02 D
 230.38 650.44 229.53 648.84 229.71 646.88 D
2 Z
N
247.08 672.15 225.64 672.15 2 L
N
(T1) 0 -90 233.78 691.79 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
163.21 575.45 185.08 619.19 R
N
90 450 5.22 4.93 270 174.15 585.88 GG
90 450 5.22 4.93 270 174.15 585.88 AA
184.65 593.1 163.21 593.1 2 L
N
(Jim) 0 -90 171.36 615.17 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
214.8 660.82 214.4 662.54 220.82 662.22 215.2 659.09 4 Y
0.3 H
0 Z
N
214.8 660.82 214.4 662.54 220.82 662.22 215.2 659.09 4 Y
V
176.34 626.38 M
 182.03 643.85 197.24 653.45 212.66 659.96 D
 213.32 660.24 213.96 660.62 214.65 660.78 D
2 Z
N
197.24 371.79 M
 198.69 376.04 191.72 379.99 187.17 374.77 D
 182.58 369.52 176.97 382.35 168.95 372.79 D
1.79 H
N
90 450 0.89 0.89 90 183.34 360.76 GG
183.34 361.66 181.08 361.66 183.34 369.55 185.6 361.66 4 Y
0 Z
N
183.34 361.66 181.08 361.66 183.34 369.55 185.6 361.66 4 Y
V
183.34 360.76 183.34 354.92 2 L
2 Z
N
286.22 534.93 287.99 534.95 286.28 528.75 284.45 534.91 4 Y
0.3 H
0 Z
N
286.22 534.93 287.99 534.95 286.28 528.75 284.45 534.91 4 Y
V
252.22 663.2 M
 291.8 630.83 285.74 580.43 286.22 535.08 D
2 Z
N
319.98 441.75 321.52 440.87 316.93 436.37 318.43 442.62 4 Y
0 Z
N
319.98 441.75 321.52 440.87 316.93 436.37 318.43 442.62 4 Y
V
302.82 506.68 M
 298.64 481.4 332.66 464.13 320.05 441.88 D
2 Z
N
(Pr) 0 -90 101.7 626.05 TF
(oducer) 0 -90 101.7 614.95 TF
(Stopper) 0 -90 153.2 389.7 TF
(Consumer) 0 -90 261.26 535.05 TF
(stop 0) 0 -90 184.76 478.46 TF
176.72 440.5 198.59 480.89 R
0.6 H
N
198.16 454.81 176.72 454.81 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
217.53 456.81 217.84 455.27 212.16 455.71 217.21 458.35 4 Y
0 Z
N
217.53 456.81 217.84 455.27 212.16 455.71 217.21 458.35 4 Y
V
281.86 504.25 M
 295.3 477.05 278.31 435.85 244.09 446.44 D
 235.83 448.99 227.7 458.89 217.82 456.87 D
2 Z
N
152.99 612.89 153.24 614.44 158.4 612 152.73 611.34 4 Y
0 Z
N
152.99 612.89 153.24 614.44 158.4 612 152.73 611.34 4 Y
V
126 611.82 M
 118.58 621.19 123.42 645.32 138.91 639.13 D
 150.44 634.53 141.45 620.72 148.95 614.78 D
 150.13 613.84 151.37 613.16 152.7 612.94 D
2 Z
N
161.04 470.36 160.93 471.93 166.52 470.72 161.14 468.79 4 Y
0 Z
N
161.04 470.36 160.93 471.93 166.52 470.72 161.14 468.79 4 Y
V
122.66 595.57 M
 109.65 557.17 93.83 497.1 138.91 473.3 D
 145.6 469.77 153.24 469.84 160.74 470.34 D
2 Z
N
(Stop?) 0 -90 137.44 506.85 TF
(Stop?) 0 -90 228.29 448.54 TF
188.26 426.01 186.7 425.86 187.77 431.47 189.83 426.14 4 Y
0 Z
N
188.26 426.01 186.7 425.86 187.77 431.47 189.83 426.14 4 Y
V
183.37 381.39 M
 188.63 394.36 189.65 410.5 188.29 425.71 D
2 Z
N
(Set) 0 -90 192.45 408.87 TF
2 19.06 Q
(Stoppab) 0 -90 339.3 660.43 TF
(le Pr) 0 -90 339.3 584.39 TF
(oducer/Consumer) 0 -90 339.3 543.45 TF
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(64) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Ex) 487.72 686.11 T
(er) 513.73 686.11 T
(cise Objective) 533.57 686.11 T
2 10.72 Q
(Edit the code in) 411.22 667.65 T
4 F
(stop_queue_problem.c) 494.03 667.65 T
2 F
( and use the ne) 622.67 667.65 T
(w global) 700.56 667.65 T
(v) 411.22 654.55 T
(ariab) 416.97 654.55 T
(le) 442.48 654.55 T
(,) 451.53 654.55 T
4 F
(stop) 457.49 654.55 T
2 F
(. When) 483.22 654.55 T
4 F
(stop==FALSE) 521.34 654.55 T
2 F
(, the pr) 592.1 654.55 T
(ogram runs as bef) 627.63 654.55 T
(ore) 720.35 654.55 T
(.) 737.24 654.55 T
(When it g) 411.22 641.45 T
(ets c) 459.57 641.45 T
(hang) 483.9 641.45 T
(ed to) 509.61 641.45 T
4 F
(TRUE) 538.21 641.45 T
2 F
(, then the pr) 563.93 641.45 T
(oducer) 625.07 641.45 T
(s will stop ad) 660.66 641.45 T
(ding) 727.87 641.45 T
(ne) 411.22 628.34 T
(w elements and e) 423.57 628.34 T
(xit. \050The) 512.19 628.34 T
(y ma) 553.13 628.34 T
(y complete whate) 577.35 628.34 T
(ver the) 666.55 628.34 T
(y\325) 701.54 628.34 T
(re w) 710.05 628.34 T
(ork-) 731.29 628.34 T
(ing on.\051 The consumer) 411.22 615.24 T
(s will also stop consuming and e) 526.03 615.24 T
(xit. \050The) 693.28 615.24 T
(y) 734.22 615.24 T
(MUST complete their current job.\051) 411.22 602.14 T
(Print out the length of the queue after the) 411.22 575.93 T
(y ha) 621.32 575.93 T
(ve e) 642.61 575.93 T
(xited. Set) 663.31 575.93 T
4 F
(stop) 713.96 575.93 T
2 F
(bac) 411.22 562.83 T
(k to) 429.48 562.83 T
4 F
(FALSE) 451.52 562.83 T
2 F
( and create some ne) 483.68 562.83 T
(w consumer) 586.6 562.83 T
(s.) 648.99 562.83 T
5 F
(After) 660.91 562.83 T
2 F
( the consum-) 685.92 562.83 T
(er) 411.22 549.73 T
(s ha) 421.19 549.73 T
(ve emptied the queue) 442.48 549.73 T
(, star) 552.21 549.73 T
(t up some ne) 578.04 549.73 T
(w pr) 644.01 549.73 T
(oducer) 665.83 549.73 T
(s.) 701.41 549.73 T
-0.32 (I ha) 411.22 523.52 P
-0.32 (ve a thread whic) 429.21 523.52 P
-0.32 (h calls) 511.57 523.52 P
4 F
-0.69 (stopper\050\051) 547.28 523.52 P
2 F
-0.32 (, whic) 605.17 523.52 P
-0.32 (h sleeps f) 634.54 523.52 P
-0.32 (or 4 seconds,) 683.14 523.52 P
(then sets) 411.22 510.42 T
4 F
(stop) 461.27 510.42 T
2 F
( to) 486.99 510.42 T
4 F
(TRUE) 503.08 510.42 T
2 F
(. It m) 528.8 510.42 T
(ust do whate) 553.61 510.42 T
(ver is necessar) 618.97 510.42 T
(y to wake) 696.56 510.42 T
(up sleeping consumer) 411.22 497.32 T
(s or pr) 524.85 497.32 T
(oducer) 558 497.32 T
(s, then e) 593.58 497.32 T
(xit itself) 636.91 497.32 T
(.) 677.32 497.32 T
(Don\325t use UNIX signals!) 411.22 471.11 T
(My solution is in) 411.22 444.9 T
4 F
(stop_queues_solution.c) 498.2 444.9 T
2 F
(.  Man) 639.71 444.9 T
(y minor \050and) 669.88 444.9 T
(major\051 v) 411.22 431.8 T
(ariations are possib) 452.71 431.8 T
(le) 553.89 431.8 T
(.) 563.05 431.8 T
(Wild Guess at Time to Completion:) 411.22 340.08 T
(30 min) 518.43 326.98 T
(utes think/design time) 552.28 326.98 T
(.) 665.68 326.98 T
(2 hour) 518.43 313.88 T
(s pr) 551.03 313.88 T
(ogramming/deb) 570.47 313.88 T
(ug) 650.67 313.88 T
(ging) 663.67 313.88 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 32
%%Page: "mini" 33
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(65) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Stoppab) 117.62 686.11 T
(le Queue:) 203.17 686.11 T
(stop_queue_pr) 92.21 657.53 T
(ob) 245.47 657.53 T
(lem.c) 271.46 657.53 T
4 7.15 Q
(/*                stop_queue_problem.c                */) 37.72 624.17 T
(/*) 37.72 607.5 T
(  This is the prototypical producer/consumer example done by) 37.72 599.16 T
(  building a singly linked list. Every few seconds we stop the) 37.72 590.82 T
(  queue completely, letting the consumers complete their current) 37.72 582.48 T
(  request, but not taking anything new from the queue.  Upon) 37.72 574.15 T
(  restart, the consumers get to empty the list before the producers) 37.72 565.81 T
(  start.) 37.72 557.47 T
(  Delays are inserted to simulate disk I/O \050and to make things) 37.72 540.79 T
(  run slower!\051.) 37.72 532.45 T
(*/) 37.72 524.12 T
(/*) 37.72 507.44 T
(cc -o stop_queue_problem stop_queue_problem.c -L. -R. -g -lpthread -lthread -) 37.72 499.1 T
(lthread_extensions -lposix4) 37.72 490.77 T
(*/) 37.72 482.43 T
(#define _POSIX_C_SOURCE 199506L) 37.72 465.75 T
(#include <pthread.h>) 37.72 449.07 T
(#include <semaphore.h>) 37.72 440.74 T
(#include <errno.h>) 37.72 432.4 T
(#include <time.h>) 37.72 424.06 T
(#include \322thread_extensions.h\323) 37.72 415.72 T
(typedef struct request_struct) 37.72 390.71 T
({int                    client;) 37.72 382.37 T
( char                   *buf;) 37.72 374.03 T
( pthread_t              tid;) 37.72 365.69 T
( struct request_struct  *next;) 37.72 357.35 T
(} request_t;) 37.72 349.02 T
(request_t               *requests = NULL;) 37.72 332.34 T
(int                     length = 0;) 37.72 324 T
(pthread_cond_t          requests_producer = PTHREAD_COND_INITIALIZER;) 37.72 315.66 T
(pthread_cond_t          requests_consumer = PTHREAD_COND_INITIALIZER;) 37.72 307.33 T
(pthread_mutex_t         requests_lock = PTHREAD_MUTEX_INITIALIZER;) 37.72 298.99 T
(pthread_attr_t          attr;) 37.72 290.65 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(66) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(sem_t                   barrier;) 411.22 695.65 T
(int                     GET_DELAY = 20, PROCESS_DELAY = 250;) 411.22 687.31 T
(int                     stop = FALSE;) 411.22 678.97 T
(int                     N_PROD = 2, N_CONS = 2;) 411.22 670.63 T
(int                     n_produced = 0, n_processed = 0;) 411.22 662.29 T
(void print_requests\050\051) 411.22 628.94 T
({request_t *r = requests;) 411.22 620.6 T
( while \050r != NULL\051) 411.22 603.92 T
(   {printf\050\322<Request: %d>\134n\323, r->client\051;) 411.22 595.59 T
(    r = r->next;) 411.22 587.25 T
(  }) 411.22 578.91 T
(}) 411.22 570.57 T
(request_t *get_request\050\051) 411.22 545.56 T
({static pthread_mutex_t mr  = PTHREAD_MUTEX_INITIALIZER;) 411.22 537.22 T
( int c;) 411.22 528.88 T
( request_t *request;) 411.22 520.54 T
( pthread_t tid = pthread_self\050\051;) 411.22 512.21 T
( char *name = thread_name\050tid\051;) 411.22 503.87 T
( delay\050GET_DELAY, 0\051;) 411.22 487.19 T
( pthread_mutex_lock\050&mr\051;) 411.22 478.85 T
( c=n_produced++;) 411.22 470.52 T
( pthread_mutex_unlock\050&mr\051;) 411.22 462.18 T
( request = \050request_t *\051 malloc\050sizeof\050request_t\051\051;) 411.22 445.5 T
( request->client = c;                        /* Cannot use count here! */) 411.22 437.16 T
( request->tid = tid;) 411.22 428.82 T
( DEBUG\050printf\050\322[%s] Creating request  %4d\134n\323, name, c\051\051;) 411.22 412.15 T
( return\050request\051;) 411.22 403.81 T
(}) 411.22 395.47 T
(void process_request\050request_t *request\051) 411.22 370.46 T
({static pthread_mutex_t mr  = PTHREAD_MUTEX_INITIALIZER;) 411.22 362.12 T
( pthread_t tid = pthread_self\050\051;) 411.22 353.78 T
( char *name = thread_name\050tid\051;) 411.22 345.44 T
( delay\050PROCESS_DELAY, 0\051;) 411.22 328.77 T
( DEBUG\050printf\050\322[%s] Processed request %4d [%s]\134n\323,) 411.22 320.43 T
(              name, request->client, thread_name\050request->tid\051\051\051;) 411.22 312.09 T
( free\050request\051;) 411.22 303.75 T
( pthread_mutex_lock\050&mr\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 33
%%Page: "mini" 34
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(67) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( n_processed++;) 37.72 695.65 T
( pthread_mutex_unlock\050&mr\051;) 37.72 687.31 T
(}) 37.72 678.97 T
(request_t *remove_request\050\051) 37.72 653.95 T
({request_t *request;) 37.72 645.62 T
( request = requests;) 37.72 628.94 T
( requests = requests->next;) 37.72 620.6 T
( length--;) 37.72 612.26 T
( return\050request\051;) 37.72 603.92 T
(}) 37.72 595.59 T
(void add_request\050request_t *request\051) 37.72 570.57 T
({) 37.72 562.23 T
( request->next = requests;                      /* Insert at head of list */) 37.72 553.9 T
( requests = request;) 37.72 545.56 T
( length++;) 37.72 537.22 T
(}) 37.72 528.88 T
(void *producer\050void *arg\051) 37.72 503.87 T
({request_t *request;) 37.72 495.53 T
( while\050TRUE\051) 37.72 487.19 T
(   {request = get_request\050\051;) 37.72 478.85 T
(    pthread_mutex_lock\050&requests_lock\051;) 37.72 470.52 T
(    while \050length >= 10\051) 37.72 462.18 T
(      {delay\05020, 0\051;            /* Leave in!  Makes lost wakeup more likely. */) 37.72 453.84 T
(       pthread_cond_wait\050&requests_producer, &requests_lock\051;}) 37.72 445.5 T
(    add_request\050request\051;) 37.72 437.16 T
(    pthread_mutex_unlock\050&requests_lock\051;) 37.72 428.82 T
(    pthread_cond_signal\050&requests_consumer\051;) 37.72 420.49 T
(  }) 37.72 412.15 T
( pthread_mutex_unlock\050&requests_lock\051;) 37.72 403.81 T
( sem_post\050&barrier\051;) 37.72 395.47 T
( pthread_exit\050NULL\051;) 37.72 387.13 T
(}) 37.72 378.8 T
(void *consumer\050void *arg\051) 37.72 353.78 T
({request_t *request;) 37.72 345.44 T
( while\050TRUE\051) 37.72 328.77 T
(   {pthread_mutex_lock\050&requests_lock\051;) 37.72 320.43 T
(    while \050length == 0\051) 37.72 312.09 T
(      {delay\05020, 0\051;                    /* Leave in!  Makes lost wakeup more) 37.72 303.75 T
(likely. */) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(68) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(       pthread_cond_wait\050&requests_consumer, &requests_lock\051;}) 411.22 695.65 T
(    request = remove_request\050\051;) 411.22 687.31 T
(    pthread_mutex_unlock\050&requests_lock\051;) 411.22 678.97 T
(    pthread_cond_signal\050&requests_producer\051;) 411.22 670.63 T
(    process_request\050request\051;) 411.22 662.29 T
(  }) 411.22 653.95 T
( pthread_mutex_unlock\050&requests_lock\051;) 411.22 645.62 T
( sem_post\050&barrier\051;) 411.22 637.28 T
( pthread_exit\050NULL\051;) 411.22 628.94 T
(}) 411.22 620.6 T
(void *stopper\050void *arg\051) 411.22 595.59 T
({) 411.22 587.25 T
(  sleep\0504\051;) 411.22 578.91 T
(  stop = TRUE;) 411.22 570.57 T
(  printf\050\322Time to stop!\134n\323\051;) 411.22 562.23 T
(  pthread_exit\050NULL\051;) 411.22 553.9 T
(}) 411.22 545.56 T
(main\050int argc, char **argv\051) 411.22 520.54 T
({int i, j;) 411.22 512.21 T
( pthread_t tid;) 411.22 503.87 T
( SEM_INIT\050&barrier, NULL,  0\051;) 411.22 487.19 T
( PTHREAD_ATTR_INIT\050&attr\051;) 411.22 478.85 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 411.22 470.52 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 411.22 462.18 T
( if \050argc >= 2\051 GET_DELAY     = atoi\050argv[1]\051;) 411.22 445.5 T
( if \050argc >= 3\051 PROCESS_DELAY = atoi\050argv[2]\051;) 411.22 437.16 T
( if \050argc >= 4\051 N_PROD        = atoi\050argv[3]\051;) 411.22 428.82 T
( if \050argc >= 5\051 N_CONS        = atoi\050argv[4]\051;) 411.22 420.49 T
( printf\050\322GET_DELAY \050ms\051 = %d PROCESS_DELAY \050ms\051 = %d N_PROD = %d N_CONS = %d\134n\323,) 411.22 412.15 T
(        GET_DELAY, PROCESS_DELAY, N_PROD, N_CONS\051;) 411.22 403.81 T
( PTHREAD_CREATE\050&tid, &attr, killer, \050void *\051 60\051;) 411.22 395.47 T
( for \050j=0; j < 3; j++\051) 411.22 378.8 T
(   {printf\050\322Starting consumers. List length: %d Produced: %d Consumed %d.\134n\323,) 411.22 370.46 T
(           length, n_produced, n_processed\051;) 411.22 362.12 T
(    for \050i=0; i<N_CONS; i++\051) 411.22 353.78 T
(      PTHREAD_CREATE\050&tid, &attr, consumer, NULL\051;) 411.22 345.44 T
(    printf\050\322Starting producers. List length: %d Produced: %d Consumed %d.\134n\323,) 411.22 320.43 T
(           length, n_produced, n_processed\051;) 411.22 312.09 T
(    for \050i=0; i<N_PROD; i++\051) 411.22 303.75 T
(      PTHREAD_CREATE\050&tid, &attr, producer, NULL\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 34
%%Page: "mini" 35
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(69) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    PTHREAD_CREATE\050&tid, &attr, stopper, NULL\051;) 37.72 687.31 T
(    thread_single_barrier\050&barrier, N_PROD+N_CONS\051;) 37.72 678.97 T
(    stop = FALSE;) 37.72 670.63 T
(    printf\050\322All exited. List length: %d Produced: %d Consumed %d.\134n\323,) 37.72 662.29 T
(           length, n_produced, n_processed\051;) 37.72 653.95 T
(    sleep\0504\051;) 37.72 645.62 T
(   }) 37.72 637.28 T
( printf\050\322Done\134n\323\051;) 37.72 628.94 T
( exit\0500\051;) 37.72 620.6 T
(}) 37.72 612.26 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(70) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Stoppab) 491.12 686.11 T
(le Queue:) 576.67 686.11 T
(stop_queue_solution.c) 465.99 657.53 T
4 7.15 Q
( /*                stop_queue_solution.c                */) 411.22 624.17 T
(/*) 411.22 607.5 T
(  This is the prototypical producer/consumer example done by) 411.22 599.16 T
(  building a singly linked list. Every few seconds we stop the) 411.22 590.82 T
(  queue completely, letting the consumers complete their current) 411.22 582.48 T
(  request, but not taking anything new from the queue.  Upon) 411.22 574.15 T
(  restart, the consumers get to empty the list before the producers) 411.22 565.81 T
(  start.) 411.22 557.47 T
(  Delays are inserted to simulate disk I/O \050and to make things) 411.22 540.79 T
(  run slower!\051.) 411.22 532.45 T
(*/) 411.22 524.12 T
(/*) 411.22 507.44 T
(cc -o stop_queue_solution stop_queue_solution.c -L. -R. -g -lpthread -lthread -) 411.22 499.1 T
(pthread_extensions -lposix4) 411.22 490.77 T
(*/) 411.22 482.43 T
(#define _POSIX_C_SOURCE 199506L) 411.22 465.75 T
(#include <pthread.h>) 411.22 449.07 T
(#include <semaphore.h>) 411.22 440.74 T
(#include <errno.h>) 411.22 432.4 T
(#include <time.h>) 411.22 424.06 T
(#include \322thread_extensions.h\323) 411.22 415.72 T
(typedef struct request_struct) 411.22 390.71 T
({int                    client;) 411.22 382.37 T
( char                   *buf;) 411.22 374.03 T
( pthread_t              tid;) 411.22 365.69 T
( struct request_struct  *next;) 411.22 357.35 T
(} request_t;) 411.22 349.02 T
(request_t               *requests = NULL;) 411.22 332.34 T
(int                     length = 0;) 411.22 324 T
(pthread_cond_t          requests_producer = PTHREAD_COND_INITIALIZER;) 411.22 315.66 T
(pthread_cond_t          requests_consumer = PTHREAD_COND_INITIALIZER;) 411.22 307.33 T
(pthread_mutex_t         requests_lock = PTHREAD_MUTEX_INITIALIZER;) 411.22 298.99 T
(pthread_attr_t          attr;) 411.22 290.65 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 35
%%Page: "mini" 36
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(71) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(sem_t                   barrier;) 37.72 695.65 T
(int                     GET_DELAY = 200, PROCESS_DELAY = 250;) 37.72 687.31 T
(int                     stop = FALSE;) 37.72 678.97 T
(int                     N_PROD = 2, N_CONS = 2;) 37.72 670.63 T
(int                     n_processed = 0, n_produced = 0;) 37.72 662.29 T
(void print_requests\050\051) 37.72 628.94 T
({request_t *r = requests;) 37.72 620.6 T
( while \050r != NULL\051) 37.72 603.92 T
(   {printf\050\322<Request: %d>\134n\323, r->client\051;) 37.72 595.59 T
(    r = r->next;) 37.72 587.25 T
(  }) 37.72 578.91 T
(}) 37.72 570.57 T
(request_t *get_request\050\051) 37.72 545.56 T
({static pthread_mutex_t mr  = PTHREAD_MUTEX_INITIALIZER;) 37.72 537.22 T
( int c;) 37.72 528.88 T
( request_t *request;) 37.72 520.54 T
( pthread_t tid = pthread_self\050\051;) 37.72 512.21 T
( char *name = thread_name\050tid\051;) 37.72 503.87 T
( delay\050GET_DELAY, 0\051;) 37.72 487.19 T
( pthread_mutex_lock\050&mr\051;) 37.72 478.85 T
( c=n_produced++;) 37.72 470.52 T
( pthread_mutex_unlock\050&mr\051;) 37.72 462.18 T
( request = \050request_t *\051 malloc\050sizeof\050request_t\051\051;) 37.72 445.5 T
( request->client = c;                        /* Cannot use count here! */) 37.72 437.16 T
( request->tid = tid;) 37.72 428.82 T
( DEBUG\050printf\050\322[%s] Creating request  %4d\134n\323, name, c\051\051;) 37.72 412.15 T
( return\050request\051;) 37.72 403.81 T
(}) 37.72 395.47 T
(void process_request\050request_t *request\051) 37.72 370.46 T
({static pthread_mutex_t mr  = PTHREAD_MUTEX_INITIALIZER;) 37.72 362.12 T
( pthread_t tid = pthread_self\050\051;) 37.72 353.78 T
( char *name = thread_name\050tid\051;) 37.72 345.44 T
( delay\050PROCESS_DELAY, 0\051;) 37.72 328.77 T
( DEBUG\050printf\050\322[%s] Processed request %4d [%s]\134n\323,) 37.72 320.43 T
(              name, request->client, thread_name\050request->tid\051\051\051;) 37.72 312.09 T
( free\050request\051;) 37.72 303.75 T
( pthread_mutex_lock\050&mr\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(72) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( n_processed++;) 411.22 695.65 T
( pthread_mutex_unlock\050&mr\051;) 411.22 687.31 T
(}) 411.22 678.97 T
(request_t *remove_request\050\051) 411.22 645.62 T
({request_t *request;) 411.22 637.28 T
( request = requests;) 411.22 620.6 T
( requests = requests->next;) 411.22 612.26 T
( length--;) 411.22 603.92 T
( return\050request\051;) 411.22 595.59 T
(}) 411.22 587.25 T
(void add_request\050request_t *request\051) 411.22 562.23 T
({) 411.22 553.9 T
( request->next = requests;                      /* Insert at head of list */) 411.22 545.56 T
( requests = request;) 411.22 537.22 T
( length++;) 411.22 528.88 T
(}) 411.22 520.54 T
(void *producer\050void *arg\051) 411.22 495.53 T
({request_t *request;) 411.22 487.19 T
( while\050TRUE\051) 411.22 478.85 T
(   {request = get_request\050\051;) 411.22 470.52 T
(    pthread_mutex_lock\050&requests_lock\051;) 411.22 462.18 T
(    while \050\050length >= 10\051 && \050!stop\051\051) 411.22 453.84 T
(      pthread_cond_wait\050&requests_producer, &requests_lock\051;) 411.22 445.5 T
(    add_request\050request\051;) 411.22 437.16 T
(    if \050stop\051 break;) 411.22 428.82 T
(    pthread_mutex_unlock\050&requests_lock\051;) 411.22 420.49 T
(    pthread_cond_signal\050&requests_consumer\051;) 411.22 412.15 T
(  }) 411.22 403.81 T
( pthread_mutex_unlock\050&requests_lock\051;) 411.22 395.47 T
( sem_post\050&barrier\051;) 411.22 387.13 T
( pthread_exit\050NULL\051;) 411.22 378.8 T
(}) 411.22 370.46 T
(void *consumer\050void *arg\051) 411.22 345.44 T
({request_t *request;) 411.22 337.11 T
( while\050TRUE\051) 411.22 320.43 T
(   {pthread_mutex_lock\050&requests_lock\051;) 411.22 312.09 T
(    while \050\050length == 0\051 && \050!stop\051\051) 411.22 303.75 T
(      pthread_cond_wait\050&requests_consumer, &requests_lock\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 36
%%Page: "mini" 37
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(73) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    if \050stop\051 break;) 37.72 695.65 T
(    request = remove_request\050\051;) 37.72 687.31 T
(    pthread_mutex_unlock\050&requests_lock\051;) 37.72 678.97 T
(    pthread_cond_signal\050&requests_producer\051;) 37.72 670.63 T
(    process_request\050request\051;) 37.72 662.29 T
(  }) 37.72 653.95 T
( pthread_mutex_unlock\050&requests_lock\051;) 37.72 645.62 T
( sem_post\050&barrier\051;) 37.72 637.28 T
( pthread_exit\050NULL\051;) 37.72 628.94 T
(}) 37.72 620.6 T
(void *stopper\050void *arg\051) 37.72 595.59 T
({) 37.72 587.25 T
(  sleep\0504\051;) 37.72 578.91 T
(  pthread_mutex_lock\050&requests_lock\051;) 37.72 570.57 T
(  stop = TRUE;                          /* No mutex? Lost wakeup!! */) 37.72 562.23 T
(  pthread_mutex_unlock\050&requests_lock\051;) 37.72 553.9 T
(  printf\050\322Time to stop!\134n\323\051;) 37.72 545.56 T
(  pthread_cond_broadcast\050&requests_producer\051;) 37.72 537.22 T
(  pthread_cond_broadcast\050&requests_consumer\051;) 37.72 528.88 T
(  pthread_exit\050NULL\051;) 37.72 520.54 T
(}) 37.72 512.21 T
(main\050int argc, char **argv\051) 37.72 478.85 T
({int i, j;) 37.72 470.52 T
( pthread_t tid;) 37.72 462.18 T
( SEM_INIT\050&barrier, NULL,  0\051;) 37.72 445.5 T
( PTHREAD_ATTR_INIT\050&attr\051;) 37.72 437.16 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 37.72 428.82 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 37.72 420.49 T
( if \050argc >= 2\051 GET_DELAY     = atoi\050argv[1]\051;) 37.72 403.81 T
( if \050argc >= 3\051 PROCESS_DELAY = atoi\050argv[2]\051;) 37.72 395.47 T
( if \050argc >= 4\051 N_PROD        = atoi\050argv[3]\051;) 37.72 387.13 T
( if \050argc >= 5\051 N_CONS        = atoi\050argv[4]\051;) 37.72 378.8 T
( printf\050\322GET_DELAY \050ms\051 = %d PROCESS_DELAY \050ms\051 = %d N_PROD = %d N_CONS = %d\134n\323,) 37.72 370.46 T
(        GET_DELAY, PROCESS_DELAY, N_PROD, N_CONS\051;) 37.72 362.12 T
( PTHREAD_CREATE\050&tid, &attr, killer, \050void *\051 60\051;) 37.72 353.78 T
( for \050j=0; j < 3; j++\051) 37.72 337.11 T
(   {printf\050\322Starting consumers. List length: %d Produced: %d Consumed %d.\134n\323,) 37.72 328.77 T
(           length, n_produced, n_processed\051;) 37.72 320.43 T
(    for \050i=0; i<N_CONS; i++\051) 37.72 312.09 T
(      PTHREAD_CREATE\050&tid, &attr, consumer, NULL\051;) 37.72 303.75 T
(    pthread_mutex_lock\050&requests_lock\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(74) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    while \050length != 0\051) 411.22 687.31 T
(      pthread_cond_wait\050&requests_producer, &requests_lock\051;) 411.22 678.97 T
(    printf\050\322Starting producers. List length: %d Produced: %d Consumed %d.\134n\323,) 411.22 662.29 T
(           length, n_produced, n_processed\051;) 411.22 653.95 T
(    pthread_mutex_unlock\050&requests_lock\051;) 411.22 645.62 T
(    for \050i=0; i<N_PROD; i++\051) 411.22 637.28 T
(      PTHREAD_CREATE\050&tid, &attr, producer, NULL\051;) 411.22 628.94 T
(    PTHREAD_CREATE\050&tid, &attr, stopper, NULL\051;) 411.22 612.26 T
(    thread_single_barrier\050&barrier, N_PROD+N_CONS\051;) 411.22 603.92 T
(    stop = FALSE;) 411.22 595.59 T
(    printf\050\322All exited. List length: %d Produced: %d Consumed %d.\134n\323,) 411.22 587.25 T
(           length, n_produced, n_processed\051;) 411.22 578.91 T
(    sleep\0504\051;) 411.22 570.57 T
(   }) 411.22 562.23 T
( printf\050\322Done\134n\323\051;) 411.22 553.9 T
( exit\0500\051;) 411.22 545.56 T
(}) 411.22 537.22 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 37
%%Page: "mini" 38
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(75) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
37.72 287.67 380.78 700.41 C
37.72 298.39 380.78 689.69 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
0 0 0 1 0 0 0 K
(Soc) 0 -90 349.3 600.71 TF
(kets: Client Side) 0 -90 349.3 561.82 TF
308.29 646.81 308.29 480.64 134.21 480.64 134.21 646.81 4 Y
7 X
V
0.3 H
2 Z
0 X
N
308.29 410.96 308.29 325.19 59.86 325.19 59.86 410.96 4 Y
V
0 Z
N
90 450 1.19 1.19 90 241.64 461.54 GG
241.64 462.73 239.28 462.73 241.64 470.96 244 462.73 4 Y
2.38 H
N
241.64 462.73 239.28 462.73 241.64 470.96 244 462.73 4 Y
V
90 450 1.19 1.19 270 241.64 435.42 GG
241.64 434.23 244 434.23 241.64 426 239.28 434.23 4 Y
N
241.64 434.23 244 434.23 241.64 426 239.28 434.23 4 Y
V
241.64 461.54 241.64 435.42 2 L
N
4 8.34 Q
(fd = connect\050...\051;) 0 -90 290.11 603.92 TF
(\322Request 1...\323) 0 -90 280.69 603.92 TF
(\322Request 2...\323) 0 -90 271.26 603.92 TF
(...) 0 -90 261.84 603.92 TF
(\322Request 10000...\323) 0 -90 252.41 603.92 TF
J
90 450 0.89 0.89 90 278 463.26 GG
278 464.15 275.73 464.15 278 472.04 280.26 464.15 4 Y
1.79 H
N
278 464.15 275.73 464.15 278 472.04 280.26 464.15 4 Y
V
J
90 450 0.89 0.89 270 278 433.7 GG
278 432.81 280.26 432.81 278 424.92 275.73 432.81 4 Y
N
278 432.81 280.26 432.81 278 424.92 275.73 432.81 4 Y
V
J
278 463.26 278 433.7 2 L
J
278 463.26 278 461.77 2 L
2 Z
N
[2.606 4.69] 2.606 I
278 461.77 278 435.19 2 L
N
J
278 435.19 278 433.7 2 L
N
J
(fd = connect\050...\051;) 0 -90 177.37 603.92 TF
(\322Request 1...\323) 0 -90 168.21 603.92 TF
(\322Request 2...\323) 0 -90 159.04 603.92 TF
(...) 0 -90 149.88 603.92 TF
(\322Request 10000...\323) 0 -90 140.72 603.92 TF
J
90 450 0.89 0.89 90 199.38 463.26 GG
199.38 464.15 197.12 464.15 199.38 472.04 201.65 464.15 4 Y
0 Z
N
199.38 464.15 197.12 464.15 199.38 472.04 201.65 464.15 4 Y
V
J
90 450 0.89 0.89 270 199.38 433.7 GG
199.38 432.81 201.65 432.81 199.38 424.92 197.12 432.81 4 Y
N
199.38 432.81 201.65 432.81 199.38 424.92 197.12 432.81 4 Y
V
J
199.38 463.26 199.38 433.7 2 L
J
199.38 463.26 199.38 461.77 2 L
2 Z
N
[2.606 4.69] 2.606 I
199.38 461.77 199.38 435.19 2 L
N
J
199.38 435.19 199.38 433.7 2 L
N
2 14.29 Q
(Client 1) 0 -90 317.7 580.51 TF
(Ser) 0 -90 320.93 394.88 TF
(ver) 0 -90 320.93 371.69 TF
J
108.65 646.81 108.65 480.64 53.8 480.64 53.8 646.81 4 Y
7 X
V
0.3 H
0 X
N
4 8.34 Q
(fd = connect\050...\051;) 0 -90 92.39 603.92 TF
(\322Request 1...\323) 0 -90 85.28 603.92 TF
(\322Request 2...\323) 0 -90 78.17 603.92 TF
(...) 0 -90 71.06 603.92 TF
(\322Request 10000...\323) 0 -90 63.95 603.92 TF
J
90 450 0.89 0.89 90 78.04 463.26 GG
78.04 464.15 75.78 464.15 78.04 472.04 80.3 464.15 4 Y
1.79 H
0 Z
N
78.04 464.15 75.78 464.15 78.04 472.04 80.3 464.15 4 Y
V
J
90 450 0.89 0.89 270 78.04 433.7 GG
78.04 432.81 80.3 432.81 78.04 424.92 75.78 432.81 4 Y
N
78.04 432.81 80.3 432.81 78.04 424.92 75.78 432.81 4 Y
V
J
78.04 463.26 78.04 433.7 2 L
J
78.04 463.26 78.04 461.77 2 L
2 Z
N
[2.606 4.69] 2.606 I
78.04 461.77 78.04 435.19 2 L
N
J
78.04 435.19 78.04 433.7 2 L
N
2 14.29 Q
(Client 2) 0 -90 115.74 580.51 TF
J
90 450 1.19 1.19 90 114.4 461.54 GG
114.4 462.73 112.04 462.73 114.4 470.96 116.75 462.73 4 Y
2.38 H
0 Z
N
114.4 462.73 112.04 462.73 114.4 470.96 116.75 462.73 4 Y
V
90 450 1.19 1.19 270 114.4 435.42 GG
114.4 434.23 116.75 434.23 114.4 426 112.04 434.23 4 Y
N
114.4 434.23 116.75 434.23 114.4 426 112.04 434.23 4 Y
V
114.4 461.54 114.4 435.42 2 L
N
2 10.72 Q
(fd1) 0 -90 280.51 453.84 TF
(fd2) 0 -90 202.64 453.84 TF
(fd3) 0 -90 80.55 453.84 TF
(6500) 0 -90 251.12 459.2 TF
(6500) 0 -90 122.96 459.2 TF
J
260.02 620.09 M
 258.38 615.85 266.25 611.9 271.4 617.12 D
 276.58 622.37 282.93 609.54 292 619.1 D
0.6 H
2 Z
N
275.73 625.67 277.3 625.67 275.73 620.18 274.15 625.67 4 Y
0 Z
N
275.73 625.67 277.3 625.67 275.73 620.18 274.15 625.67 4 Y
V
275.73 625.97 275.73 636.97 2 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
146.13 620.09 M
 144.53 615.85 152.19 611.9 157.19 617.12 D
 162.23 622.37 168.4 609.54 177.22 619.1 D
N
161.4 625.67 162.98 625.67 161.4 620.18 159.82 625.67 4 Y
0 Z
N
161.4 625.67 162.98 625.67 161.4 620.18 159.82 625.67 4 Y
V
161.4 625.97 161.4 636.97 2 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
67.67 619.21 M
 66.43 614.96 72.37 611.02 76.25 616.23 D
 80.16 621.48 84.94 608.66 91.79 618.22 D
N
79.51 624.79 81.09 624.79 79.51 619.3 77.94 624.79 4 Y
0 Z
N
79.51 624.79 81.09 624.79 79.51 619.3 77.94 624.79 4 Y
V
79.51 625.09 79.51 636.09 2 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 8.34 Q
(\322Reply 1...\323) 0 -90 228.95 587.49 TF
(\322Reply 2...\323) 0 -90 220.93 587.49 TF
(...) 0 -90 212.91 587.49 TF
(\322Reply 10000...\323) 0 -90 204.9 587.49 TF
211.37 603.66 M
 209.97 599.41 216.67 595.46 221.05 600.68 D
 225.46 605.93 230.85 593.11 238.57 602.66 D
N
224.73 609.24 226.3 609.24 224.73 603.74 223.16 609.24 4 Y
0 Z
N
224.73 609.24 226.3 609.24 224.73 603.74 223.16 609.24 4 Y
V
224.73 609.53 224.73 620.53 2 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
37.72 287.67 380.78 700.41 C
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(76) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Threads and Soc) 471.56 686.11 T
(kets:) 643.9 686.11 T
(c) 546.02 657.53 T
(lient.c) 557.51 657.53 T
4 7.15 Q
( /*                client.c                */) 411.22 615.84 T
(/*) 411.22 599.16 T
(  The client side simply sends a hugh number of requests to the) 411.22 590.82 T
(  chosen server as fast as requested, spawing one thread to do the) 411.22 582.48 T
(  sending and another to receive the replies. You may request multiple) 411.22 574.15 T
(  pairs of senders & receivers each with their own socket. The) 411.22 565.81 T
(  senders & receivers run asynchronously intentionally, thus replies) 411.22 557.47 T
(  may be received out-of-order.) 411.22 549.13 T
(  The client will try the requested port first, then the next higher) 411.22 532.45 T
(  port and keep going \050in case the server is actually on another port\051.) 411.22 524.12 T
(  Nothing interesting here.) 411.22 507.44 T
(cc -o client client.c -L. -R. -g -lpthread -pthread_extensions -lposix4 -lnsl -) 411.22 482.43 T
(lsocket) 411.22 474.09 T
(*/) 411.22 465.75 T
(#define _POSIX_C_SOURCE 199506L) 411.22 440.74 T
(#define __EXTENSIONS__) 411.22 432.4 T
(#include <stdio.h>) 411.22 415.72 T
(#include <sys/types.h>) 411.22 407.38 T
(#include <sys/socket.h>) 411.22 399.05 T
(#include <netinet/in.h>) 411.22 390.71 T
(#include <arpa/inet.h>) 411.22 382.37 T
(#include <string.h>) 411.22 374.03 T
(#include <unistd.h>) 411.22 365.69 T
(#include <stdlib.h>) 411.22 357.35 T
(#include <pthread.h>) 411.22 349.02 T
(#include <sys/resource.h>) 411.22 340.68 T
(#include \322thread_extensions.h\323) 411.22 332.34 T
(/* Constants etc. rlimit set to MAX_FDS in main\050\051 */) 411.22 307.33 T
(#define                 MESSAGE_SIZE 70) 411.22 298.99 T
(#define                 MAX_FDS  1000) 411.22 290.65 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 38
%%Page: "mini" 39
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(77) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(/* 127.0.0.1 is the loopback address.  You may change it. */) 37.72 687.31 T
(const char              *SERV_HOST_ADDR =   \322127.0.0.1\323;) 37.72 678.97 T
(int                     REQUESTED_TCP_PORT = 6500, ACTUAL_TCP_PORT;) 37.72 670.63 T
(int) 37.72 662.29 T
(MAX_PORT_RANGE = 100;) 187.81 662.29 T
(int                     N_REQUESTS = 10000;) 37.72 653.95 T
(int                     SLEEP = 0, SPIN= 0, N_CONSUMERS=10;) 37.72 645.62 T
(int                     PID;) 37.72 637.28 T
(thread_single_barrier_t client_barrier;) 37.72 628.94 T
(const char              *END_CLIENT_MSG =) 37.72 620.6 T
(  \322End\1340                                                                   \322;) 37.72 612.26 T
(/* A bunch of simple helper functions */) 37.72 587.25 T
(void set_up_signal_mask\050\051 {) 37.72 570.57 T
( sigset_t               s, s1, s2;) 37.72 562.23 T
( static struct          sigaction action;) 37.72 553.9 T
(/* Block everything first \050in particular SIGPIPE\051 */) 37.72 537.22 T
( sigfillset\050&s\051;) 37.72 528.88 T
( pthread_sigmask\050SIG_BLOCK, &s, &s2\051;) 37.72 520.54 T
( sigemptyset\050&s\051;) 37.72 512.21 T
( sigaddset\050&s, SIGINT\051;                 /* For ^C */) 37.72 495.53 T
( pthread_sigmask\050SIG_UNBLOCK, &s, &s1\051;) 37.72 487.19 T
(}) 37.72 478.85 T
(/* Send out N_REQUESTS requests to server */) 37.72 445.5 T
(void *send_requests\050void *arg\051 {) 37.72 437.16 T
(  int            i, j, sockfd = \050int\051 arg, err;) 37.72 428.82 T
(  char           obuf[MESSAGE_SIZE], ibuf[MESSAGE_SIZE];) 37.72 420.49 T
(  char           *name = thread_name\050pthread_self\050\051\051;) 37.72 412.15 T
(  set_up_signal_mask\050\051;) 37.72 395.47 T
(  printf\050\322Client_%d[%s] \134tSending %d requests on fd#%d...\134n\323,) 37.72 387.13 T
( PID, name, N_REQUESTS, sockfd\051;) 59.16 378.8 T
(  for \050j=0; j<N_REQUESTS; j++\051 {) 37.72 370.46 T
(    sprintf\050obuf, \322Client_%d[%s] Request: %d\323, PID, name, j\051;) 37.72 362.12 T
(    err=write\050sockfd, obuf, MESSAGE_SIZE\051;) 37.72 353.78 T
(    if \050err == -1\051 {) 37.72 345.44 T
(      printf\050\322Write failed from Client_%d[%s]\134n\323, PID, name\051;) 37.72 337.11 T
(      perror\050\322\322\051;) 37.72 328.77 T
(      pthread_exit\050NULL\051;) 37.72 320.43 T
(    }) 37.72 312.09 T
(    DEBUG\050printf\050\322Client_%d[%s] sent: \324%s\325\134n\323, PID, name, obuf\051\051;) 37.72 303.75 T
(    delay\050SLEEP, SPIN\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(78) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    if \050\050j%1000 == 0\051 && ! \050j==0\051\051) 411.22 695.65 T
(      printf\050\322Client_%d[%s] \134tSent %d segments on fd#%d.\134n\323,) 411.22 687.31 T
(     PID, name, j, sockfd\051;) 432.66 678.97 T
(  }) 411.22 670.63 T
(  err=write\050sockfd, END_CLIENT_MSG, MESSAGE_SIZE\051;) 411.22 662.29 T
(  if \050err == -1\051 {) 411.22 653.95 T
(    printf\050\322Write END failed from Client_%d[%s]\134n\323, PID, name\051;) 411.22 645.62 T
(    perror\050\322\322\051;) 411.22 637.28 T
(    thread_single_barrier_post\050&client_barrier\051;) 411.22 628.94 T
(    pthread_exit\050NULL\051;) 411.22 620.6 T
(  }) 411.22 612.26 T
(  DEBUG\050printf\050\322Client_%d[%s] sent: \324%s\325\134n\323, PID, name, END_CLIENT_MSG\051\051;) 411.22 603.92 T
(  printf\050\322Client_%d[%s] \134tDone sending on fd#%d.\134n\323, PID, name, sockfd\051;) 411.22 595.59 T
(}) 411.22 587.25 T
(/* Listen to segments until \322End\323 */) 411.22 562.23 T
(void *receive_replies\050void *arg\051 {) 411.22 553.9 T
(  int                    i, j, sockfd = \050int\051 arg;) 411.22 545.56 T
(  struct sockaddr_in     serv_addr;) 411.22 537.22 T
(  char                   obuf[MESSAGE_SIZE], ibuf[MESSAGE_SIZE];) 411.22 528.88 T
(  char                   *name = thread_name\050pthread_self\050\051\051;) 411.22 520.54 T
(  set_up_signal_mask\050\051;) 411.22 503.87 T
(  printf\050\322Client_%d[%s] \134tReceiving segments on fd#%d...\134n\323,) 411.22 495.53 T
( PID, name, sockfd\051;) 432.66 487.19 T
(  for \050j=1; TRUE; j++\051) 411.22 470.52 T
(    {int         nbytes;) 411.22 462.18 T
(    nbytes = read\050sockfd, ibuf, MESSAGE_SIZE\051;) 411.22 445.5 T
(    if \050nbytes != MESSAGE_SIZE\051 {) 411.22 437.16 T
(      printf\050\322Read failed from Client_%d[%s]\134n\323, PID, name\051;) 411.22 428.82 T
(      if \050nbytes < 0\051 perror\050\322\322\051;) 411.22 420.49 T
(      thread_single_barrier_post\050&client_barrier\051;) 411.22 412.15 T
(      pthread_exit\050NULL\051;) 411.22 403.81 T
(    }) 411.22 395.47 T
(    DEBUG\050printf\050\322Client_%d[%s] received: \324%s\325\134n\323, PID, name, ibuf\051\051;) 411.22 387.13 T
(    if \050strncmp\050ibuf, END_CLIENT_MSG, 3\051 == 0\051 break;) 411.22 370.46 T
(    if \050\050j%1000 == 0\051 && ! \050j==0\051\051) 411.22 362.12 T
(      printf\050\322Client_%d[%s] \134tReceived %d segments on fd#%d.\134n\323,) 411.22 353.78 T
(             PID, name, j, sockfd\051;) 411.22 345.44 T
(    }) 411.22 337.11 T
(  close\050sockfd\051;) 411.22 320.43 T
(  if \050j < N_REQUESTS\051) 411.22 312.09 T
(    printf\050\322Client_%d[%s] \134tDone receiving on fd#%d.\134) 411.22 303.75 T
(Server dropped %d requests!\134n\323,) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 39
%%Page: "mini" 40
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(79) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(   PID, name, sockfd, N_REQUESTS-j\051;) 59.16 695.65 T
(  else) 37.72 687.31 T
(    printf\050\322Client_%d[%s] \134tDone receiving on fd#%d.\134n\323, PID, name, sockfd\051;) 37.72 678.97 T
(  thread_single_barrier_post\050&client_barrier\051;) 37.72 670.63 T
(}) 37.72 662.29 T
(int open_a_socket\050\051 {) 37.72 637.28 T
(  struct sockaddr_in     serv_addr;) 37.72 628.94 T
(  int sockfd, j;) 37.72 620.6 T
(  for \050j=REQUESTED_TCP_PORT; j<REQUESTED_TCP_PORT+MAX_PORT_RANGE;j++\051 {) 37.72 603.92 T
(    if \050\050sockfd = socket\050AF_INET, SOCK_STREAM, 0\051\051 < 0\051) 37.72 595.59 T
(      {perror\050\322clientsoc: can\325t open stream socket \322\051; abort\050\051;}) 37.72 587.25 T
(    memset\050\050char *\051 &serv_addr, 0, sizeof\050serv_addr\051\051;) 37.72 578.91 T
(    serv_addr.sin_family = AF_INET;) 37.72 570.57 T
(    serv_addr.sin_addr.s_addr = inet_addr\050SERV_HOST_ADDR\051;) 37.72 562.23 T
(    serv_addr.sin_port = htons\050j\051;) 37.72 553.9 T
(    if \050connect\050sockfd, \050struct sockaddr *\051 &serv_addr, sizeof\050serv_addr\051\051 < 0\051) 37.72 545.56 T
(      {) 37.72 537.22 T
(DEBUG\050printf\050\322Can\325t connect to server on port %d\134n\323, j\051\051;) 59.16 528.88 T
(close\050sockfd\051;) 59.16 520.54 T
(      }) 37.72 512.21 T
(    else) 37.72 503.87 T
(      break;) 37.72 495.53 T
(    if \050j==REQUESTED_TCP_PORT+MAX_PORT_RANGE-1\051 { /* Maybe server was down? */) 37.72 487.19 T
(      printf\050\322Maybe server was down? Starting again...\134n\323\051;) 37.72 478.85 T
(      j=REQUESTED_TCP_PORT-1;) 37.72 470.52 T
(      sleep\0505\051;) 37.72 462.18 T
(/* Don\325t rush. Let the server restart */) 102.04 462.18 T
(    }) 37.72 453.84 T
(  }) 37.72 445.5 T
(  ACTUAL_TCP_PORT=j;) 37.72 437.16 T
(  return\050sockfd\051;) 37.72 428.82 T
(}) 37.72 420.49 T
(main\050int argc, char **argv\051 {) 37.72 395.47 T
(  int                    i, j, sockfd, N_SOCKETS = 1;) 37.72 387.13 T
(  pthread_attr_t         attr;) 37.72 378.8 T
(  pthread_t              tid;) 37.72 370.46 T
(  struct rlimit) 37.72 362.12 T
(r;) 144.93 362.12 T
(  PID = getpid\050\051;) 37.72 337.11 T
(  if \050argc > 1\051 REQUESTED_TCP_PORT = atoi\050argv[1]\051;) 37.72 328.77 T
(  if \050argc > 2\051 SLEEP = atoi\050argv[2]\051;) 37.72 320.43 T
(  if \050argc > 3\051 SPIN = atoi\050argv[3]\051;) 37.72 312.09 T
(  if \050argc > 4\051 N_SOCKETS = atoi\050argv[4]\051;) 37.72 303.75 T
(  if \050argc > 5\051 N_REQUESTS = atoi\050argv[5]\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(80) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  if \050N_SOCKETS > MAX_FDS\051) 411.22 695.65 T
(      printf\050\322No more than %d connections allowed!\134n\323, MAX_FDS\051, abort\050\051;) 411.22 687.31 T
(  printf\050\322Client_%d\050PORT %d SLEEP %dms SPIN %dus N_SOCKETS %d \134) 411.22 678.97 T
(N_REQUESTS %d\051\134n\323,) 411.22 670.63 T
( PID, REQUESTED_TCP_PORT, SLEEP, SPIN, N_SOCKETS, N_REQUESTS\051;) 432.66 662.29 T
(  getrlimit\050RLIMIT_NOFILE, &r\051;) 411.22 628.94 T
(  r.rlim_cur=MAX_FDS+10;) 411.22 620.6 T
(  setrlimit\050RLIMIT_NOFILE, &r\051;) 411.22 612.26 T
(  /*  printf\050\322Current limit: %d Max limit: %d\134n\323, r.rlim_cur, r.rlim_max\051; */) 411.22 603.92 T
(  set_up_signal_mask\050\051;) 411.22 595.59 T
(  PTHREAD_ATTR_INIT\050&attr\051;) 411.22 570.57 T
(  pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 411.22 562.23 T
(  pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 411.22 553.9 T
(  thread_single_barrier_init\050&client_barrier, N_SOCKETS\051;) 411.22 545.56 T
(  iobench_start\050\051;) 411.22 528.88 T
(  for \050i=0; i < N_SOCKETS; i++\051 {) 411.22 512.21 T
(    sockfd=open_a_socket\050\051;) 411.22 503.87 T
(    printf\050\322Connected to server on port %d\134n\323, ACTUAL_TCP_PORT\051;) 411.22 495.53 T
(    PTHREAD_CREATE\050&tid, &attr, send_requests, \050void *\051 sockfd\051;) 411.22 487.19 T
(    PTHREAD_CREATE\050&tid, &attr, receive_replies, \050void *\051 sockfd\051;) 411.22 478.85 T
(  }) 411.22 470.52 T
(  thread_single_barrier_wait\050&client_barrier\051;) 411.22 453.84 T
(  iobench_end\050\051;) 411.22 445.5 T
(  iobench_report\050\051;) 411.22 437.16 T
(  exit\050NULL\051;) 411.22 428.82 T
(}) 411.22 420.49 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 40
%%Page: "mini" 41
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(81) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(T&S: No Threads:) 118.72 686.11 T
(ser) 168.66 657.53 T
(ver) 201.06 657.53 T
(.c) 231.96 657.53 T
4 7.15 Q
(/*                server_simple.c                */) 37.72 615.84 T
(/*) 37.72 599.16 T
(  A simple server program.  It sets up a TCP port for the client) 37.72 582.48 T
(  program to connect to.) 37.72 574.15 T
(  This version is unthreaded and very slow if there is any I/O delay) 37.72 557.47 T
(  simulated.) 37.72 549.13 T
(  On most errors this programs just aborts.) 37.72 532.45 T
(*/) 37.72 515.78 T
(/*) 37.72 482.43 T
(cc -o serve_simpler server_simple.c -L. -R. -g -lpthread  -lthread_extensions -) 37.72 474.09 T
(lposix4 -lnsl -lsocket) 37.72 465.75 T
(*/) 37.72 457.41 T
(#define _POSIX_C_SOURCE 199506L) 37.72 440.74 T
(/* Note that you need to define  __EXTENSIONS__ when using sockets. */) 37.72 432.4 T
(#define __EXTENSIONS__) 37.72 424.06 T
(#include <stdio.h>) 37.72 390.71 T
(#include <sys/types.h>) 37.72 382.37 T
(#include <sys/socket.h>) 37.72 374.03 T
(#include <netinet/in.h>) 37.72 365.69 T
(#include <arpa/inet.h>) 37.72 357.35 T
(#include <pthread.h>) 37.72 349.02 T
(#include <semaphore.h>) 37.72 340.68 T
(#include <time.h>) 37.72 332.34 T
(#include <limits.h>) 37.72 324 T
(#include <errno.h>) 37.72 315.66 T
(#include \322thread_extensions.h\323) 37.72 307.33 T
(/* Constants etc. */) 37.72 290.65 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(82) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(#define                 MESSAGE_SIZE 70) 411.22 695.65 T
(const int               MAX_FDS = OPEN_MAX-10;         /* Solaris constant */) 411.22 670.63 T
( /* String sent by & to client when done */) 411.22 662.29 T
(const char              *END_CLIENT_MSG =) 411.22 653.95 T
(  \322End\1340                                                                   \322;) 411.22 645.62 T
(/* The structures for clients, and requests */) 411.22 603.92 T
(typedef struct client_struct {) 411.22 587.25 T
(  int                   socket;                 /* socket fd */) 411.22 570.57 T
(  char                  name[30];               /* \322Client_123[T@23]\323 */) 411.22 562.23 T
(  int                   outstanding_requests;   /* No. unanswered */) 411.22 553.9 T
(  pthread_mutex_t       lock;) 411.22 537.22 T
(  pthread_cond_t        cv;) 411.22 528.88 T
(} client_t;) 411.22 520.54 T
(typedef struct request_struct {) 411.22 503.87 T
(  client_t              *client;) 411.22 495.53 T
(  char                  data[MESSAGE_SIZE]; /* \322Client_7[T@4] Request: 4\323 */) 411.22 487.19 T
(  struct request_struct *next;) 411.22 478.85 T
(} request_t;) 411.22 470.52 T
(/* Optional command line arguments \050+ defaults\051 */) 411.22 428.82 T
(int                     SLEEP = 0, SPIN= 0, N_CONSUMERS=10;) 411.22 420.49 T
(int) 411.22 412.15 T
(REQUESTED_TCP_PORT = 6500, ACTUAL_TCP_PORT,) 529.74 412.15 T
(MAX_PORT_RANGE=100;) 529.74 403.81 T
(int                     STOPPER_SLEEP=-1, KILLER_SLEEP=-1;) 411.22 395.47 T
(/* Other useful bits */) 411.22 353.78 T
(int                     PID;) 411.22 345.44 T
(pthread_attr_t          attr;) 411.22 337.11 T
(int                     port_socket;) 411.22 328.77 T
(int                     n_replies=0;) 411.22 320.43 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 41
%%Page: "mini" 42
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(83) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(/* A List of REQUESTS with protection and related varaibles. */) 37.72 628.94 T
(request_t               *requests =     NULL;) 37.72 620.6 T
(int                     length =        0;) 37.72 612.26 T
(pthread_mutex_t         requests_lock = PTHREAD_MUTEX_INITIALIZER;) 37.72 603.92 T
(pthread_cond_t          producer_cv =   PTHREAD_COND_INITIALIZER;) 37.72 595.59 T
(pthread_cond_t          consumer_cv =   PTHREAD_COND_INITIALIZER;) 37.72 587.25 T
(/* Some function declarations */) 37.72 553.9 T
(client_t *new_client\050int\051;) 37.72 537.22 T
(void *producer\050void *\051;) 37.72 528.88 T
(request_t *get_request\050client_t *\051;) 37.72 520.54 T
(void *process_request\050request_t *\051;) 37.72 512.21 T
(/* A bunch of simple helper functions */) 37.72 487.19 T
(void set_up_signal_mask\050\051 {) 37.72 470.52 T
( sigset_t               s, s1, s2;) 37.72 462.18 T
( static struct          sigaction action;) 37.72 453.84 T
(/* Block everything first \050in particular SIGPIPE\051 */) 37.72 437.16 T
( sigfillset\050&s\051;) 37.72 428.82 T
( pthread_sigmask\050SIG_BLOCK, &s, &s2\051;) 37.72 420.49 T
( sigemptyset\050&s\051;) 37.72 412.15 T
( sigaddset\050&s, SIGUSR1\051;                /* For stopper\050\051 */) 37.72 403.81 T
( sigaddset\050&s, SIGINT\051;                 /* For ^C */) 37.72 395.47 T
( pthread_sigmask\050SIG_UNBLOCK, &s, &s1\051;) 37.72 387.13 T
(}) 37.72 378.8 T
(/* Keep track of the current number of clients for stats & fd limit */) 37.72 353.78 T
(int client_max_count = 0;) 37.72 345.44 T
(int count_clients\050int i\051 {) 37.72 328.77 T
(  static pthread_mutex_t counter_lock = PTHREAD_MUTEX_INITIALIZER;) 37.72 320.43 T
(  static int             client_count = 0;) 37.72 312.09 T
(  int j;) 37.72 303.75 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(84) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  pthread_mutex_lock\050&counter_lock\051;) 411.22 695.65 T
(  client_count += i;) 411.22 687.31 T
(  if \050client_count > client_max_count\051) 411.22 678.97 T
(    client_max_count = client_count;) 411.22 670.63 T
(  j = client_count;) 411.22 662.29 T
(  pthread_mutex_unlock\050&counter_lock\051;) 411.22 653.95 T
(  return\050j\051;) 411.22 645.62 T
(}) 411.22 637.28 T
(int count_requests\050int i\051 {) 411.22 520.54 T
(  static int count=0;) 411.22 512.21 T
(  static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 411.22 503.87 T
( pthread_mutex_lock\050&count_lock\051;) 411.22 487.19 T
( count += i;) 411.22 478.85 T
( i = count;) 411.22 470.52 T
( pthread_mutex_unlock\050&count_lock\051;) 411.22 462.18 T
( return\050i\051;) 411.22 453.84 T
(/* Can\325t return count */) 571.43 453.84 T
(}) 411.22 445.5 T
(void print_requests\050\051) 411.22 428.82 T
({request_t              *r = requests;) 411.22 420.49 T
( while \050r != NULL\051) 411.22 403.81 T
(   {printf\050\322<Request: %d>\134n\323, r->client->socket\051;) 411.22 395.47 T
(    r = r->next;) 411.22 387.13 T
(  }) 411.22 378.8 T
(}) 411.22 370.46 T
(/* Synchronize on the number of OUTSTANDING REQUESTS per client. */) 411.22 345.44 T
(void wait_for_requests_to_zero\050client_t *client\051 {) 411.22 328.77 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 42
%%Page: "mini" 43
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(85) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(}) 37.72 695.65 T
(int decrement_requests_for\050client_t *client\051 {) 37.72 678.97 T
(  int i;) 37.72 670.63 T
(  return\050i\051;) 37.72 603.92 T
(}) 37.72 595.59 T
(void increment_requests_for\050client_t *client\051 {) 37.72 578.91 T
(}) 37.72 545.56 T
(/* Build a new REQUEST */) 37.72 520.54 T
(request_t *new_request\050client_t *client, char *ibuf\051 {) 37.72 503.87 T
(  request_t             *request;) 37.72 495.53 T
(  pthread_t tid = pthread_self\050\051;) 37.72 478.85 T
(  DEBUG\050printf\050\322Server_%d[%s] get_request\050\051 received: \134\323%s\134\323\134n\323,) 37.72 470.52 T
(               PID, thread_name\050tid\051, ibuf\051\051;) 37.72 462.18 T
(  request = \050request_t *\051 malloc\050sizeof\050request_t\051\051;) 37.72 453.84 T
(  request->client = client;) 37.72 445.5 T
(  strcpy\050request->data, ibuf\051;) 37.72 437.16 T
(  count_requests\0501\051;) 37.72 428.82 T
(  return\050request\051;) 37.72 353.78 T
(}) 37.72 345.44 T
(int delete_request\050request_t *request\051 {) 37.72 320.43 T
(  int i;) 37.72 312.09 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(86) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  free\050request\051;) 411.22 695.65 T
(  return\050i\051;) 411.22 687.31 T
(}) 411.22 678.97 T
(/*) 411.22 645.62 T
(  Send \322End\323 and close the socket.) 411.22 637.28 T
(*/) 411.22 612.26 T
(void close_client\050client_t *client\051 {) 411.22 595.59 T
(  int j;) 411.22 587.25 T
(  DEBUG\050printf\050\322Closing socket %s...\134n\323, client->name\051\051;) 411.22 570.57 T
(  pthread_mutex_lock\050&client->lock\051;) 411.22 553.9 T
(  if \050client->socket != -1\051 {) 411.22 545.56 T
(/* Ensure only close\050\051 once. */) 539.87 545.56 T
(    write\050client->socket, END_CLIENT_MSG, MESSAGE_SIZE\051;   /* Ignore errors */) 411.22 537.22 T
(    close\050client->socket\051;) 411.22 528.88 T
(    client->socket = -1;) 411.22 520.54 T
(    j = count_clients\050-1\051;) 411.22 495.53 T
(    DEBUG\050printf\050\322Closed %s. \050%d active clients\051\134n\323,) 411.22 470.52 T
(                 client->name, count_clients\0500\051\051\051;) 411.22 462.18 T
(  }) 411.22 453.84 T
(  pthread_mutex_unlock\050&client->lock\051;) 411.22 445.5 T
(}) 411.22 437.16 T
(void write_msg\050client_t *client, char *obuf\051 {) 411.22 387.13 T
(  int                   nbytes, socket, active;) 411.22 378.8 T
(  char                  *cname;) 411.22 370.46 T
(  char                  *t_name = thread_name\050pthread_self\050\051\051;) 411.22 362.12 T
(  DEBUG\050printf\050\322Server_%d[%s] write_msg\050\051 sending: \134\323%s\134\323\134n\323,) 411.22 345.44 T
(               PID, t_name, obuf\051\051;) 411.22 337.11 T
(  pthread_mutex_lock\050&client->lock\051;) 411.22 328.77 T
(  socket = client->socket;) 411.22 320.43 T
(  cname  = client->name;) 411.22 312.09 T
(  pthread_mutex_unlock\050&client->lock\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 43
%%Page: "mini" 44
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(87) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  retry: nbytes = write\050socket, obuf, MESSAGE_SIZE\051;) 37.72 678.97 T
(  if \050nbytes == MESSAGE_SIZE\051 {) 37.72 662.29 T
(    return;) 37.72 653.95 T
(  }) 37.72 645.62 T
(  if \050nbytes > -1\051 {) 37.72 628.94 T
(    printf\050\322Only wrote %d bytes to %s. \050Impossible?\051\323, nbytes, cname\051;) 37.72 620.6 T
(    abort\050\051;) 37.72 612.26 T
(  }) 37.72 603.92 T
(  if \050errno == EINTR\051 {) 37.72 587.25 T
(    printf\050\322EINTR while trying to write to %s on fd#%d. retrying...\134n\323,) 37.72 578.91 T
(   cname, socket\051;) 71.07 570.57 T
(    goto retry;) 37.72 562.23 T
(  }) 37.72 553.9 T
(  if \050\050errno == EPIPE\051 || \050errno == EBADF\051\051 {) 37.72 537.22 T
(    printf\050\322Failed trying to write to %s. \134n\323, cname\051;) 37.72 528.88 T
(    perror\050\322Closing socket\323\051;) 37.72 520.54 T
(    close_client\050client\051;) 37.72 487.19 T
(    return;) 37.72 478.85 T
(  }) 37.72 470.52 T
(  else) 37.72 462.18 T
(    perror\050\322Unknown bug \050Impossible?\051\323\051, abort\050\051;) 37.72 453.84 T
(}) 37.72 445.5 T
(/* Manipulate the requests list. Caller must own requests_lock. */) 37.72 412.15 T
(request_t *remove_request\050\051 {) 37.72 403.81 T
(  request_t *request;) 37.72 395.47 T
(  request = requests;) 37.72 378.8 T
(  requests = requests->next;) 37.72 370.46 T
(  length--;) 37.72 362.12 T
(  return\050request\051;) 37.72 353.78 T
(}) 37.72 345.44 T
(void add_request\050request_t *request\051 {) 37.72 328.77 T
(  request->next = requests;) 37.72 320.43 T
(/* Insert at head of list */) 209.25 320.43 T
(  requests = request;) 37.72 312.09 T
(  length++;) 37.72 303.75 T
(}) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(88) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(int open_port\050\051 {) 411.22 678.97 T
(  struct sockaddr_in    cli_addr, serv_addr;) 411.22 670.63 T
(  int                   port_socket, clilen, i;) 411.22 662.29 T
(  /* Open a new port. Try to get requested port. */) 411.22 645.62 T
(  if\050\050port_socket = socket\050AF_INET, SOCK_STREAM, 0\051\051 < 0\051) 411.22 637.28 T
(    perror\050\322Can\325t create new socket\323\051, abort\050\051;) 411.22 628.94 T
(  for \050i=REQUESTED_TCP_PORT; i< REQUESTED_TCP_PORT+MAX_PORT_RANGE; i++\051 {) 411.22 612.26 T
(    memset\050\050char *\051 &serv_addr, 0, sizeof\050serv_addr\051\051;) 411.22 603.92 T
(    serv_addr.sin_family = AF_INET;) 411.22 595.59 T
(    serv_addr.sin_addr.s_addr = htonl\050INADDR_ANY\051;) 411.22 587.25 T
(    serv_addr.sin_port = htons\050i\051;) 411.22 578.91 T
(    if \050bind\050port_socket, \050struct sockaddr *\051&serv_addr, sizeof\050serv_addr\051\051<0\051) 411.22 570.57 T
(      {DEBUG\050printf\050\322Can\325t bind to port %d\134n\323, i\051\051;}) 411.22 562.23 T
(    else {) 411.22 553.9 T
(      printf\050\322Server bound to port: %d\134n\323, i\051;) 411.22 545.56 T
(      ACTUAL_TCP_PORT=i;) 411.22 537.22 T
(      listen\050port_socket, 5\051;) 411.22 528.88 T
(      return\050port_socket\051;) 411.22 520.54 T
(    }) 411.22 512.21 T
(  }) 411.22 503.87 T
(  printf\050\322Could not find an available port from %d to %d\323,) 411.22 495.53 T
( REQUESTED_TCP_PORT, REQUESTED_TCP_PORT+MAX_PORT_RANGE\051;) 444.58 487.19 T
(  abort\050\051;) 411.22 478.85 T
(}) 411.22 470.52 T
(client_t *accept_a_connection\050int port_socket\051 {) 411.22 437.16 T
(  int                   new_socket, clilen;) 411.22 428.82 T
(  struct sockaddr_in    cli_addr;) 411.22 420.49 T
(  clilen = sizeof\050cli_addr\051;) 411.22 403.81 T
(  new_socket = accept\050port_socket, \050struct sockaddr *\051 &cli_addr, &clilen\051;) 411.22 395.47 T
(  if \050new_socket < 0\051) 411.22 387.13 T
(    perror\050\322Accept failed. \050Impossible?\051\323\051, abort\050\051;) 411.22 378.8 T
(  return\050new_client\050new_socket\051\051;) 411.22 362.12 T
(}) 411.22 353.78 T
(void *reporter\050void *arg\051 {) 411.22 328.77 T
(  while \050TRUE\051 {) 411.22 312.09 T
(    sleep\05030\051;) 411.22 303.75 T
(    printf\050\322Server up on port %d. Processed %d requests.\134n\323,) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 44
%%Page: "mini" 45
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(89) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(   ACTUAL_TCP_PORT, count_requests\0500\051\051;) 71.07 695.65 T
(  }) 37.72 687.31 T
(}) 37.72 678.97 T
(int startup_initialize\050\051 {) 37.72 653.95 T
(  int) 37.72 645.62 T
(i;) 112.77 645.62 T
(  set_up_signal_mask\050\051;) 37.72 628.94 T
(  PTHREAD_ATTR_INIT\050&attr\051;) 37.72 612.26 T
(  pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 37.72 603.92 T
(  pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 37.72 595.59 T
(}) 37.72 578.91 T
(void *acceptor\050void *arg\051 {) 37.72 553.9 T
(  client_t *client;) 37.72 545.56 T
(  pthread_t tid;) 37.72 537.22 T
(  int port_socket = \050int\051 arg;) 37.72 528.88 T
(  while \050TRUE\051 {) 37.72 512.21 T
(    client = accept_a_connection\050port_socket\051;) 37.72 503.87 T
(    PTHREAD_CREATE\050&tid, &attr, producer, \050void *\051 client\051;) 37.72 495.53 T
(  }) 37.72 487.19 T
(}) 37.72 478.85 T
(client_t *new_client\050int socket\051 {) 37.72 445.5 T
(  client_t *client = \050client_t *\051 malloc\050sizeof\050client_t\051\051;) 37.72 437.16 T
(  client->socket = socket;) 37.72 420.49 T
(  client->outstanding_requests=0;) 37.72 403.81 T
(  count_clients\0501\051;) 37.72 395.47 T
(  DEBUG\050printf\050\322New Client fd#%d. \050%d active clients\051\134n\323,) 37.72 387.13 T
(       socket, count_clients\0500\051\051\051;) 71.07 378.8 T
(  return\050client\051;) 37.72 370.46 T
(}) 37.72 362.12 T
(void *producer\050void *arg\051 {) 37.72 345.44 T
(  request_t *request;) 37.72 337.11 T
(  client_t *client = \050client_t *\051 arg;) 37.72 328.77 T
(  DEBUG\050printf\050\322Producer starting.\134n\323\051\051;) 37.72 312.09 T
(  while \050TRUE\051 {) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(90) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    request = get_request\050client\051;) 411.22 695.65 T
(    if \050request == NULL\051  {) 411.22 687.31 T
(      close_client\050client\051;) 411.22 678.97 T
(      return;) 411.22 670.63 T
(    }) 411.22 662.29 T
(    process_request\050request\051;) 411.22 653.95 T
(  }) 411.22 645.62 T
(}) 411.22 637.28 T
(request_t *get_request\050client_t *client\051 {) 411.22 620.6 T
(  request_t) 411.22 612.26 T
(*request;) 486.27 612.26 T
(  char) 411.22 603.92 T
(ibuf[MESSAGE_SIZE];) 486.27 603.92 T
(  int) 411.22 595.59 T
(nbytes;) 486.27 595.59 T
(  nbytes = read\050client->socket, ibuf, MESSAGE_SIZE\051;) 411.22 578.91 T
(  if \050nbytes != MESSAGE_SIZE\051 {printf\050\322Read failed!\134n\323\051; abort\050\051;}) 411.22 570.57 T
(  if \050strncmp\050ibuf, END_CLIENT_MSG, 3\051 == 0\051 return\050NULL\051;) 411.22 562.23 T
(  request = new_request\050client, ibuf\051;) 411.22 545.56 T
(  return\050request\051;) 411.22 537.22 T
(}) 411.22 528.88 T
(/* Send a reply back to client */) 411.22 495.53 T
(void *process_request\050request_t *request\051 {) 411.22 487.19 T
(  client_t              *client = request->client;) 411.22 478.85 T
(  char                  *cname;) 411.22 470.52 T
(  char                  obuf[MESSAGE_SIZE];) 411.22 462.18 T
(  char                  *t_name = thread_name\050pthread_self\050\051\051;) 411.22 453.84 T
(  int                   i, nbytes, finishing, socket;) 411.22 445.5 T
(  DEBUG\050printf\050\322Server_%d[%s] processing: \134\323%s\134\323\134n\323,) 411.22 428.82 T
(       PID, t_name, request->data\051\051;) 444.58 420.49 T
(  delay\050SLEEP, SPIN\051;) 411.22 403.81 T
(  sprintf\050obuf, \322Server_%d[%s] reply %d to %s\323,) 411.22 395.47 T
(  PID, t_name, n_replies++, request->data\051;) 444.58 387.13 T
(  write_msg\050client, obuf\051;) 411.22 378.8 T
(  delete_request\050request\051;) 411.22 370.46 T
(}) 411.22 362.12 T
(main\050int argc, char **argv\051 {) 411.22 345.44 T
(  int                   i;) 411.22 337.11 T
(  pthread_t tid;) 411.22 328.77 T
(  PID = getpid\050\051;) 411.22 312.09 T
(  if \050argc > 1\051 REQUESTED_TCP_PORT = atoi\050argv[1]\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 45
%%Page: "mini" 46
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(91) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  if \050argc > 2\051 SLEEP = atoi\050argv[2]\051;) 37.72 695.65 T
(  if \050argc > 3\051 SPIN = atoi\050argv[3]\051;) 37.72 687.31 T
(  if \050argc > 4\051 N_CONSUMERS = atoi\050argv[4]\051;) 37.72 678.97 T
(  if \050argc > 5\051 STOPPER_SLEEP = atoi\050argv[5]\051;) 37.72 670.63 T
(  if \050argc > 6\051 KILLER_SLEEP = atoi\050argv[6]\051;) 37.72 662.29 T
(  printf\050\322Server_%d\050TCP_PORT %d SLEEP %dms SPIN %dus N_CONSUMERS \134n\134) 37.72 653.95 T
(%d STOPPER %ds KILLER %ds\051\134n\323,) 37.72 645.62 T
(         PID, REQUESTED_TCP_PORT, SLEEP, SPIN, N_CONSUMERS,) 37.72 637.28 T
(         STOPPER_SLEEP, KILLER_SLEEP\051;) 37.72 628.94 T
(  startup_initialize\050\051;) 37.72 612.26 T
(  PTHREAD_CREATE\050&tid, &attr, reporter, NULL\051;) 37.72 595.59 T
(  port_socket = open_port\050\051;) 37.72 578.91 T
(  if \050KILLER_SLEEP > 0\051) 37.72 570.57 T
(    PTHREAD_CREATE\050&tid, &attr, killer, \050void *\051 KILLER_SLEEP\051;) 37.72 562.23 T
(  acceptor\050\050void *\051port_socket\051;) 37.72 545.56 T
(}) 37.72 537.22 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(92) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
411.22 340.77 724.35 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
668.54 401.43 M
 670.41 405.16 661.45 408.62 655.59 404.04 D
 649.7 399.43 642.48 410.69 632.16 402.3 D
1.79 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
90 450 0.89 0.89 90 650.67 390.28 GG
650.67 391.17 648.41 391.17 650.67 399.06 652.93 391.17 4 Y
0 Z
N
650.67 391.17 648.41 391.17 650.67 399.06 652.93 391.17 4 Y
V
650.67 390.28 650.67 386.62 2 L
2 Z
N
618.97 402.29 M
 620.83 406.01 611.87 409.48 606.01 404.9 D
 600.12 400.29 592.9 411.55 582.58 403.16 D
N
90 450 0.89 0.89 90 601.09 391.13 GG
601.09 392.03 598.83 392.03 601.09 399.92 603.35 392.03 4 Y
0 Z
N
601.09 392.03 598.83 392.03 601.09 399.92 603.35 392.03 4 Y
V
601.09 391.13 601.09 387.47 2 L
2 Z
N
573.35 404.86 M
 575.22 408.59 566.25 412.05 560.39 407.47 D
 554.5 402.86 547.28 414.12 536.96 405.73 D
N
90 450 0.89 0.89 90 555.47 393.71 GG
555.47 394.6 553.21 394.6 555.47 402.49 557.73 394.6 4 Y
0 Z
N
555.47 394.6 553.21 394.6 555.47 402.49 557.73 394.6 4 Y
V
555.47 393.71 555.47 390.05 2 L
2 Z
N
527.46 403.14 M
 529.33 406.87 520.37 410.34 514.51 405.76 D
 508.62 401.15 501.4 412.4 491.08 404.01 D
N
90 450 0.89 0.89 90 509.59 391.99 GG
509.59 392.89 507.33 392.89 509.59 400.77 511.85 392.89 4 Y
0 Z
N
509.59 392.89 507.33 392.89 509.59 400.77 511.85 392.89 4 Y
V
509.59 391.99 509.59 388.33 2 L
2 Z
N
592.05 489.89 M
 593.92 493.62 584.96 497.09 579.1 492.51 D
 573.2 487.9 565.98 499.15 555.66 490.76 D
N
90 450 0.89 0.89 90 574.17 478.74 GG
574.17 479.64 571.91 479.64 574.17 487.52 576.44 479.64 4 Y
0 Z
N
574.17 479.64 571.91 479.64 574.17 487.52 576.44 479.64 4 Y
V
574.17 478.74 574.17 475.08 2 L
2 Z
N
632.03 425.67 633.47 426.31 634.24 420.65 630.59 425.04 4 Y
0.6 H
0 Z
N
632.03 425.67 633.47 426.31 634.24 420.65 630.59 425.04 4 Y
V
591.15 471.39 M
 608.06 459.32 623.53 444.91 631.91 425.95 D
2 Z
N
595.1 420.85 596.58 421.41 597.07 415.71 593.63 420.29 4 Y
0 Z
N
595.1 420.85 596.58 421.41 597.07 415.71 593.63 420.29 4 Y
V
583.86 469.25 M
 587.6 453.08 589.11 436.54 595 421.13 D
2 Z
N
547.27 426.71 548.84 426.84 547.73 421.24 545.7 426.58 4 Y
0 Z
N
547.27 426.71 548.84 426.84 547.73 421.24 545.7 426.58 4 Y
V
565.85 470.1 M
 554.5 458.92 545.91 443.01 547.25 427.01 D
2 Z
N
510.86 427.2 512.43 427.01 510.23 421.73 509.3 427.38 4 Y
0 Z
N
510.86 427.2 512.43 427.01 510.23 421.73 509.3 427.38 4 Y
V
559.42 471.82 M
 537.25 465.38 513.66 451.16 510.9 427.49 D
2 Z
N
575.12 589.3 573.55 589.3 575.12 594.79 576.7 589.3 4 Y
0 Z
N
575.12 589.3 573.55 589.3 575.12 594.79 576.7 589.3 4 Y
V
575.12 516.26 576.7 516.26 575.12 510.76 573.55 516.26 4 Y
N
575.12 516.26 576.7 516.26 575.12 510.76 573.55 516.26 4 Y
V
575.12 589.01 575.12 516.55 2 L
N
2 10.72 Q
(Soc) 0 -90 581.98 574.86 TF
(ket) 0 -90 581.98 555.42 TF
(\322Data Segment ...) 0 -90 665.37 565.21 TF
(\323) 0 -90 665.37 477.73 TF
(\322D) 0 -90 601.05 447.29 TF
(.S...) 0 -90 601.05 434.51 TF
(\323) 0 -90 601.05 416.72 TF
(\322D) 0 -90 558.9 447.93 TF
(.S...) 0 -90 558.9 435.16 TF
(\323) 0 -90 558.9 417.37 TF
(\322Data Segment ...) 0 -90 505.37 570.57 TF
(\323) 0 -90 505.37 483.09 TF
641.59 658.05 684.04 689.35 R
N
573.41 652.91 615.86 684.21 R
N
503.08 649.48 545.54 680.78 R
N
661.24 422.43 662.72 421.9 659.4 417.26 659.75 422.96 4 Y
N
661.24 422.43 662.72 421.9 659.4 417.26 659.75 422.96 4 Y
V
664.63 645.84 663.15 645.35 662.94 651.02 666.12 646.33 4 Y
N
664.63 645.84 663.15 645.35 662.94 651.02 666.12 646.33 4 Y
V
664.72 645.56 M
 680.89 596.14 692.41 543.89 683.5 491.68 D
 679.43 467.81 669.43 445.52 661.34 422.71 D
N
498.02 433.02 499.55 433.43 499.44 427.71 496.5 432.62 4 Y
N
498.02 433.02 499.55 433.43 499.44 427.71 496.5 432.62 4 Y
V
519.05 637.99 517.84 638.99 522.55 642.21 520.26 636.99 4 Y
N
519.05 637.99 517.84 638.99 522.55 642.21 520.26 636.99 4 Y
V
518.86 637.76 M
 476 586.06 488.51 508.1 496.26 445.03 D
 496.74 441.17 496.92 437.15 497.95 433.31 D
N
(W) 0 -90 461.2 680.09 TF
(orker thread e) 0 -90 461.2 670.61 TF
(xits after ser) 0 -90 461.2 599.28 TF
(ving the one request.) 0 -90 461.2 535.41 TF
2 19.06 Q
(Master/Sla) 0 -90 705.98 693.79 TF
(ve \0502\051 \322Thread per Request\323) 0 -90 705.98 598.74 TF
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 46
%%Page: "mini" 47
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(93) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Ex) 114.22 686.11 T
(er) 140.23 686.11 T
(cise Objective) 160.07 686.11 T
2 10.72 Q
-0.21 (Edit the code in) 37.72 642.04 P
4 F
-0.44 (server.c) 119.7 642.04 P
2 F
-0.21 ( and c) 171.16 642.04 P
-0.21 (hang) 201.62 642.04 P
-0.21 (e it so that instead of pr) 227.34 642.04 P
-0.21 (ocess-) 346.82 642.04 P
(ing e) 37.72 628.94 T
(ver) 62.58 628.94 T
(y request as it comes in, the incoming requests are put) 78.78 628.94 T
(onto a queue) 37.72 615.84 T
(. Then create 10 consumer threads whic) 104.65 615.84 T
(h e) 308.31 615.84 T
(x) 323.64 615.84 T
(ecute the) 329.49 615.84 T
(c) 37.72 602.73 T
(lassic Pr) 43.47 602.73 T
(oducer/Consumer code to remo) 87.36 602.73 T
(ve those requests and) 249.17 602.73 T
(send replies bac) 37.72 589.63 T
(k \050as in the e) 121.52 589.63 T
(xisting code\051.) 186.31 589.63 T
(Extra: Ad) 37.72 563.43 T
(d a method of stopping the ser) 85.27 563.43 T
(ver) 242.03 563.43 T
(, suc) 257.48 563.43 T
(h as in) 281.81 563.43 T
4 F
(stop_queue_solution.c) 37.72 550.32 T
2 F
(.) 172.8 550.32 T
(Hint: Soc) 37.72 524.12 T
(ket connections take ~5 min) 84.56 524.12 T
(utes to time-out if y) 227.74 524.12 T
(our pr) 326.35 524.12 T
(o-) 357.11 524.12 T
(gram crashes \050e) 37.72 511.01 T
(.g., y) 120.16 511.01 T
(ou ^C it\051. Y) 144.33 511.01 T
(ou can run the code with diff) 199.55 511.01 T
(erent) 345.38 511.01 T
(soc) 37.72 497.91 T
(kets:) 55.98 497.91 T
4 F
(% server 6501&) 37.72 471.71 T
(% client 6501) 37.72 458.6 T
2 F
(Make sure that y) 37.72 432.4 T
(ou send replies to) 121.46 432.4 T
5 F
(all) 216.19 432.4 T
2 F
( the requests. The c) 228.11 432.4 T
(lient will) 328.58 432.4 T
(tell y) 37.72 419.3 T
(ou if it didn\325t g) 61.89 419.3 T
(et all the replies:) 135.85 419.3 T
4 F
(Client[T@5] Done recving. Server dropped 85 requests!) 37.72 393.09 T
2 F
(My solution is in) 37.72 366.88 T
4 F
(server_pc.c) 124.7 366.88 T
2 F
(. Man) 195.45 366.88 T
(y minor v) 222.64 366.88 T
(ariations of the same) 270.09 366.88 T
(basic code are possib) 37.72 353.78 T
(le) 149.63 353.78 T
(.) 158.79 353.78 T
(Wild Guess at Time to Completion:) 37.72 327.58 T
(30 min) 144.93 314.47 T
(utes think/design time) 178.78 314.47 T
(.) 292.18 314.47 T
(2 hour) 144.93 301.37 T
(s pr) 177.53 301.37 T
(ogramming/deb) 196.98 301.37 T
(ug) 277.17 301.37 T
(ging) 290.17 301.37 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(94) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
411.22 340.77 727.19 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
663.73 401.43 M
 665.33 405.16 657.67 408.62 652.67 404.04 D
 647.63 399.43 641.46 410.69 632.64 402.3 D
1.79 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
90 450 0.89 0.89 90 648.46 390.28 GG
648.46 391.17 646.2 391.17 648.46 399.06 650.72 391.17 4 Y
0 Z
N
648.46 391.17 646.2 391.17 648.46 399.06 650.72 391.17 4 Y
V
648.46 390.28 648.46 386.62 2 L
2 Z
N
621.37 402.29 M
 622.97 406.01 615.31 409.48 610.31 404.9 D
 605.27 400.29 599.1 411.55 590.28 403.16 D
N
90 450 0.89 0.89 90 606.1 391.13 GG
606.1 392.03 603.84 392.03 606.1 399.92 608.36 392.03 4 Y
0 Z
N
606.1 392.03 603.84 392.03 606.1 399.92 608.36 392.03 4 Y
V
606.1 391.13 606.1 387.47 2 L
2 Z
N
582.4 404.86 M
 583.99 408.59 576.34 412.05 571.33 407.47 D
 566.29 402.86 560.13 414.12 551.31 405.73 D
N
90 450 0.89 0.89 90 567.12 393.71 GG
567.12 394.6 564.86 394.6 567.12 402.49 569.39 394.6 4 Y
0 Z
N
567.12 394.6 564.86 394.6 567.12 402.49 569.39 394.6 4 Y
V
567.12 393.71 567.12 390.05 2 L
2 Z
N
543.19 403.14 M
 544.79 406.87 537.13 410.34 532.13 405.76 D
 527.09 401.15 520.92 412.4 512.1 404.01 D
N
90 450 0.89 0.89 90 527.92 391.99 GG
527.92 392.89 525.66 392.89 527.92 400.77 530.18 392.89 4 Y
0 Z
N
527.92 392.89 525.66 392.89 527.92 400.77 530.18 392.89 4 Y
V
527.92 391.99 527.92 388.33 2 L
2 Z
N
599.39 521.2 M
 600.99 524.92 593.33 528.39 588.33 523.81 D
 583.29 519.2 577.12 530.46 568.3 522.07 D
N
90 450 0.89 0.89 90 584.12 510.04 GG
584.12 510.94 581.86 510.94 584.12 518.83 586.38 510.94 4 Y
0 Z
N
584.12 510.94 581.86 510.94 584.12 518.83 586.38 510.94 4 Y
V
584.12 510.05 584.12 506.38 2 L
2 Z
N
585.13 535.45 586.71 535.45 585.13 529.96 583.56 535.45 4 Y
0.6 H
0 Z
N
585.13 535.45 586.71 535.45 585.13 529.96 583.56 535.45 4 Y
V
585.13 649.19 585.13 535.75 2 L
2 Z
N
4 8.34 Q
(\322request #435\323) 0 -90 592.18 641.9 TF
640.7 658.05 676.97 689.35 R
0 Z
N
582.45 652.91 618.72 684.21 R
N
522.36 649.48 558.64 680.78 R
N
660.43 645.69 658.91 645.27 658.95 651.01 661.96 646.12 4 Y
N
660.43 645.69 658.91 645.27 658.95 651.01 661.96 646.12 4 Y
V
660.51 645.41 M
 674.31 596.02 684.12 543.84 676.52 491.68 D
 672.71 465.55 663 441.25 655.61 416.24 D
2 Z
N
535.8 637.68 534.52 638.59 538.96 642.16 537.08 636.78 4 Y
0 Z
N
535.8 637.68 534.52 638.59 538.96 642.16 537.08 636.78 4 Y
V
535.63 637.44 M
 499.03 585.58 509.92 507.97 516.54 445.03 D
 517.18 438.95 517.71 432.63 519.49 426.67 D
2 Z
N
633.01 543.56 644 579.58 R
0 Z
N
644 557.28 633.01 557.28 2 L
2 Z
N
90 450 2.79 2.2 270 638.5 551.06 GG
90 450 2.79 2.2 270 638.5 551.06 AA
(R1) 0 -90 635.56 575.93 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
633.01 495.96 644 531.98 R
0 Z
N
644 509.68 633.01 509.68 2 L
2 Z
N
90 450 2.79 2.2 270 638.5 503.47 GG
90 450 2.79 2.2 270 638.5 503.47 AA
(R2) 0 -90 635.56 528.34 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
633.01 444.93 644 480.95 R
0 Z
N
644 458.66 633.01 458.66 2 L
2 Z
N
90 450 2.79 2.2 270 638.5 452.44 GG
90 450 2.79 2.2 270 638.5 452.44 AA
(R3) 0 -90 635.56 477.31 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
638.51 538.98 640.08 538.98 638.51 533.49 636.93 538.98 4 Y
0 Z
N
638.51 538.98 640.08 538.98 638.51 533.49 636.93 538.98 4 Y
V
638.51 549.14 638.51 539.28 2 L
2 Z
N
638.87 489.67 640.45 489.67 638.87 484.18 637.3 489.67 4 Y
0 Z
N
638.87 489.67 640.45 489.67 638.87 484.18 637.3 489.67 4 Y
V
638.87 499.82 638.87 489.97 2 L
2 Z
N
622.64 569.54 621.98 570.97 627.63 571.84 623.3 568.1 4 Y
0 Z
N
622.64 569.54 621.98 570.97 627.63 571.84 623.3 568.1 4 Y
V
592.26 515.9 M
 599.07 508.67 613.81 514.5 615.68 523.03 D
 618.84 537.48 606.86 562.26 622.37 569.41 D
2 Z
N
620.94 495.43 619.7 496.4 624.33 499.77 622.18 494.46 4 Y
0 Z
N
620.94 495.43 619.7 496.4 624.33 499.77 622.18 494.46 4 Y
V
608.46 408.48 M
 594.47 435.22 603.14 472.66 620.76 495.2 D
2 Z
N
613.91 456.06 613.58 457.6 619.27 457.21 614.24 454.52 4 Y
0 Z
N
613.91 456.06 613.58 457.6 619.27 457.21 614.24 454.52 4 Y
V
565.96 413.2 M
 565.91 440 592.81 451.52 613.62 455.99 D
2 Z
N
(\322Reply #124\323) 0 -90 521.45 575.93 TF
(\322Reply #999) 0 -90 665.37 565.21 TF
2 10.72 Q
(W) 0 -90 480.71 683.66 TF
(orker threads take requests fr) 0 -90 480.71 674.18 TF
(om queue) 0 -90 480.71 523.07 TF
(, e) 0 -90 480.71 472.33 TF
(x) 0 -90 480.71 460.57 TF
(ecute them, then go) 0 -90 480.71 454.71 TF
(bac) 0 -90 469.99 683.66 TF
(k f) 0 -90 469.99 665.4 TF
(or more requests.) 0 -90 469.99 653.11 TF
2 19.06 Q
(W) 0 -90 704.05 659.84 TF
(orkpile \050Pr) 0 -90 704.05 642.99 TF
(oducer/Consumer\051) 0 -90 704.05 549.11 TF
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 47
%%Page: "mini" 48
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(95) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(T&S: Pr) 74.85 686.11 T
(oducer/Consumer:) 153.04 686.11 T
(ser) 149.55 657.53 T
(ver_pc.c) 181.95 657.53 T
4 7.15 Q
(/*                server_pc.c                */) 37.72 615.84 T
(/* 4567890 234567890 234567890 234567890 234567890 234567890 234567890 2345678*/) 37.72 607.5 T
(/*) 37.72 599.16 T
(  A simple server program.  It sets up a TCP port for the client) 37.72 582.48 T
(  program to connect to.) 37.72 574.15 T
(  This version is really just a producer/consumer program that happens) 37.72 557.47 T
(  to run across a socket.) 37.72 549.13 T
(  This version checks to ensure all replies have been sent out before) 37.72 532.45 T
(  closing the socket.) 37.72 524.12 T
(  On most errors this programs just aborts.) 37.72 507.44 T
(*/) 37.72 482.43 T
(#define _POSIX_C_SOURCE 199506L) 37.72 449.07 T
(/* Note that you need to define  __EXTENSIONS__ when using sockets. */) 37.72 440.74 T
(#define __EXTENSIONS__) 37.72 432.4 T
(#include <stdio.h>) 37.72 399.05 T
(#include <sys/types.h>) 37.72 390.71 T
(#include <sys/socket.h>) 37.72 382.37 T
(#include <netinet/in.h>) 37.72 374.03 T
(#include <arpa/inet.h>) 37.72 365.69 T
(#include <pthread.h>) 37.72 357.35 T
(#include <semaphore.h>) 37.72 349.02 T
(#include <time.h>) 37.72 340.68 T
(#include <limits.h>) 37.72 332.34 T
(#include <errno.h>) 37.72 324 T
(#include \322thread_extensions.h\323) 37.72 315.66 T
(/* Constants etc. */) 37.72 298.99 T
(#define                 MESSAGE_SIZE 70) 37.72 290.65 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(96) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(const int               MAX_FDS = OPEN_MAX-10;         /* Solaris constant */) 411.22 678.97 T
( /* String sent by & to client when done */) 411.22 670.63 T
(const char              *END_CLIENT_MSG =) 411.22 662.29 T
(  \322End\1340                                                                   \322;) 411.22 653.95 T
(/* The structures for clients, and requests */) 411.22 612.26 T
(typedef struct client_struct {) 411.22 595.59 T
(  int                   socket;                 /* socket fd */) 411.22 578.91 T
(  char                  name[30];               /* \322Client_123[T@23]\323 */) 411.22 570.57 T
(  int                   outstanding_requests;   /* No. unanswered */) 411.22 562.23 T
(  pthread_mutex_t       lock;) 411.22 545.56 T
(  pthread_cond_t        cv;) 411.22 537.22 T
(} client_t;) 411.22 528.88 T
(typedef struct request_struct {) 411.22 512.21 T
(  client_t              *client;) 411.22 503.87 T
(  char                  data[MESSAGE_SIZE]; /* \322Client_7[T@4] Request: 4\323 */) 411.22 495.53 T
(  struct request_struct *next;) 411.22 487.19 T
(} request_t;) 411.22 478.85 T
(/* Optional command line arguments \050+ defaults\051 */) 411.22 437.16 T
(int                     SLEEP = 0, SPIN= 0, N_CONSUMERS=10;) 411.22 428.82 T
(int) 411.22 420.49 T
(REQUESTED_TCP_PORT = 6500, ACTUAL_TCP_PORT,) 529.74 420.49 T
(MAX_PORT_RANGE=100;) 529.74 412.15 T
(int                     STOPPER_SLEEP=-1, KILLER_SLEEP=-1;) 411.22 403.81 T
(/* Other useful bits */) 411.22 362.12 T
(int                     PID;) 411.22 353.78 T
(pthread_attr_t          attr;) 411.22 345.44 T
(int                     port_socket;) 411.22 337.11 T
(int                     n_replies=0;) 411.22 328.77 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 48
%%Page: "mini" 49
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(97) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(/* A List of REQUESTS with protection and related varaibles. */) 37.72 637.28 T
(request_t               *requests =     NULL;) 37.72 628.94 T
(int                     length =        0;) 37.72 620.6 T
(pthread_mutex_t         requests_lock = PTHREAD_MUTEX_INITIALIZER;) 37.72 612.26 T
(pthread_cond_t          producer_cv =   PTHREAD_COND_INITIALIZER;) 37.72 603.92 T
(pthread_cond_t          consumer_cv =   PTHREAD_COND_INITIALIZER;) 37.72 595.59 T
(/* Some function declarations */) 37.72 562.23 T
(client_t *new_client\050int\051;) 37.72 545.56 T
(void *producer\050void *\051;) 37.72 537.22 T
(request_t *get_request\050client_t *\051;) 37.72 528.88 T
(void *process_request\050request_t *\051;) 37.72 520.54 T
(/* A bunch of simple helper functions */) 37.72 495.53 T
(void set_up_signal_mask\050\051 {) 37.72 478.85 T
( sigset_t               s, s1, s2;) 37.72 470.52 T
( static struct          sigaction action;) 37.72 462.18 T
(/* Block everything first \050in particular SIGPIPE\051 */) 37.72 445.5 T
( sigfillset\050&s\051;) 37.72 437.16 T
( pthread_sigmask\050SIG_BLOCK, &s, &s2\051;) 37.72 428.82 T
( sigemptyset\050&s\051;) 37.72 420.49 T
( sigaddset\050&s, SIGINT\051;                 /* For ^C */) 37.72 403.81 T
( pthread_sigmask\050SIG_UNBLOCK, &s, &s1\051;) 37.72 395.47 T
(}) 37.72 387.13 T
(/* Keep track of the current number of clients for stats & fd limit */) 37.72 362.12 T
(int client_max_count = 0;) 37.72 353.78 T
(int count_clients\050int i\051 {) 37.72 337.11 T
(  static pthread_mutex_t counter_lock = PTHREAD_MUTEX_INITIALIZER;) 37.72 328.77 T
(  static int             client_count = 0;) 37.72 320.43 T
(  int j;) 37.72 312.09 T
(  pthread_mutex_lock\050&counter_lock\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(98) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  client_count += i;) 411.22 695.65 T
(  if \050client_count > client_max_count\051) 411.22 687.31 T
(    client_max_count = client_count;) 411.22 678.97 T
(  j = client_count;) 411.22 670.63 T
(  pthread_mutex_unlock\050&counter_lock\051;) 411.22 662.29 T
(  return\050j\051;) 411.22 653.95 T
(}) 411.22 645.62 T
(int count_requests\050int i\051 {) 411.22 528.88 T
(  static int count=0;) 411.22 520.54 T
(  static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 411.22 512.21 T
( pthread_mutex_lock\050&count_lock\051;) 411.22 495.53 T
( count += i;) 411.22 487.19 T
( i = count;) 411.22 478.85 T
( pthread_mutex_unlock\050&count_lock\051;) 411.22 470.52 T
( return\050i\051;) 411.22 462.18 T
(/* Can\325t return count */) 571.43 462.18 T
(}) 411.22 453.84 T
(void print_requests\050\051) 411.22 437.16 T
({request_t              *r = requests;) 411.22 428.82 T
( while \050r != NULL\051) 411.22 412.15 T
(   {printf\050\322<Request: %d>\134n\323, r->client->socket\051;) 411.22 403.81 T
(    r = r->next;) 411.22 395.47 T
(  }) 411.22 387.13 T
(}) 411.22 378.8 T
(/* Synchronize on the number of OUTSTANDING REQUESTS per client. */) 411.22 353.78 T
(void wait_for_requests_to_zero\050client_t *client\051 {) 411.22 337.11 T
(  pthread_mutex_lock\050&client->lock\051;) 411.22 328.77 T
(  while \050client->outstanding_requests > 0\051) 411.22 320.43 T
(    pthread_cond_wait\050&client->cv, &client->lock\051;) 411.22 312.09 T
(  pthread_mutex_unlock\050&client->lock\051;) 411.22 303.75 T
(}) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 49
%%Page: "mini" 50
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(99) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(int decrement_requests_for\050client_t *client\051 {) 37.72 687.31 T
(  int i;) 37.72 678.97 T
(  pthread_mutex_lock\050&client->lock\051;) 37.72 662.29 T
(  client->outstanding_requests--;) 37.72 653.95 T
(  i = client->outstanding_requests;) 37.72 645.62 T
(  if \050client->outstanding_requests == 0\051) 37.72 637.28 T
(    pthread_cond_signal\050&client->cv\051;) 37.72 628.94 T
(  pthread_mutex_unlock\050&client->lock\051;) 37.72 620.6 T
(  return\050i\051;) 37.72 612.26 T
(}) 37.72 603.92 T
(void increment_requests_for\050client_t *client\051 {) 37.72 587.25 T
(  pthread_mutex_lock\050&client->lock\051;) 37.72 578.91 T
(  client->outstanding_requests++;) 37.72 570.57 T
(  pthread_mutex_unlock\050&client->lock\051;) 37.72 562.23 T
(}) 37.72 553.9 T
(/* Build a new REQUEST */) 37.72 528.88 T
(request_t *new_request\050client_t *client, char *ibuf\051 {) 37.72 512.21 T
(  request_t             *request;) 37.72 503.87 T
(  pthread_t tid = pthread_self\050\051;) 37.72 487.19 T
(  DEBUG\050printf\050\322Server_%d[%s] get_request\050\051 received: \134\323%s\134\323\134n\323,) 37.72 478.85 T
(               PID, thread_name\050tid\051, ibuf\051\051;) 37.72 470.52 T
(  request = \050request_t *\051 malloc\050sizeof\050request_t\051\051;) 37.72 462.18 T
(  request->client = client;) 37.72 453.84 T
(  strcpy\050request->data, ibuf\051;) 37.72 445.5 T
(  count_requests\0501\051;) 37.72 437.16 T
(  increment_requests_for\050client\051;) 37.72 428.82 T
(  return\050request\051;) 37.72 362.12 T
(}) 37.72 353.78 T
(int delete_request\050request_t *request\051 {) 37.72 328.77 T
(  int i;) 37.72 320.43 T
(  i=decrement_requests_for\050request->client\051;) 37.72 303.75 T
(  free\050request\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(100) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  return\050i\051;) 411.22 695.65 T
(}) 411.22 687.31 T
(/*) 411.22 653.95 T
(  Send \322End\323 and close the socket.) 411.22 645.62 T
(*/) 411.22 620.6 T
(void close_client\050client_t *client\051 {) 411.22 603.92 T
(  int j;) 411.22 595.59 T
(  DEBUG\050printf\050\322Closing socket %s...\134n\323, client->name\051\051;) 411.22 578.91 T
(  pthread_mutex_lock\050&client->lock\051;) 411.22 562.23 T
(  if \050client->socket != -1\051 {) 411.22 553.9 T
(/* Ensure only close\050\051 once. */) 539.87 553.9 T
(    write\050client->socket, END_CLIENT_MSG, MESSAGE_SIZE\051;   /* Ignore errors */) 411.22 545.56 T
(    close\050client->socket\051;) 411.22 537.22 T
(    client->socket = -1;) 411.22 528.88 T
(    j = count_clients\050-1\051;) 411.22 503.87 T
(    if \050j == 0\051) 411.22 495.53 T
(      DEBUG\050printf\050\322Max open sockets: %d\134n\323, client_max_count\051\051;) 411.22 487.19 T
(    DEBUG\050printf\050\322Closed %s. \050%d active clients\051\134n\323,) 411.22 478.85 T
(                 client->name, count_clients\0500\051\051\051;) 411.22 470.52 T
(  }) 411.22 462.18 T
(  pthread_mutex_unlock\050&client->lock\051;) 411.22 453.84 T
(}) 411.22 445.5 T
(void write_msg\050client_t *client, char *obuf\051 {) 411.22 395.47 T
(  int                   nbytes, socket, active;) 411.22 387.13 T
(  char                  *cname;) 411.22 378.8 T
(  char                  *t_name = thread_name\050pthread_self\050\051\051;) 411.22 370.46 T
(  DEBUG\050printf\050\322Server_%d[%s] write_msg\050\051 sending: \134\323%s\134\323\134n\323,) 411.22 353.78 T
(               PID, t_name, obuf\051\051;) 411.22 345.44 T
(  pthread_mutex_lock\050&client->lock\051;) 411.22 337.11 T
(  socket = client->socket;) 411.22 328.77 T
(  cname  = client->name;) 411.22 320.43 T
(  pthread_mutex_unlock\050&client->lock\051;) 411.22 303.75 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 50
%%Page: "mini" 51
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(101) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  retry: nbytes = write\050socket, obuf, MESSAGE_SIZE\051;) 37.72 687.31 T
(  if \050nbytes == MESSAGE_SIZE\051 {) 37.72 670.63 T
(    return;) 37.72 662.29 T
(  }) 37.72 653.95 T
(  if \050nbytes > -1\051 {) 37.72 637.28 T
(    printf\050\322Only wrote %d bytes to %s. \050Impossible?\051\323, nbytes, cname\051;) 37.72 628.94 T
(    abort\050\051;) 37.72 620.6 T
(  }) 37.72 612.26 T
(  if \050errno == EINTR\051 {) 37.72 595.59 T
(    printf\050\322EINTR while trying to write to %s on fd#%d. retrying...\134n\323,) 37.72 587.25 T
(   cname, socket\051;) 71.07 578.91 T
(    goto retry;) 37.72 570.57 T
(  }) 37.72 562.23 T
(  if \050\050errno == EPIPE\051 || \050errno == EBADF\051\051 {) 37.72 545.56 T
(    printf\050\322Failed trying to write to %s. \134n\323, cname\051;) 37.72 537.22 T
(    perror\050\322Closing socket\323\051;) 37.72 528.88 T
(    close_client\050client\051;) 37.72 495.53 T
(    return;) 37.72 487.19 T
(  }) 37.72 478.85 T
(  else) 37.72 470.52 T
(    perror\050\322Unknown bug \050Impossible?\051\323\051, abort\050\051;) 37.72 462.18 T
(}) 37.72 453.84 T
(/* Manipulate the requests list. Caller must own requests_lock. */) 37.72 420.49 T
(request_t *remove_request\050\051 {) 37.72 412.15 T
(  request_t *request;) 37.72 403.81 T
(  request = requests;) 37.72 387.13 T
(  requests = requests->next;) 37.72 378.8 T
(  length--;) 37.72 370.46 T
(  return\050request\051;) 37.72 362.12 T
(}) 37.72 353.78 T
(void add_request\050request_t *request\051 {) 37.72 337.11 T
(  request->next = requests;) 37.72 328.77 T
(/* Insert at head of list */) 209.25 328.77 T
(  requests = request;) 37.72 320.43 T
(  length++;) 37.72 312.09 T
(}) 37.72 303.75 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(102) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(int open_port\050\051 {) 411.22 687.31 T
(  struct sockaddr_in    cli_addr, serv_addr;) 411.22 678.97 T
(  int                   port_socket, clilen, i;) 411.22 670.63 T
(  /* Open a new port. Try to get requested port. */) 411.22 653.95 T
(  if\050\050port_socket = socket\050AF_INET, SOCK_STREAM, 0\051\051 < 0\051) 411.22 645.62 T
(    perror\050\322Can\325t create new socket\323\051, abort\050\051;) 411.22 637.28 T
(  for \050i=REQUESTED_TCP_PORT; i< REQUESTED_TCP_PORT+MAX_PORT_RANGE; i++\051 {) 411.22 620.6 T
(    memset\050\050char *\051 &serv_addr, 0, sizeof\050serv_addr\051\051;) 411.22 612.26 T
(    serv_addr.sin_family = AF_INET;) 411.22 603.92 T
(    serv_addr.sin_addr.s_addr = htonl\050INADDR_ANY\051;) 411.22 595.59 T
(    serv_addr.sin_port = htons\050i\051;) 411.22 587.25 T
(    if \050bind\050port_socket, \050struct sockaddr *\051&serv_addr, sizeof\050serv_addr\051\051<0\051) 411.22 578.91 T
(      {DEBUG\050printf\050\322Can\325t bind to port %d\134n\323, i\051\051;}) 411.22 570.57 T
(    else {) 411.22 562.23 T
(      printf\050\322Server bound to port: %d\134n\323, i\051;) 411.22 553.9 T
(      ACTUAL_TCP_PORT=i;) 411.22 545.56 T
(      listen\050port_socket, 5\051;) 411.22 537.22 T
(      return\050port_socket\051;) 411.22 528.88 T
(    }) 411.22 520.54 T
(  }) 411.22 512.21 T
(  printf\050\322Could not find an available port from %d to %d\323,) 411.22 503.87 T
( REQUESTED_TCP_PORT, REQUESTED_TCP_PORT+MAX_PORT_RANGE\051;) 444.58 495.53 T
(  abort\050\051;) 411.22 487.19 T
(}) 411.22 478.85 T
(client_t *accept_a_connection\050int port_socket\051 {) 411.22 445.5 T
(  int                   new_socket, clilen;) 411.22 437.16 T
(  struct sockaddr_in    cli_addr;) 411.22 428.82 T
(  clilen = sizeof\050cli_addr\051;) 411.22 412.15 T
(  new_socket = accept\050port_socket, \050struct sockaddr *\051 &cli_addr, &clilen\051;) 411.22 403.81 T
(  if \050new_socket < 0\051) 411.22 395.47 T
(    perror\050\322Accept failed. \050Impossible?\051\323\051, abort\050\051;) 411.22 387.13 T
(  return\050new_client\050new_socket\051\051;) 411.22 370.46 T
(}) 411.22 362.12 T
(void *reporter\050void *arg\051 {) 411.22 337.11 T
(  while \050TRUE\051 {) 411.22 320.43 T
(    sleep\05030\051;) 411.22 312.09 T
(    printf\050\322Server up on port %d. Processed %d requests.\134n\323,) 411.22 303.75 T
(   ACTUAL_TCP_PORT, count_requests\0500\051\051;) 444.58 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 51
%%Page: "mini" 52
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(103) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  }) 37.72 695.65 T
(}) 37.72 687.31 T
(int startup_initialize\050\051 {) 37.72 662.29 T
(  int) 37.72 653.95 T
(i;) 112.77 653.95 T
(  set_up_signal_mask\050\051;) 37.72 637.28 T
(  PTHREAD_ATTR_INIT\050&attr\051;) 37.72 620.6 T
(  pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 37.72 612.26 T
(  pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 37.72 603.92 T
(}) 37.72 587.25 T
(void *acceptor\050void *arg\051 {) 37.72 562.23 T
(  client_t *client;) 37.72 553.9 T
(  pthread_t tid;) 37.72 545.56 T
(  int port_socket = \050int\051 arg;) 37.72 537.22 T
(  while \050TRUE\051 {) 37.72 520.54 T
(    client = accept_a_connection\050port_socket\051;) 37.72 512.21 T
(    PTHREAD_CREATE\050&tid, &attr, producer, \050void *\051 client\051;) 37.72 503.87 T
(  }) 37.72 495.53 T
(}) 37.72 487.19 T
(request_t *get_request\050client_t *client\051 {) 37.72 453.84 T
(  request_t) 37.72 445.5 T
(*request;) 112.77 445.5 T
(  char) 37.72 437.16 T
(ibuf[MESSAGE_SIZE];) 112.77 437.16 T
(  int) 37.72 428.82 T
(nbytes;) 112.77 428.82 T
(  nbytes = read\050client->socket, ibuf, MESSAGE_SIZE\051;) 37.72 412.15 T
(  if \050nbytes != MESSAGE_SIZE\051 {printf\050\322Read failed!\134n\323\051; abort\050\051;}) 37.72 403.81 T
(  if \050strncmp\050ibuf, END_CLIENT_MSG, 3\051 == 0\051 return\050NULL\051;) 37.72 395.47 T
(  request = new_request\050client, ibuf\051;) 37.72 378.8 T
(  return\050request\051;) 37.72 370.46 T
(}) 37.72 362.12 T
(client_t *new_client\050int socket\051 {) 37.72 345.44 T
(  client_t *client = \050client_t *\051 malloc\050sizeof\050client_t\051\051;) 37.72 337.11 T
(  client->socket = socket;) 37.72 320.43 T
(  client->outstanding_requests=0;) 37.72 303.75 T
(  count_clients\0501\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(104) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  DEBUG\050printf\050\322New Client fd#%d. \050%d active clients\051\134n\323,) 411.22 695.65 T
(       socket, count_clients\0500\051\051\051;) 444.58 687.31 T
(  return\050client\051;) 411.22 678.97 T
(}) 411.22 670.63 T
(/* Send a reply back to client */) 411.22 653.95 T
(void *process_request\050request_t *request\051 {) 411.22 645.62 T
(  client_t              *client = request->client;) 411.22 637.28 T
(  char                  *cname;) 411.22 628.94 T
(  char                  obuf[MESSAGE_SIZE];) 411.22 620.6 T
(  char                  *t_name = thread_name\050pthread_self\050\051\051;) 411.22 612.26 T
(  int                   i, nbytes, finishing, socket;) 411.22 603.92 T
(  DEBUG\050printf\050\322Server_%d[%s] processing: \134\323%s\134\323\134n\323,) 411.22 587.25 T
(       PID, t_name, request->data\051\051;) 444.58 578.91 T
(  delay\050SLEEP, SPIN\051;) 411.22 562.23 T
(  sprintf\050obuf, \322Server_%d[%s] reply %d to %s\323,) 411.22 553.9 T
(  PID, t_name, n_replies++, request->data\051;) 444.58 545.56 T
(  write_msg\050client, obuf\051;) 411.22 537.22 T
(  delete_request\050request\051;) 411.22 528.88 T
(}) 411.22 520.54 T
(void *producer\050void *arg\051 {) 411.22 495.53 T
(  request_t *request;) 411.22 487.19 T
(  client_t *client = \050client_t *\051 arg;) 411.22 478.85 T
(  DEBUG\050printf\050\322Producer starting.\134n\323\051\051;) 411.22 462.18 T
(  while \050TRUE\051 {) 411.22 445.5 T
(    request = get_request\050client\051;) 411.22 437.16 T
(    if \050request == NULL\051 {) 411.22 428.82 T
(      wait_for_requests_to_zero\050client\051;) 411.22 420.49 T
(      close_client\050client\051;) 411.22 412.15 T
(      return;) 411.22 403.81 T
(    }) 411.22 395.47 T
(    pthread_mutex_lock\050&requests_lock\051;) 411.22 387.13 T
(    while \050\050length >= 10\051\051) 411.22 378.8 T
(      pthread_cond_wait\050&producer_cv, &requests_lock\051;) 411.22 370.46 T
(    add_request\050request\051;) 411.22 362.12 T
(    pthread_mutex_unlock\050&requests_lock\051;) 411.22 353.78 T
(    pthread_cond_signal\050&consumer_cv\051;) 411.22 345.44 T
(  }) 411.22 337.11 T
(}) 411.22 328.77 T
(void *consumer\050void *arg\051 {) 411.22 303.75 T
(  request_t *request;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 52
%%Page: "mini" 53
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(105) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  DEBUG\050printf\050\322Consumer starting.\134n\323\051\051;) 37.72 687.31 T
(  set_up_signal_mask\050\051;) 37.72 678.97 T
(  while\050TRUE\051 {) 37.72 662.29 T
(    pthread_mutex_lock\050&requests_lock\051;) 37.72 653.95 T
(    while \050\050length == 0\051\051) 37.72 645.62 T
(      pthread_cond_wait\050&consumer_cv, &requests_lock\051;) 37.72 637.28 T
(    request = remove_request\050\051;) 37.72 628.94 T
(    pthread_mutex_unlock\050&requests_lock\051;) 37.72 620.6 T
(    pthread_cond_signal\050&producer_cv\051;) 37.72 612.26 T
(    process_request\050request\051;) 37.72 603.92 T
(  }) 37.72 595.59 T
(}) 37.72 587.25 T
(main\050int argc, char **argv\051 {) 37.72 553.9 T
(  int                   i;) 37.72 545.56 T
(  pthread_t tid;) 37.72 537.22 T
(  PID = getpid\050\051;) 37.72 520.54 T
(  if \050argc > 1\051 REQUESTED_TCP_PORT = atoi\050argv[1]\051;) 37.72 503.87 T
(  if \050argc > 2\051 SLEEP = atoi\050argv[2]\051;) 37.72 495.53 T
(  if \050argc > 3\051 SPIN = atoi\050argv[3]\051;) 37.72 487.19 T
(  if \050argc > 4\051 N_CONSUMERS = atoi\050argv[4]\051;) 37.72 478.85 T
(  if \050argc > 5\051 STOPPER_SLEEP = atoi\050argv[5]\051;) 37.72 470.52 T
(  if \050argc > 6\051 KILLER_SLEEP = atoi\050argv[6]\051;) 37.72 462.18 T
(  printf\050\322Server_%d\050TCP_PORT %d SLEEP %dms SPIN %dus N_CONSUMERS \134n\134) 37.72 453.84 T
(%d STOPPER %ds KILLER %ds\051\134n\323,) 37.72 445.5 T
(         PID, REQUESTED_TCP_PORT, SLEEP, SPIN, N_CONSUMERS,) 37.72 437.16 T
(         STOPPER_SLEEP, KILLER_SLEEP\051;) 37.72 428.82 T
(  startup_initialize\050\051;) 37.72 412.15 T
(  PTHREAD_CREATE\050&tid, &attr, reporter, NULL\051;) 37.72 395.47 T
(  for \050i=0; i<N_CONSUMERS; i++\051 {) 37.72 378.8 T
(    PTHREAD_CREATE\050&tid, &attr, consumer, \050void *\051 NULL\051;) 37.72 370.46 T
(  }) 37.72 362.12 T
(  port_socket = open_port\050\051;) 37.72 345.44 T
(  if \050KILLER_SLEEP > 0\051) 37.72 337.11 T
(    PTHREAD_CREATE\050&tid, &attr, killer, \050void *\051 KILLER_SLEEP\051;) 37.72 328.77 T
(  acceptor\050\050void *\051port_socket\051;) 37.72 312.09 T
(}) 37.72 303.75 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(106) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
411.22 307.32 752.49 693.26 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
716.51 332.86 M
 718.11 336.59 710.45 340.05 705.44 335.47 D
 700.41 330.86 694.24 342.12 685.42 333.73 D
1.79 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
90 450 0.89 0.89 90 701.24 321.71 GG
701.24 322.6 698.98 322.6 701.24 330.49 703.5 322.6 4 Y
0 Z
N
701.24 322.6 698.98 322.6 701.24 330.49 703.5 322.6 4 Y
V
701.24 321.71 701.24 318.05 2 L
2 Z
N
674.15 333.72 M
 675.75 337.45 668.09 340.91 663.09 336.33 D
 658.05 331.72 651.88 342.98 643.06 334.59 D
N
90 450 0.89 0.89 90 658.88 322.56 GG
658.88 323.46 656.62 323.46 658.88 331.35 661.14 323.46 4 Y
0 Z
N
658.88 323.46 656.62 323.46 658.88 331.35 661.14 323.46 4 Y
V
658.88 322.57 658.88 318.9 2 L
2 Z
N
635.17 336.29 M
 636.77 340.02 629.11 343.48 624.11 338.9 D
 619.07 334.29 612.9 345.55 604.09 337.16 D
N
90 450 0.89 0.89 90 619.9 325.14 GG
619.9 326.03 617.64 326.03 619.9 333.92 622.16 326.03 4 Y
0 Z
N
619.9 326.03 617.64 326.03 619.9 333.92 622.16 326.03 4 Y
V
619.9 325.14 619.9 321.48 2 L
2 Z
N
595.97 334.57 M
 597.57 338.3 589.91 341.77 584.91 337.19 D
 579.87 332.58 573.7 343.83 564.88 335.45 D
N
90 450 0.89 0.89 90 580.7 323.42 GG
580.7 324.32 578.44 324.32 580.7 332.2 582.96 324.32 4 Y
0 Z
N
580.7 324.32 578.44 324.32 580.7 332.2 582.96 324.32 4 Y
V
580.7 323.42 580.7 319.76 2 L
2 Z
N
672.09 655.74 702.28 683.4 R
0 Z
N
630.47 654.67 661.37 682.54 R
N
588.71 652.74 618.48 677.18 R
N
688.17 438.02 699.16 468.13 R
0.6 H
N
699.16 449.49 688.17 449.49 2 L
2 Z
N
90 450 2.33 2.2 270 693.66 444.29 GG
90 450 2.33 2.2 270 693.66 444.29 AA
3 8.34 Q
(R1) 0 -90 690.72 465.09 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
688.17 398.23 699.16 428.34 R
0 Z
N
699.16 409.7 688.17 409.7 2 L
2 Z
N
90 450 2.33 2.2 270 693.66 404.5 GG
90 450 2.33 2.2 270 693.66 404.5 AA
(R2) 0 -90 690.72 425.29 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
688.17 355.57 699.16 385.68 R
0 Z
N
699.16 367.04 688.17 367.04 2 L
2 Z
N
90 450 2.33 2.2 270 693.66 361.84 GG
90 450 2.33 2.2 270 693.66 361.84 AA
(R3) 0 -90 690.72 382.63 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
693.66 435.27 695.24 435.27 693.66 429.78 692.09 435.27 4 Y
0 Z
N
693.66 435.27 695.24 435.27 693.66 429.78 692.09 435.27 4 Y
V
693.66 442.68 693.66 435.57 2 L
2 Z
N
694.03 394.05 695.6 394.05 694.03 388.55 692.46 394.05 4 Y
0 Z
N
694.03 394.05 695.6 394.05 694.03 388.55 692.46 394.05 4 Y
V
694.03 401.45 694.03 394.34 2 L
2 Z
N
680.4 400.51 679.67 401.9 685.25 403.05 681.13 399.12 4 Y
0 Z
N
680.4 400.51 679.67 401.9 685.25 403.05 681.13 399.12 4 Y
V
660.67 344.85 M
 638.92 361.99 653.57 386.45 680.14 400.37 D
2 Z
N
676.29 376.17 676.09 377.73 681.74 376.87 676.49 374.61 4 Y
0 Z
N
676.29 376.17 676.09 377.73 681.74 376.87 676.49 374.61 4 Y
V
617.72 344.85 M
 617.66 364.65 651.03 372.93 675.99 376.13 D
2 Z
N
2 19.06 Q
(Pr) 0 -90 729.36 653.88 TF
(oducer/Consumer w/) 0 -90 729.36 634.14 TF
4 F
(select\050\051) 0 -90 729.36 445.63 TF
439.81 312.69 720.33 602.14 R
1.79 H
0 Z
N
500.56 521.4 591.68 536.62 R
0.6 H
N
574.32 521.4 582.98 536.62 R
N
555.88 521.4 564.54 536.62 R
N
538 521.4 546.66 536.62 R
N
519 521.4 527.66 536.62 R
N
500.56 521.4 509.22 536.62 R
N
619.36 537.82 655.63 602.14 R
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
547.73 493.67 M
 549.33 497.39 541.67 500.86 536.66 496.28 D
 531.63 491.67 525.46 502.93 516.64 494.54 D
1.79 H
2 Z
N
90 450 0.89 0.89 90 532.46 482.51 GG
532.46 483.41 530.2 483.41 532.46 491.3 534.72 483.41 4 Y
0 Z
N
532.46 483.41 530.2 483.41 532.46 491.3 534.72 483.41 4 Y
V
532.46 482.51 532.46 478.85 2 L
2 Z
N
548.8 658.1 578.58 682.54 R
0 Z
N
502.95 655.74 532.72 680.18 R
N
6 8.34 Q
(while \050true\051 {) 0 -90 545.94 467.06 TF
( select\050\051;) 0 -90 537.6 467.06 TF
( if \050stop\051 return;) 0 -90 529.27 467.06 TF
( if \050#1\051 accept\050\051) 0 -90 520.93 467.06 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
3 F
(Clients) 0 -90 489.84 543.18 TF
6 F
(Port #6500) 0 -90 646.59 596.78 TF
(host: Local) 0 -90 638.26 596.78 TF
642.96 613.63 644.53 614.45 645.8 608.15 641.38 612.82 4 Y
0.3 H
N
642.96 613.63 644.53 614.45 645.8 608.15 641.38 612.82 4 Y
V
645.29 650.38 M
 655.78 637.03 637.75 623.66 642.89 613.77 D
2 Z
N
634.69 618.22 636.46 618.19 634.58 612.04 632.92 618.26 4 Y
0 Z
N
634.69 618.22 636.46 618.19 634.58 612.04 632.92 618.26 4 Y
V
602.4 650.38 M
 602.13 638.53 614.84 615.36 628.12 632.34 D
 629.48 634.08 636.48 633.41 635.87 628.09 D
 635.49 624.84 634.75 621.62 634.69 618.37 D
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
694.44 643.36 692.75 642.83 692.58 649.27 696.13 643.9 4 Y
0 Z
N
694.44 643.36 692.75 642.83 692.58 649.27 696.13 643.9 4 Y
V
709.61 344.85 M
 710.17 438.49 728.88 537.75 699.17 628.09 D
 697.52 633.11 696.07 638.18 694.48 643.22 D
2 Z
N
542.77 544.34 544.49 543.91 541.27 538.34 541.05 544.77 4 Y
0 Z
N
542.77 544.34 544.49 543.91 541.27 538.34 541.05 544.77 4 Y
V
564.39 655.74 M
 566.2 635.86 581.91 600.1 554.11 594.04 D
 525.77 587.87 547.05 561.48 542.81 544.49 D
2 Z
N
531.17 550.09 532.93 550.32 531.97 543.97 529.41 549.86 4 Y
0 Z
N
531.17 550.09 532.93 550.32 531.97 543.97 529.41 549.86 4 Y
V
516.64 655.74 M
 510.78 634.95 533.59 632.03 531.79 615.33 D
 529.54 594.46 528.25 572.47 531.15 550.24 D
2 Z
N
90 450 2.68 2.68 270 586.88 529.01 GG
90 450 2.68 2.68 270 586.88 529.01 AA
90 450 2.68 2.68 270 542.04 529.01 GG
90 450 2.68 2.68 270 542.04 529.01 AA
90 450 2.68 2.68 270 532.59 529.01 GG
90 450 2.68 2.68 270 532.59 529.01 AA
90 450 2.68 2.68 270 523.15 529.01 GG
90 450 2.68 2.68 270 523.15 529.01 AA
(Client_1) 0 -90 706.49 681.78 TF
(Client_2) 0 -90 664.72 686.37 TF
(Client_4) 0 -90 622.09 687.99 TF
(Client_25) 0 -90 581.59 686.63 TF
(Client_6565) 0 -90 537.26 683.14 TF
(\322Request #123\323) 0 -90 520.97 621.13 TF
(connect\050\051) 0 -90 651.06 652.1 TF
(\322Reply #13\323) 0 -90 702.54 584.88 TF
(\322Request #144\323) 0 -90 574.91 641.46 TF
3 F
(Producer) 0 -90 475.38 454.6 TF
(Consumers) 0 -90 513.57 361.59 TF
557.05 335.54 M
 558.64 339.27 550.99 342.74 545.98 338.15 D
 540.95 333.55 534.78 344.8 525.96 336.41 D
1.79 H
N
90 450 0.89 0.89 90 541.78 324.39 GG
541.78 325.28 539.51 325.28 541.78 333.17 544.04 325.28 4 Y
0 Z
N
541.78 325.28 539.51 325.28 541.78 333.17 544.04 325.28 4 Y
V
541.78 324.39 541.78 320.73 2 L
2 Z
N
677.68 454.38 677.42 456.14 683.81 455.29 677.94 452.62 4 Y
0.3 H
0 Z
N
677.68 454.38 677.42 456.14 683.81 455.29 677.94 452.62 4 Y
V
506.01 391.56 M
 508.87 377.4 522.18 354.4 541.21 365.14 D
 565.92 379.09 595.14 358.78 619.11 371.24 D
 636.62 380.34 657.82 389.01 668.66 407.3 D
 676.54 420.59 659.78 451.73 677.53 454.36 D
2 Z
N
578.47 545.71 580.24 545.59 578.03 539.55 576.71 545.84 4 Y
0 Z
N
578.47 545.71 580.24 545.59 578.03 539.55 576.71 545.84 4 Y
V
636.35 537.82 M
 641.8 528.66 633.55 512.83 622.06 515.59 D
 598.47 521.25 610.42 550.74 594.07 558.6 D
 582.38 564.22 579.14 554.92 578.48 545.86 D
2 Z
N
90 450 2.68 2.68 270 578.88 528.58 GG
90 450 2.68 2.68 270 578.88 528.58 AA
689.48 512.42 M
 691.08 516.14 683.42 519.61 678.41 515.03 D
 673.38 510.42 667.21 521.68 658.39 513.29 D
1.79 H
N
90 450 0.89 0.89 90 674.21 501.26 GG
674.21 502.16 671.94 502.16 674.21 510.05 676.47 502.16 4 Y
0 Z
N
674.21 502.16 671.94 502.16 674.21 510.05 676.47 502.16 4 Y
V
674.21 501.26 674.21 497.6 2 L
2 Z
N
6 F
(sleep\050delay\051;) 0 -90 657.91 506.96 TF
(stop = true;) 0 -90 649.57 506.96 TF
(write\050int\051;) 0 -90 641.23 506.96 TF
585.83 546.91 587.59 547.04 586.28 540.74 584.06 546.78 4 Y
0.3 H
0 Z
N
585.83 546.91 587.59 547.04 586.28 540.74 584.06 546.78 4 Y
V
641.71 452.65 M
 645.28 444.51 635.42 434.75 627.42 441.33 D
 614.6 451.86 601.49 468.01 598.83 486.6 D
 595.86 507.38 604.91 539.93 589.3 548.19 D
 587.21 549.29 585.7 548.62 585.82 547.05 D
2 Z
N
(}) 0 -90 495.91 467.06 TF
( add_request\050\051;) 0 -90 504.25 467.06 TF
( read\050fd\051;) 0 -90 512.59 467.06 TF
517.35 472.58 518.99 471.92 515.05 466.85 515.71 473.24 4 Y
0 Z
N
517.35 472.58 518.99 471.92 515.05 466.85 515.71 473.24 4 Y
V
532.13 521.14 M
 539.24 499.94 512.88 509.64 501.75 505.08 D
 496.06 502.75 494.14 493.2 499.37 491.04 D
 507.78 487.55 520.67 480.86 517.41 472.72 D
2 Z
N
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 53
%%Page: "mini" 54
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(107) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Rob) 45.31 686.11 T
(ust Ser) 86.57 686.11 T
(ver Using) 159.46 686.11 T
4 F
(select\050\051) 263.13 686.11 T
2 F
(:) 366.05 686.11 T
(ser) 131.67 657.53 T
(ver_select.c) 164.06 657.53 T
4 7.15 Q
(/*                server_select.c                */) 37.72 624.17 T
(/* 4567890 234567890 234567890 234567890 234567890 234567890 234567890 2345678*/) 37.72 615.84 T
(/*) 37.72 607.5 T
(  This version of the server is designed to be robust under client) 37.72 590.82 T
(  failure and implements a complete shutdown, first closing the port,) 37.72 582.48 T
(  then shutting down the producer thread, finally closing the Interruptor) 37.72 574.15 T
(  pipe. The consumers do not exit, but they continue and empty the queue,) 37.72 565.81 T
(  then they sit around waiting for the server to restart. \050This is) 37.72 557.47 T
(  trickier than it may seem!\051) 37.72 549.13 T
(  This uses a single producer thread which calls select\050\051 on all clients) 37.72 532.45 T
(  and on the port socket. When a new connect comes it, it gets accepted) 37.72 524.12 T
(  and the new socket added to the select\050\051 list. When a new request) 37.72 515.78 T
(  comes in, it is read and returned as a request_t.) 37.72 507.44 T
(  Any IO failures are handled by printing out an error message, closing the) 37.72 482.43 T
(  socket in question, then ignoring it. The Client program is sent an \322End\323) 37.72 474.09 T
(  message then, and left to its own devices to deal with the fact that the) 37.72 465.75 T
(  socket has been closed early.) 37.72 457.41 T
(  Shutdown is accomplished by setting \322stop\323 variables and then ensuring) 37.72 440.74 T
(  that the producer, which may be blocked on select\050\051 is woken up by doing a) 37.72 432.4 T
(  sending data on a special \322Interruptor\323 pipe. Both read\050\051 and accept\050\051 are) 37.72 424.06 T
(  assumed never to block because they are only called after select\050\051) 37.72 415.72 T
(  returns. Calls to write\050\051 are also assumed never to block \050although an) 37.72 407.38 T
(  uncooperative client could cause this by never reading replies and letting) 37.72 399.05 T
(  the socket fill up \050~64k!\051\051.) 37.72 390.71 T
(*/) 37.72 374.03 T
(/*                                           replies) 37.72 357.35 T
(                                  <-------------------------) 37.72 349.02 T
(                 _______     _______     _______            |) 37.72 340.68 T
(   Requests     |_______|-->|_______|-->|_______|           |) 37.72 332.34 T
(                               ^            |               |) 37.72 324 T
(                               |            |               |) 37.72 315.66 T
(        requests __________    |            |            __________) 37.72 307.33 T
(Client1 ------->| PRODUCER |   |             ---------> | CONSUMER |) 37.72 298.99 T
(Client2 ------->| select\050\051 |   |                        |          |) 37.72 290.65 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(108) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(Client3 ------->|  read\050\051  |---                         |          |) 411.22 695.65 T
(Client4 =======>|  accept\050\051|<-------------------        |__________|) 411.22 687.31 T
(        connect |__________|                    |) 411.22 678.97 T
(                                 Interruptor    |) 411.22 670.63 T
(                                 Pipe           |        __________) 411.22 662.29 T
(                 __________                     |       | CONSUMER |) 411.22 653.95 T
(                | STOPPER  |                    |       |          |) 411.22 645.62 T
(                |          |                    |       |          |) 411.22 637.28 T
(                |stop vars |--------------------        |__________|) 411.22 628.94 T
(                |__________|            \322STOP\323) 411.22 620.6 T
(                                                                ...) 411.22 612.26 T
(*/) 411.22 595.59 T
(#define _POSIX_C_SOURCE 199506L) 411.22 562.23 T
(/* Note that you need to define  __EXTENSIONS__ when using sockets. */) 411.22 553.9 T
(#define __EXTENSIONS__) 411.22 545.56 T
(#include <stdio.h>) 411.22 512.21 T
(#include <sys/types.h>) 411.22 503.87 T
(#include <sys/socket.h>) 411.22 495.53 T
(#include <netinet/in.h>) 411.22 487.19 T
(#include <arpa/inet.h>) 411.22 478.85 T
(#include <pthread.h>) 411.22 470.52 T
(#include <semaphore.h>) 411.22 462.18 T
(#include <time.h>) 411.22 453.84 T
(#include <limits.h>) 411.22 445.5 T
(#include <errno.h>) 411.22 437.16 T
(#include <sys/resource.h>) 411.22 428.82 T
(#include \322thread_extensions.h\323) 411.22 420.49 T
(/* Constants etc. rlimit set to MAX_FDS in main\050\051 */) 411.22 403.81 T
(#define                 MESSAGE_SIZE 70) 411.22 395.47 T
(#define                 READ 0) 411.22 387.13 T
(#define                 WRITE 1) 411.22 378.8 T
(#define                 MAX_FDS  1024) 411.22 370.46 T
(int                     ACTUAL_MAX_FDS=MAX_FDS;) 411.22 362.12 T
( /* String sent by & to client when done */) 411.22 345.44 T
(const char              *END_CLIENT_MSG =) 411.22 337.11 T
(  \322End\1340                                                                   \322;) 411.22 328.77 T
(/* String used by Stopper thread to wake up Producer */) 411.22 320.43 T
(const char              *STOP_MSG =) 411.22 312.09 T
(  \322STOP\1340                                                                  \322;) 411.22 303.75 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 54
%%Page: "mini" 55
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(109) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(/* The structures for clients, and requests */) 37.72 695.65 T
(typedef struct client_struct {) 37.72 678.97 T
(  int                   active;                 /* Is the socket valid? */) 37.72 670.63 T
(  int                   socket;                 /* socket fd */) 37.72 662.29 T
(  char                  name[30];               /* \322Client_123[T@23]\323 */) 37.72 653.95 T
(  int                   outstanding_requests;   /* No. unanswered */) 37.72 645.62 T
(  int                   finishing;              /* \322End\323 received */) 37.72 637.28 T
(  pthread_mutex_t       lock;) 37.72 628.94 T
(  pthread_cond_t        cv;) 37.72 620.6 T
(} client_t;) 37.72 612.26 T
(typedef struct request_struct {) 37.72 595.59 T
(  client_t              *client;) 37.72 587.25 T
(  char                  data[MESSAGE_SIZE]; /* \322Client_7[T@4] Request: 4\323 */) 37.72 578.91 T
(  struct request_struct *next;) 37.72 570.57 T
(} request_t;) 37.72 562.23 T
(/* Optional command line arguments \050+ defaults\051 */) 37.72 520.54 T
(int                     SLEEP = 0, SPIN= 0, N_CONSUMERS=10;) 37.72 512.21 T
(int                     REQUESTED_TCP_PORT = 6500, ACTUAL_TCP_PORT,) 37.72 503.87 T
(                        MAX_PORT_RANGE=100;) 37.72 495.53 T
(int                     STOPPER_SLEEP=-1, KILLER_SLEEP=-1;) 37.72 487.19 T
(/* Array of clients */) 37.72 470.52 T
(client_t                clients[MAX_FDS];) 37.72 462.18 T
(/* Other useful bits */) 37.72 445.5 T
(int                     PID;) 37.72 437.16 T
(pthread_attr_t          attr;) 37.72 428.82 T
(int                     port_socket;) 37.72 420.49 T
(int                     interrupter_pipe[2];) 37.72 412.15 T
(/* Barriers and variables used for shutting down the server */) 37.72 387.13 T
(thread_single_barrier_t producer_barrier;) 37.72 378.8 T
(thread_single_barrier_t stopper_barrier;) 37.72 370.46 T
(thread_barrier_t        consumer_barrier1, consumer_barrier2;) 37.72 362.12 T
(pthread_t               producer_thread;) 37.72 353.78 T
(int                     stop_producer = FALSE;) 37.72 345.44 T
(int                     stop_consumers= FALSE;) 37.72 337.11 T
(/* A List of REQUESTS with protection and related varaibles. */) 37.72 312.09 T
(request_t               *requests =     NULL;) 37.72 303.75 T
(int                     length =        0;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(1) 577.39 268.68 T
(10) 580.57 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(pthread_mutex_t         requests_lock = PTHREAD_MUTEX_INITIALIZER;) 411.22 695.65 T
(pthread_cond_t          producer_cv =   PTHREAD_COND_INITIALIZER;) 411.22 687.31 T
(pthread_cond_t          consumer_cv =   PTHREAD_COND_INITIALIZER;) 411.22 678.97 T
(/* Some function declarations */) 411.22 645.62 T
(client_t *new_client\050int\051;) 411.22 628.94 T
(void *producer\050void *\051;) 411.22 620.6 T
(request_t *get_request\050\051;) 411.22 612.26 T
(void *process_request\050request_t *\051;) 411.22 603.92 T
(/* A bunch of simple helper functions */) 411.22 578.91 T
(void set_up_signal_mask\050\051 {) 411.22 562.23 T
( sigset_t               s, s1, s2;) 411.22 553.9 T
( static struct          sigaction action;) 411.22 545.56 T
(/* Block everything first \050in particular SIGPIPE\051 */) 411.22 528.88 T
( sigfillset\050&s\051;) 411.22 520.54 T
( pthread_sigmask\050SIG_BLOCK, &s, &s2\051;) 411.22 512.21 T
( sigemptyset\050&s\051;) 411.22 503.87 T
( sigaddset\050&s, SIGINT\051;                 /* For ^C */) 411.22 487.19 T
( pthread_sigmask\050SIG_UNBLOCK, &s, &s1\051;) 411.22 478.85 T
(}) 411.22 470.52 T
(/* Keep track of the current number of clients for stats & fd limit */) 411.22 445.5 T
(int client_max_count = 0;) 411.22 437.16 T
(int count_clients\050int i\051 {) 411.22 420.49 T
(  static pthread_mutex_t counter_lock = PTHREAD_MUTEX_INITIALIZER;) 411.22 412.15 T
(  static int             client_count = 0;) 411.22 403.81 T
(  int j;) 411.22 395.47 T
(  pthread_mutex_lock\050&counter_lock\051;) 411.22 378.8 T
(  client_count += i;) 411.22 370.46 T
(  if \050client_count > client_max_count\051) 411.22 362.12 T
(    client_max_count = client_count;) 411.22 353.78 T
(  j = client_count;) 411.22 345.44 T
(  pthread_mutex_unlock\050&counter_lock\051;) 411.22 337.11 T
(  return\050j\051;) 411.22 328.77 T
(}) 411.22 320.43 T
(/* Used for debugging */) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 55
%%Page: "mini" 56
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(1) 203.89 268.68 T
(1) 207.07 268.68 T
(1) 210.25 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(void dump_client_data\050\051 {) 37.72 695.65 T
(  int i;) 37.72 687.31 T
(  for \050i=0; i<ACTUAL_MAX_FDS; i++\051 {) 37.72 670.63 T
(    if \050clients[i].active\051) 37.72 662.29 T
(      printf\050\322%s on fd#%d\134n\323, clients[i].name, clients[i].socket\051;) 37.72 653.95 T
(  }) 37.72 645.62 T
(}) 37.72 637.28 T
(int count_requests\050int i\051 {) 37.72 612.26 T
(  static int count=0;) 37.72 603.92 T
(  static pthread_mutex_t count_lock = PTHREAD_MUTEX_INITIALIZER;) 37.72 595.59 T
( pthread_mutex_lock\050&count_lock\051;) 37.72 578.91 T
( count += i;) 37.72 570.57 T
( i = count;) 37.72 562.23 T
( pthread_mutex_unlock\050&count_lock\051;) 37.72 553.9 T
( return\050i\051;                             /* Can\325t return count */) 37.72 545.56 T
(}) 37.72 537.22 T
(void print_requests\050\051) 37.72 520.54 T
({request_t              *r = requests;) 37.72 512.21 T
( while \050r != NULL\051) 37.72 495.53 T
(   {printf\050\322<Request: %d>\134n\323, r->client->socket\051;) 37.72 487.19 T
(    r = r->next;) 37.72 478.85 T
(  }) 37.72 470.52 T
(}) 37.72 462.18 T
(/* Synchronize on the number of OUTSTANDING REQUESTS per client. */) 37.72 437.16 T
(void wait_for_requests_to_zero\050client_t *client\051 {) 37.72 420.49 T
(  pthread_mutex_lock\050&client->lock\051;) 37.72 412.15 T
(  while \050client->outstanding_requests > 0\051) 37.72 403.81 T
(    pthread_cond_wait\050&client->cv, &client->lock\051;) 37.72 395.47 T
(  pthread_mutex_unlock\050&client->lock\051;) 37.72 387.13 T
(}) 37.72 378.8 T
(int decrement_requests_for\050client_t *client\051 {) 37.72 362.12 T
(  int i;) 37.72 353.78 T
(  pthread_mutex_lock\050&client->lock\051;) 37.72 337.11 T
(  client->outstanding_requests--;) 37.72 328.77 T
(  i = client->outstanding_requests;) 37.72 320.43 T
(  if \050client->outstanding_requests == 0\051) 37.72 312.09 T
(    pthread_cond_signal\050&client->cv\051;) 37.72 303.75 T
(  pthread_mutex_unlock\050&client->lock\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(1) 577.39 268.68 T
(12) 580.57 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  return\050i\051;) 411.22 695.65 T
(}) 411.22 687.31 T
(void increment_requests_for\050client_t *client\051 {) 411.22 670.63 T
(  pthread_mutex_lock\050&client->lock\051;) 411.22 662.29 T
(  client->outstanding_requests++;) 411.22 653.95 T
(  pthread_mutex_unlock\050&client->lock\051;) 411.22 645.62 T
(}) 411.22 637.28 T
(/* Build a new REQUEST */) 411.22 612.26 T
(request_t *new_request\050client_t *client, char *ibuf\051 {) 411.22 595.59 T
(  request_t             *request;) 411.22 587.25 T
(  pthread_t tid = pthread_self\050\051;) 411.22 570.57 T
(  DEBUG\050printf\050\322Server_%d[%s] get_request\050\051 received: \134\323%s\134\323\134n\323,) 411.22 562.23 T
(               PID, thread_name\050tid\051, ibuf\051\051;) 411.22 553.9 T
(  request = \050request_t *\051 malloc\050sizeof\050request_t\051\051;) 411.22 545.56 T
(  request->client = client;) 411.22 537.22 T
(  strcpy\050request->data, ibuf\051;) 411.22 528.88 T
(  count_requests\0501\051;) 411.22 520.54 T
(  increment_requests_for\050client\051;) 411.22 512.21 T
(  pthread_mutex_lock\050&client->lock\051;) 411.22 495.53 T
(  if \050client->name[0] == \324 \324\051 {         /* Hack to get a client name! */) 411.22 487.19 T
(    strncpy\050client->name, ibuf, 18\051;    /* Runs only on first request */) 411.22 478.85 T
(    client->name[18] = 0;) 411.22 470.52 T
(  }) 411.22 462.18 T
(  pthread_mutex_unlock\050&client->lock\051;) 411.22 453.84 T
(  return\050request\051;) 411.22 445.5 T
(}) 411.22 437.16 T
(int delete_request\050request_t *request\051 {) 411.22 412.15 T
(  int i;) 411.22 403.81 T
(  i=decrement_requests_for\050request->client\051;) 411.22 387.13 T
(  free\050request\051;) 411.22 378.8 T
(  return\050i\051;) 411.22 370.46 T
(}) 411.22 362.12 T
(/*) 411.22 328.77 T
(  Send \322End\323 and close the socket.) 411.22 320.43 T
(  It\325s OK if the socket has already been closed.) 411.22 312.09 T
(  This is only called when outstanding_requests == 0.) 411.22 303.75 T
(*/) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 56
%%Page: "mini" 57
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(1) 203.89 268.68 T
(13) 207.07 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(void close_client\050client_t *client\051 {) 37.72 687.31 T
(  int j;) 37.72 678.97 T
(  DEBUG\050printf\050\322Closing socket %s...\134n\323, client->name\051\051;) 37.72 662.29 T
(  pthread_mutex_lock\050&client->lock\051;) 37.72 645.62 T
(  if \050client->socket != -1\051 {                   /* Ensure only close\050\051 once. */) 37.72 637.28 T
(    write\050client->socket, END_CLIENT_MSG, MESSAGE_SIZE\051;   /* Ignore errors */) 37.72 628.94 T
(    close\050client->socket\051;) 37.72 620.6 T
(    client->socket = -1;) 37.72 612.26 T
(    client->active = FALSE;) 37.72 603.92 T
(    client->finishing = FALSE;) 37.72 595.59 T
(    j = count_clients\050-1\051;) 37.72 587.25 T
(    if \050j == 0\051) 37.72 578.91 T
(      DEBUG\050printf\050\322Max open sockets: %d\134n\323, client_max_count\051\051;) 37.72 570.57 T
(    DEBUG\050printf\050\322Closed %s. \050%d active clients\051\134n\323,) 37.72 562.23 T
(                 client->name, count_clients\0500\051\051\051;) 37.72 553.9 T
(  }) 37.72 545.56 T
(  pthread_mutex_unlock\050&client->lock\051;) 37.72 537.22 T
(}) 37.72 528.88 T
(void write_msg\050client_t *client, char *obuf\051 {) 37.72 478.85 T
(  int                   nbytes, socket, active;) 37.72 470.52 T
(  char                  *cname;) 37.72 462.18 T
(  char                  *t_name = thread_name\050pthread_self\050\051\051;) 37.72 453.84 T
(  DEBUG\050printf\050\322Server_%d[%s] write_msg\050\051 sending: \134\323%s\134\323\134n\323,) 37.72 437.16 T
(               PID, t_name, obuf\051\051;) 37.72 428.82 T
(  pthread_mutex_lock\050&client->lock\051;) 37.72 420.49 T
(  socket = client->socket;) 37.72 412.15 T
(  cname  = client->name;) 37.72 403.81 T
(  active = client-> active;) 37.72 395.47 T
(  pthread_mutex_unlock\050&client->lock\051;) 37.72 387.13 T
(  if \050active\051  { /* Another consumer got an error & closed socket */) 37.72 370.46 T
(  retry: nbytes = write\050socket, obuf, MESSAGE_SIZE\051;) 37.72 362.12 T
(  if \050nbytes == MESSAGE_SIZE\051 {) 37.72 345.44 T
(    return;) 37.72 337.11 T
(  }) 37.72 328.77 T
(  if \050nbytes > -1\051 {) 37.72 312.09 T
(    printf\050\322Only wrote %d bytes to %s. \050Impossible?\051\323, nbytes, cname\051;) 37.72 303.75 T
(    abort\050\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(1) 577.39 268.68 T
(14) 580.57 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  }) 411.22 695.65 T
(  if \050errno == EINTR\051 {) 411.22 678.97 T
(    printf\050\322EINTR while trying to write to %s on fd#%d. retrying...\134n\323,) 411.22 670.63 T
(           cname, socket\051;) 411.22 662.29 T
(    goto retry;) 411.22 653.95 T
(  }) 411.22 645.62 T
(  if \050\050errno == EPIPE\051 || \050errno == EBADF\051\051 {) 411.22 628.94 T
(    printf\050\322Failed trying to write to %s. \134n\323, cname\051;) 411.22 620.6 T
(    perror\050\322Closing socket\323\051;) 411.22 612.26 T
(    pthread_mutex_lock\050&client->lock\051;) 411.22 603.92 T
(    client->active = FALSE;) 411.22 595.59 T
(    pthread_mutex_unlock\050&client->lock\051;) 411.22 587.25 T
(    close_client\050client\051;) 411.22 578.91 T
(    return;) 411.22 570.57 T
(  }) 411.22 562.23 T
(  else) 411.22 553.9 T
(    perror\050\322Unknown bug \050Impossible?\051\323\051, abort\050\051;) 411.22 545.56 T
(  }) 411.22 537.22 T
(}) 411.22 528.88 T
(/* Manipulate the requests list. Caller must own requests_lock. */) 411.22 503.87 T
(request_t *remove_request\050\051 {) 411.22 495.53 T
(  request_t *request;) 411.22 487.19 T
(  request = requests;) 411.22 470.52 T
(  requests = requests->next;) 411.22 462.18 T
(  length--;) 411.22 453.84 T
(  return\050request\051;) 411.22 445.5 T
(}) 411.22 437.16 T
(void add_request\050request_t *request\051 {) 411.22 420.49 T
(  request->next = requests;                     /* Insert at head of list */) 411.22 412.15 T
(  requests = request;) 411.22 403.81 T
(  length++;) 411.22 395.47 T
(}) 411.22 387.13 T
(int open_port\050\051 {) 411.22 362.12 T
(  struct sockaddr_in    cli_addr, serv_addr;) 411.22 353.78 T
(  int                   port_socket, clilen, i;) 411.22 345.44 T
(  /* Open a new port. Try to get requested port. */) 411.22 328.77 T
(  if\050\050port_socket = socket\050AF_INET, SOCK_STREAM, 0\051\051 < 0\051) 411.22 320.43 T
(    perror\050\322Can\325t create new socket\323\051, abort\050\051;) 411.22 312.09 T
(  for \050i=REQUESTED_TCP_PORT; i< REQUESTED_TCP_PORT+MAX_PORT_RANGE; i++\051 {) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 57
%%Page: "mini" 58
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(1) 203.89 268.68 T
(15) 207.07 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    memset\050\050char *\051 &serv_addr, 0, sizeof\050serv_addr\051\051;) 37.72 695.65 T
(    serv_addr.sin_family = AF_INET;) 37.72 687.31 T
(    serv_addr.sin_addr.s_addr = htonl\050INADDR_ANY\051;) 37.72 678.97 T
(    serv_addr.sin_port = htons\050i\051;) 37.72 670.63 T
(    if \050bind\050port_socket, \050struct sockaddr *\051&serv_addr, sizeof\050serv_addr\051\051<0\051) 37.72 662.29 T
(      {DEBUG\050printf\050\322Can\325t bind to port %d\134n\323, i\051\051;}) 37.72 653.95 T
(    else {) 37.72 645.62 T
(      printf\050\322Server bound to port: %d\134n\323, i\051;) 37.72 637.28 T
(      ACTUAL_TCP_PORT=i;) 37.72 628.94 T
(      listen\050port_socket, 5\051;) 37.72 620.6 T
(      return\050port_socket\051;) 37.72 612.26 T
(    }) 37.72 603.92 T
(  }) 37.72 595.59 T
(  printf\050\322Could not find an available port from %d to %d\323,) 37.72 587.25 T
(         REQUESTED_TCP_PORT, REQUESTED_TCP_PORT+MAX_PORT_RANGE\051;) 37.72 578.91 T
(  abort\050\051;) 37.72 570.57 T
(}) 37.72 562.23 T
(/* This will never block. Only called when select\050\051 indicates a new client. */) 37.72 537.22 T
(client_t *accept_a_connection\050int port_socket\051 {) 37.72 528.88 T
(  int                   new_socket, clilen;) 37.72 520.54 T
(  struct sockaddr_in    cli_addr;) 37.72 512.21 T
(  clilen = sizeof\050cli_addr\051;) 37.72 495.53 T
(  new_socket = accept\050port_socket, \050struct sockaddr *\051 &cli_addr, &clilen\051;) 37.72 487.19 T
(  if \050new_socket < 0\051) 37.72 478.85 T
(    perror\050\322Accept failed. \050Impossible?\051\323\051, abort\050\051;) 37.72 470.52 T
(  return\050new_client\050new_socket\051\051;) 37.72 453.84 T
(}) 37.72 445.5 T
(void *reporter\050void *arg\051 {) 37.72 420.49 T
(  while \050TRUE\051 {) 37.72 403.81 T
(    sleep\05030\051;) 37.72 395.47 T
(    printf\050\322Server up on port %d. Processed %d requests. %d currently connected) 37.72 387.13 T
(clients.\134n\323,) 37.72 378.8 T
(           ACTUAL_TCP_PORT, count_requests\0500\051, count_clients\0500\051\051;) 37.72 370.46 T
(  }) 37.72 362.12 T
(}) 37.72 353.78 T
(int startup_initialize\050\051 {) 37.72 328.77 T
(  int           i;) 37.72 320.43 T
(  struct rlimit         r;) 37.72 312.09 T
(  set_up_signal_mask\050\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(1) 577.39 268.68 T
(16) 580.57 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  thread_barrier_init\050&consumer_barrier1, N_CONSUMERS+1\051;) 411.22 687.31 T
(  thread_barrier_init\050&consumer_barrier2, N_CONSUMERS+1\051;) 411.22 678.97 T
(  thread_single_barrier_init\050&producer_barrier, 1\051;) 411.22 670.63 T
(  thread_single_barrier_init\050&stopper_barrier, 1\051;) 411.22 662.29 T
(  PTHREAD_ATTR_INIT\050&attr\051;) 411.22 653.95 T
(  pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 411.22 645.62 T
(  pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 411.22 637.28 T
(  getrlimit\050RLIMIT_NOFILE, &r\051;) 411.22 620.6 T
(  r.rlim_cur=r.rlim_max;) 411.22 612.26 T
(  ACTUAL_MAX_FDS = r.rlim_max-10;) 411.22 603.92 T
(  setrlimit\050RLIMIT_NOFILE, &r\051;) 411.22 595.59 T
(  /*  getrlimit\050RLIMIT_NOFILE, &r\051;) 411.22 587.25 T
(      printf\050\322Current limit: %d Max limit: %d\134n\323, r.rlim_cur, r.rlim_max\051; */) 411.22 578.91 T
(  for \050i=0; i<ACTUAL_MAX_FDS; i++\051 {) 411.22 553.9 T
(    pthread_mutex_init\050&clients[i].lock, NULL\051;) 411.22 545.56 T
(  }) 411.22 537.22 T
(}) 411.22 528.88 T
(int initialize_clients\050\051 {) 411.22 503.87 T
(  int i;) 411.22 495.53 T
(  client_t *client;) 411.22 487.19 T
(  count_clients\050-count_clients\0500\051\051; /* Zero it out */) 411.22 470.52 T
(  for \050i=0; i<ACTUAL_MAX_FDS; i++\051 {) 411.22 462.18 T
(    client = &clients[i];) 411.22 453.84 T
(    pthread_mutex_lock\050&client->lock\051;) 411.22 445.5 T
(    close\050client->socket\051;      /* Could be left open by dirty exit */) 411.22 437.16 T
(    client->socket = -1;) 411.22 428.82 T
(    client->name[0] = \324 \324;) 411.22 420.49 T
(    client->active = FALSE;) 411.22 412.15 T
(    client->finishing = FALSE;) 411.22 403.81 T
(    client->outstanding_requests = 0;) 411.22 395.47 T
(    pthread_mutex_unlock\050&client->lock\051;) 411.22 387.13 T
(  }) 411.22 378.8 T
(  if \050pipe\050interrupter_pipe\051 < 0\051) 411.22 362.12 T
(    printf\050\322Can\325t open Interruptor pipe\134n\323\051, abort\050\051;) 411.22 353.78 T
(  /* clients[0] is the local socket for announcing new clients. */) 411.22 337.11 T
(  clients[0].socket = interrupter_pipe[READ];) 411.22 328.77 T
(  strcpy\050clients[0].name, \322Interruptor\323\051;) 411.22 320.43 T
(  clients[0].active = TRUE;) 411.22 312.09 T
(  port_socket = open_port\050\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 58
%%Page: "mini" 59
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(1) 203.89 268.68 T
(17) 207.07 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  /* clients[1] is the local socket for announcing new clients. */) 37.72 695.65 T
(  clients[1].socket = port_socket;) 37.72 687.31 T
(  strcpy\050clients[1].name, \322Acceptor\323\051;) 37.72 678.97 T
(  clients[1].active = TRUE;) 37.72 670.63 T
(}) 37.72 645.62 T
(client_t *new_client\050int socket\051 {) 37.72 595.59 T
(  int i, c;) 37.72 587.25 T
(  client_t *client;) 37.72 578.91 T
(  for \050i=0; i<ACTUAL_MAX_FDS; i++\051 { /* Find an open slot in array */) 37.72 562.23 T
(    client=&clients[i];) 37.72 553.9 T
(    pthread_mutex_lock\050&client->lock\051;) 37.72 545.56 T
(    if \050!client->active & \050client->outstanding_requests == 0\051\051 {) 37.72 528.88 T
(      /* If client died dirty, there could still be outstanding requests. */) 37.72 520.54 T
(      client = &clients[i];) 37.72 512.21 T
(      client->socket = socket;) 37.72 503.87 T
(      client->active = TRUE;) 37.72 495.53 T
(      client->outstanding_requests=0;) 37.72 487.19 T
(      client->finishing = FALSE;) 37.72 478.85 T
(      client->name[0] = \324 \324;         /* Hack! \050see new_request\050\051\051 */) 37.72 470.52 T
(      c =count_clients\0501\051;) 37.72 462.18 T
(      DEBUG\050printf\050\322New Client fd#%d. \050%d active clients\051\134n\323,) 37.72 453.84 T
(                   socket, c\051\051;) 37.72 445.5 T
(      pthread_mutex_unlock\050&client->lock\051;) 37.72 437.16 T
(      return\050client\051;) 37.72 428.82 T
(    }) 37.72 420.49 T
(    pthread_mutex_unlock\050&client->lock\051;) 37.72 403.81 T
(  }) 37.72 395.47 T
(  pthread_mutex_unlock\050&client->lock\051;) 37.72 378.8 T
(  write\050socket, END_CLIENT_MSG, MESSAGE_SIZE\051;             /* Ignore errors */) 37.72 370.46 T
(  close\050socket\051;) 37.72 362.12 T
(  printf\050\322Too many clients \050max = %d\051. Ignoring new one.\134n\323, ACTUAL_MAX_FDS-2\051;) 37.72 353.78 T
(}) 37.72 345.44 T
(/* Wait for any client to send a request & return that request. */) 37.72 320.43 T
(/* Only one thread may call get_request\050\051. */) 37.72 312.09 T
(request_t *get_request\050\051 {) 37.72 303.75 T
(  fd_set                readset, errorset;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(1) 577.39 268.68 T
(18) 580.57 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  int                   i, num_ready, num_now, nbytes, socket;) 411.22 695.65 T
(  char                  buf[MESSAGE_SIZE];) 411.22 687.31 T
(  request_t             *request;) 411.22 678.97 T
(  client_t              *client;) 411.22 670.63 T
(  pthread_t             tid = pthread_self\050\051;) 411.22 662.29 T
(  while \050TRUE\051 {) 411.22 637.28 T
(    /* Reset the bit arrays for select\050\051 */) 411.22 620.6 T
(    FD_ZERO\050&readset\051;) 411.22 612.26 T
(    FD_ZERO\050&errorset\051;) 411.22 603.92 T
(    for \050i = 0; i < ACTUAL_MAX_FDS; i++\051 {) 411.22 595.59 T
(      client = &clients[i];) 411.22 587.25 T
(      pthread_mutex_lock\050&client->lock\051;) 411.22 578.91 T
(      if \050client->active\051 {) 411.22 570.57 T
(        FD_SET\050client->socket, &readset\051;) 411.22 562.23 T
(        FD_SET\050client->socket, &errorset\051;) 411.22 553.9 T
(      }) 411.22 545.56 T
(      pthread_mutex_unlock\050&client->lock\051;) 411.22 537.22 T
(    }) 411.22 528.88 T
(    num_ready = select\050OPEN_MAX, &readset, 0, &errorset, 0\051;) 411.22 512.21 T
(    /* Time to exit? */) 411.22 495.53 T
(    pthread_mutex_lock\050&requests_lock\051;) 411.22 487.19 T
(    if \050stop_producer\051 {) 411.22 478.85 T
(      pthread_mutex_unlock\050&requests_lock\051;) 411.22 470.52 T
(      return\050NULL\051;           /* Clean exit */) 411.22 462.18 T
(    }) 411.22 453.84 T
(    pthread_mutex_unlock\050&requests_lock\051;) 411.22 445.5 T
(    if \050num_ready < 0\051 {) 411.22 420.49 T
(      if \050errno == EBADF\051 goto bottom;  /* An fd was closed, retry */) 411.22 412.15 T
(      perror\050\322Error in select\050\051. Impossible\323\051; abort\050\051;) 411.22 403.81 T
(    }) 411.22 395.47 T
(    /* Find the socket with data ready */) 411.22 370.46 T
(    for \050i = 0; i < ACTUAL_MAX_FDS;  i++\051 {) 411.22 362.12 T
(      client = &clients[i];) 411.22 353.78 T
(      pthread_mutex_lock\050&client->lock\051;) 411.22 345.44 T
(      if \050client->active && FD_ISSET\050client->socket, &errorset\051\051 {) 411.22 328.77 T
(        /* Error condition pending on this fd. \050What does that mean??\051 */) 411.22 320.43 T
(        client->active = FALSE;) 411.22 312.09 T
(        pthread_mutex_unlock\050&client->lock\051;) 411.22 303.75 T
(        close_client\050client\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 59
%%Page: "mini" 60
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(1) 203.89 268.68 T
(19) 207.07 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(        printf\050\322Error condition on %s, fd#%d from select\050\051. Impossible?\134n\323,) 37.72 695.65 T
(               client->name, client->socket\051;) 37.72 687.31 T
(        goto bottom;) 37.72 678.97 T
(      }) 37.72 670.63 T
(      if \050client->active && FD_ISSET\050client->socket, &readset\051\051 {) 37.72 645.62 T
(        /* This is the socket with data ready! */) 37.72 637.28 T
(        socket = client->socket;) 37.72 628.94 T
(        pthread_mutex_unlock\050&client->lock\051;) 37.72 620.6 T
(        if \050i == 1\051 {) 37.72 603.92 T
(          DEBUG\050printf\050\322Accepting...\134n\323\051\051;) 37.72 595.59 T
(          accept_a_connection\050socket\051;) 37.72 587.25 T
(          goto bottom;) 37.72 578.91 T
(        }) 37.72 570.57 T
(        nbytes = read\050socket, buf, MESSAGE_SIZE\051;) 37.72 562.23 T
(        if \050\050nbytes == -1\051 || \050nbytes != MESSAGE_SIZE\051\051 {) 37.72 545.56 T
(          printf\050\322Read only %d bytes on %s!\134n\323, nbytes, client->name\051;) 37.72 537.22 T
(          if \050i == 0\051 {) 37.72 528.88 T
(            printf\050\322Interrupt pipe failed. Impossible!\134n\323\051;) 37.72 520.54 T
(            abort\050\051;) 37.72 512.21 T
(          }) 37.72 503.87 T
(          pthread_mutex_lock\050&client->lock\051;) 37.72 495.53 T
(          client->active = FALSE;) 37.72 487.19 T
(          pthread_mutex_unlock\050&client->lock\051;) 37.72 478.85 T
(          close_client\050client\051;) 37.72 470.52 T
(          goto bottom;) 37.72 462.18 T
(        }) 37.72 453.84 T
(        if \050i == 0\051 {    /* Should have exited on stop_producer */) 37.72 437.16 T
(          printf\050\322Bogus message on Interruptor. Impossible!\134n\323\051;) 37.72 428.82 T
(          abort\050\051;) 37.72 420.49 T
(        }) 37.72 412.15 T
(        if \050nbytes == MESSAGE_SIZE\051 {/* All is well, return new request_t. */) 37.72 395.47 T
(          DEBUG\050printf\050\322Server_%d[%s] get_request\050\051 received: \134\323%s\134\323\134n\323,) 37.72 387.13 T
(                       PID, thread_name\050tid\051, buf\051\051;) 37.72 378.8 T
(          request = new_request\050client, buf\051;) 37.72 370.46 T
(          return\050request\051;) 37.72 362.12 T
(        }) 37.72 353.78 T
(      }) 37.72 345.44 T
(      pthread_mutex_unlock\050&client->lock\051;) 37.72 337.11 T
(    }) 37.72 328.77 T
(    /* select\050\051 returned 0 ready, or failed to set readset */) 37.72 312.09 T
(    if \050num_ready == 0\051) 37.72 303.75 T
(      printf\050\322select\050\051 returned 0 ready. Impossible?\134n\323\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(120) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    else) 411.22 695.65 T
(      printf\050\322select\050\051 returned %d ready \050readset not set\051 Impossible?\134n\323,) 411.22 687.31 T
(             num_ready\051;) 411.22 678.97 T
(    abort\050\051;) 411.22 670.63 T
(  bottom: {}) 411.22 653.95 T
(  }     /* End while\050TRUE\051 */) 411.22 645.62 T
(}) 411.22 637.28 T
(/* Send a reply back to client */) 411.22 620.6 T
(void *process_request\050request_t *request\051 {) 411.22 612.26 T
(  client_t              *client = request->client;) 411.22 603.92 T
(  char                  *cname;) 411.22 595.59 T
(  char                  obuf[MESSAGE_SIZE];) 411.22 587.25 T
(  char                  *t_name = thread_name\050pthread_self\050\051\051;) 411.22 578.91 T
(  int                   i, nbytes, finishing, socket;) 411.22 570.57 T
(  DEBUG\050printf\050\322Server_%d[%s] processing: \134\323%s\134\323\134n\323,) 411.22 553.9 T
(               PID, t_name, request->data\051\051;) 411.22 545.56 T
(    pthread_mutex_lock\050&client->lock\051;) 411.22 528.88 T
(    socket = client->socket;) 411.22 520.54 T
(    cname = client->name;) 411.22 512.21 T
(    pthread_mutex_unlock\050&client->lock\051;) 411.22 503.87 T
(    if \050strncmp\050request->data, END_CLIENT_MSG, 3\051 == 0\051 {) 411.22 487.19 T
(      pthread_mutex_lock\050&client->lock\051;) 411.22 478.85 T
(      client->finishing = TRUE;) 411.22 470.52 T
(      pthread_mutex_unlock\050&client->lock\051;) 411.22 462.18 T
(    }) 411.22 453.84 T
(    else {) 411.22 445.5 T
(      delay\050SLEEP, SPIN\051;) 411.22 437.16 T
(      sprintf\050obuf, \322Server_%d[%s] reply %d to %s\323,) 411.22 428.82 T
(              PID, t_name, count_requests\0501\051, request->data\051;) 411.22 420.49 T
(      write_msg\050client, obuf\051;) 411.22 412.15 T
(    }) 411.22 403.81 T
(  i = delete_request\050request\051;) 411.22 395.47 T
(  if \050i == 0\051 {) 411.22 387.13 T
(    pthread_mutex_lock\050&client->lock\051;) 411.22 378.8 T
(    finishing = client->finishing;) 411.22 370.46 T
(    pthread_mutex_unlock\050&client->lock\051;) 411.22 362.12 T
(    if \050finishing\051 close_client\050client\051;) 411.22 353.78 T
(  }) 411.22 345.44 T
(}) 411.22 337.11 T
(void *producer\050void *arg\051 {) 411.22 328.77 T
(  request_t *request;) 411.22 320.43 T
(  int j;) 411.22 312.09 T
(  DEBUG\050printf\050\322Producer starting.\134n\323\051\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 60
%%Page: "mini" 61
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(121) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  set_up_signal_mask\050\051;) 37.72 695.65 T
(  while \050TRUE\051 {) 37.72 678.97 T
(    request = get_request\050\051;) 37.72 670.63 T
(    if \050request == NULL\051 {) 37.72 653.95 T
(      pthread_mutex_lock\050&requests_lock\051;) 37.72 645.62 T
(      if \050!stop_producer\051 {) 37.72 637.28 T
(        printf\050\322get_request\050\051 returned NULL w/o stop. Impossible.\323\051;) 37.72 628.94 T
(        abort\050\051;) 37.72 620.6 T
(      }) 37.72 612.26 T
(      pthread_mutex_unlock\050&requests_lock\051;) 37.72 603.92 T
(      DEBUG\050printf\050\322Producer exiting via get_request\050\051.\134n\323\051\051;) 37.72 595.59 T
(      thread_single_barrier_post\050&producer_barrier\051;) 37.72 587.25 T
(      pthread_exit\050NULL\051;) 37.72 578.91 T
(    }) 37.72 570.57 T
(    pthread_mutex_lock\050&requests_lock\051;) 37.72 545.56 T
(    while \050\050length >= 10\051 && \050!stop_producer\051\051) 37.72 537.22 T
(      pthread_cond_wait\050&producer_cv, &requests_lock\051;) 37.72 528.88 T
(    add_request\050request\051;) 37.72 520.54 T
(    if \050stop_producer\051 break;) 37.72 512.21 T
(    pthread_mutex_unlock\050&requests_lock\051;) 37.72 503.87 T
(    pthread_cond_signal\050&consumer_cv\051;) 37.72 495.53 T
(  }) 37.72 487.19 T
(  pthread_mutex_unlock\050&requests_lock\051;) 37.72 462.18 T
(  DEBUG\050printf\050\322Producer exiting via wait.\134n\323\051\051;) 37.72 453.84 T
(  thread_single_barrier_post\050&producer_barrier\051;) 37.72 445.5 T
(  pthread_exit\050NULL\051;) 37.72 437.16 T
(}) 37.72 428.82 T
(void *consumer\050void *arg\051 {) 37.72 403.81 T
(  request_t *request;) 37.72 395.47 T
(  DEBUG\050printf\050\322Consumer starting.\134n\323\051\051;) 37.72 378.8 T
(  set_up_signal_mask\050\051;) 37.72 370.46 T
(  while\050TRUE\051 {) 37.72 353.78 T
(    pthread_mutex_lock\050&requests_lock\051;) 37.72 345.44 T
(    while \050\050length == 0\051 && \050!stop_consumers\051\051) 37.72 337.11 T
(      pthread_cond_wait\050&consumer_cv, &requests_lock\051;) 37.72 328.77 T
(    if \050\050length == 0\051 && \050stop_consumers\051\051 {) 37.72 320.43 T
(      /* Empty the queue first, then indicate done. */) 37.72 312.09 T
(      pthread_mutex_unlock\050&requests_lock\051;) 37.72 303.75 T
(      thread_barrier_wait\050&consumer_barrier1\051; /* consumers are stopped */) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(122) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(      thread_barrier_wait\050&consumer_barrier2\051; /* consumers may continue */) 411.22 695.65 T
(      continue;         /* Continue when everyone is done. */) 411.22 687.31 T
(    }) 411.22 678.97 T
(    request = remove_request\050\051;) 411.22 670.63 T
(    pthread_mutex_unlock\050&requests_lock\051;) 411.22 662.29 T
(    pthread_cond_signal\050&producer_cv\051;) 411.22 653.95 T
(    process_request\050request\051;) 411.22 645.62 T
(  }) 411.22 637.28 T
(}) 411.22 628.94 T
(void *stopper\050void *arg\051 {) 411.22 595.59 T
(  pthread_t waker_thread;) 411.22 587.25 T
(  sleep\050STOPPER_SLEEP\051;) 411.22 570.57 T
(  printf\050\322Time to stop!\134n\323\051;) 411.22 562.23 T
(  /* Wake up producer if blocked in select\050\051 wait\050\051 */) 411.22 545.56 T
(  pthread_mutex_lock\050&requests_lock\051;) 411.22 537.22 T
(  stop_producer = TRUE;) 411.22 528.88 T
(  pthread_mutex_unlock\050&requests_lock\051;) 411.22 520.54 T
(  pthread_cond_broadcast\050&producer_cv\051;) 411.22 512.21 T
(  /* Wake producer */) 411.22 503.87 T
(  write\050interrupter_pipe[WRITE], STOP_MSG, MESSAGE_SIZE\051;) 411.22 495.53 T
(  thread_single_barrier_wait\050&producer_barrier\051;) 411.22 487.19 T
(  close\050interrupter_pipe[WRITE]\051;) 411.22 478.85 T
(  /* Wake up all CV sleepers and stop them last. Otherwise the producer) 411.22 453.84 T
(   could still add a request after they all stopped. */) 411.22 445.5 T
(  pthread_mutex_lock\050&requests_lock\051;) 411.22 437.16 T
(  stop_consumers=TRUE;) 411.22 428.82 T
(  pthread_mutex_unlock\050&requests_lock\051;) 411.22 420.49 T
(  pthread_cond_broadcast\050&consumer_cv\051;) 411.22 412.15 T
(  thread_barrier_wait\050&consumer_barrier1\051;) 411.22 403.81 T
(  DEBUG\050printf\050\322Stopper finished.\134n\323\051\051;) 411.22 387.13 T
(  thread_single_barrier_post\050&stopper_barrier\051;) 411.22 378.8 T
(  pthread_exit\050NULL\051;) 411.22 370.46 T
(}) 411.22 362.12 T
(main\050int argc, char **argv\051 {) 411.22 345.44 T
(  int                   i, j;) 411.22 337.11 T
(  pthread_t             tid;) 411.22 328.77 T
(  PID = getpid\050\051;) 411.22 303.75 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 61
%%Page: "mini" 62
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(123) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  if \050argc > 1\051 REQUESTED_TCP_PORT = atoi\050argv[1]\051;) 37.72 695.65 T
(  if \050argc > 2\051 SLEEP = atoi\050argv[2]\051;) 37.72 687.31 T
(  if \050argc > 3\051 SPIN = atoi\050argv[3]\051;) 37.72 678.97 T
(  if \050argc > 4\051 N_CONSUMERS = atoi\050argv[4]\051;) 37.72 670.63 T
(  if \050argc > 5\051 STOPPER_SLEEP = atoi\050argv[5]\051;) 37.72 662.29 T
(  if \050argc > 6\051 KILLER_SLEEP = atoi\050argv[6]\051;) 37.72 653.95 T
(  printf\050\322Server_%d\050TCP_PORT %d SLEEP %dms SPIN %dus N_CONSUMERS \134) 37.72 645.62 T
(%d STOPPER %ds KILLER %ds\051\134n\323,) 37.72 637.28 T
(         PID, REQUESTED_TCP_PORT, SLEEP, SPIN, N_CONSUMERS,) 37.72 628.94 T
(         STOPPER_SLEEP, KILLER_SLEEP\051;) 37.72 620.6 T
(  startup_initialize\050\051;) 37.72 603.92 T
(  for \050i=0; i<N_CONSUMERS; i++\051 {) 37.72 587.25 T
(    PTHREAD_CREATE\050&tid, &attr, consumer, \050void *\051 NULL\051;) 37.72 578.91 T
(  }) 37.72 570.57 T
(  PTHREAD_CREATE\050&tid, &attr, reporter, NULL\051;) 37.72 553.9 T
(  for \050j=0; j<1000; j++\051 {         /* Start/Stop 1000 times */) 37.72 537.22 T
(    printf\050\322Starting up interation %d.\134n\323, j\051;) 37.72 528.88 T
(    initialize_clients\050\051;) 37.72 520.54 T
(    PTHREAD_CREATE\050&producer_thread, &attr, producer, \050void *\051 NULL\051;) 37.72 503.87 T
(    if \050STOPPER_SLEEP > 0\051) 37.72 495.53 T
(      PTHREAD_CREATE\050&tid, &attr, stopper, \050void *\051 NULL\051;) 37.72 487.19 T
(    if \050KILLER_SLEEP > 0\051) 37.72 478.85 T
(      PTHREAD_CREATE\050&tid, &attr, killer, \050void *\051 KILLER_SLEEP\051;) 37.72 470.52 T
(    thread_single_barrier_wait\050&stopper_barrier\051;) 37.72 453.84 T
(    printf\050\322Shutdown successful. %d replies sent.\134n\134n\134n\323, count_requests\0500\051\051;) 37.72 445.5 T
(    pthread_mutex_lock\050&requests_lock\051;) 37.72 428.82 T
(    stop_producer=FALSE;) 37.72 420.49 T
(    stop_consumers=FALSE;) 37.72 412.15 T
(    pthread_mutex_unlock\050&requests_lock\051;) 37.72 403.81 T
(    thread_barrier_wait\050&consumer_barrier2\051; /* NOW restart consumers */) 37.72 395.47 T
(  }) 37.72 387.13 T
(  printf\050\322Exiting Server Normally after 1000 iterations.\134n\323\051;) 37.72 378.8 T
(}) 37.72 370.46 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(124) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
411.22 287.67 754.28 700.41 C
411.22 327.77 728.62 693.26 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
669.08 685.73 669.08 367.71 2 L
0.6 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
664.42 476.83 673.75 669.78 R
7 X
V
0.3 H
0 X
N
664.42 424.61 673.75 476.83 R
7 X
V
0 X
N
2 8.34 Q
(T@1) 0 -90 666.66 359.65 TF
467.91 610.72 477.24 640.54 R
N
481.55 413.26 484.35 413.26 2 L
0 Z
N
481.7 414.79 484.35 413.26 481.7 411.73 3 L
N
471.61 413.26 481.55 413.26 2 L
2 Z
N
(W) 0 -90 459.37 642.06 TF
(orking) 0 -90 459.37 634.69 TF
(Sleeping) 0 -90 458.55 523.82 TF
(Signal) 0 -90 461.41 425.77 TF
469.96 496.77 475.18 516.12 R
3 X
V
0 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
535.61 684.26 535.61 369.32 2 L
0.6 H
N
4 F
(settimer\0503,fn,T@1\051) 0 -90 681.16 572.34 TF
(call_device\050\051) 0 -90 653.59 581.49 TF
(handler\050\051) 0 -90 653.55 475.86 TF
520.72 499.99 523.52 499.99 2 L
0.3 H
0 Z
N
520.87 501.52 523.52 499.99 520.87 498.47 3 L
N
510.78 499.99 520.72 499.99 2 L
2 Z
N
530.95 465.95 540.28 499.99 R
7 X
V
0 X
N
2 F
(SIGALRM) 0 -90 498.35 540.49 TF
648.12 476.71 650.92 476.71 2 L
0 Z
N
648.27 478.24 650.92 476.71 648.27 475.18 3 L
N
560.74 476.71 648.12 476.71 2 L
2 Z
N
(SIGUSR1) 0 -90 591.77 472.58 TF
664.42 372.94 673.75 424.61 R
7 X
V
0 X
N
533.01 499.99 538.22 661.78 R
3 X
V
0 X
N
533.01 380.83 538.22 465.95 R
3 X
V
0 X
N
(W) 0 -90 533.54 362.65 TF
(aiter) 0 -90 533.54 355.11 TF
530.95 639.56 540.28 678.74 R
7 X
V
0 X
N
4 F
(fn\050T@1\051) 0 -90 547.68 507.86 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(sigwait\050\051) 0 -90 547.63 646.52 TF
605.5 549.18 620.27 630.22 R
0.6 H
0 Z
N
620.27 589.53 605.5 589.53 2 L
2 Z
N
90 450 2.94 2.95 270 613.46 556.34 GG
90 450 2.94 2.95 270 613.46 556.34 AA
2 10.72 Q
(fn T@1 1:10) 0 -90 610.29 626.79 TF
620.27 615.21 605.5 615.21 2 L
N
4 8.34 Q
(setjmp\050\051) 0 -90 681.16 651.67 TF
(longjmp\050\051) 0 -90 681.16 472.5 TF
620.27 564.62 605.5 564.62 2 L
N
575.08 600.53 576.85 600.62 575.39 594.36 573.31 600.44 4 Y
0.3 H
0 Z
N
575.08 600.53 576.85 600.62 575.39 594.36 573.31 600.44 4 Y
V
613.41 555.61 M
 617.16 547.53 612.93 531.78 601.62 541.87 D
 583.85 557.72 604.06 590.06 586.5 611.4 D
 583.29 615.29 574.67 608.66 575.07 600.68 D
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
568.39 511.01 583.15 592.06 R
0.6 H
0 Z
N
583.15 551.36 568.39 551.36 2 L
2 Z
N
90 450 2.94 2.95 270 576.35 518.18 GG
90 450 2.94 2.95 270 576.35 518.18 AA
2 10.72 Q
(fb T@2 1:12) 0 -90 573.18 588.63 TF
583.16 577.05 568.39 577.05 2 L
N
583.16 526.45 568.39 526.45 2 L
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 8.34 Q
(PC=x0123) 0 -90 667.84 649.24 TF
(PC=x0123!) 0 -90 667.41 423.61 TF
673.51 581.77 664.51 581.77 2 L
0.3 H
N
2 19.06 Q
(Signals and Timer) 0 -90 705.48 601.47 TF
(s) 0 -90 705.48 437.58 TF
[4.103 4.103] 0 I
641.71 666.46 M
 641.71 669.42 639.31 671.82 636.35 671.82 D
 633.39 671.82 630.99 669.42 630.99 666.46 D
 630.99 663.5 633.39 661.1 636.35 661.1 D
 639.31 661.1 641.71 663.5 641.71 666.46 D
O
V
0.6 H
N
J
613.1 643.97 614.87 643.82 612.58 637.82 611.34 644.13 4 Y
0.3 H
0 Z
N
613.1 643.97 614.87 643.82 612.58 637.82 611.34 644.13 4 Y
V
636.35 666.46 M
 640.18 658.87 634.08 642.77 624.44 650.75 D
 621.41 653.26 618.5 661.8 614.73 656.34 D
 612.01 652.41 613.47 648.25 613.12 644.12 D
2 Z
N
4 8.34 Q
(% callout_tests) 0 -90 427.44 606.07 TF
411.22 287.67 754.28 700.41 C
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 62
%%Page: "mini" 63
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(125) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Creating Thread-Local) 95.47 686.11 T
(Signals:callout_tests.c) 93.07 657.53 T
4 7.15 Q
(   /*                callout_tests.c                */) 37.72 624.17 T
(/*) 37.72 607.5 T
(================================================================) 37.72 599.16 T
(  I want to read from an unreliable device and interrupt it if) 37.72 590.82 T
(it should fail to return from the read after some amount of time.) 37.72 582.48 T
(So I set a per-thread timer and longjmp\050\051 out of the device) 37.72 574.15 T
(driver should it expire.) 37.72 565.81 T
(================================================================) 37.72 557.47 T
(cc -o callout_tests callout_tests.c -L. -R. -lcallout -g  -lpthread -lthread -) 37.72 532.45 T
(pthread_extensions -lposix4) 37.72 524.12 T
(*/) 37.72 515.78 T
(#define _POSIX_C_SOURCE 199506L) 37.72 499.1 T
(#include <signal.h>) 37.72 482.43 T
(#include <stdio.h>) 37.72 474.09 T
(#include <assert.h>) 37.72 465.75 T
(#include <pthread.h>) 37.72 457.41 T
(#include <setjmp.h>) 37.72 449.07 T
(#include \322callout.h\323) 37.72 440.74 T
(#include \322thread_extensions.h\323) 37.72 432.4 T
(int                     TIMEOUT = 3, DEVICE_SPEED = 3;) 37.72 382.37 T
(pthread_key_t           JMPBUF_KEY;) 37.72 374.03 T
(void my_SigHandler\050int signo\051) 37.72 349.02 T
({void                   *envp;) 37.72 340.68 T
( pthread_t              tid = pthread_self\050\051;) 37.72 332.34 T
( char                   *name = thread_name\050tid\051;) 37.72 324 T
( /*   Note that printf\050\051 and thread_name\050\051 are not signal safe! */) 37.72 307.33 T
( printf\050\322Got signal in thread: %s. Signal %d\134n\323, name, signo\051;) 37.72 298.99 T
( envp = pthread_getspecific\050JMPBUF_KEY\051;) 37.72 290.65 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(126) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( siglongjmp\050\050int *\051 envp, 1\051;) 411.22 695.65 T
(}) 411.22 687.31 T
(void slow_device_interrupter\050void *arg\051) 411.22 670.63 T
({pthread_t *ptid;) 411.22 662.29 T
( ptid = \050pthread_t *\051 arg;) 411.22 645.62 T
( printf\050\322Interrupting the device on thread %s...\134n\323, thread_name \050*ptid\051\051;) 411.22 637.28 T
( pthread_kill\050*ptid, SIGUSR1\051;   /* Interrupt the device. */) 411.22 628.94 T
(}) 411.22 620.6 T
(device_read\050int speed\051  /* Fake a read from the actual device */) 411.22 595.59 T
({) 411.22 587.25 T
(  delay\050speed*1000, 0\051;) 411.22 578.91 T
(}) 411.22 570.57 T
(void call_device\050int speed, int timeout\051) 411.22 545.56 T
({int                    timer_number;) 411.22 537.22 T
( pthread_t              tid = pthread_self\050\051;) 411.22 528.88 T
( timer_number = thread_settimer\050timeout, slow_device_interrupter,) 411.22 512.21 T
(                                 \050void *\051 &tid\051; /* Should not pass tid! */) 411.22 503.87 T
( device_read\050speed\051;) 411.22 495.53 T
( thread_deletetimer\050timer_number\051;) 411.22 487.19 T
( printf\050\322Device responded in time!\134n\323\051;) 411.22 478.85 T
(}) 411.22 470.52 T
(/* This thread doesn\325t do anything useful for this program.  It does) 411.22 445.5 T
(   prove that you can have different threads calling sigwait\050\051 on) 411.22 437.16 T
(   different signal sets.) 411.22 428.82 T
(*/) 411.22 420.49 T
(void *my_sigwaiter\050void *arg\051) 411.22 412.15 T
({int            sig, err;) 411.22 403.81 T
( sigset_t       s;) 411.22 395.47 T
( sigfillset\050&s\051;) 411.22 378.8 T
( pthread_sigmask\050SIG_BLOCK, &s, NULL\051;  /* Take no interrupts */) 411.22 370.46 T
( sigemptyset \050&s\051;) 411.22 353.78 T
( sigaddset \050&s, SIGINT\051;) 411.22 345.44 T
( sigaddset \050&s, SIGTSTP\051;) 411.22 337.11 T
( sigaddset \050&s, SIGQUIT\051;) 411.22 328.77 T
( sigaddset \050&s, SIGHUP\051;) 411.22 320.43 T
( /* User program waits for everything EXCEPT USR1 and ALRM */) 411.22 303.75 T
( while\0501\051) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 63
%%Page: "mini" 64
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(127) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    {err = sigwait\050&s, &sig\051;) 37.72 695.65 T
(    if \050err != 0\051 {) 37.72 687.31 T
(        printf\050\322%s\134n\323, strerror\050err\051\051;) 37.72 678.97 T
(        abort\050\051;) 37.72 670.63 T
(     }) 37.72 662.29 T
(     switch \050sig\051) 37.72 653.95 T
(       {case SIGINT  :  printf\050\322Exit on SIGINT\134n\323\051, exit\0501\051;) 37.72 645.62 T
(        case SIGTSTP :  printf\050\322Exit on SIGSTP\134n\323\051, exit\0501\051;) 37.72 637.28 T
(        case SIGQUIT :  printf\050\322Exit on SIGQUIT\134n\323\051, exit\0501\051;) 37.72 628.94 T
(        default:        printf\050\322Default handler for signal: %d\134n\323, sig\051;) 37.72 612.26 T
(      }) 37.72 603.92 T
(   }) 37.72 595.59 T
(}) 37.72 587.25 T
(main\050int argc, char *argv[]\051) 37.72 562.23 T
({jmp_buf                        env;) 37.72 553.9 T
( sigset_t                       s, s1, s2;) 37.72 545.56 T
( static struct sigaction        action;) 37.72 537.22 T
( int                            i;) 37.72 528.88 T
( pthread_t                      tid;) 37.72 520.54 T
( /* Initialize things */) 37.72 487.19 T
( action.sa_handler = \050void \050*\051\050void\051\051 my_SigHandler;) 37.72 478.85 T
( sigaction\050SIGUSR1, &action, NULL\051;) 37.72 470.52 T
( sigfillset\050&s\051;) 37.72 453.84 T
( pthread_sigmask\050SIG_BLOCK, &s, &s2\051; /* Block everything, then... */) 37.72 445.5 T
( sigemptyset\050&s\051;) 37.72 437.16 T
( sigaddset\050&s, SIGUSR1\051;) 37.72 428.82 T
( pthread_sigmask\050SIG_UNBLOCK, &s, &s1\051; /* Unblock USR1 */) 37.72 420.49 T
( PTHREAD_CREATE\050&tid, NULL, my_sigwaiter, NULL\051;) 37.72 403.81 T
( pthread_key_create\050&JMPBUF_KEY, NULL\051;) 37.72 395.47 T
(#if !defined\050__sun\051 && !defined\050__alpha\051) 37.72 378.8 T
( initialize_thread_timer\050\051;) 37.72 370.46 T
(#endif) 37.72 362.12 T
( /* The real program begins here. */) 37.72 345.44 T
( for \050i=0; i < 4; i++\051) 37.72 328.77 T
(   {DEVICE_SPEED = i; TIMEOUT = 4 - i;) 37.72 312.09 T
(    printf\050\322DEVICE_SPEED=%d TIMEOUT=%d\134n\323, DEVICE_SPEED, TIMEOUT\051;) 37.72 303.75 T
(    if \050sigsetjmp\050env, 1\051 != 0\051) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(128) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(      {printf\050\322Device timed out!\134n\323\051;) 411.22 695.65 T
(       continue;) 411.22 687.31 T
(     }) 411.22 678.97 T
(    pthread_setspecific\050JMPBUF_KEY, \050void *\051env\051;) 411.22 670.63 T
(    call_device\050DEVICE_SPEED, TIMEOUT\051;) 411.22 662.29 T
(  }) 411.22 653.95 T
( printf\050\322Done\134n\323\051;) 411.22 637.28 T
( exit\0500\051;) 411.22 628.94 T
(}) 411.22 620.6 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 64
%%Page: "mini" 65
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(129) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Creating Thread-Local Signals:) 50.79 686.11 T
(callout.c \050librar) 122.76 657.53 T
(y\051) 276.68 657.53 T
4 7.15 Q
(/*                callout.c                */) 37.72 615.84 T
(/*) 37.72 582.48 T
( The interface to the per-thread alarm package.  This is fully MT-safe) 37.72 565.81 T
( and will handle any number of alarms / sleeps.) 37.72 557.47 T
(   int thread_settimer\050int delay, void fn\050void *\051, void *arg\051) 37.72 540.79 T
(   thread_deletetimer\050int timer_number\051) 37.72 532.45 T
(   void thread_sleep\050int t\051) 37.72 524.12 T
( typically:) 37.72 490.77 T
(   i = thread_settimer\05020, foo, TID\051;) 37.72 474.09 T
(   ...) 37.72 465.75 T
(   thread_deletetimer\050i\051;) 37.72 457.41 T
( \322Run function foo\050TID\051 in 20 seconds.\323) 37.72 440.74 T
( If the thread gets to the deletetimer\050\051 line before the alarm expires,) 37.72 424.06 T
( only that one alarm will be affected.) 37.72 415.72 T
( TID can be any value, and foo\050\051 is allowed to send a signal to specific) 37.72 399.05 T
( threads if desired \050eg, TID\051.  That thread would have to install a signal) 37.72 390.71 T
( handler in that case \050presumably SIGUSR1\051.) 37.72 382.37 T
( thread_sleep\0503\051;) 37.72 357.35 T
( \322Put the current thread to sleep for 3 seconds.\323) 37.72 340.68 T
( sleep\050\051 uses SIGALRM, so it will not work with other uses of alarm\050\051.) 37.72 324 T
( thread_sleep\050\051 is based upon thread_settimer\050\051 and works reliably with any) 37.72 315.66 T
( number of threads.  Note that the sleeping thread will become RUNNABLE) 37.72 307.33 T
( at wake-up time.  When it actually gets a CPU is a scheduling question.) 37.72 298.99 T
( \050Yes, nanosleep\050\051 makes more sense, but this is a nice proof-of-concept.\051) 37.72 290.65 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(130) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( The user code must not handle SIGALRM, but that is the only limitation.) 411.22 678.97 T
( \050Mask it out & don\325t sigwait\050\051 on it.\051  The user code may install handlers) 411.22 670.63 T
( or sigwait\050\051 for any other signal.) 411.22 662.29 T
( This library uses alarm\050\051, hence its finest granularity is 1 second.  Higher) 411.22 645.62 T
( resolution timers can easily be built on top of this, and are left to the) 411.22 637.28 T
( reader as an exercise.) 411.22 628.94 T
(  Build a dynamic library:) 411.22 603.92 T
(cc  -G -o libcallout.so callout.c -g -lpthread -lthread -lposix4) 411.22 587.25 T
(*/) 411.22 578.91 T
(#define _POSIX_C_SOURCE 199506L) 411.22 545.56 T
(#include <signal.h>) 411.22 528.88 T
(#include <stdio.h>) 411.22 520.54 T
(#include <pthread.h>) 411.22 512.21 T
(#include <semaphore.h>) 411.22 503.87 T
(#include <errno.h>) 411.22 495.53 T
(#include \322thread_extensions.h\323) 411.22 487.19 T
( /*  This runs before main\050\051 and starts up the sigwait\050\051 loop for SIGALRM. */) 411.22 462.18 T
(void initialize_thread_timer\050\051;) 411.22 445.5 T
(#ifdef __sun) 411.22 428.82 T
(#pragma init \050initialize_thread_timer\051) 411.22 420.49 T
(#endif) 411.22 412.15 T
(#if defined \050__alpha\051 && defined \050__osf__\051) 411.22 395.47 T
(__init_thread_timer\050\051) 411.22 387.13 T
({initialize_thread_timer\050\051;}) 411.22 378.8 T
(#endif) 411.22 370.46 T
(typedef struct timer_struct {) 411.22 345.44 T
(  int                   expire_time;   /* UTC time */) 411.22 337.11 T
(  int                   number;        /* Unique identifier */) 411.22 328.77 T
(  void                  \050*fn\051\050void *\051; /* Function to call */) 411.22 320.43 T
(  void                  *arg;          /* Argument to fn */) 411.22 312.09 T
(  struct timer_struct   *next;         /* Pointer to next */) 411.22 303.75 T
(} timer_queue_t;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 65
%%Page: "mini" 66
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(131) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(timer_queue_t           *timer_queue;) 37.72 687.31 T
(pthread_t               _SIGWAIT_TID;) 37.72 678.97 T
(pthread_mutex_t         timer_queue_mutex;) 37.72 670.63 T
(sem_t                   timer_sema;) 37.72 662.29 T
(int                     timer_number;) 37.72 653.95 T
(void UnusedSigHandler\050int signo\051) 37.72 637.28 T
({) 37.72 628.94 T
(  /* This should never happen.) 37.72 620.6 T
(     Note that printf\050\051 and thread_name\050\051 are not signal safe!) 37.72 612.26 T
(     */) 37.72 603.92 T
(  printf\050\322Got SIGALRM \050%d\051 in handler for thread %d?!\134n\323,) 37.72 595.59 T
(         signo, thread_name\050pthread_self\050\051\051\051;) 37.72 587.25 T
(  exit\0501\051;) 37.72 578.91 T
(}) 37.72 570.57 T
( /* To wake up a sleeping thread, just release its semaphore.  The) 37.72 553.9 T
(   thread will run as soon as the scheduler decides to schedule it.) 37.72 545.56 T
( */) 37.72 537.22 T
(void thread_timer_wakeup\050void *s\051) 37.72 528.88 T
({) 37.72 520.54 T
(  sem_post\050\050sem_t *\051 s\051;) 37.72 512.21 T
(}) 37.72 503.87 T
( /* Set a sleep time.  This function will set up the ALRM, then sleep) 37.72 487.19 T
(   on a semaphore it creates for the purpose. */) 37.72 478.85 T
(void thread_sleep\050int t\051) 37.72 470.52 T
({sem_t s;) 37.72 462.18 T
( if \050t < 1\051 return;) 37.72 445.5 T
( SEM_INIT\050&s, 0, NULL\051;) 37.72 437.16 T
( thread_settimer\050t, thread_timer_wakeup, &s\051;) 37.72 428.82 T
( while\050sem_wait\050&s\051 != 0\051 DEBUG\050printf\050\322Sem Interrupted\134n\323\051;\051) 37.72 420.49 T
( sem_destroy\050&s\051;) 37.72 412.15 T
(}) 37.72 403.81 T
(initialize_timer\050\051) 37.72 378.8 T
({) 37.72 370.46 T
(  _SIGWAIT_TID = pthread_self\050\051;) 37.72 362.12 T
(  timer_queue = \050timer_queue_t *\051 malloc\050sizeof\050timer_queue_t\051\051;) 37.72 353.78 T
(  timer_queue->next = NULL;) 37.72 345.44 T
(  timer_queue->expire_time = -1;) 37.72 337.11 T
(  timer_number = 1;) 37.72 328.77 T
(  sem_post\050&timer_sema\051;                /* Used only for initialization */) 37.72 320.43 T
(}) 37.72 312.09 T
(thread_timer_setalarm\050\051) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(132) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
({int now = time\050NULL\051;) 411.22 695.65 T
( int delay;) 411.22 687.31 T
( pthread_mutex_lock\050&timer_queue_mutex\051;) 411.22 670.63 T
( if \050timer_queue->next == NULL\051) 411.22 662.29 T
(   {pthread_mutex_unlock\050&timer_queue_mutex\051;) 411.22 653.95 T
(    return;}) 411.22 645.62 T
( delay = timer_queue->next->expire_time - now;) 411.22 637.28 T
( if \050delay < 1\051 delay = 1;) 411.22 628.94 T
(  alarm\050delay\051;) 411.22 620.6 T
( pthread_mutex_unlock\050&timer_queue_mutex\051;) 411.22 612.26 T
(}) 411.22 603.92 T
( /* Delete the node for the 1st matching entry.  Leave the ALRM. */) 411.22 587.25 T
(void thread_deletetimer\050int timer_number\051) 411.22 578.91 T
({) 411.22 570.57 T
(  timer_queue_t         *tq, *tq1, *tq2, *ts;) 411.22 562.23 T
(  pthread_mutex_lock\050&timer_queue_mutex\051;) 411.22 545.56 T
(  tq2 = timer_queue;) 411.22 537.22 T
(  for \050tq = timer_queue, tq1 = timer_queue->next;) 411.22 528.88 T
(       tq1 != NULL;) 411.22 520.54 T
(       tq1 = tq1->next, tq = tq->next\051) 411.22 512.21 T
(    {if \050tq1->number == timer_number\051) 411.22 503.87 T
(     {tq->next = tq1->next;) 411.22 495.53 T
(      free\050tq1\051;}}) 411.22 487.19 T
( pthread_mutex_unlock\050&timer_queue_mutex\051;) 411.22 478.85 T
(}) 411.22 470.52 T
(int thread_settimer\050int delay, void fn\050void *\051, void *arg\051) 411.22 445.5 T
({) 411.22 437.16 T
(  timer_queue_t         *tq, *tq1, *tq2, *ts;) 411.22 428.82 T
(  int                   expire_time;) 411.22 420.49 T
(  int                   killp = 0;) 411.22 412.15 T
(  ts  = \050timer_queue_t *\051 malloc\050sizeof\050timer_queue_t\051\051;) 411.22 395.47 T
(  expire_time = \050int\051 time\050NULL\051+delay;) 411.22 387.13 T
(  ts->expire_time=expire_time;) 411.22 378.8 T
(  ts->fn = fn;) 411.22 370.46 T
(  ts->arg = arg;) 411.22 362.12 T
(  pthread_mutex_lock\050&timer_queue_mutex\051;) 411.22 345.44 T
(  timer_number++;) 411.22 337.11 T
(  ts->number = timer_number;) 411.22 328.77 T
(  tq2 = timer_queue;) 411.22 320.43 T
(  DEBUG\050if \050tq2->next == NULL\051 printf\050\322New Timer\134n\323\051;\051) 411.22 312.09 T
(  for \050tq = timer_queue, tq1 = timer_queue->next;) 411.22 303.75 T
(       1;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 66
%%Page: "mini" 67
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(133) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(       tq1 = tq1->next, tq = tq->next\051) 37.72 695.65 T
(    {if \050\050tq1 == NULL\051 || \050tq1->expire_time > expire_time\051\051) 37.72 687.31 T
(     {tq->next = ts;) 37.72 678.97 T
(      ts->next = tq1;) 37.72 670.63 T
(      if \050tq2->next == ts\051 killp = 1;) 37.72 662.29 T
(      pthread_mutex_unlock\050&timer_queue_mutex\051;) 37.72 653.95 T
(      thread_timer_setalarm\050\051;) 37.72 637.28 T
(      return\050timer_number\051;}) 37.72 628.94 T
(   }) 37.72 620.6 T
(}) 37.72 612.26 T
(thread_expired_timer\050\051) 37.72 595.59 T
({) 37.72 587.25 T
(  timer_queue_t         *tq, *tq1;) 37.72 578.91 T
(  int                   now = time\050NULL\051;) 37.72 570.57 T
(  void                  \050*fn\051 \050void *\051;) 37.72 562.23 T
(  void                  *arg;) 37.72 553.9 T
(  pthread_mutex_lock\050&timer_queue_mutex\051;) 37.72 528.88 T
(  tq = timer_queue->next;) 37.72 520.54 T
(  tq1 = tq->next;) 37.72 512.21 T
(  while\050tq->expire_time <= now\051) 37.72 495.53 T
(    {fn = tq->fn;) 37.72 487.19 T
(     arg = tq->arg;) 37.72 478.85 T
(     free\050tq\051;) 37.72 470.52 T
(     tq = tq1;) 37.72 462.18 T
(     timer_queue->next = tq;) 37.72 453.84 T
(     pthread_mutex_unlock\050&timer_queue_mutex\051;) 37.72 437.16 T
(     fn\050arg\051;) 37.72 428.82 T
(     if \050tq1 == NULL\051 {DEBUG\050printf\050\322No timer.\134n\323\051;\051 return;}) 37.72 412.15 T
(     pthread_mutex_lock\050&timer_queue_mutex\051;) 37.72 403.81 T
(     tq1 = tq1->next;) 37.72 395.47 T
(   }) 37.72 387.13 T
(  alarm\050tq->expire_time - now\051;) 37.72 378.8 T
(  pthread_mutex_unlock\050&timer_queue_mutex\051;) 37.72 370.46 T
(}) 37.72 362.12 T
(void *sigwaiter\050void *arg\051) 37.72 345.44 T
({int                            sig, err;) 37.72 337.11 T
( sigset_t                       s;) 37.72 328.77 T
( static struct sigaction        action;) 37.72 320.43 T
( action.sa_handler = \050void \050*\051\050void\051\051 UnusedSigHandler;) 37.72 303.75 T
( sigaction\050SIGALRM, &action, NULL\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(134) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( sigfillset\050&s\051;) 411.22 695.65 T
( pthread_sigmask\050SIG_BLOCK, &s, NULL\051;  /* Take no interrupts */) 411.22 687.31 T
( initialize_timer\050\051;) 411.22 678.97 T
( sigemptyset\050&s\051;) 411.22 662.29 T
( sigaddset\050&s, SIGALRM\051;) 411.22 653.95 T
( while\0501\051) 411.22 637.28 T
(    {err = sigwait\050&s, &sig\051;) 411.22 628.94 T
(     if \050err\051 {errno = err; perror\050\322Sigwait error!\323\051;}) 411.22 620.6 T
(     switch \050sig\051) 411.22 612.26 T
(       {case SIGALRM :          thread_expired_timer\050\051;) 411.22 603.92 T
(                                break;) 411.22 595.59 T
(       default:                 printf\050\322IMPOSSIBLE! signal: %d\134n\323, sig\051;) 411.22 587.25 T
(      }) 411.22 578.91 T
(   }) 411.22 570.57 T
(}) 411.22 562.23 T
(void initialize_thread_timer\050\051) 411.22 537.22 T
({ pthread_attr_t        attr;) 411.22 528.88 T
(  int                   err;) 411.22 520.54 T
(  pthread_t             tid;) 411.22 512.21 T
(  SEM_INIT\050&timer_sema, 0, 0\051;) 411.22 495.53 T
(  PTHREAD_ATTR_INIT\050&attr\051;) 411.22 487.19 T
(  err = pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 411.22 478.85 T
(  pthread_mutex_lock\050&timer_queue_mutex\051;) 411.22 470.52 T
(  PTHREAD_CREATE\050&tid, &attr, sigwaiter, NULL\051;) 411.22 462.18 T
(  while\050sem_wait\050&timer_sema\051 != 0\051 ;) 411.22 453.84 T
(  pthread_mutex_unlock\050&timer_queue_mutex\051;) 411.22 445.5 T
(}) 411.22 437.16 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 67
%%Page: "mini" 68
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(135) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(P) 99.36 686.11 T
(assing Shared Data:) 113.01 686.11 T
(matrix_pr) 120.21 657.53 T
(ob) 217.48 657.53 T
(lem.c) 243.47 657.53 T
4 7.15 Q
(/*                matrix_problem.c                */) 37.72 615.84 T
(/*) 37.72 599.16 T
(This program illustrates the dangers of inadvertantly using shared) 37.72 582.48 T
(data, and the problems which result.) 37.72 574.15 T
(What is particularly interesting about this program, is that the) 37.72 557.47 T
(thread start times must be considered as random, making this into) 37.72 549.13 T
(a big race condition.  It is possible that you will get the correct) 37.72 540.79 T
(answer.  It is possible that all the threads will get the same values) 37.72 532.45 T
(for {i,j}, it is possible for any combination of values! A very nice) 37.72 524.12 T
(program indeed.) 37.72 515.78 T
(*/) 37.72 499.1 T
(/*) 37.72 474.09 T
(cc -o matrix_problem matrix_problem.c -L. -R. -g -lpthread -lthread -pthread -) 37.72 465.75 T
(lposix4) 37.72 457.41 T
(*/) 37.72 449.07 T
(#define _POSIX_C_SOURCE 199506L) 37.72 424.06 T
(#include <stdio.h>) 37.72 407.38 T
(#include <pthread.h>) 37.72 399.05 T
(#include <semaphore.h>) 37.72 390.71 T
(#include <errno.h>) 37.72 382.37 T
(#include \322thread_extensions.h\323) 37.72 374.03 T
(#define SIZE            4) 37.72 340.68 T
(pthread_mutex_t         unused_lock = PTHREAD_MUTEX_INITIALIZER;) 37.72 324 T
(sem_t                   barrier;) 37.72 315.66 T
(int                     a[SIZE] [SIZE], b[SIZE] [SIZE], c[SIZE] [SIZE];) 37.72 307.33 T
(typedef struct _v) 37.72 290.65 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(136) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
({int    i;) 411.22 695.65 T
( int    j;) 411.22 687.31 T
(} element_t;) 411.22 678.97 T
(void *add_element\050void *arg\051) 411.22 645.62 T
({element_t *e = \050element_t *\051 arg;) 411.22 637.28 T
( delay\050100, 100\051;) 411.22 620.6 T
( c[e->i] [e->j] =  a[e->i] [e->j] +  b[e->i] [e->j];) 411.22 612.26 T
( sem_post\050&barrier\051;) 411.22 603.92 T
( pthread_exit\050NULL\051;) 411.22 595.59 T
(}) 411.22 587.25 T
(void fill_matrix\050int m[SIZE][SIZE]\051) 411.22 562.23 T
({int i, j, n = 0;) 411.22 553.9 T
( for \050i=0; i<SIZE; i++\051) 411.22 537.22 T
(   for \050j=0; j<SIZE; j++\051) 411.22 528.88 T
(     m[i][j] = n++;) 411.22 520.54 T
(}) 411.22 512.21 T
(void print_matrix\050int m[SIZE][SIZE]\051) 411.22 495.53 T
({int i, j, n = 0;) 411.22 487.19 T
( for \050i=0; i<SIZE; i++\051) 411.22 470.52 T
(   {printf\050\322\134n\134t| \322\051;) 411.22 462.18 T
(    for \050j=0; j<SIZE; j++\051) 411.22 453.84 T
(      printf\050\322%2d \322, m[i][j]\051;) 411.22 445.5 T
(    printf\050\322|\323\051;) 411.22 437.16 T
(  }) 411.22 428.82 T
(}) 411.22 420.49 T
(main\050int argc, char *argv[]\051) 411.22 395.47 T
({int            i, j, n = 0;) 411.22 387.13 T
( element_t      element;) 411.22 378.8 T
( pthread_attr_t attr;) 411.22 370.46 T
( pthread_t      tid;) 411.22 362.12 T
( SEM_INIT\050&barrier, NULL, 0\051;) 411.22 345.44 T
( PTHREAD_ATTR_INIT\050&attr\051;) 411.22 337.11 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 411.22 328.77 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 411.22 320.43 T
( fill_matrix\050a\051;) 411.22 303.75 T
( fill_matrix\050b\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 68
%%Page: "mini" 69
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(137) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( iobench_start\050\051;) 37.72 678.97 T
( for \050i=0; i<SIZE; i++\051) 37.72 670.63 T
(   for \050j=0; j<SIZE; j++\051) 37.72 662.29 T
(     {element.i = i; element.j = j;) 37.72 653.95 T
(      PTHREAD_CREATE\050&tid, &attr, add_element, &element\051;) 37.72 645.62 T
(      delay\0500, 40000\051;) 37.72 637.28 T
(    }) 37.72 628.94 T
( thread_single_barrier\050&barrier, SIZE*SIZE\051;) 37.72 620.6 T
( iobench_end\050\051;) 37.72 612.26 T
( printf\050\322\134n\134n\134n\323\051;) 37.72 595.59 T
( print_matrix\050a\051;) 37.72 587.25 T
( printf\050\322\134n\134n\134n\134t       + \134n\323\051;) 37.72 578.91 T
( print_matrix\050b\051;) 37.72 570.57 T
( printf\050\322\134n\134n\134n\134t       = \134n\323\051;) 37.72 562.23 T
( print_matrix\050c\051;) 37.72 553.9 T
( printf\050\322\134n\134n\134n\323\051;) 37.72 545.56 T
( iobench_report\050\051;) 37.72 537.22 T
( printf\050\322Done\134n\323\051;) 37.72 528.88 T
( exit\0500\051;) 37.72 520.54 T
(}) 37.72 512.21 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(138) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Ex) 487.72 686.11 T
(er) 513.73 686.11 T
(cise Objective) 533.57 686.11 T
2 10.72 Q
-0.12 (Edit the code in) 411.22 642.04 P
4 F
-0.26 (matrix_problem.c) 493.54 642.04 P
2 F
-0.12 ( and \336x it so that the ans) 596.46 642.04 P
-0.12 (wer is) 721.15 642.04 P
(correct.) 411.22 628.94 T
(Don\325t peek at) 411.22 589.63 T
4 F
(matrix_solution.c) 481.52 589.63 T
2 F
( or) 590.86 589.63 T
4 F
(matrix_solution2.c) 607.55 589.63 T
2 F
( until) 723.33 589.63 T
-0.15 (y) 411.22 576.53 P
-0.15 (ou ha) 416.92 576.53 P
-0.15 (ve \336gured it out on y) 445.19 576.53 P
-0.15 (our o) 549.6 576.53 P
-0.15 (wn! \050The objective is not to g) 576.09 576.53 P
-0.15 (et the) 723.01 576.53 P
(ans) 411.22 563.43 T
(wer) 429.53 563.43 T
(, the objective is f) 447.36 563.43 T
(or y) 537.11 563.43 T
(ou to think about the issue) 556.51 563.43 T
(, so that) 693.02 563.43 T
(when y) 411.22 550.32 T
(ou encounter something similar in real code) 447.3 550.32 T
(, y) 672.6 550.32 T
(ou\325) 684.25 550.32 T
(ll be ab) 700.12 550.32 T
(le) 736.95 550.32 T
(to deal with it!\051) 411.22 537.22 T
(There are n) 411.22 497.91 T
(umer) 468.91 497.91 T
(ous simple solutions to the pr) 494.91 497.91 T
(ob) 647.19 497.91 T
(lem.) 660.18 497.91 T
(Wild Guess at Time to Completion:) 411.22 471.71 T
(30 min) 518.43 458.6 T
(utes think/design time) 552.28 458.6 T
(.) 665.68 458.6 T
(30 min) 518.43 445.5 T
(utes pr) 552.28 445.5 T
(ogramming/deb) 587.81 445.5 T
(ug) 668.01 445.5 T
(ging) 681 445.5 T
(My solution c) 518.43 432.4 T
(hang) 586.82 432.4 T
(ed 4 lines of code) 612.54 432.4 T
(.) 702.72 432.4 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 69
%%Page: "mini" 70
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(139) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(P) 107.31 686.11 T
(assing Stac) 120.97 686.11 T
(k Data:) 239.71 686.11 T
(matrix_solution.c) 120.49 657.53 T
4 7.15 Q
(/*                matrix_solution.c                */) 37.72 615.84 T
(/*) 37.72 599.16 T
(This program illustrates the dangers of inadvertantly using shared) 37.72 582.48 T
(data, and the problems which result.) 37.72 574.15 T
(What is particularly interesting about this program, is that the) 37.72 557.47 T
(thread start times must be considered as random, making this into) 37.72 549.13 T
(a big race condition.  It is possible that you will get the correct) 37.72 540.79 T
(answer.  It is possible that all the threads will get the same values) 37.72 532.45 T
(for {i,j}, it is possible for any combination of values! A very nice) 37.72 524.12 T
(program indeed.) 37.72 515.78 T
(This shows just one of many possible solutions.  You could pass a) 37.72 499.1 T
(structure, you could pass a single integer which encoded i and j,) 37.72 490.77 T
(you could use a global array, you could make it a producer/consumer) 37.72 482.43 T
(program, etc.) 37.72 474.09 T
(*/) 37.72 457.41 T
(/*) 37.72 432.4 T
(cc -o matrix_solution matrix_solution.c -L. -R. -g -lpthread -lthread -pthread -) 37.72 424.06 T
(lposix4) 37.72 415.72 T
(*/) 37.72 407.38 T
(#define _POSIX_C_SOURCE 199506L) 37.72 382.37 T
(#include <stdio.h>) 37.72 365.69 T
(#include <pthread.h>) 37.72 357.35 T
(#include <semaphore.h>) 37.72 349.02 T
(#include <errno.h>) 37.72 340.68 T
(#include \322thread_extensions.h\323) 37.72 332.34 T
(#define SIZE            4) 37.72 298.99 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(140) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(pthread_mutex_t         unused_lock = PTHREAD_MUTEX_INITIALIZER;) 411.22 695.65 T
(sem_t                   barrier, one_at_a_time;) 411.22 687.31 T
(int                     a[SIZE] [SIZE], b[SIZE] [SIZE], c[SIZE] [SIZE];) 411.22 678.97 T
(typedef struct _v) 411.22 662.29 T
({int    i;) 411.22 653.95 T
( int    j;) 411.22 645.62 T
(} element_t;) 411.22 637.28 T
(void *add_element\050void *arg\051) 411.22 603.92 T
({element_t *e = \050element_t *\051 arg;) 411.22 595.59 T
( int i = e->i, j = e->j;) 411.22 587.25 T
( delay\050100, 100\051;) 411.22 570.57 T
( sem_post\050&one_at_a_time\051;) 411.22 562.23 T
( c[i] [j] =  a[i] [j] +  b[i] [j];) 411.22 553.9 T
( sem_post\050&barrier\051;) 411.22 545.56 T
( pthread_exit\050NULL\051;) 411.22 537.22 T
(}) 411.22 528.88 T
(void fill_matrix\050int m[SIZE][SIZE]\051) 411.22 503.87 T
({int i, j, n = 0;) 411.22 495.53 T
( for \050i=0; i<SIZE; i++\051) 411.22 478.85 T
(   for \050j=0; j<SIZE; j++\051) 411.22 470.52 T
(     m[i][j] = n++;) 411.22 462.18 T
(}) 411.22 453.84 T
(void print_matrix\050int m[SIZE][SIZE]\051) 411.22 437.16 T
({int i, j, n = 0;) 411.22 428.82 T
( for \050i=0; i<SIZE; i++\051) 411.22 412.15 T
(   {printf\050\322\134n\134t| \322\051;) 411.22 403.81 T
(    for \050j=0; j<SIZE; j++\051) 411.22 395.47 T
(      printf\050\322%2d \322, m[i][j]\051;) 411.22 387.13 T
(    printf\050\322|\323\051;) 411.22 378.8 T
(  }) 411.22 370.46 T
(}) 411.22 362.12 T
(main\050int argc, char *argv[]\051) 411.22 337.11 T
({int i, j, n = 0;) 411.22 328.77 T
( element_t element;) 411.22 320.43 T
( pthread_attr_t attr;) 411.22 312.09 T
( pthread_t tid;) 411.22 303.75 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 70
%%Page: "mini" 71
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(141) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( SEM_INIT\050&barrier, NULL, 0\051;) 37.72 695.65 T
( SEM_INIT\050&one_at_a_time, NULL, 0\051;) 37.72 687.31 T
( PTHREAD_ATTR_INIT\050&attr\051;) 37.72 678.97 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 37.72 670.63 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 37.72 662.29 T
( fill_matrix\050a\051;) 37.72 645.62 T
( fill_matrix\050b\051;) 37.72 637.28 T
( iobench_start\050\051;) 37.72 620.6 T
( for \050i=0; i<SIZE; i++\051) 37.72 612.26 T
(   for \050j=0; j<SIZE; j++\051) 37.72 603.92 T
(     {element.i = i; element.j = j;) 37.72 595.59 T
(      PTHREAD_CREATE\050&tid, &attr, add_element, &element\051;) 37.72 587.25 T
(      delay\0500, 40000\051;) 37.72 578.91 T
(      SEM_WAIT\050&one_at_a_time\051;) 37.72 570.57 T
(    }) 37.72 562.23 T
( thread_single_barrier\050&barrier, SIZE*SIZE\051;) 37.72 553.9 T
( iobench_end\050\051;) 37.72 545.56 T
( printf\050\322\134n\134n\134n\323\051;) 37.72 528.88 T
( print_matrix\050a\051;) 37.72 520.54 T
( printf\050\322\134n\134n\134n\134t       + \134n\323\051;) 37.72 512.21 T
( print_matrix\050b\051;) 37.72 503.87 T
( printf\050\322\134n\134n\134n\134t       = \134n\323\051;) 37.72 495.53 T
( print_matrix\050c\051;) 37.72 487.19 T
( printf\050\322\134n\134n\134n\323\051;) 37.72 478.85 T
( iobench_report\050\051;) 37.72 470.52 T
( printf\050\322Done\134n\323\051;) 37.72 462.18 T
( exit\0500\051;) 37.72 453.84 T
(}) 37.72 445.5 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(142) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Ex) 487.72 686.11 T
(er) 513.73 686.11 T
(cise Objective) 533.57 686.11 T
2 10.72 Q
(Look at the code in) 411.22 667.65 T
4 F
(test_recursive_mutex.c.) 511.9 667.65 T
2 F
( It needs a recur-) 659.84 667.65 T
-0.2 (sive m) 411.22 654.55 P
-0.2 (ute) 444.18 654.55 P
-0.2 (x to function. Unf) 460.1 654.55 P
-0.2 (or) 547.44 654.55 P
-0.2 (tunatel) 558.37 654.55 P
-0.2 (y) 593.35 654.55 P
-0.2 (, POSIX m) 598.46 654.55 P
-0.2 (ute) 649.09 654.55 P
-0.2 (x) 665.01 654.55 P
-0.2 (es are not recur-) 670.86 654.55 P
(sive) 411.22 641.45 T
(.) 432.3 641.45 T
(Right no) 411.22 622.39 T
(w) 454.53 622.39 T
(, it runs using the recur) 462.45 622.39 T
(sive m) 581.43 622.39 T
(ute) 614.59 622.39 T
(x I wr) 630.51 622.39 T
(ote \050named) 657.71 622.39 T
4 F
(thread_recursive_mutex) 411.22 609.29 T
2 F
(\051, b) 552.73 609.29 T
(ut I\325m sure y) 568.6 609.29 T
(ou could b) 631.48 609.29 T
(uild a better) 685.47 609.29 T
(one) 411.22 596.18 T
(. So do a global replacement of \322) 430.5 596.18 T
4 F
(thread_recursive_mutex) 597.31 596.18 T
2 F
(\323) 738.82 596.18 T
(with \322) 411.22 583.08 T
4 F
(my_thread_recursive_mutex) 441 583.08 T
2 F
(\323 and then implement it.) 601.81 583.08 T
(Y) 411.22 564.02 T
(ou will need to write three functions and a datatype:) 417.3 564.02 T
4 8.34 Q
(typedef struct _rm {...} my_thread_recursive_mutex_t;) 411.22 546.55 T
(int thread_recursive_mutex_lock \050my_thread_recursive_mutex_t *\051) 411.22 530.47 T
(int thread_recursive_mutex_unlock \050my_thread_recursive_mutex_t *\051) 411.22 514.39 T
2 10.72 Q
(Extra Credit: Write the other tw) 411.22 477.66 T
(o functions:) 568.86 477.66 T
4 8.34 Q
(int my_thread_recursive_mutex_trylock \050thread_recursive_mutex_t *\051) 411.22 460.19 T
(int my_thread_recursive_mutex_destroy \050thread_recursive_mutex_t *\051) 411.22 444.11 T
2 10.72 Q
-0.05 (There is reall) 411.22 426.44 P
-0.05 (y onl) 477.11 426.44 P
-0.05 (y one simple solution to the pr) 501.92 426.44 P
-0.05 (ob) 656.89 426.44 P
-0.05 (lem \050with lots of) 669.89 426.44 P
(little v) 411.22 413.34 T
(ariations\051. Y) 441.99 413.34 T
(ou ma) 502.28 413.34 T
(y look at the de\336nition of FIFO m) 533.64 413.34 T
(ute) 700.21 413.34 T
(x) 716.13 413.34 T
(es f) 721.99 413.34 T
(or) 740.24 413.34 T
(guidance) 411.22 400.24 T
(.) 458.5 400.24 T
(Wild Guess at Time to Completion:) 411.22 362.12 T
(30 min) 518.43 349.02 T
(utes think/design time) 552.28 349.02 T
(.) 665.68 349.02 T
(30 min) 518.43 335.91 T
(utes pr) 552.28 335.91 T
(ogramming/deb) 587.81 335.91 T
(ug) 668.01 335.91 T
(ging) 681 335.91 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 71
%%Page: "mini" 72
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(143) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
37.72 314.47 361.52 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
182.45 527.69 310.9 656.34 R
0.6 H
2 Z
0 X
0 0 0 1 0 0 0 K
N
310.9 592.02 182.45 592.02 2 L
N
246.58 656.34 246.58 527.69 2 L
N
289.46 592.01 289.46 527.69 2 L
N
2 10.72 Q
(Loc) 0 -90 286.32 645.62 TF
(k) 0 -90 286.32 626.77 TF
(CV) 0 -90 254.15 645.62 TF
(Owner) 0 -90 232.71 645.62 TF
(Owned) 0 -90 211.27 646.23 TF
(Held? 0) 0 -90 297.04 587.85 TF
(Sleeper) 0 -90 276.4 588.3 TF
(s) 0 -90 276.4 549.73 TF
(Sleeper) 0 -90 254.15 588.3 TF
(s) 0 -90 254.15 549.73 TF
( T@1) 0 -90 232.71 589.1 TF
(1 | 0 | -1) 0 -90 212.08 586.65 TF
225.13 656.34 225.13 527.69 2 L
N
268.02 656.34 268.02 527.69 2 L
N
90 450 4.17 4.17 270 279.33 535.14 GG
90 450 4.17 4.17 270 279.33 535.14 AA
90 450 4.17 4.17 270 257 535.14 GG
90 450 4.17 4.17 270 257 535.14 AA
246.13 443.12 267.57 502.08 R
7 X
V
0 X
N
267.57 464.56 246.13 464.56 2 L
N
(T@4) 0 -90 254.51 496.72 TF
90 450 4.17 4.17 270 256.85 454.43 GG
90 450 4.17 4.17 270 256.85 454.43 AA
256.7 510.74 258.27 510.74 256.7 505.24 255.12 510.74 4 Y
0 Z
N
256.7 510.74 258.27 510.74 256.7 505.24 255.12 510.74 4 Y
V
256.7 534.84 256.7 511.04 2 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
246.13 362.12 267.57 421.08 R
7 X
V
0 X
N
267.57 383.56 246.13 383.56 2 L
N
(T@5) 0 -90 254.51 415.72 TF
90 450 4.17 4.17 270 256.85 373.43 GG
90 450 4.17 4.17 270 256.85 373.43 AA
256.7 429.74 258.27 429.74 256.7 424.25 255.12 429.74 4 Y
0 Z
N
256.7 429.74 258.27 429.74 256.7 424.25 255.12 429.74 4 Y
V
256.7 453.84 256.7 430.04 2 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 19.06 Q
(FIFO Mute) 0 -90 337.79 571.69 TF
(x) 0 -90 337.79 478.8 TF
2 10.72 Q
(The loc) 0 -90 142.59 688.5 TF
(k pr) 0 -90 142.59 651.18 TF
(otects the o) 0 -90 142.59 631.73 TF
(wner w) 0 -90 142.59 571.73 TF
(or) 0 -90 142.59 535.6 TF
(d and waiter) 0 -90 142.59 525.1 TF
(s count. If o) 0 -90 142.59 462.7 TF
(wned, then) 0 -90 142.59 402.7 TF
(Owner contains the TID) 0 -90 131.87 688.5 TF
(. If Owned == 0, it\325) 0 -90 131.87 569.08 TF
(s free) 0 -90 131.87 478.56 TF
(. If Owned == -1, then) 0 -90 131.87 449.74 TF
(it\325) 0 -90 121.15 688.5 TF
(s being passed to a thread whic) 0 -90 121.15 679.61 TF
(h is presentl) 0 -90 121.15 517.67 TF
(y waking up. W) 0 -90 121.15 454.67 TF
(aiter) 0 -90 121.15 377.66 TF
(s) 0 -90 121.15 355.18 TF
(is the n) 0 -90 110.43 688.5 TF
(umber of threads on the CV\325) 0 -90 110.43 651.07 TF
(s sleep queue) 0 -90 110.43 508.16 TF
(.) 0 -90 110.43 437.04 TF
203.89 656.34 203.89 527.69 2 L
N
(W) 0 -90 190.03 646.83 TF
(aiter) 0 -90 190.03 637.14 TF
(s) 0 -90 190.03 614.66 TF
(2) 0 -90 190.83 587.25 TF
(Note that Owner is de\336ned as pthread_t, hence it cannot contain) 0 -90 99.71 688.5 TF
(an) 0 -90 88.99 688.5 TF
(ything else \050e) 0 -90 88.99 676.2 TF
(.g., 0 or -1\051. Theref) 0 -90 88.99 607.47 TF
(ore we need the Owner \336eld.) 0 -90 88.99 514.75 TF
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(144) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
411.22 312.69 750.11 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 19.06 Q
0 X
0 0 0 1 0 0 0 K
(FIFO Mute) 0 -90 707.32 560.38 TF
(x \050loc) 0 -90 707.32 467.48 TF
(k\051) 0 -90 707.32 418.08 TF
607.93 673.77 642.04 639.66 607.93 605.55 573.82 639.66 4 Y
7 X
V
0.3 H
2 Z
0 X
N
493.41 594.1 536.29 685.22 R
7 X
V
0 X
N
4 8.34 Q
(owned  = 1) 0 -90 524.95 672.18 TF
(owner  = TID) 0 -90 512.72 671.95 TF
(unlock\050\051) 0 -90 500.5 671.57 TF
(owned==0?) 0 -90 605.39 660.57 TF
654.22 358.25 686.38 449.37 R
7 X
V
0 X
N
(waiters++) 0 -90 675.03 439.26 TF
(cond_wait\050\051) 0 -90 664.31 439.03 TF
(return) 0 -90 462.43 654.67 TF
568.46 473.49 589.9 543.18 R
7 X
V
0 X
N
(waiters--) 0 -90 578.55 533.06 TF
493.41 358.25 514.85 449.37 R
7 X
V
0 X
N
(cond_wait\050\051) 0 -90 503.51 439.03 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
650.07 639.66 650.07 638.09 644.58 639.66 650.07 641.23 4 Y
0.6 H
0 Z
N
650.07 639.66 650.07 638.09 644.58 639.66 650.07 641.23 4 Y
V
675.66 639.66 650.37 639.66 2 L
2 Z
N
548.23 639.66 548.23 638.09 542.73 639.66 548.23 641.23 4 Y
0 Z
N
548.23 639.66 548.23 638.09 542.73 639.66 548.23 641.23 4 Y
V
573.82 639.66 548.53 639.66 2 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
579.18 461.56 577.6 461.56 579.18 467.05 580.75 461.56 4 Y
0 Z
N
579.18 461.56 577.6 461.56 579.18 467.05 580.75 461.56 4 Y
V
579.18 435.97 579.18 461.26 2 L
2 Z
N
521.43 403.81 521.43 402.23 515.93 403.81 521.43 405.39 4 Y
0 Z
N
521.43 403.81 521.43 402.23 515.93 403.81 521.43 405.39 4 Y
V
547.02 403.81 521.72 403.81 2 L
2 Z
N
623.27 403.81 623.27 402.23 617.78 403.81 623.27 405.39 4 Y
0 Z
N
623.27 403.81 623.27 402.23 617.78 403.81 623.27 405.39 4 Y
V
648.86 403.81 623.57 403.81 2 L
2 Z
N
579.18 360.91 577.6 360.91 579.18 366.4 580.75 360.91 4 Y
0 Z
N
579.18 360.91 577.6 360.91 579.18 366.4 580.75 360.91 4 Y
V
504.13 350.89 504.13 328.77 579.18 328.77 579.18 360.61 4 L
2 Z
N
530.93 580.68 529.36 580.68 530.93 586.17 532.51 580.68 4 Y
0 Z
N
530.93 580.68 529.36 580.68 530.93 586.17 532.51 580.68 4 Y
V
579.18 543.18 579.18 557.87 530.93 557.87 530.93 580.38 4 L
2 Z
N
681.02 458.62 682.6 458.62 681.02 453.13 679.45 458.62 4 Y
0 Z
N
681.02 458.62 682.6 458.62 681.02 453.13 679.45 458.62 4 Y
V
607.76 596.78 607.76 543.18 681.02 543.18 681.02 458.92 4 L
2 Z
N
478.54 639.66 478.54 638.09 473.05 639.66 478.54 641.23 4 Y
0 Z
N
478.54 639.66 478.54 638.09 473.05 639.66 478.54 641.23 4 Y
V
493.41 639.66 478.84 639.66 2 L
2 Z
N
579.18 437.92 613.29 403.81 579.18 369.7 545.07 403.81 4 Y
7 X
V
0.3 H
0 X
N
(owned==-1?) 0 -90 576.64 424.71 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
675.66 599.46 701.73 679.86 R
7 X
V
0 X
N
(lock\050\051) 0 -90 685.03 668.66 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(Yes) 0 -90 559.52 632.87 TF
(Yes) 0 -90 584.53 457.17 TF
(No) 0 -90 532.12 423.11 TF
(No) 0 -90 612.52 579.15 TF
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 72
%%Page: "mini" 73
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(145) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
37.72 312.69 376.01 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 19.06 Q
0 X
0 0 0 1 0 0 0 K
(FIFO Mute) 0 -90 354.07 560.38 TF
(x \050unloc) 0 -90 354.07 467.48 TF
(k\051) 0 -90 354.07 394.79 TF
254.68 673.77 288.79 639.66 254.68 605.55 220.57 639.66 4 Y
7 X
V
0.3 H
2 Z
0 X
N
140.16 594.1 183.04 685.22 R
7 X
V
0 X
N
4 8.34 Q
(owned  = 0) 0 -90 171.7 672.18 TF
(owner  = NULL) 0 -90 159.47 671.95 TF
(unlock\050\051) 0 -90 147.25 671.57 TF
(waiters>0?) 0 -90 252.73 665.33 TF
228.31 380.88 277.74 472 R
7 X
V
0 X
N
(owned = -1) 0 -90 266.9 461.89 TF
(cond_signal\050\051) 0 -90 240.48 461.66 TF
(return) 0 -90 109.18 654.67 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
296.82 639.66 296.82 638.09 291.33 639.66 296.82 641.23 4 Y
0.6 H
0 Z
N
296.82 639.66 296.82 638.09 291.33 639.66 296.82 641.23 4 Y
V
322.41 639.66 297.12 639.66 2 L
2 Z
N
194.98 639.66 194.98 638.09 189.49 639.66 194.98 641.23 4 Y
0 Z
N
194.98 639.66 194.98 638.09 189.49 639.66 194.98 641.23 4 Y
V
220.57 639.66 195.27 639.66 2 L
2 Z
N
254.51 483.64 256.09 483.64 254.51 478.15 252.94 483.64 4 Y
0 Z
N
254.51 483.64 256.09 483.64 254.51 478.15 252.94 483.64 4 Y
V
254.51 596.78 254.51 552.44 254.51 552.44 254.51 483.94 4 L
2 Z
N
125.29 639.66 125.29 638.09 119.8 639.66 125.29 641.23 4 Y
0 Z
N
125.29 639.66 125.29 638.09 119.8 639.66 125.29 641.23 4 Y
V
140.16 639.66 125.59 639.66 2 L
2 Z
N
322.41 599.46 348.48 679.86 R
7 X
V
0.3 H
0 X
N
(lock\050\051) 0 -90 331.77 668.66 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(No) 0 -90 206.26 630.37 TF
(Yes) 0 -90 259.27 581.65 TF
(unlock\050\051) 0 -90 253.69 461.89 TF
110.68 607.48 109.11 607.48 110.68 612.97 112.26 607.48 4 Y
0.6 H
0 Z
N
110.68 607.48 109.11 607.48 110.68 612.97 112.26 607.48 4 Y
V
228.31 430.02 110.68 430.02 110.68 607.18 3 L
2 Z
N
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(146) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
411.22 334.72 748.92 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 19.06 Q
0 X
0 0 0 1 0 0 0 K
(Recur) 0 -90 721.53 617.59 TF
(sive Mute) 0 -90 721.53 563.86 TF
(x \050loc) 0 -90 721.53 477.3 TF
(k\051) 0 -90 721.53 427.9 TF
494.6 540.5 537.49 631.62 R
7 X
V
0.3 H
2 Z
0 X
N
4 8.34 Q
(owned  = 1) 0 -90 526.14 618.58 TF
(owner  = TID) 0 -90 517.99 618.35 TF
(unlock\050\051) 0 -90 501.69 617.97 TF
(return) 0 -90 463.63 601.07 TF
656.62 586.51 656.59 584.93 651.13 586.63 656.66 588.08 4 Y
0.6 H
0 Z
N
656.62 586.51 656.59 584.93 651.13 586.63 656.66 588.08 4 Y
V
676.85 586.06 656.92 586.5 2 L
2 Z
N
549.42 586.06 549.42 584.48 543.93 586.06 549.42 587.63 4 Y
0 Z
N
549.42 586.06 549.42 584.48 543.93 586.06 549.42 587.63 4 Y
V
575.01 586.06 549.72 586.06 2 L
2 Z
N
575.01 448.5 576.58 448.5 575.01 443.01 573.43 448.5 4 Y
0 Z
N
575.01 448.5 576.58 448.5 575.01 443.01 573.43 448.5 4 Y
V
608.96 543.18 608.96 505.68 575.01 505.68 575.01 448.8 4 L
2 Z
N
479.73 586.06 479.73 584.48 474.24 586.06 479.73 587.63 4 Y
0 Z
N
479.73 586.06 479.73 584.48 474.24 586.06 479.73 587.63 4 Y
V
494.6 586.06 480.03 586.06 2 L
2 Z
N
676.85 545.86 702.92 626.26 R
7 X
V
0.3 H
0 X
N
(lock\050\051) 0 -90 686.22 615.05 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(Yes) 0 -90 554.75 581.29 TF
(No) 0 -90 613.71 525.55 TF
(count++) 0 -90 509.84 618.35 TF
564.29 356.16 590.36 436.57 R
7 X
V
0 X
N
(cond_wait\050\051) 0 -90 573.65 425.36 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
639.33 547.92 637.76 547.92 639.33 553.41 640.91 547.92 4 Y
0.6 H
0 Z
N
639.33 547.92 637.76 547.92 639.33 553.41 640.91 547.92 4 Y
V
591.09 393.68 639.33 393.68 639.33 547.62 3 L
2 Z
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
607.17 626.26 647.37 586.06 607.17 545.86 566.97 586.06 4 Y
7 X
V
0.3 H
0 X
N
(owned==0?) 0 -90 614.31 613.57 TF
(    or) 0 -90 605.97 613.57 TF
(owner==TID?) 0 -90 597.63 613.57 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 73
%%Page: "mini" 74
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(147) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
37.72 321.02 377.8 699.22 C
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 19.06 Q
0 X
0 0 0 1 0 0 0 K
(Recur) 0 -90 357.84 616.86 TF
(sive Mute) 0 -90 357.84 563.13 TF
(x \050unloc) 0 -90 357.84 476.57 TF
(k\051) 0 -90 357.84 403.88 TF
232.05 651.44 266.16 617.33 232.05 583.21 197.93 617.33 4 Y
7 X
V
0.3 H
2 Z
0 X
N
133.61 571.76 155.05 662.89 R
7 X
V
0 X
N
4 8.34 Q
(unlock\050\051) 0 -90 140.7 649.24 TF
(count==0?) 0 -90 230.1 642.99 TF
205.68 360.63 255.11 451.75 R
7 X
V
0 X
N
(owned = 0) 0 -90 244.27 441.64 TF
(cond_signal\050\051) 0 -90 217.84 441.41 TF
(return) 0 -90 102.63 632.33 TF
274.19 617.33 274.19 615.75 268.7 617.33 274.19 618.9 4 Y
0.6 H
0 Z
N
274.19 617.33 274.19 615.75 268.7 617.33 274.19 618.9 4 Y
V
299.78 617.33 274.49 617.33 2 L
2 Z
N
172.35 617.33 172.35 615.75 166.85 617.33 172.35 618.9 4 Y
0 Z
N
172.35 617.33 172.35 615.75 166.85 617.33 172.35 618.9 4 Y
V
197.93 617.33 172.64 617.33 2 L
2 Z
N
231.88 463.39 233.46 463.39 231.88 457.9 230.31 463.39 4 Y
0 Z
N
231.88 463.39 233.46 463.39 231.88 457.9 230.31 463.39 4 Y
V
231.88 576.53 231.88 532.19 231.88 532.19 231.88 463.69 4 L
2 Z
N
118.74 617.33 118.74 615.75 113.25 617.33 118.74 618.9 4 Y
0 Z
N
118.74 617.33 118.74 615.75 113.25 617.33 118.74 618.9 4 Y
V
133.61 617.33 119.04 617.33 2 L
2 Z
N
299.78 577.12 325.85 657.53 R
7 X
V
0.3 H
0 X
N
(lock\050\051) 0 -90 316 642.22 TF
(No) 0 -90 183.04 603.92 TF
(Yes) 0 -90 236.64 561.4 TF
(unlock\050\051) 0 -90 226.65 441.64 TF
104.43 587.23 102.85 587.23 104.43 592.72 106 587.23 4 Y
0.6 H
0 Z
N
104.43 587.23 102.85 587.23 104.43 592.72 106 587.23 4 Y
V
205.68 409.77 104.43 409.77 104.43 586.93 3 L
2 Z
N
(count--) 0 -90 307.66 642.22 TF
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
(owner = NULL) 0 -90 235.46 441.64 TF
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(148) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(T) 442.03 686.11 T
(esting Recur) 453.85 686.11 T
(sive Mute) 583.39 686.11 T
(x) 680.78 686.11 T
(es:) 692.48 686.11 T
(test_recur) 464.12 657.53 T
(sive_m) 567.46 657.53 T
(ute) 639.74 657.53 T
(x.c) 671.58 657.53 T
4 7.15 Q
(/*                test_recursive_mutex.c                */) 411.22 615.84 T
(/*) 411.22 599.16 T
(  Test your recursive mutex.  Replace \322thread_recursive_mutex\323 with) 411.22 582.48 T
(  \322my_thread_recursive_mutex\323, then write it!) 411.22 574.15 T
(*/) 411.22 557.47 T
(/*) 411.22 532.45 T
(cc -o test_recursive_mutex test_recursive_mutex.c -L. -R. -g -lpthread -lthread) 411.22 524.12 T
(-thread_extensions -lposix4) 411.22 515.78 T
(*/) 411.22 507.44 T
(#define _POSIX_C_SOURCE 199506L) 411.22 490.77 T
(#include <pthread.h>) 411.22 474.09 T
(#include <semaphore.h>) 411.22 465.75 T
(#include <errno.h>) 411.22 457.41 T
(#include <time.h>) 411.22 449.07 T
(#include \322thread_extensions.h\323) 411.22 440.74 T
(typedef struct {) 411.22 424.06 T
(  pthread_mutex_t       lock;           /* lock for structure */) 411.22 415.72 T
(  pthread_cond_t        cv;             /* waiting list control */) 411.22 407.38 T
(  pthread_t             owner;          /* NULL_TID or TID */) 411.22 399.05 T
(} my_thread_recursive_mutex_t;) 411.22 390.71 T
(char *s[6] = {\322\322, \322*\323, \322**\323, \322***\323, \322****\323, \322*****\323};) 411.22 365.69 T
(thread_recursive_mutex_t m;) 411.22 340.68 T
(void *recursive\050void *arg\051) 411.22 315.66 T
({int            i = \050int\051 arg;) 411.22 307.33 T
( pthread_t      tid = pthread_self\050\051;) 411.22 298.99 T
( char           *name = thread_name\050tid\051;) 411.22 290.65 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 74
%%Page: "mini" 75
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(149) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( if \050i > 0\051) 37.72 678.97 T
(   {printf\050\322%s Trying to enter level %d \134t%s\134n\323, name, 6-i, s[6-i]\051;) 37.72 670.63 T
(    thread_recursive_mutex_lock\050&m\051;) 37.72 662.29 T
(    printf\050\322%s Entered         level %d \134t%s\134n\323, name, 6-i, s[6-i]\051;) 37.72 653.95 T
(    delay\050200, 0\051;) 37.72 645.62 T
(    recursive\050\050void *\051\050i-1\051\051;) 37.72 637.28 T
(    thread_recursive_mutex_unlock\050&m\051;) 37.72 628.94 T
(    printf\050\322%s Leaving         level %d \134t%s\134n\323, name, 6-i, s[6-i]\051;) 37.72 620.6 T
(  }) 37.72 612.26 T
( return;) 37.72 603.92 T
(}) 37.72 595.59 T
(main\050int argc, char **argv\051) 37.72 570.57 T
({int                    i;) 37.72 562.23 T
( pthread_attr_t         attr;) 37.72 553.9 T
( pthread_t              tid;) 37.72 545.56 T
( thread_recursive_mutex_init\050&m, NULL\051;) 37.72 528.88 T
( PTHREAD_ATTR_INIT\050&attr\051;) 37.72 512.21 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 37.72 503.87 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 37.72 495.53 T
( PTHREAD_CREATE\050&tid, &attr, recursive, \050void *\051 5\051;) 37.72 478.85 T
( PTHREAD_CREATE\050&tid, &attr, recursive, \050void *\051 5\051;) 37.72 470.52 T
( PTHREAD_CREATE\050&tid, &attr, recursive, \050void *\051 5\051;) 37.72 462.18 T
( pthread_exit\0500\051;) 37.72 445.5 T
(}) 37.72 437.16 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(150) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Bil\325) 450.44 686.11 T
(s Extensions \050Librar) 482.51 686.11 T
(y\051:) 688.86 686.11 T
(thread_e) 478.65 657.53 T
(xtensions.h) 567.7 657.53 T
4 7.15 Q
(/*) 411.22 615.84 T
(        A set of useful functions and macros for pthreads programs.) 411.22 607.5 T
(*/) 411.22 599.16 T
(#include <pthread.h>) 411.22 582.48 T
(#include <semaphore.h>) 411.22 574.15 T
(#define _POSIX_C_SOURCE 199506L) 411.22 549.13 T
(/* Some useful constants */) 411.22 532.45 T
(#ifndef NULL) 411.22 524.12 T
(# define NULL           \050\050void*\0510\051) 411.22 515.78 T
(#endif) 411.22 507.44 T
(#ifndef TRUE) 411.22 499.1 T
(# define TRUE           1) 411.22 490.77 T
(#endif) 411.22 482.43 T
(#ifndef FALSE) 411.22 474.09 T
(# define FALSE          0) 411.22 465.75 T
(#endif) 411.22 457.41 T
(#define DEBUG\050arg\051      {if \050getenv\050\322DEBUG\323\051\051 arg;}) 411.22 449.07 T
(/* This NULL_TID may not work on all implementations! */) 411.22 440.74 T
(#define NULL_TID        \050pthread_t\051 0L) 411.22 432.4 T
(/*) 411.22 407.38 T
(   ================================================================) 411.22 399.05 T
(                        General List) 411.22 390.71 T
(   ================================================================) 411.22 382.37 T
(*/) 411.22 374.03 T
(typedef struct _list_t {) 411.22 357.35 T
(        void            *frst;) 411.22 349.02 T
(        struct _list_t  *next;) 411.22 340.68 T
(} list_t;) 411.22 332.34 T
(extern          list_t  *cons\050void *, void *\051;) 411.22 315.66 T
(extern          int     empty\050list_t *\051;) 411.22 307.33 T
(extern          void    *first\050list_t *\051;) 411.22 298.99 T
(extern          list_t  *rest\050list_t *\051;) 411.22 290.65 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 75
%%Page: "mini" 76
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(151) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(/*) 37.72 687.31 T
(   ================================================================) 37.72 678.97 T
(                        Readers / Writer Lock) 37.72 670.63 T
(   ================================================================) 37.72 662.29 T
(*/) 37.72 653.95 T
(/*) 37.72 637.28 T
(   Definitions for rw locks adapted from Sun\325s SPILT package.) 37.72 628.94 T
(   RWLocks are  not part of the POSIX threads standard, but) 37.72 620.6 T
(   they are part of UNIX98.) 37.72 612.26 T
(*/) 37.72 603.92 T
(#define THREAD_RWLOCK_INITIALIZER \134) 37.72 587.25 T
( {PTHREAD_MUTEX_INITIALIZER, PTHREAD_COND_INITIALIZER, \134) 37.72 578.91 T
(    PTHREAD_COND_INITIALIZER, 0, 0}) 37.72 570.57 T
(typedef struct {) 37.72 553.9 T
(  pthread_mutex_t       lock;           /* lock for structure           */) 37.72 545.56 T
(  pthread_cond_t        readers;        /* waiting readers              */) 37.72 537.22 T
(  pthread_cond_t        writers;        /* waiting writers              */) 37.72 528.88 T
(  int                   state;          /* -1:writer,0:free,>0:readers  */) 37.72 520.54 T
(  int                   waiters;        /* number of waiting writers    */) 37.72 512.21 T
(} thread_rwlock_t;) 37.72 503.87 T
(typedef int thread_rwlock_attr_t;       /* Not implemented */) 37.72 487.19 T
(extern  int     thread_rwlock_init\050thread_rwlock_t *,) 37.72 470.52 T
(                                        thread_rwlock_attr_t *\051;) 37.72 462.18 T
(extern  int     thread_rwlock_destroy\050thread_rwlock_t *\051;) 37.72 453.84 T
(extern  int     thread_rw_rdlock\050thread_rwlock_t *\051;) 37.72 445.5 T
(extern  int     thread_rw_tryrdlock\050thread_rwlock_t *\051;) 37.72 437.16 T
(extern  int     thread_rw_wrlock\050thread_rwlock_t *\051;) 37.72 428.82 T
(extern  int     thread_rw_trywrlock\050thread_rwlock_t *\051;) 37.72 420.49 T
(extern  int     thread_rw_unlock\050thread_rwlock_t *\051;) 37.72 412.15 T
(/*) 37.72 378.8 T
(   ================================================================) 37.72 370.46 T
(                        Fifo Mutex Lock) 37.72 362.12 T
(   ================================================================) 37.72 353.78 T
(*/) 37.72 345.44 T
(typedef struct _fifo_mutex_queue_t {) 37.72 328.77 T
(  pthread_t                     tid;) 37.72 320.43 T
(  sem_t                         semaphore;) 37.72 312.09 T
(  struct _fifo_mutex_queue_t    *next;) 37.72 303.75 T
(} fifo_mutex_queue_t;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(152) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(#define THREAD_FIFO_MUTEX_INITIALIZER \134) 411.22 678.97 T
( {PTHREAD_MUTEX_INITIALIZER, NULL, FALSE, NULL_TID}) 411.22 670.63 T
(typedef struct  {) 411.22 645.62 T
(  pthread_mutex_t       lock;           /* lock for structure           */) 411.22 637.28 T
(  fifo_mutex_queue_t    *waitersQueue;  /* queue of waiting writers     */) 411.22 628.94 T
(  fifo_mutex_queue_t    *waitersQueueLast; /* last of waiting writers   */) 411.22 620.6 T
(  int                   owned;          /* TRUE | FALSE | -1:awaiting   */) 411.22 612.26 T
(  pthread_t             owner;          /* tid of owner                 */) 411.22 603.92 T
(} thread_fifo_mutex_t;) 411.22 595.59 T
(extern  int     thread_fifo_mutex_init\050thread_fifo_mutex_t *,) 411.22 578.91 T
(                                            pthread_mutexattr_t *\051;) 411.22 570.57 T
(extern  int     thread_fifo_mutex_destroy\050thread_fifo_mutex_t *\051;) 411.22 562.23 T
(extern  int     thread_fifo_mutex_lock\050thread_fifo_mutex_t *\051;) 411.22 553.9 T
(extern  int     thread_fifo_mutex_trylock\050thread_fifo_mutex_t *\051;) 411.22 545.56 T
(extern  int     thread_fifo_mutex_unlock\050thread_fifo_mutex_t *\051;) 411.22 537.22 T
(/*) 411.22 512.21 T
(   ================================================================) 411.22 503.87 T
(                        Debug Mutex Lock) 411.22 495.53 T
(   ================================================================) 411.22 487.19 T
(*/) 411.22 478.85 T
(#define PTHREAD_DMUTEX_INITIALIZER \134) 411.22 453.84 T
( {PTHREAD_MUTEX_INITIALIZER, PTHREAD_COND_INITIALIZER, \134) 411.22 445.5 T
(    NULL, NULL, 0, 0, FALSE, NULL_TID}) 411.22 437.16 T
(typedef struct _sleep_queue_t {) 411.22 420.49 T
(  pthread_t                     tid;) 411.22 412.15 T
(  struct _sleep_queue_t         *next;) 411.22 403.81 T
(} sleep_queue_t;) 411.22 395.47 T
(typedef struct _dmutex {) 411.22 370.46 T
(  pthread_mutex_t       lock;           /* lock for structure   */) 411.22 362.12 T
(  pthread_cond_t        cv;             /* waiting list control */) 411.22 353.78 T
(  char                  *name;          /* The declared name    */) 411.22 345.44 T
(  sleep_queue_t         *sleepers;      /* List of sleepers     */) 411.22 337.11 T
(  int                   n_locked;       /* Number of times locked */) 411.22 328.77 T
(  int                   n_failed;       /* Times woken w/o locking */) 411.22 320.43 T
(  int                   owned;          /* TRUE | FALSE         */) 411.22 312.09 T
(  pthread_t             owner;          /* NULL_TID or TID      */) 411.22 303.75 T
(} pthread_dmutex_t;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 76
%%Page: "mini" 77
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(153) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(typedef struct _dmutex_queue_t {) 37.72 687.31 T
(  struct _dmutex                *mutex;) 37.72 678.97 T
(  struct _dmutex_queue_t        *next;) 37.72 670.63 T
(} dmutex_queue_t;) 37.72 662.29 T
(extern  int     pthread_dmutex_init\050pthread_dmutex_t *, pthread_mutexattr_t *\051;) 37.72 645.62 T
(extern  int     pthread_dmutex_destroy\050pthread_dmutex_t *\051;) 37.72 637.28 T
(extern  int     pthread_dmutex_lock\050pthread_dmutex_t *\051;) 37.72 628.94 T
(extern  int     pthread_dmutex_trylock\050pthread_dmutex_t *\051;) 37.72 620.6 T
(extern  int     pthread_dmutex_unlock\050pthread_dmutex_t *\051;) 37.72 612.26 T
(#define pthread_dmutex_init\050m, a\051 pthread_dmutex_init1\050m, a, #m\051) 37.72 595.59 T
(/*) 37.72 578.91 T
(   ================================================================) 37.72 570.57 T
(                        Recursive Mutex Lock) 37.72 562.23 T
(   ================================================================) 37.72 553.9 T
(*/) 37.72 545.56 T
(#define THREAD_RECURSIVE_MUTEX_INITIALIZER \134) 37.72 528.88 T
( {PTHREAD_MUTEX_INITIALIZER, PTHREAD_COND_INITIALIZER, 0, FALSE, NULL_TID}) 37.72 520.54 T
(typedef struct  {) 37.72 495.53 T
(  pthread_mutex_t       lock;           /* lock for structure           */) 37.72 487.19 T
(  pthread_cond_t        cv;             /* waiting list control         */) 37.72 478.85 T
(  int                   count;          /* times locked recursively     */) 37.72 470.52 T
(  int                   owned;          /* TRUE | FALSE         */) 37.72 462.18 T
(  pthread_t             owner;          /* NULL_TID or TID      */) 37.72 453.84 T
(} thread_recursive_mutex_t;) 37.72 445.5 T
(extern  int     thread_recursive_mutex_init\050thread_recursive_mutex_t *,) 37.72 428.82 T
(                                                 pthread_mutexattr_t *\051;) 37.72 420.49 T
(extern  int     thread_recursive_mutex_destroy\050thread_recursive_mutex_t *\051;) 37.72 412.15 T
(extern  int     thread_recursive_mutex_lock\050thread_recursive_mutex_t *\051;) 37.72 403.81 T
(extern  int     thread_recursive_mutex_trylock\050thread_recursive_mutex_t *\051;) 37.72 395.47 T
(extern  int     thread_recursive_mutex_unlock\050thread_recursive_mutex_t *\051;) 37.72 387.13 T
(/*) 37.72 370.46 T
(   ================================================================) 37.72 362.12 T
(                                Barrier) 37.72 353.78 T
(   ================================================================) 37.72 345.44 T
(*/) 37.72 337.11 T
(typedef struct {) 37.72 303.75 T
(  pthread_mutex_t       lock;           /* lock for structure           */) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(154) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  pthread_cond_t        cv;             /* waiting list control         */) 411.22 695.65 T
(  int                   count;          /* Number of threads to wait for*/) 411.22 687.31 T
(  int                   n_sleepers;     /* Number of threads to waiting */) 411.22 678.97 T
(  int                   releasing;      /* Still waking up sleepers     */) 411.22 670.63 T
(} thread_barrier_t;) 411.22 662.29 T
(extern  int     thread_barrier_init\050thread_barrier_t *, int\051;) 411.22 645.62 T
(extern  int     thread_barrier_destroy\050thread_barrier_t *\051;) 411.22 637.28 T
(extern  int     thread_barrier_wait\050thread_barrier_t *\051;) 411.22 628.94 T
(extern  int     thread_barrier_trywait\050thread_barrier_t *\051;) 411.22 620.6 T
(/*) 411.22 595.59 T
(   ================================================================) 411.22 587.25 T
(                                Single Barrier) 411.22 578.91 T
(   ================================================================) 411.22 570.57 T
(*/) 411.22 562.23 T
(typedef struct  {) 411.22 528.88 T
(  pthread_mutex_t       lock;           /* lock for structure           */) 411.22 520.54 T
(  pthread_cond_t        cv;             /* waiting list control         */) 411.22 512.21 T
(  int                   count;          /* Number of threads to post    */) 411.22 503.87 T
(  int                   n_posters;      /* Number of threads who posted */) 411.22 495.53 T
(  int                   n_waiters;      /* Number of threads waiting    */) 411.22 487.19 T
(  int                   releasing;      /* Still waking up sleepers     */) 411.22 478.85 T
(} thread_single_barrier_t;) 411.22 470.52 T
(extern  int     thread_single_barrier_init\050thread_single_barrier_t *, int\051;) 411.22 453.84 T
(extern  int     thread_single_barrier_destroy\050thread_single_barrier_t *\051;) 411.22 445.5 T
(extern  int     thread_single_barrier_wait\050thread_single_barrier_t *\051;) 411.22 437.16 T
(extern  int     thread_single_barrier_post\050thread_single_barrier_t *\051;) 411.22 428.82 T
(/*) 411.22 412.15 T
(   ================================================================) 411.22 403.81 T
(                        Timed Mutex Lock) 411.22 395.47 T
(   ================================================================) 411.22 387.13 T
(*/) 411.22 378.8 T
(#define THREAD_TIMED_MUTEX_INITIALIZER  \134) 411.22 362.12 T
( {PTHREAD_MUTEX_INITIALIZER, PTHREAD_COND_INITIALIZER, FALSE, NULL_TID, 0}) 411.22 353.78 T
(typedef struct _timed_mutex {) 411.22 328.77 T
(  pthread_mutex_t       lock;           /* lock for structure           */) 411.22 320.43 T
(  pthread_cond_t        cv;             /* waiting list control         */) 411.22 312.09 T
(  int                   owned;          /* TRUE | FALSE                 */) 411.22 303.75 T
(  pthread_t             owner;          /* NULL_TID or TID              */) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 77
%%Page: "mini" 78
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(155) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  const struct timespec *abstime;       /* absolute time before timeout */) 37.72 695.65 T
(} thread_timed_mutex_t;) 37.72 687.31 T
(extern  int     thread_timed_mutex_init\050thread_timed_mutex_t *,) 37.72 670.63 T
(                                                 pthread_mutexattr_t *\051;) 37.72 662.29 T
(extern  int     thread_timed_mutex_destroy\050thread_timed_mutex_t *\051;) 37.72 653.95 T
(extern  int     thread_timed_mutex_lock\050thread_timed_mutex_t *,) 37.72 645.62 T
(                                            const struct timespec *\051;) 37.72 637.28 T
(extern  int     thread_timed_mutex_trylock\050thread_timed_mutex_t *\051;) 37.72 628.94 T
(extern  int     thread_timed_mutex_unlock\050thread_timed_mutex_t *\051;) 37.72 620.6 T
(/*) 37.72 603.92 T
(   ================================================================) 37.72 595.59 T
(                        Assorted Useful Functions) 37.72 587.25 T
(   ================================================================) 37.72 578.91 T
(*/) 37.72 570.57 T
(extern  char    *thread_name\050pthread_t\051;) 37.72 553.9 T
(int PTHREAD_CREATE\050pthread_t *new_thread_ID,) 37.72 528.88 T
(                   const pthread_attr_t *attr,) 37.72 520.54 T
(                   void * \050*start_func\051\050void *\051, void *arg\051;) 37.72 512.21 T
(int PTHREAD_ATTR_INIT\050pthread_attr_t *a\051;) 37.72 495.53 T
(int PTHREAD_CONDATTR_INIT\050pthread_condattr_t *a\051;) 37.72 478.85 T
(int PTHREAD_MUTEXATTR_INIT\050pthread_mutexattr_t *a\051;) 37.72 462.18 T
(int SEM_INIT\050sem_t *sem, int pshared, unsigned int value\051;) 37.72 445.5 T
(int SEM_WAIT\050sem_t *arg\051;) 37.72 428.82 T
(void delay\050int sleep_ms, int cpu_us\051;) 37.72 412.15 T
(void *killer\050void *arg\051;) 37.72 395.47 T
(/*-----------------------------------------------------------------------------) 37.72 378.8 T
( *) 37.72 370.46 T
( * Library Name: UTIL) 37.72 362.12 T
( * Module Name:  iobench) 37.72 353.78 T
( *) 37.72 345.44 T
( * Designer:    R. C. Sullivan) 37.72 337.11 T
( * Programmer:  R. C. Sullivan) 37.72 328.77 T
( * Date:        Sep 22, 1995) 37.72 320.43 T
( *) 37.72 312.09 T
( * History Of Changes:) 37.72 303.75 T
( *      Name         Date            Description) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(156) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( *      ----         ----            -----------) 411.22 695.65 T
( *      RCS     Jan 17, 1996     Inital release) 411.22 687.31 T
( *) 411.22 678.97 T
( * Purpose:) 411.22 670.63 T
( *   To report resource usage statistics that will be correct for) 411.22 662.29 T
( * programs using threads on a Solaris system.) 411.22 653.95 T
( *) 411.22 645.62 T
( * Notes:) 411.22 637.28 T
( *) 411.22 628.94 T
( *-----------------------------------------------------------------------------) 411.22 620.6 T
( */) 411.22 612.26 T
(extern struct prusage prusagebuf_start, prusagebuf_end;) 411.22 595.59 T
(extern int procfd;) 411.22 587.25 T
(extern double real_time, user_time, system_time, trap_time, wait_time;) 411.22 578.91 T
(extern unsigned long minor_pfs, major_pfs, input_blocks, output_blocks, iochars;) 411.22 570.57 T
(void iobench_start\050\051;) 411.22 553.9 T
(void iobench_end\050\051;) 411.22 545.56 T
(void iobench_report\050\051;) 411.22 537.22 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 78
%%Page: "mini" 79
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(157) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Bil\325) 76.94 686.11 T
(s Extensions \050Librar) 109.01 686.11 T
(y\051:) 315.36 686.11 T
(thread_e) 105.74 657.53 T
(xtensions.c) 194.79 657.53 T
4 7.15 Q
( /*                thread_extensions.c                */) 37.72 615.84 T
(/*) 37.72 599.16 T
(  Lots of useful functions for all sorts of neat things.) 37.72 590.82 T
(   I changed the names to avoid all conflicts / confusion) 37.72 574.15 T
(   with Solaris threads.) 37.72 565.81 T
(*/) 37.72 557.47 T
(/*) 37.72 540.79 T
(cc  -G -o libthread_extensions.so thread_extensions.c -g -lpthread) 37.72 532.45 T
(        -lthread -lposix4) 37.72 524.12 T
(*/) 37.72 507.44 T
(#include <stdio.h>) 37.72 465.75 T
(#include <errno.h>) 37.72 457.41 T
(#include \322thread_extensions.h\323) 37.72 449.07 T
(#define _POSIX_C_SOURCE 199506L) 37.72 424.06 T
(pthread_key_t   sleep_queue_key, FIFO_MUTEX_QUEUE_KEY;) 37.72 399.05 T
(void dmutex_key_initializer\050\051;) 37.72 382.37 T
(#ifdef __sun) 37.72 365.69 T
( /*  This runs before main\050\051 and declares the TSD key. */) 37.72 357.35 T
(#pragma init\050dmutex_key_initializer\051) 37.72 349.02 T
(#pragma init\050fifo_key_initializer\051) 37.72 340.68 T
(#endif) 37.72 332.34 T
(#if defined\050__alpha\051 && \050__osf__\051) 37.72 315.66 T
(void __init_dmutex_key\050\051) 37.72 307.33 T
({) 37.72 298.99 T
(  dmutex_key_initializer\050\051;) 37.72 290.65 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(158) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  fifo_key_initializer\050\051;) 411.22 695.65 T
(}) 411.22 687.31 T
(#endif) 411.22 678.97 T
(/*) 411.22 637.28 T
(   ================================================================) 411.22 628.94 T
(                        General List) 411.22 620.6 T
(   ================================================================) 411.22 612.26 T
(*/) 411.22 603.92 T
(list_t *cons\050void *obj, void *lst\051 {) 411.22 587.25 T
(  list_t                *l = \050list_t *\051 malloc\050sizeof\050list_t\051\051;) 411.22 578.91 T
(  l->frst = obj;) 411.22 562.23 T
(  l->next = lst;) 411.22 553.9 T
(  return\050l\051;) 411.22 545.56 T
(}) 411.22 537.22 T
(int empty\050list_t *l\051 {return\050l == NULL\051;}) 411.22 520.54 T
(void *first\050list_t *l\051 {return\050l->frst\051;}) 411.22 512.21 T
(list_t *rest\050list_t *l\051 {return\050l->next\051;}) 411.22 503.87 T
(/*) 411.22 478.85 T
(   ================================================================) 411.22 470.52 T
(                        Stringify \050for printing\051 TIDs) 411.22 462.18 T
(   ================================================================) 411.22 453.84 T
(*/) 411.22 445.5 T
(typedef struct _pt) 411.22 420.49 T
({pthread_t      tid;) 411.22 412.15 T
( char           *name;) 411.22 403.81 T
( struct _pt     *next;) 411.22 395.47 T
(} thread_name_t;) 411.22 387.13 T
(#if \050!defined\050__sun\051 && !defined\050__sgi\051\051) 411.22 370.46 T
(char *thread_name\050pthread_t tid\051) 411.22 353.78 T
({char s[100];) 411.22 345.44 T
( thread_name_t *n;) 411.22 337.11 T
( static int tid_count = 1000;) 411.22 328.77 T
( static pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;) 411.22 320.43 T
( static thread_name_t *thread_names = NULL;) 411.22 312.09 T
( if \050pthread_equal\050NULL_TID, tid\051\051 tid = pthread_self\050\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 79
%%Page: "mini" 80
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(159) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_mutex_lock\050&lock\051;) 37.72 695.65 T
(   for \050n = thread_names; n != NULL; n=n->next\051) 37.72 678.97 T
(     {if \050pthread_equal\050n->tid, tid\051\051) 37.72 670.63 T
(        goto L;) 37.72 662.29 T
(    }) 37.72 653.95 T
( n = \050thread_name_t *\051 malloc\050sizeof\050thread_name_t\051\051;) 37.72 645.62 T
( n->tid = tid;) 37.72 637.28 T
(#if defined\050__alpha\051 && defined\050__osf__\051) 37.72 628.94 T
( sprintf\050s, \322T@%d\323, pthread_getsequence_np\050tid\051\051;) 37.72 620.6 T
(#else) 37.72 612.26 T
( sprintf\050s, \322T@%d\323, tid_count\051;) 37.72 603.92 T
( tid_count++;) 37.72 595.59 T
(#endif) 37.72 587.25 T
( n->name = \050char *\051 malloc\050strlen\050s\051+1\051;) 37.72 578.91 T
( strcpy\050n->name, s\051;) 37.72 570.57 T
( n->next = thread_names;) 37.72 562.23 T
( thread_names = n;) 37.72 553.9 T
(L:pthread_mutex_unlock\050&lock\051;) 37.72 537.22 T
( return\050n->name\051;) 37.72 528.88 T
(}) 37.72 520.54 T
(#else) 37.72 503.87 T
(/* For known implementations, use the underlying TID numbering */) 37.72 495.53 T
(char *thread_name\050pthread_t tid\051) 37.72 478.85 T
({char s[100];) 37.72 470.52 T
( thread_name_t *n;) 37.72 462.18 T
( static pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;) 37.72 445.5 T
( static thread_name_t *thread_names = NULL;) 37.72 437.16 T
( if \050pthread_equal\050NULL_TID, tid\051\051 tid = pthread_self\050\051;) 37.72 420.49 T
( pthread_mutex_lock\050&lock\051;) 37.72 412.15 T
(   for \050n = thread_names; n != NULL; n=n->next\051) 37.72 395.47 T
(     {if \050pthread_equal\050n->tid, tid\051\051) 37.72 387.13 T
(        goto L;) 37.72 378.8 T
(    }) 37.72 370.46 T
( n = \050thread_name_t *\051 malloc\050sizeof\050thread_name_t\051\051;) 37.72 362.12 T
( n->tid = tid;) 37.72 353.78 T
( sprintf\050s, \322T@%d\323, \050int\051 tid\051;) 37.72 345.44 T
( n->name = \050char *\051 malloc\050strlen\050s\051+1\051;) 37.72 337.11 T
( strcpy\050n->name, s\051;) 37.72 328.77 T
( n->next = thread_names;) 37.72 320.43 T
( thread_names = n;) 37.72 312.09 T
(L:pthread_mutex_unlock\050&lock\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(160) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( return\050n->name\051;) 411.22 695.65 T
(}) 411.22 687.31 T
(#endif) 411.22 678.97 T
(/*) 411.22 653.95 T
(   ================================================================) 411.22 645.62 T
(                        Readers / Writer Lock) 411.22 637.28 T
(   ================================================================) 411.22 628.94 T
(*/) 411.22 620.6 T
(int thread_rwlock_init\050thread_rwlock_t *rwp,) 411.22 603.92 T
(                           thread_rwlock_attr_t *attr\051) 411.22 595.59 T
({int                    ptype;) 411.22 587.25 T
( pthread_mutexattr_t    mutex_attr;) 411.22 578.91 T
( pthread_condattr_t     cond_attr;) 411.22 570.57 T
( pthread_mutexattr_init\050&mutex_attr\051;) 411.22 553.9 T
( pthread_condattr_init\050&cond_attr\051;) 411.22 545.56 T
(    /* Not Implemented ...) 411.22 528.88 T
(    ptype = thread_rwlock_attr_getshared\050&attr\051;) 411.22 520.54 T
(    pthread_mutexattr_setpshared\050&mutex_attr, ptype\051;) 411.22 512.21 T
(    pthread_condattr_setpshared\050&cond_attr, ptype\051;) 411.22 503.87 T
(    */) 411.22 495.53 T
( pthread_mutex_init\050&rwp->lock, &mutex_attr\051;) 411.22 478.85 T
( pthread_cond_init\050&rwp->readers, &cond_attr\051;) 411.22 470.52 T
( pthread_cond_init\050&rwp->writers, &cond_attr\051;) 411.22 462.18 T
( rwp->state     = 0;) 411.22 445.5 T
( rwp->waiters   = 0;) 411.22 437.16 T
( return\0500\051;) 411.22 420.49 T
(}) 411.22 412.15 T
(int thread_rwlock_destroy\050thread_rwlock_t *rwp\051) 411.22 387.13 T
({) 411.22 378.8 T
(  pthread_mutex_destroy\050&rwp->lock\051;) 411.22 370.46 T
(  pthread_cond_destroy\050&rwp->readers\051;) 411.22 362.12 T
(  pthread_cond_destroy\050&rwp->writers\051;) 411.22 353.78 T
(  return\0500\051;) 411.22 337.11 T
(}) 411.22 328.77 T
(int thread_rw_rdlock\050thread_rwlock_t *rwp\051) 411.22 303.75 T
({pthread_mutex_t        *lkp    = &rwp->lock;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 80
%%Page: "mini" 81
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(161) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_mutex_lock\050lkp\051;) 37.72 687.31 T
( pthread_cleanup_push\050pthread_mutex_unlock, lkp\051;) 37.72 678.97 T
( /* active or queued writers            */) 37.72 670.63 T
( while \050\050rwp->state < 0\051 || rwp->waiters\051) 37.72 662.29 T
(   pthread_cond_wait\050&rwp->readers, lkp\051;) 37.72 653.95 T
( rwp->state++;) 37.72 637.28 T
( pthread_cleanup_pop\0501\051;) 37.72 628.94 T
( return\0500\051;) 37.72 612.26 T
(}) 37.72 603.92 T
(int thread_rw_tryrdlock\050thread_rwlock_t *rwp\051) 37.72 578.91 T
({int    status  = EBUSY;) 37.72 570.57 T
( pthread_mutex_lock\050&rwp->lock\051;) 37.72 553.9 T
( /* available and no writers queued     */) 37.72 545.56 T
( if \050\050rwp->state >= 0\051 && !rwp->waiters\051 {) 37.72 537.22 T
(   rwp->state++;) 37.72 528.88 T
(   status       = 0;) 37.72 520.54 T
( }) 37.72 512.21 T
( pthread_mutex_unlock\050&rwp->lock\051;) 37.72 495.53 T
( return\050status\051;) 37.72 478.85 T
(}) 37.72 470.52 T
(void thread_rw_wrlock_cleanup\050void *arg\051) 37.72 445.5 T
({thread_rwlock_t        *rwp    = \050thread_rwlock_t *\051 arg;) 37.72 437.16 T
( /*) 37.72 420.49 T
(  * Was the only queued writer and lock is available for readers.) 37.72 412.15 T
(  * Called through cancellation clean-up so lock is held at entry.) 37.72 403.81 T
(  */) 37.72 395.47 T
( if \050\050--rwp->waiters == 0\051 && \050rwp->state >= 0\051\051) 37.72 387.13 T
(   pthread_cond_broadcast\050&rwp->readers\051;) 37.72 378.8 T
( pthread_mutex_unlock\050&rwp->lock\051;) 37.72 362.12 T
( return;) 37.72 345.44 T
(}) 37.72 337.11 T
(int thread_rw_wrlock\050thread_rwlock_t *rwp\051) 37.72 312.09 T
({pthread_mutex_t        *lkp    = &rwp->lock;) 37.72 303.75 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(162) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( pthread_mutex_lock\050lkp\051;) 411.22 695.65 T
( rwp->waiters++;                /* another writer queued                */) 411.22 687.31 T
( pthread_cleanup_push\050thread_rw_wrlock_cleanup, rwp\051;) 411.22 678.97 T
( while \050rwp->state\051) 411.22 662.29 T
(   pthread_cond_wait\050&rwp->writers, lkp\051;) 411.22 653.95 T
( rwp->state     = -1;) 411.22 637.28 T
( pthread_cleanup_pop\0501\051;) 411.22 628.94 T
( return\0500\051;) 411.22 612.26 T
(}) 411.22 603.92 T
(int thread_rw_trywrlock\050thread_rwlock_t *rwp\051) 411.22 578.91 T
({int    status  = EBUSY;) 411.22 570.57 T
( pthread_mutex_lock\050&rwp->lock\051;) 411.22 553.9 T
( /* no readers, no writers, no writers queued   */) 411.22 545.56 T
( if \050!rwp->state && !rwp->waiters\051 {) 411.22 537.22 T
(   rwp->state   = -1;) 411.22 528.88 T
(   status               = 0;) 411.22 520.54 T
( }) 411.22 512.21 T
( pthread_mutex_unlock\050&rwp->lock\051;) 411.22 495.53 T
( return\050status\051;) 411.22 478.85 T
(}) 411.22 470.52 T
(int thread_rw_unlock\050thread_rwlock_t *rwp\051) 411.22 445.5 T
({pthread_mutex_lock\050&rwp->lock\051;) 411.22 437.16 T
( if \050rwp->state == -1\051 {        /* writer releasing     */) 411.22 420.49 T
(   rwp->state   = 0;            /* mark as available    */) 411.22 412.15 T
(   if \050rwp->waiters\051            /* writers queued       */) 411.22 395.47 T
(     pthread_cond_signal\050&rwp->writers\051;) 411.22 387.13 T
(   else) 411.22 378.8 T
(     pthread_cond_broadcast\050&rwp->readers\051;) 411.22 370.46 T
( } else {) 411.22 362.12 T
(   if \050--rwp->state == 0\051       /* no more readers      */) 411.22 353.78 T
(     pthread_cond_signal\050&rwp->writers\051;) 411.22 345.44 T
( }) 411.22 337.11 T
( pthread_mutex_unlock\050&rwp->lock\051;) 411.22 320.43 T
( return\0500\051;) 411.22 303.75 T
(}) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 81
%%Page: "mini" 82
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(163) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(/*) 37.72 678.97 T
(   ================================================================) 37.72 670.63 T
(                        Fifo Mutex Lock) 37.72 662.29 T
(   ================================================================) 37.72 653.95 T
(        Guarantees that all sleepers will get the mutex in correct) 37.72 637.28 T
(        order.) 37.72 628.94 T
(*/) 37.72 620.6 T
(int thread_fifo_mutex_init\050thread_fifo_mutex_t *m,) 37.72 595.59 T
(                               pthread_mutexattr_t *attr\051) 37.72 587.25 T
({) 37.72 578.91 T
(  pthread_mutex_init\050&\050m->lock\051, NULL\051;) 37.72 570.57 T
(  m->waitersQueue = NULL;) 37.72 562.23 T
(  m->owned = FALSE;) 37.72 553.9 T
(  m->owner = NULL_TID;) 37.72 545.56 T
(}) 37.72 537.22 T
(int thread_fifo_mutex_destroy\050thread_fifo_mutex_t *m\051) 37.72 512.21 T
({) 37.72 503.87 T
(  pthread_mutex_destroy\050&\050m->lock\051\051;) 37.72 495.53 T
(}) 37.72 487.19 T
(void fifo_queue_destroyer\050void *arg\051) 37.72 462.18 T
({) 37.72 453.84 T
(  fifo_mutex_queue_t *fifo_mutex_queue = \050fifo_mutex_queue_t *\051 arg;) 37.72 445.5 T
(  free\050fifo_mutex_queue\051;) 37.72 428.82 T
(}) 37.72 420.49 T
(void fifo_key_initializer\050\051) 37.72 395.47 T
({) 37.72 387.13 T
(  pthread_key_create\050&FIFO_MUTEX_QUEUE_KEY, fifo_queue_destroyer\051;) 37.72 378.8 T
(}) 37.72 370.46 T
(fifo_mutex_queue_t *get_fifo_mutex_queue\050\051) 37.72 337.11 T
({fifo_mutex_queue_t *fifo_mutex_queue =) 37.72 328.77 T
-0.24 (                \050fifo_mutex_queue_t *\051 pthread_getspecific\050FIFO_MUTEX_QUEUE_KEY\051;) 37.72 320.43 P
(int i;) 37.72 312.09 T
( if \050fifo_mutex_queue == NULL\051) 37.72 303.75 T
(        {fifo_mutex_queue = \050fifo_mutex_queue_t *\051 mal-) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(164) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(loc\050sizeof\050fifo_mutex_queue_t\051\051;) 411.22 695.65 T
(        i++;) 411.22 687.31 T
(         fifo_mutex_queue->tid = pthread_self\050\051;) 411.22 678.97 T
(         sem_init\050&fifo_mutex_queue->semaphore, FALSE, 0\051;) 411.22 670.63 T
(         pthread_setspecific\050FIFO_MUTEX_QUEUE_KEY, fifo_mutex_queue\051;) 411.22 662.29 T
(        }) 411.22 653.95 T
( return\050fifo_mutex_queue\051;) 411.22 645.62 T
(}) 411.22 637.28 T
(int thread_fifo_mutex_lock\050thread_fifo_mutex_t *m\051) 411.22 612.26 T
({pthread_t self = pthread_self\050\051;) 411.22 603.92 T
( fifo_mutex_queue_t *fifo_mutex_queue = get_fifo_mutex_queue\050\051;) 411.22 595.59 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 411.22 578.91 T
(  if \050!\050m->owned\051\051) 411.22 570.57 T
(    {m->owner = self;) 411.22 562.23 T
(     m->owned = TRUE;) 411.22 553.9 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 411.22 545.56 T
(     return\0500\051;}) 411.22 537.22 T
(  fifo_mutex_queue->next = NULL;) 411.22 520.54 T
(  if \050m->waitersQueue == NULL\051) 411.22 512.21 T
(    m->waitersQueue = fifo_mutex_queue;) 411.22 503.87 T
(  else) 411.22 495.53 T
(    m->waitersQueueLast->next = fifo_mutex_queue;) 411.22 487.19 T
(  m->waitersQueueLast = fifo_mutex_queue;) 411.22 478.85 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 411.22 470.52 T
(  SEM_WAIT\050&\050fifo_mutex_queue->semaphore\051\051;) 411.22 462.18 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 411.22 445.5 T
(  if \050m->owned != -1\051 {abort\0501\051;}  /* Cannot happen */) 411.22 437.16 T
(  m->owner = self;) 411.22 428.82 T
(  m->owned = TRUE;) 411.22 420.49 T
(  m->waitersQueue = m->waitersQueue->next;) 411.22 412.15 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 411.22 403.81 T
(  return\0500\051;) 411.22 395.47 T
(}) 411.22 387.13 T
(int thread_fifo_mutex_trylock\050thread_fifo_mutex_t *m\051) 411.22 362.12 T
({) 411.22 353.78 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 411.22 337.11 T
(  if \050!\050m->owned\051\051) 411.22 328.77 T
(    {m->owner = pthread_self\050\051;) 411.22 320.43 T
(     m->owned = TRUE;) 411.22 312.09 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 411.22 303.75 T
(     return\0500\051;}) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 82
%%Page: "mini" 83
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(165) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 695.65 T
(  return\050EBUSY\051;) 37.72 687.31 T
(}) 37.72 678.97 T
(int thread_fifo_mutex_unlock\050thread_fifo_mutex_t *m\051) 37.72 653.95 T
({) 37.72 645.62 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 37.72 637.28 T
(  m->owner = NULL_TID;) 37.72 628.94 T
(  if \050m->waitersQueue == NULL\051) 37.72 612.26 T
(    {m->owned = FALSE;) 37.72 603.92 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 595.59 T
(     return\0500\051;}) 37.72 587.25 T
(  m->owned = -1;) 37.72 570.57 T
(  sem_post\050&\050m->waitersQueue->semaphore\051\051;) 37.72 562.23 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 553.9 T
(  return\0500\051;) 37.72 545.56 T
(}) 37.72 537.22 T
(/*) 37.72 503.87 T
(   ================================================================) 37.72 495.53 T
(                        Simple \050wrong\051 Fifo Mutex Lock) 37.72 487.19 T
(   ================================================================) 37.72 478.85 T
(        Guarantees that a sleeper will get the mutex, even if) 37.72 462.18 T
(        some other thread trys first.  But several sleeping threads) 37.72 453.84 T
(        will NOT be FIFO.  But the implementation is simple.) 37.72 445.5 T
(int thread_fifo_mutex_init\050thread_fifo_mutex_t *m,) 37.72 412.15 T
(                               pthread_mutexattr_t *attr\051) 37.72 403.81 T
({) 37.72 395.47 T
(  pthread_mutex_init\050&\050m->lock\051, NULL\051;) 37.72 387.13 T
(  pthread_cond_init\050&\050m->cv\051, NULL\051;) 37.72 378.8 T
(  m->waiters = 0;) 37.72 370.46 T
(  m->owned = FALSE;) 37.72 362.12 T
(  m->owner = NULL_TID;) 37.72 353.78 T
(}) 37.72 345.44 T
(int thread_fifo_mutex_destroy\050thread_fifo_mutex_t *m\051) 37.72 320.43 T
({) 37.72 312.09 T
(  pthread_mutex_destroy\050&\050m->lock\051\051;) 37.72 303.75 T
(  pthread_cond_destroy\050&\050m->cv\051\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(166) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(}) 411.22 695.65 T
(int thread_fifo_mutex_lock\050thread_fifo_mutex_t *m\051) 411.22 670.63 T
({) 411.22 662.29 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 411.22 645.62 T
(  if \050!\050m->owned\051\051) 411.22 637.28 T
(    {m->owner = pthread_self\050\051;) 411.22 628.94 T
(     m->owned = TRUE;) 411.22 620.6 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 411.22 612.26 T
(     return\0500\051;}) 411.22 603.92 T
(  m->waiters++;) 411.22 587.25 T
(  /* Don\325t check for -1 the first time because) 411.22 578.91 T
(     that -1 is intended for a sleeper.) 411.22 570.57 T
(  pthread_cond_wait\050&\050m->cv\051, &\050m->lock\051\051;) 411.22 562.23 T
(  while \050m->owned != -1\051) 411.22 545.56 T
(    pthread_cond_wait\050&\050m->cv\051, &\050m->lock\051\051;) 411.22 537.22 T
(  /* A spurious wakeup at just the wrong moment will give) 411.22 528.88 T
(     ownership to the wrong thread.  So we\325re only 99.999% FIFO.) 411.22 520.54 T
(     But NEVER incorrect.) 411.22 512.21 T
(  m->owner = pthread_self\050\051;) 411.22 503.87 T
(  m->owned = TRUE;) 411.22 495.53 T
(  m->waiters--;) 411.22 487.19 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 411.22 478.85 T
(  return\0500\051;) 411.22 470.52 T
(}) 411.22 462.18 T
(int thread_fifo_mutex_trylock\050thread_fifo_mutex_t *m\051) 411.22 437.16 T
({) 411.22 428.82 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 411.22 412.15 T
(  if \050!\050m->owned\051\051) 411.22 403.81 T
(    {m->owner = pthread_self\050\051;) 411.22 395.47 T
(     m->owned = TRUE;) 411.22 387.13 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 411.22 378.8 T
(     return\0500\051;}) 411.22 370.46 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 411.22 362.12 T
(  return\050EBUSY\051;) 411.22 353.78 T
(}) 411.22 345.44 T
(int thread_fifo_mutex_unlock\050thread_fifo_mutex_t *m\051) 411.22 320.43 T
({) 411.22 312.09 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 411.22 303.75 T
(  m->owner = NULL_TID;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 83
%%Page: "mini" 84
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(167) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  if \050m->waiters == 0\051) 37.72 687.31 T
(    {m->owned = FALSE;) 37.72 678.97 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 670.63 T
(     return\0500\051;}) 37.72 662.29 T
(  m->owned = -1;) 37.72 645.62 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 637.28 T
(  pthread_cond_signal\050&\050m->cv\051\051;) 37.72 628.94 T
(  return\0500\051;) 37.72 620.6 T
(}) 37.72 612.26 T
(*/) 37.72 595.59 T
(/*) 37.72 562.23 T
(   ================================================================) 37.72 553.9 T
(                        Debug Mutex Lock) 37.72 545.56 T
(   ================================================================) 37.72 537.22 T
(        For debugging programs.  Do a global replace of _mutex_ with) 37.72 520.54 T
(        _dmutex_ and then the dmutex will detect self deadlocks,) 37.72 512.21 T
(        non-owner unlocks, and record the owner\325s TID for use from) 37.72 503.87 T
(        the debugger.) 37.72 495.53 T
(        If you call pthread_dmutex_init\050\051, then a macro will place) 37.72 478.85 T
(        the dmutex on a global list and record its name.  If you only) 37.72 470.52 T
(        use PTHREAD_DMUTEX_INITIALIZER, then no recording.  You may) 37.72 462.18 T
(        choose specific names via pthread_dmutex_init1\050\051.) 37.72 453.84 T
(        print_dmutexes\050\051 will print out the state \050and sleep queue\051) 37.72 437.16 T
(        for all mutexes on the list.  From the debugger:) 37.72 428.82 T
(        \050debugger\051 call print_dmutexes\050\051) 37.72 420.49 T
(*/) 37.72 403.81 T
(pthread_mutex_t dmutex_queue_lock = PTHREAD_MUTEX_INITIALIZER;) 37.72 387.13 T
(dmutex_queue_t  *dmutex_queue;) 37.72 378.8 T
(void dmutex_key_initializer\050\051) 37.72 353.78 T
({) 37.72 345.44 T
(  pthread_key_create\050&sleep_queue_key, NULL\051;) 37.72 337.11 T
( }) 37.72 328.77 T
(void insert_dmutex\050pthread_dmutex_t *m\051) 37.72 312.09 T
({dmutex_queue_t *dq;) 37.72 303.75 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(168) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( dq = \050dmutex_queue_t *\051 malloc\050sizeof\050dmutex_queue_t\051\051;) 411.22 695.65 T
( dq->mutex = m;) 411.22 687.31 T
( pthread_mutex_lock\050&dmutex_queue_lock\051;) 411.22 678.97 T
( dq->next = dmutex_queue;) 411.22 670.63 T
( dmutex_queue = dq;) 411.22 662.29 T
( pthread_mutex_unlock\050&dmutex_queue_lock\051;) 411.22 653.95 T
(}) 411.22 645.62 T
(void remove_dmutex\050dmutex_queue_t **q, pthread_dmutex_t *m\051) 411.22 628.94 T
({dmutex_queue_t *dq, *dq1;) 411.22 620.6 T
( pthread_mutex_lock\050&dmutex_queue_lock\051;) 411.22 603.92 T
( if \050\050*q\051->mutex == m\051) 411.22 587.25 T
(   {dq1 = dmutex_queue->next;) 411.22 578.91 T
(    *q = dq1->next;) 411.22 570.57 T
(    free\050dq1\051;) 411.22 562.23 T
(  }) 411.22 553.9 T
( else) 411.22 545.56 T
(   for \050dq = *q; dq->next != NULL; dq = dq->next\051) 411.22 537.22 T
(     if \050dq->next->mutex == m\051) 411.22 528.88 T
(       {dq1 = dq->next;) 411.22 520.54 T
(        dq->next = dq1->next;) 411.22 512.21 T
(        free\050dq1\051;) 411.22 503.87 T
(        break;) 411.22 495.53 T
(      }) 411.22 487.19 T
( pthread_mutex_unlock\050&dmutex_queue_lock\051;) 411.22 470.52 T
(}) 411.22 462.18 T
(void remove_sleeper\050sleep_queue_t **q, pthread_t tid\051) 411.22 445.5 T
({sleep_queue_t *dq, *dq1;) 411.22 437.16 T
( if \050pthread_equal\050\050*q\051->tid, tid\051\051) 411.22 420.49 T
(   {) 411.22 412.15 T
(     *q = \050*q\051->next;) 411.22 403.81 T
(   }) 411.22 395.47 T
( else) 411.22 387.13 T
(   for \050dq = *q; dq->next != NULL; dq = dq->next\051) 411.22 378.8 T
(     if \050pthread_equal\050dq->next->tid, tid\051\051) 411.22 370.46 T
(       {dq1 = dq->next;) 411.22 362.12 T
(        dq->next = dq1->next;) 411.22 353.78 T
(        break;) 411.22 345.44 T
(      }) 411.22 337.11 T
(}) 411.22 320.43 T
(void print_dmutex\050pthread_dmutex_t *m\051) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 84
%%Page: "mini" 85
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(169) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
({sleep_queue_t  *sq;) 37.72 695.65 T
( pthread_mutex_lock\050&\050m->lock\051\051;) 37.72 678.97 T
( flockfile \050stdout\051;) 37.72 670.63 T
(   if \050!m->owned\051) 37.72 662.29 T
(   printf\050\322%s ---- Times locked: %3d,  failed: %3d.  Sleepers: \050 \322,) 37.72 653.95 T
(          m->name, m->n_locked, m->n_failed\051;) 37.72 645.62 T
( else) 37.72 637.28 T
(   printf\050\322%s %s  Times locked: %3d,  failed: %3d.  Sleepers: \050 \322,) 37.72 628.94 T
(          m->name, thread_name\050m->owner\051, m->n_locked, m->n_failed\051;) 37.72 620.6 T
( for \050sq = m->sleepers; sq != NULL; sq = sq->next\051) 37.72 603.92 T
(   printf\050\322%s \322, thread_name\050sq->tid\051\051;) 37.72 595.59 T
( printf\050\322\051\134n\323\051;) 37.72 587.25 T
( funlockfile \050stdout\051;) 37.72 578.91 T
( pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 570.57 T
(}) 37.72 562.23 T
(void print_dmutexes\050\051) 37.72 528.88 T
({dmutex_queue_t *dq;) 37.72 520.54 T
( pthread_dmutex_t *m;) 37.72 512.21 T
( pthread_mutex_lock\050&dmutex_queue_lock\051;) 37.72 495.53 T
( for \050dq = dmutex_queue; dq != NULL; dq = dq->next\051) 37.72 487.19 T
(   {m = dq->mutex;) 37.72 478.85 T
(    print_dmutex\050m\051;) 37.72 470.52 T
(  }) 37.72 462.18 T
( pthread_mutex_unlock\050&dmutex_queue_lock\051;) 37.72 453.84 T
(}) 37.72 445.5 T
(int pthread_dmutex_init1\050pthread_dmutex_t *m, pthread_mutexattr_t *attr,) 37.72 412.15 T
(                         char *name\051) 37.72 403.81 T
({) 37.72 395.47 T
(  pthread_mutex_init\050&\050m->lock\051, NULL\051;) 37.72 387.13 T
(  pthread_cond_init\050&\050m->cv\051, NULL\051;) 37.72 378.8 T
(  m->owned = FALSE;) 37.72 370.46 T
(  m->owner = NULL_TID;) 37.72 362.12 T
(  m->name = name;) 37.72 353.78 T
(  m->sleepers = NULL;) 37.72 345.44 T
(  m->n_locked = 0;) 37.72 337.11 T
(  m->n_failed = 0;) 37.72 328.77 T
(  insert_dmutex\050m\051;) 37.72 320.43 T
(}) 37.72 312.09 T
(int pthread_dmutex_destroy\050pthread_dmutex_t *m\051) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(170) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
({) 411.22 695.65 T
(  pthread_mutex_destroy\050&\050m->lock\051\051;) 411.22 687.31 T
(  pthread_cond_destroy\050&\050m->cv\051\051;) 411.22 678.97 T
(  remove_dmutex\050&dmutex_queue, m\051;) 411.22 670.63 T
(}) 411.22 662.29 T
(int pthread_dmutex_lock\050pthread_dmutex_t *m\051) 411.22 628.94 T
({pthread_t tid = pthread_self\050\051;) 411.22 620.6 T
( sleep_queue_t *dq = \050sleep_queue_t *\051 pthread_getspecific\050sleep_queue_key\051;) 411.22 612.26 T
( if \050dq == NULL\051) 411.22 595.59 T
(   {dq = \050sleep_queue_t *\051 malloc\050sizeof\050sleep_queue_t\051\051;) 411.22 587.25 T
(    pthread_setspecific\050sleep_queue_key, dq\051;) 411.22 578.91 T
(    dq->tid = tid;) 411.22 570.57 T
(  }) 411.22 562.23 T
( pthread_mutex_lock\050&\050m->lock\051\051;) 411.22 545.56 T
( if \050pthread_equal\050m->owner, tid\051\051) 411.22 537.22 T
(   {if \050m->name\051) 411.22 528.88 T
(      printf\050\322Error! %s deadlocking dmutex %s.\134n\323, thread_name\050tid\051, m->name\051;) 411.22 520.54 T
(   else) 411.22 512.21 T
(     printf\050\322Error! %s deadlocking dmutex x%x.\134n\323, thread_name\050tid\051, m\051;) 411.22 503.87 T
(    abort\050\051;    /* I don\325t want it to exit.  I want it to crash. */) 411.22 495.53 T
(  }) 411.22 487.19 T
( while \050m->owned\051) 411.22 478.85 T
(   {dq->next = m->sleepers;) 411.22 470.52 T
(    m->sleepers = dq;) 411.22 462.18 T
(    m->n_failed++;) 411.22 453.84 T
(    pthread_cond_wait\050&\050m->cv\051, &\050m->lock\051\051;) 411.22 445.5 T
(    remove_sleeper\050&\050m->sleepers\051, tid\051;) 411.22 437.16 T
(   }) 411.22 428.82 T
( m->owner = tid;) 411.22 420.49 T
( m->owned = TRUE;) 411.22 412.15 T
( m->n_locked++;) 411.22 403.81 T
( pthread_mutex_unlock\050&\050m->lock\051\051;) 411.22 395.47 T
( return\0500\051;) 411.22 387.13 T
(}) 411.22 378.8 T
(int pthread_dmutex_trylock\050pthread_dmutex_t *m\051) 411.22 353.78 T
({pthread_t tid = pthread_self\050\051;) 411.22 345.44 T
( pthread_mutex_lock\050&\050m->lock\051\051;) 411.22 328.77 T
( if \050!\050m->owned\051\051) 411.22 320.43 T
(    {m->owner = tid;) 411.22 312.09 T
(     m->owned = TRUE;) 411.22 303.75 T
(     m->n_locked++;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 85
%%Page: "mini" 86
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(171) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 695.65 T
(     return\0500\051;) 37.72 687.31 T
(   }) 37.72 678.97 T
( m->n_failed++;) 37.72 670.63 T
( pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 662.29 T
( return\050EBUSY\051;) 37.72 653.95 T
(}) 37.72 645.62 T
(int pthread_dmutex_unlock\050pthread_dmutex_t *m\051) 37.72 620.6 T
({pthread_t tid = pthread_self\050\051;) 37.72 612.26 T
( pthread_mutex_lock\050&\050m->lock\051\051;) 37.72 595.59 T
( if \050!pthread_equal\050m->owner, tid\051\051) 37.72 587.25 T
(   {if \050m->name\051) 37.72 578.91 T
(      printf\050\322Error! %s unlocking dmutex %s owned by %s\134n\323,) 37.72 570.57 T
(             thread_name\050tid\051, m->name, thread_name\050m->owner\051\051;) 37.72 562.23 T
(   else) 37.72 553.9 T
(     printf\050\322Error! %s unlocking dmutex x%x owned by %s\134n\323,) 37.72 545.56 T
(            thread_name\050tid\051, m, thread_name\050m->owner\051\051;) 37.72 537.22 T
(    abort\050\051;    /* I don\325t want it to exit.  I want it to crash. */) 37.72 528.88 T
(    }) 37.72 520.54 T
( m->owned = FALSE;) 37.72 503.87 T
( m->owner = NULL_TID;) 37.72 495.53 T
( pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 487.19 T
( pthread_cond_signal\050&\050m->cv\051\051;) 37.72 478.85 T
( return\0500\051;) 37.72 470.52 T
(}) 37.72 462.18 T
(/*) 37.72 420.49 T
(   ================================================================) 37.72 412.15 T
(                        Recursive Mutex Lock) 37.72 403.81 T
(   ================================================================) 37.72 395.47 T
(        Allow the same thread to lock the mutex recursively) 37.72 378.8 T
(        \050requiring the same number of unlocks\051.) 37.72 370.46 T
(        Use of these is NOT recommended for any program!  Write) 37.72 353.78 T
(        your program better so that you don\325t WANT them.) 37.72 345.44 T
(*/) 37.72 337.11 T
(int thread_recursive_mutex_init\050thread_recursive_mutex_t *m,) 37.72 312.09 T
(                                    pthread_mutexattr_t *attr\051) 37.72 303.75 T
({) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(172) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  pthread_mutex_init\050&\050m->lock\051, NULL\051;) 411.22 695.65 T
(  pthread_cond_init\050&\050m->cv\051, NULL\051;) 411.22 687.31 T
(  m->owned = FALSE;) 411.22 678.97 T
(  m->owner = NULL_TID;) 411.22 670.63 T
(  m->count = 0;) 411.22 662.29 T
(}) 411.22 653.95 T
(int thread_recursive_mutex_destroy\050thread_recursive_mutex_t *m\051) 411.22 628.94 T
({) 411.22 620.6 T
(  pthread_mutex_destroy\050&\050m->lock\051\051;) 411.22 612.26 T
(  pthread_cond_destroy\050&\050m->cv\051\051;) 411.22 603.92 T
(}) 411.22 595.59 T
(int thread_recursive_mutex_lock\050thread_recursive_mutex_t *m\051) 411.22 562.23 T
({pthread_t tid = pthread_self\050\051;) 411.22 553.9 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 411.22 537.22 T
(  while \050m->owned && !pthread_equal\050m->owner, tid\051\051) 411.22 528.88 T
(    pthread_cond_wait\050&\050m->cv\051, &\050m->lock\051\051;) 411.22 520.54 T
( m->owner = tid;) 411.22 512.21 T
( m->owned = TRUE;) 411.22 503.87 T
( m->count++;) 411.22 495.53 T
( pthread_mutex_unlock\050&\050m->lock\051\051;) 411.22 487.19 T
( return\0500\051;) 411.22 478.85 T
(}) 411.22 470.52 T
(int thread_recursive_mutex_trylock\050thread_recursive_mutex_t *m\051) 411.22 445.5 T
({pthread_t tid = pthread_self\050\051;) 411.22 437.16 T
( pthread_mutex_lock\050&\050m->lock\051\051;) 411.22 420.49 T
( if \050!m->owned || pthread_equal\050m->owner, tid\051\051) 411.22 412.15 T
(    {m->owner = tid;) 411.22 403.81 T
(     m->owned = TRUE;) 411.22 395.47 T
(     m->count++;) 411.22 387.13 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 411.22 378.8 T
(     return\0500\051;) 411.22 370.46 T
(   }) 411.22 362.12 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 411.22 353.78 T
(  return\050EBUSY\051;) 411.22 345.44 T
(}) 411.22 337.11 T
(int thread_recursive_mutex_unlock\050thread_recursive_mutex_t *m\051) 411.22 312.09 T
({) 411.22 303.75 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 86
%%Page: "mini" 87
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(173) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  m->count--;) 37.72 695.65 T
(  if \050m->count == 0\051) 37.72 687.31 T
(    {m->owned = FALSE;) 37.72 678.97 T
(     m->owner = NULL_TID;) 37.72 670.63 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 662.29 T
(     pthread_cond_signal\050&\050m->cv\051\051;) 37.72 653.95 T
(     return\0500\051;) 37.72 645.62 T
(   }) 37.72 637.28 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 628.94 T
(  return\0500\051;) 37.72 620.6 T
(}) 37.72 612.26 T
(/*) 37.72 587.25 T
(   ================================================================) 37.72 578.91 T
(                        Barrier) 37.72 570.57 T
(   ================================================================) 37.72 562.23 T
(        Full barrier: all threads wait until the last thread arrives) 37.72 545.56 T
(        before waking up.) 37.72 537.22 T
(*/) 37.72 528.88 T
(int thread_barrier_init\050thread_barrier_t *m, int i\051) 37.72 503.87 T
({) 37.72 495.53 T
(  pthread_mutex_init\050&\050m->lock\051, NULL\051;) 37.72 487.19 T
(  pthread_cond_init\050&\050m->cv\051, NULL\051;) 37.72 478.85 T
(  m->n_sleepers = 0;) 37.72 470.52 T
(  m->releasing = FALSE;) 37.72 462.18 T
(  m->count = i;) 37.72 453.84 T
(}) 37.72 445.5 T
(int thread_barrier_destroy\050thread_barrier_t *m\051) 37.72 420.49 T
({) 37.72 412.15 T
(  pthread_mutex_destroy\050&\050m->lock\051\051;) 37.72 403.81 T
(  pthread_cond_destroy\050&\050m->cv\051\051;) 37.72 395.47 T
(}) 37.72 387.13 T
(int thread_barrier_wait\050thread_barrier_t *m\051) 37.72 353.78 T
({int release = FALSE;) 37.72 345.44 T
( pthread_mutex_lock\050&\050m->lock\051\051;) 37.72 328.77 T
( while \050m->releasing\051           /* If previous cycle still releasing, wait */) 37.72 320.43 T
(   pthread_cond_wait\050&\050m->cv\051, &\050m->lock\051\051;) 37.72 312.09 T
( m->n_sleepers++;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(174) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( if \050m->n_sleepers == m->count\051) 411.22 695.65 T
(   release = m->releasing = TRUE;) 411.22 687.31 T
( else) 411.22 678.97 T
(   while \050!m->releasing\051) 411.22 670.63 T
(     pthread_cond_wait\050&\050m->cv\051, &\050m->lock\051\051;) 411.22 662.29 T
( m->n_sleepers--;) 411.22 645.62 T
( if \050m->n_sleepers == 0\051) 411.22 637.28 T
(   {m->releasing = FALSE;) 411.22 628.94 T
(    release = TRUE;             /* Wake up waiters \050if any\051 for next cycle */) 411.22 620.6 T
(  }) 411.22 612.26 T
( pthread_mutex_unlock\050&\050m->lock\051\051;) 411.22 603.92 T
( if \050release\051) 411.22 587.25 T
(   pthread_cond_broadcast\050&m->cv\051;) 411.22 578.91 T
( return\0500\051;) 411.22 570.57 T
(}) 411.22 562.23 T
(/*) 411.22 537.22 T
(   ================================================================) 411.22 528.88 T
(                        Barrier) 411.22 520.54 T
(   ================================================================) 411.22 512.21 T
(        Full barrier: all threads wait until the last thread arrives) 411.22 495.53 T
(        before waking up.) 411.22 487.19 T
(*/) 411.22 478.85 T
(int thread_single_barrier_init\050thread_single_barrier_t *b, int i\051) 411.22 453.84 T
({) 411.22 445.5 T
(  pthread_mutex_init\050&\050b->lock\051, NULL\051;) 411.22 437.16 T
(  pthread_cond_init\050&\050b->cv\051, NULL\051;) 411.22 428.82 T
(  b->n_posters = 0;) 411.22 420.49 T
(  b->n_waiters = 0;) 411.22 412.15 T
(  b->releasing = FALSE;) 411.22 403.81 T
(  b->count = i;) 411.22 395.47 T
(}) 411.22 387.13 T
(int thread_single_barrier_destroy\050thread_single_barrier_t *b\051) 411.22 362.12 T
({) 411.22 353.78 T
(  pthread_mutex_destroy\050&\050b->lock\051\051;) 411.22 345.44 T
(  pthread_cond_destroy\050&\050b->cv\051\051;) 411.22 337.11 T
(}) 411.22 328.77 T
(int thread_single_barrier_wait\050thread_single_barrier_t *b\051 {) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 87
%%Page: "mini" 88
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(175) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  int release = FALSE;) 37.72 695.65 T
(  b->n_waiters++;) 37.72 678.97 T
(  while \050!b->releasing\051) 37.72 670.63 T
(    pthread_cond_wait\050&\050b->cv\051, &\050b->lock\051\051;) 37.72 662.29 T
(  b->n_waiters--;) 37.72 645.62 T
(  if \050b->n_waiters == 0\051 {) 37.72 637.28 T
(    b->releasing = FALSE;) 37.72 628.94 T
(    release = TRUE;             /* Wake up waiters \050if any\051 for next cycle */) 37.72 620.6 T
(    b->n_posters=0;) 37.72 612.26 T
(    }) 37.72 603.92 T
(  pthread_mutex_unlock\050&\050b->lock\051\051;) 37.72 595.59 T
(  if \050release\051) 37.72 578.91 T
(    pthread_cond_broadcast\050&b->cv\051;) 37.72 570.57 T
(  return\0500\051;) 37.72 562.23 T
(}) 37.72 553.9 T
(int thread_single_barrier_post\050thread_single_barrier_t *b\051) 37.72 512.21 T
({int release = FALSE;) 37.72 503.87 T
( pthread_mutex_lock\050&\050b->lock\051\051;) 37.72 487.19 T
( while \050b->releasing\051           /* If previous cycle still releasing, wait */) 37.72 478.85 T
(   pthread_cond_wait\050&\050b->cv\051, &\050b->lock\051\051;) 37.72 470.52 T
( b->n_posters++;) 37.72 453.84 T
( if \050b->n_posters == b->count\051) 37.72 445.5 T
(   {b->releasing = TRUE;) 37.72 437.16 T
(    release = TRUE;             /* Wake up waiters \050if any\051 for next cycle */) 37.72 428.82 T
(  }) 37.72 420.49 T
( pthread_mutex_unlock\050&\050b->lock\051\051;) 37.72 412.15 T
( if \050release\051) 37.72 395.47 T
(   pthread_cond_broadcast\050&b->cv\051;) 37.72 387.13 T
( return\0500\051;) 37.72 378.8 T
(}) 37.72 370.46 T
(/*) 37.72 320.43 T
(   ================================================================) 37.72 312.09 T
(                        Error Detection) 37.72 303.75 T
(   ================================================================) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(176) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(        For those functions which can return a \322reasonable\323 runtime) 411.22 687.31 T
(        error, go ahead and detect them.  And then abort.) 411.22 678.97 T
(*/) 411.22 670.63 T
(int PTHREAD_CREATE\050pthread_t *new_thread_ID,) 411.22 645.62 T
(                   const pthread_attr_t *attr,) 411.22 637.28 T
(                   void * \050*start_func\051\050void *\051, void *arg\051) 411.22 628.94 T
({int err;) 411.22 620.6 T
( pthread_t tid;) 411.22 612.26 T
( if \050!new_thread_ID\051) 411.22 595.59 T
(   {printf\050\322TID cannot be NULL.\134n\323\051;) 411.22 587.25 T
(    abort\050\051;) 411.22 578.91 T
(  }) 411.22 570.57 T
( if \050err = pthread_create\050new_thread_ID, attr, start_func, arg\051\051) 411.22 562.23 T
(   {printf\050\322%s\134n\323, strerror\050err\051\051;) 411.22 553.9 T
(    abort\050\051;) 411.22 545.56 T
(  }}) 411.22 537.22 T
(int PTHREAD_ATTR_INIT\050pthread_attr_t *a\051) 411.22 520.54 T
({int err;) 411.22 512.21 T
( if \050err = pthread_attr_init\050a\051\051) 411.22 503.87 T
(   {printf\050\322%s\134n\323, strerror\050err\051\051;) 411.22 495.53 T
(    abort\050\051;) 411.22 487.19 T
(  }}) 411.22 478.85 T
(int PTHREAD_CONDATTR_INIT\050pthread_condattr_t *a\051) 411.22 462.18 T
({int err;) 411.22 453.84 T
( if \050err = pthread_condattr_init\050a\051\051) 411.22 445.5 T
(   {printf\050\322%s\134n\323, strerror\050err\051\051;) 411.22 437.16 T
(    abort\050\051;) 411.22 428.82 T
(  }}) 411.22 420.49 T
(int PTHREAD_MUTEXATTR_INIT\050pthread_mutexattr_t *a\051) 411.22 403.81 T
({int err;) 411.22 395.47 T
( if \050err = pthread_mutexattr_init\050a\051\051) 411.22 387.13 T
(   {printf\050\322%s\134n\323, strerror\050err\051\051;) 411.22 378.8 T
(    abort\050\051;) 411.22 370.46 T
(  }}) 411.22 362.12 T
(int SEM_INIT\050sem_t *sem, int pshared, unsigned int value\051) 411.22 345.44 T
({int err;) 411.22 337.11 T
( if \050err = sem_init\050sem, pshared, value\051\051) 411.22 328.77 T
(   {perror\050\322\322\051;) 411.22 320.43 T
(    abort\050\051;) 411.22 312.09 T
(  }}) 411.22 303.75 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 88
%%Page: "mini" 89
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(177) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(int SEM_WAIT\050sem_t *arg\051        /* Ignore signal interruptions */) 37.72 687.31 T
({while \050sem_wait\050arg\051 != 0\051 {}}) 37.72 678.97 T
(/*) 37.72 653.95 T
(   ================================================================) 37.72 645.62 T
(                        Random useful functions) 37.72 637.28 T
(   ================================================================) 37.72 628.94 T
(*/) 37.72 612.26 T
(int delay_cycles_per_us = 8;            /* App. number for 110MHz SS4) 37.72 595.59 T
(/* sleep time will be quantized at 10ms, CPU time is VERY approximate. */) 37.72 578.91 T
(void delay\050int sleep_ms, int cpu_us\051) 37.72 562.23 T
({int i, cycles = cpu_us*delay_cycles_per_us;) 37.72 553.9 T
( volatile j=0;) 37.72 545.56 T
( struct timespec tv;) 37.72 537.22 T
( if \050sleep_ms != 0\051) 37.72 520.54 T
(   {tv.tv_sec = sleep_ms/1000;) 37.72 512.21 T
(    tv.tv_nsec = \050sleep_ms%1000\051 * 1000000;) 37.72 503.87 T
(    nanosleep\050&tv, NULL\051;) 37.72 495.53 T
(  }) 37.72 487.19 T
( if \050cpu_us != 0\051) 37.72 470.52 T
(   for \050i=0; i<cycles; i++\051 j++;) 37.72 462.18 T
(}) 37.72 453.84 T
(int calibrate_delay\050\051) 37.72 428.82 T
({) 37.72 420.49 T
(  delay_cycles_per_us = 8;) 37.72 412.15 T
(  iobench_start\050\051;) 37.72 403.81 T
(  delay\0500, 1000000\051;) 37.72 395.47 T
(  iobench_end\050\051;) 37.72 387.13 T
(  DEBUG\050iobench_report\050\051\051;) 37.72 378.8 T
(  DEBUG\050printf\050\322Calibration pass: %d delay cycles -> %f seconds\134n\323,) 37.72 370.46 T
(               delay_cycles_per_us, user_time\051\051;) 37.72 362.12 T
(  delay_cycles_per_us = \050delay_cycles_per_us * 1.0\051 / user_time;) 37.72 353.78 T
(  iobench_start\050\051;) 37.72 337.11 T
(  delay\0500, 1000000\051;) 37.72 328.77 T
(  iobench_end\050\051;) 37.72 320.43 T
(  DEBUG\050iobench_report\050\051\051;) 37.72 312.09 T
(  DEBUG\050printf\050\322Verification pass: %d delay cycles -> %f seconds\134n\323,) 37.72 303.75 T
(               delay_cycles_per_us, user_time\051\051;) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(178) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(}) 411.22 695.65 T
(/* A barrier for one thread to wait for lots of others. */) 411.22 678.97 T
(void thread_single_barrier\050sem_t *barrier, int count\051) 411.22 670.63 T
({) 411.22 662.29 T
(  while \050count > 0\051) 411.22 653.95 T
(    {SEM_WAIT\050barrier\051;) 411.22 645.62 T
(     count--;) 411.22 637.28 T
(    }) 411.22 628.94 T
(}) 411.22 620.6 T
(/*) 411.22 595.59 T
(   ================================================================) 411.22 587.25 T
(                        Timed Mutex Lock) 411.22 578.91 T
(   ================================================================) 411.22 570.57 T
(        Just like a timed CV, only for a mutex!) 411.22 553.9 T
(*/) 411.22 545.56 T
(int thread_timed_mutex_init\050thread_timed_mutex_t *m,) 411.22 520.54 T
(                                    pthread_mutexattr_t *attr\051) 411.22 512.21 T
({) 411.22 503.87 T
(  pthread_mutex_init\050&\050m->lock\051, NULL\051;) 411.22 495.53 T
(  pthread_cond_init\050&\050m->cv\051, NULL\051;) 411.22 487.19 T
(  m->owned = FALSE;) 411.22 478.85 T
(  m->owner = NULL_TID;) 411.22 470.52 T
(  m->abstime = 0;) 411.22 462.18 T
(}) 411.22 453.84 T
(int thread_timed_mutex_destroy\050thread_timed_mutex_t *m\051) 411.22 428.82 T
({) 411.22 420.49 T
(  pthread_mutex_destroy\050&\050m->lock\051\051;) 411.22 412.15 T
(  pthread_cond_destroy\050&\050m->cv\051\051;) 411.22 403.81 T
(}) 411.22 395.47 T
(int thread_timed_mutex_lock\050thread_timed_mutex_t *m,) 411.22 362.12 T
(                                const struct timespec *abstime\051) 411.22 353.78 T
({int err;) 411.22 345.44 T
( pthread_t tid = pthread_self\050\051;) 411.22 337.11 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 411.22 320.43 T
(  while \050m->owned\051) 411.22 312.09 T
(    {err=pthread_cond_timedwait\050&\050m->cv\051, &\050m->lock\051, abstime\051;) 411.22 303.75 T
(     if \050err\051) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 89
%%Page: "mini" 90
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(179) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(       {pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 695.65 T
(        return\050err\051;) 37.72 687.31 T
(      }}) 37.72 678.97 T
( m->owner = tid;) 37.72 670.63 T
( m->owned = TRUE;) 37.72 662.29 T
( pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 653.95 T
( return\0500\051;) 37.72 645.62 T
(}) 37.72 637.28 T
(int thread_timed_mutex_trylock\050thread_timed_mutex_t *m\051) 37.72 612.26 T
({pthread_t tid = pthread_self\050\051;) 37.72 603.92 T
( pthread_mutex_lock\050&\050m->lock\051\051;) 37.72 587.25 T
( if \050!m->owned\051) 37.72 578.91 T
(    {m->owner = tid;) 37.72 570.57 T
(     m->owned = TRUE;) 37.72 562.23 T
(     pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 553.9 T
(     return\0500\051;) 37.72 545.56 T
(   }) 37.72 537.22 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 528.88 T
(  return\050EBUSY\051;) 37.72 520.54 T
(}) 37.72 512.21 T
(int thread_timed_mutex_unlock\050thread_timed_mutex_t *m\051) 37.72 487.19 T
({) 37.72 478.85 T
(  pthread_mutex_lock\050&\050m->lock\051\051;) 37.72 470.52 T
(  m->owned = FALSE;) 37.72 462.18 T
(  m->owner = NULL_TID;) 37.72 453.84 T
(  pthread_mutex_unlock\050&\050m->lock\051\051;) 37.72 445.5 T
(  pthread_cond_signal\050&\050m->cv\051\051;) 37.72 437.16 T
(}) 37.72 428.82 T
(/*) 37.72 387.13 T
(   ================================================================) 37.72 378.8 T
(                        Wait before fork\050\051) 37.72 370.46 T
(   ================================================================) 37.72 362.12 T
(  The idea is that you count the number of threads you have, then have) 37.72 345.44 T
(the forker thread wait for them all to reach a fork-safe location \050where) 37.72 337.11 T
(they will pause\051.  The forker then forks and wakes up all of the other) 37.72 328.77 T
(threads.) 37.72 320.43 T
(  The other threads will call thread_wait_for_forker\050\051 whenever they) 37.72 303.75 T
(are at a fork-safe location.  If no thread is waiting to fork, they) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(180) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(simply continue.  If there is one, they will then sleep until awaken.) 411.22 695.65 T
(  The forker thread \050there can only be one!\051 calls thread_wait_for_others\050\051) 411.22 678.97 T
(before forking, and thread_awake_others\050\051 afterwards.  The child does) 411.22 670.63 T
(not need to call thread_awake_others\050\051 unless it plans to call fork\050\051) 411.22 662.29 T
(also.  \050A bug w/spurious wakeups if child also forks?\051) 411.22 653.95 T
(*/) 411.22 637.28 T
(struct _fork_waiter) 411.22 620.6 T
({) 411.22 612.26 T
(  pthread_mutex_t       lock;) 411.22 603.92 T
(  pthread_cond_t        forker_cv;) 411.22 595.59 T
(  pthread_cond_t        others_cv;) 411.22 587.25 T
(  int                   runners;) 411.22 578.91 T
(  int                   owned;) 411.22 570.57 T
(  pthread_t             owner;) 411.22 562.23 T
(};) 411.22 553.9 T
(struct _fork_waiter fork_waiter =) 411.22 537.22 T
({PTHREAD_MUTEX_INITIALIZER, PTHREAD_COND_INITIALIZER, PTHREAD_COND_INITIALIZER,) 411.22 528.88 T
(   0, FALSE, NULL_TID};) 411.22 520.54 T
(void thread_wait_for_others\050int i\051) 411.22 495.53 T
({) 411.22 487.19 T
(  pthread_mutex_lock\050&fork_waiter.lock\051;) 411.22 478.85 T
(  if \050fork_waiter.owned\051) 411.22 470.52 T
(    {printf\050\322Fatal Error: Multiple calls to thread_wait_for_others!\323\051;) 411.22 462.18 T
(     abort\050\051;) 411.22 453.84 T
(   }) 411.22 445.5 T
(  fork_waiter.owned = TRUE;) 411.22 437.16 T
(  fork_waiter.owner = pthread_self\050\051;) 411.22 428.82 T
(  fork_waiter.runners=i;) 411.22 420.49 T
(  while \050fork_waiter.runners>0\051) 411.22 412.15 T
(    pthread_cond_wait\050&fork_waiter.forker_cv, &fork_waiter.lock\051;) 411.22 403.81 T
(  pthread_mutex_unlock\050&fork_waiter.lock\051;) 411.22 395.47 T
(}) 411.22 387.13 T
(void thread_awake_others\050\051) 411.22 362.12 T
({) 411.22 353.78 T
(  pthread_mutex_lock\050&fork_waiter.lock\051;) 411.22 345.44 T
(  fork_waiter.owned = FALSE;) 411.22 337.11 T
(  fork_waiter.owner = NULL_TID;) 411.22 328.77 T
(  pthread_mutex_unlock\050&fork_waiter.lock\051;) 411.22 320.43 T
(  pthread_cond_broadcast\050&fork_waiter.others_cv\051;) 411.22 312.09 T
(}) 411.22 303.75 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 90
%%Page: "mini" 91
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(181) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(void thread_wait_for_forker\050\051) 37.72 695.65 T
({) 37.72 687.31 T
(  pthread_mutex_lock\050&fork_waiter.lock\051;) 37.72 678.97 T
(  if \050fork_waiter.owned\051) 37.72 670.63 T
(    {fork_waiter.runners--;) 37.72 662.29 T
(     while \050fork_waiter.owned\051) 37.72 653.95 T
(       {if \050fork_waiter.runners == 0\051) 37.72 645.62 T
(pthread_cond_signal\050&fork_waiter.forker_cv\051;) 37.72 637.28 T
(        pthread_cond_wait\050&fork_waiter.others_cv, &fork_waiter.lock\051;) 37.72 628.94 T
(   }}) 37.72 620.6 T
(  pthread_mutex_unlock\050&fork_waiter.lock\051;) 37.72 612.26 T
(}) 37.72 603.92 T
(/*) 37.72 570.57 T
(   ================================================================) 37.72 562.23 T
(                                Killer) 37.72 553.9 T
(   ================================================================) 37.72 545.56 T
(   */) 37.72 537.22 T
(void *killer\050void *arg\051 {) 37.72 520.54 T
(  int time = \050int\051 arg;) 37.72 512.21 T
(  sleep\050time\051;) 37.72 503.87 T
(  printf\050\322Killer thread timing out. \050Program hung?\051  Die!  Die!  Die!\134n\323\051;) 37.72 495.53 T
(  exit\050-1\051;) 37.72 487.19 T
(}) 37.72 478.85 T
(/*) 37.72 445.5 T
(   ================================================================) 37.72 437.16 T
(                                Spin locks) 37.72 428.82 T
(   ================================================================) 37.72 420.49 T
(  Two versions of spin locks.  The good versions \050only defined for) 37.72 403.81 T
(  Solaris right now\051 will not flood the memory bus.) 37.72 395.47 T
(  The bad version of spin lock will flood the memory bus with ldstub) 37.72 378.8 T
(  ops.  Try setting BAD_SPIN_COUNT = 10^9 and then running this on) 37.72 370.46 T
(  a couple of CPUs, while trying to get work done on the other CPUs.) 37.72 362.12 T
(*/) 37.72 345.44 T
(#ifdef __sun2_5) 37.72 320.43 T
(const int SPIN_COUNT = 1000;            /* About .1us per loop, SS10 */) 37.72 312.09 T
(void spin_lock\050pthread_mutex_t *m\051) 37.72 295.41 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(182) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
({int i;) 411.22 695.65 T
( for \050i = 0; i < SPIN_COUNT; i++\051) 411.22 687.31 T
(   {if \050m->pthread_mutex_lock.pthread_mutex_owner64 == 0\051 /* Check w/o ldstub */) 411.22 678.97 T
(      if \050pthread_mutex_trylock\050m\051 != EBUSY\051) 411.22 670.63 T
(        return;                         /* Got it! */) 411.22 662.29 T
(    /* Didn\325t get it, continue the loop */) 411.22 653.95 T
(    }) 411.22 645.62 T
( pthread_mutex_lock\050m\051;                 /* Give up and block */) 411.22 637.28 T
(}) 411.22 628.94 T
(#else) 411.22 612.26 T
(const int BAD_SPIN_COUNT = 100;         /* About 1us  per loop, SS10 */) 411.22 603.92 T
(void spin_lock\050pthread_mutex_t *m\051) 411.22 587.25 T
({int i;) 411.22 578.91 T
( for \050i=0; i < BAD_SPIN_COUNT; i++\051) 411.22 570.57 T
(   {if \050pthread_mutex_trylock\050m\051 != EBUSY\051      /* Trash the memory bus! */) 411.22 562.23 T
(      return;    }                              /* got the lock! */) 411.22 553.9 T
( pthread_mutex_lock\050m\051;                         /* give up and block. */) 411.22 545.56 T
-0.18 ( return;                                        /* got the lock after blocking! */) 411.22 537.22 P
(}) 411.22 528.88 T
(#endif) 411.22 495.53 T
(/*-----------------------------------------------------------------------------) 411.22 453.84 T
( *) 411.22 445.5 T
( * Library Name: UTIL) 411.22 437.16 T
( * Module Name:  iobench) 411.22 428.82 T
( *) 411.22 420.49 T
( * Designer:    R. C. Sullivan) 411.22 412.15 T
( * Programmer:  R. C. Sullivan) 411.22 403.81 T
( * Date:        Sep 22, 1995) 411.22 395.47 T
( *) 411.22 387.13 T
( * History Of Changes:) 411.22 378.8 T
( *      Name         Date            Description) 411.22 370.46 T
( *      ----         ----            -----------) 411.22 362.12 T
( *      RCS     Jan 17, 1996     Inital release) 411.22 353.78 T
( *) 411.22 345.44 T
( * Purpose:) 411.22 337.11 T
( *   To report resource usage statistics that will be correct for) 411.22 328.77 T
( * programs using threads on a Solaris system.) 411.22 320.43 T
( *) 411.22 312.09 T
( * Notes:) 411.22 303.75 T
( *) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 91
%%Page: "mini" 92
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(183) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( *-----------------------------------------------------------------------------) 37.72 695.65 T
( */) 37.72 687.31 T
(#ifdef __sun) 37.72 670.63 T
(#include <stdio.h>) 37.72 662.29 T
(#include <unistd.h>) 37.72 653.95 T
(#include <fcntl.h>) 37.72 645.62 T
(#include <sys/stat.h>) 37.72 637.28 T
(#include <sys/procfs.h>) 37.72 628.94 T
(struct stat statbuf;) 37.72 612.26 T
(struct prusage prusagebuf_start, prusagebuf_end;) 37.72 603.92 T
(int procfd;) 37.72 595.59 T
(double real_time, total_real_time, user_time, system_time, trap_time, wait_time;) 37.72 587.25 T
(unsigned long minor_pfs, major_pfs, input_blocks, output_blocks, iochars;) 37.72 578.91 T
(void iobench_start\050\051 {) 37.72 562.23 T
(  char pfile[80];) 37.72 553.9 T
(  sprintf\050pfile, \322/proc/%ld\323, getpid\050\051\051;) 37.72 537.22 T
(  procfd = open\050pfile, O_RDONLY\051;) 37.72 528.88 T
(  ioctl\050procfd, PIOCUSAGE, &prusagebuf_start\051;) 37.72 512.21 T
(}) 37.72 503.87 T
(void iobench_end\050\051 {) 37.72 487.19 T
(  ioctl\050procfd, PIOCUSAGE, &prusagebuf_end\051;) 37.72 478.85 T
(  close\050procfd\051;) 37.72 470.52 T
(  real_time = \050double\051 prusagebuf_start.pr_tstamp.tv_sec +) 37.72 453.84 T
(    \050double\051 prusagebuf_start.pr_tstamp.tv_nsec / NANOSEC;) 37.72 445.5 T
(  real_time = \050double\051 prusagebuf_end.pr_tstamp.tv_sec +) 37.72 437.16 T
(    \050double\051 prusagebuf_end.pr_tstamp.tv_nsec / NANOSEC - real_time;) 37.72 428.82 T
(  total_real_time = \050double\051 prusagebuf_start.pr_rtime.tv_sec +) 37.72 412.15 T
(    \050double\051 prusagebuf_start.pr_rtime.tv_nsec / NANOSEC;) 37.72 403.81 T
(  total_real_time = \050double\051 prusagebuf_end.pr_rtime.tv_sec +) 37.72 395.47 T
(    \050double\051 prusagebuf_end.pr_rtime.tv_nsec / NANOSEC - real_time;) 37.72 387.13 T
(  user_time = \050double\051 prusagebuf_start.pr_utime.tv_sec +) 37.72 370.46 T
(    \050double\051 prusagebuf_start.pr_utime.tv_nsec / NANOSEC;) 37.72 362.12 T
(  user_time = \050double\051 prusagebuf_end.pr_utime.tv_sec +) 37.72 353.78 T
(    \050double\051 prusagebuf_end.pr_utime.tv_nsec / NANOSEC - user_time;) 37.72 345.44 T
(  system_time = \050double\051 prusagebuf_start.pr_stime.tv_sec +) 37.72 328.77 T
(    \050double\051 prusagebuf_start.pr_stime.tv_nsec / NANOSEC;) 37.72 320.43 T
(  system_time = \050double\051 prusagebuf_end.pr_stime.tv_sec +) 37.72 312.09 T
(    \050double\051 prusagebuf_end.pr_stime.tv_nsec / NANOSEC - system_time;) 37.72 303.75 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(184) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  trap_time = \050double\051 prusagebuf_start.pr_ttime.tv_sec +) 411.22 695.65 T
(    \050double\051 prusagebuf_start.pr_ttime.tv_nsec / NANOSEC;) 411.22 687.31 T
(  trap_time = \050double\051 prusagebuf_end.pr_ttime.tv_sec +) 411.22 678.97 T
(    \050double\051 prusagebuf_end.pr_ttime.tv_nsec / NANOSEC - trap_time;) 411.22 670.63 T
(  wait_time = \050double\051 prusagebuf_start.pr_wtime.tv_sec +) 411.22 653.95 T
(    \050double\051 prusagebuf_start.pr_wtime.tv_nsec / NANOSEC;) 411.22 645.62 T
(  wait_time = \050double\051 prusagebuf_end.pr_wtime.tv_sec +) 411.22 637.28 T
(    \050double\051 prusagebuf_end.pr_wtime.tv_nsec / NANOSEC - wait_time;) 411.22 628.94 T
(  minor_pfs = prusagebuf_end.pr_minf - prusagebuf_start.pr_minf;) 411.22 612.26 T
(  major_pfs = prusagebuf_end.pr_majf - prusagebuf_start.pr_majf;) 411.22 603.92 T
(  input_blocks = prusagebuf_end.pr_inblk - prusagebuf_start.pr_inblk;) 411.22 595.59 T
(  output_blocks = prusagebuf_end.pr_oublk - prusagebuf_start.pr_oublk;) 411.22 587.25 T
(  /*  iochars = prusagebuf_end.pr_ioch - prusagebuf_start.pr_ioch;*/) 411.22 578.91 T
(}) 411.22 570.57 T
(void iobench_report\050\051 {) 411.22 553.9 T
(  fprintf\050stderr, \322\134nProcess info:\134n\323\051;) 411.22 545.56 T
(  fprintf\050stderr, \322  elapsed time  %g\134n\323, real_time\051;) 411.22 537.22 T
(  /*  fprintf\050stderr, \322  total time    %g\134n\323, total_real_time\051;*/) 411.22 528.88 T
(  fprintf\050stderr, \322  CPU time      %g\134n\323, user_time + system_time\051;) 411.22 520.54 T
(  /*  fprintf\050stderr, \322  user time     %g\134n\323, user_time\051;) 411.22 512.21 T
(  fprintf\050stderr, \322  system time   %g\134n\323, system_time\051;) 411.22 503.87 T
(  fprintf\050stderr, \322  trap time     %g\134n\323, trap_time\051;) 411.22 495.53 T
(  fprintf\050stderr, \322  wait time     %g\134n\323,  wait_time\051;) 411.22 487.19 T
(  fprintf\050stderr, \322  pfs    major/minor  %6lu/%6lu\134n\323, major_pfs, minor_pfs\051;) 411.22 478.85 T
(  fprintf\050stderr, \322  blocks input/output %6lu/%6lu\134n\323,) 411.22 470.52 T
(          input_blocks, output_blocks\051; */) 411.22 462.18 T
(  /*  fprintf\050stderr, \322  char inp/out  %lu\134n\323, iochars\051;*/) 411.22 453.84 T
(  fprintf\050stderr, \322\134n\323\051;) 411.22 445.5 T
(  /*  fprintf\050stderr, \322%2.5g Mbytes/sec \050real time\051\134n\323, iochars /) 411.22 428.82 T
(      real_time / 1e6\051;) 411.22 420.49 T
(      fprintf\050stderr, \322%2.5g Mbytes/sec \050CPU time\051 \134n\323, iochars /) 411.22 412.15 T
(      \050user_time + system_time\051 / 1e6\051;*/) 411.22 403.81 T
(  fprintf\050stderr, \322%2.1f%% CPU usage\134n\134n\323, 100 * \050user_time + system_time\051 /) 411.22 387.13 T
(          real_time + .05\051;) 411.22 378.8 T
(}) 411.22 370.46 T
(#else) 411.22 353.78 T
(void iobench_start\050\051 {}) 411.22 345.44 T
(void iobench_end\050\051 {}) 411.22 337.11 T
(void iobench_report\050\051 {}) 411.22 328.77 T
(#endif) 411.22 320.43 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 92
%%Page: "mini" 93
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(185) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Misusing the Cac) 105.11 686.11 T
(he:) 281.23 686.11 T
(cac) 131.3 657.53 T
(he_thrash.c) 166.85 657.53 T
4 7.15 Q
(/*                cache_thrash.c                */) 37.72 624.17 T
(/*) 37.72 607.5 T
(cc -o cache_thrash cache_thrash.c -L. -R. -D__sun -D__sun2_6 -fast -lpthread -) 37.72 599.16 T
(lthread -lposix4 -lthread_extensions) 37.72 590.82 T
(  Standard deviation < 1% of mean.) 37.72 574.15 T
(*/) 37.72 557.47 T
(#define _POSIX_C_SOURCE 199506L) 37.72 532.45 T
(#include <pthread.h>) 37.72 515.78 T
(#include <semaphore.h>) 37.72 507.44 T
(#include <errno.h>) 37.72 499.1 T
(#include <time.h>) 37.72 490.77 T
(#include \322thread_extensions.h\323) 37.72 482.43 T
(#define SIZE            1000000) 37.72 457.41 T
(int                     INTERATIONS = 30;) 37.72 432.4 T
(int                     BLOCK_SIZE = 1;) 37.72 424.06 T
(int                     touches = 0;) 37.72 415.72 T
(int                     CACHE_RESIDENT = 0;) 37.72 407.38 T
(int                     a[SIZE+100];) 37.72 399.05 T
(int add_rows\050\051) 37.72 374.03 T
({int            sum = 0, i, j;) 37.72 365.69 T
( for \050i = 0; i <  BLOCK_SIZE; i++\051) 37.72 349.02 T
(   {) 37.72 340.68 T
(     DEBUG\050printf\050\322%d %d\134n\323, j, i\051\051;) 37.72 332.34 T
(     for \050j = i; j < SIZE; j+= BLOCK_SIZE*2\051) 37.72 324 T
(       {if \050CACHE_RESIDENT\051) 37.72 315.66 T
(         {sum += a[i];) 37.72 307.33 T
(         sum += a[i+BLOCK_SIZE];) 37.72 298.99 T
(         }) 37.72 290.65 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(186) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(       else) 411.22 695.65 T
(         {sum += a[j];) 411.22 687.31 T
(         sum += a[j+BLOCK_SIZE];) 411.22 678.97 T
(         }) 411.22 670.63 T
(       }) 411.22 662.29 T
(   }) 411.22 653.95 T
( touches += SIZE;) 411.22 645.62 T
( return\050sum\051;) 411.22 637.28 T
(}) 411.22 628.94 T
(main\050int argc, char **argv\051) 411.22 603.92 T
({int i, j, k;) 411.22 595.59 T
( if \050argc >= 2\051 INTERATIONS    = atoi\050argv[1]\051;) 411.22 578.91 T
( if \050argc >= 3\051 CACHE_RESIDENT = atoi\050argv[2]\051;) 411.22 570.57 T
( printf\050\322INTERATIONS: %d CACHE_RESIDENT: %d\134n\323,  INTERATIONS, CACHE_RESIDENT\051;) 411.22 562.23 T
( j = add_rows\050\051;) 411.22 545.56 T
( for \050k = 1; k <= 8; k = k*2\051) 411.22 528.88 T
(   {iobench_start\050\051;) 411.22 520.54 T
(   touches = 0;) 411.22 512.21 T
(   BLOCK_SIZE = k;) 411.22 503.87 T
(   for \050i = 0; i <  INTERATIONS; i++\051) 411.22 495.53 T
(     j = add_rows\050\051;) 411.22 487.19 T
(   iobench_end\050\051;) 411.22 478.85 T
(   printf\050\322BLOCK_SIZE: %d.  Total of %dM touches. Sum: %d\134n\323, BLOCK_SIZE,) 411.22 470.52 T
(touches/1000000, j\051;) 411.22 462.18 T
(   iobench_report\050\051;) 411.22 453.84 T
(   }) 411.22 445.5 T
( printf\050\322Done\134n\323\051;) 411.22 428.82 T
( exit\0500\051;) 411.22 420.49 T
(}) 411.22 412.15 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 93
%%Page: "mini" 94
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(187) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Misusing the Cac) 107.26 686.11 T
(he:) 283.37 686.11 T
(false_sharing.c) 131.19 657.53 T
4 7.15 Q
(/*                false_sharing.c                */) 37.72 607.5 T
(/*) 37.72 590.82 T
(  Demonstrates what NOT to do on an MP.  If SEPARATION = 1, then there will be) 37.72 582.48 T
(  horrible false sharing and the machine will crawl.  If SEPARATION = 16) 37.72 574.15 T
(  then there will be no false sharing and the program will run about 10x) 37.72 565.81 T
(  faster.) 37.72 557.47 T
(*/) 37.72 549.13 T
(#define _POSIX_C_SOURCE 199506L) 37.72 524.12 T
(#include <pthread.h>) 37.72 507.44 T
(#include <semaphore.h>) 37.72 499.1 T
(#include \322thread_extensions.h\323) 37.72 490.77 T
(int             AVOCADOS_NUMBER = 6023500;) 37.72 465.75 T
(int             N_CPUS = 4;) 37.72 457.41 T
-0.17 (int             SEPARATION = 16; /* 8 64-bit words per cache-line on Ultra SPARC) 37.72 449.07 P
(*/) 37.72 440.74 T
(sem_t           exit_barrier;) 37.72 432.4 T
(int             a[128];) 37.72 424.06 T
(pthread_attr_t  attr;) 37.72 415.72 T
(void *worker\050void *arg\051) 37.72 390.71 T
({int            index = \050int\051 arg;) 37.72 382.37 T
( int            i;) 37.72 374.03 T
( for \050i=0; i<AVOCADOS_NUMBER; i++\051) 37.72 357.35 T
(   {a[index]++;}) 37.72 349.02 T
( sem_post\050&exit_barrier\051;) 37.72 332.34 T
(}) 37.72 324 T
(main\050int argc, char **argv\051) 37.72 307.33 T
({int            i, j;) 37.72 298.99 T
( pthread_t      tid;) 37.72 290.65 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(188) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
( if \050argc >= 2\051 N_CPUS = atoi\050argv[1]\051;) 411.22 687.31 T
( printf\050\322N_CPUS = %d \134n \134n\323, N_CPUS\051;) 411.22 670.63 T
( PTHREAD_ATTR_INIT\050&attr\051;) 411.22 653.95 T
( pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 411.22 645.62 T
( pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 411.22 637.28 T
( SEM_INIT\050&exit_barrier, 0, 0\051;) 411.22 628.94 T
( for \050j=1;j<17;j+=j\051) 411.22 612.26 T
(   {) 411.22 603.92 T
(     SEPARATION=j;) 411.22 595.59 T
(     printf\050\322SEPARATION = %d\134n\323, SEPARATION\051;) 411.22 587.25 T
(     iobench_start\050\051;) 411.22 578.91 T
(     for \050i=0;i<N_CPUS;i++\051) 411.22 570.57 T
(       PTHREAD_CREATE\050&tid, &attr, worker, \050void *\051 \050i * SEPARATION\051\051;) 411.22 562.23 T
(     thread_single_barrier\050&exit_barrier, N_CPUS\051;) 411.22 545.56 T
(     iobench_end\050\051;) 411.22 537.22 T
(     iobench_report\050\051;) 411.22 528.88 T
(   }) 411.22 520.54 T
(     printf\050\322Done\134n\323\051;) 411.22 512.21 T
(     exit\0500\051;) 411.22 503.87 T
(}) 411.22 495.53 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 94
%%Page: "mini" 95
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(189) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
2 21.44 Q
0 X
(Timing Disk Access:) 104.39 686.11 T
(time_disk.c) 150.86 657.53 T
4 7.15 Q
(/*                time_disk.c                */) 37.72 615.84 T
(/*) 37.72 599.16 T
(  This program runs a set of read\050\051 calls against one large file.) 37.72 590.82 T
(  It runs with one or more threads so you can see the performance) 37.72 582.48 T
(  effect of MT.  Each read\050\051 gets one byte from a random location.) 37.72 574.15 T
(  You can run it for a number of iterations & get mean & SD.) 37.72 565.81 T
(  Make sure that there are links in /tmp pointing to wherever you) 37.72 549.13 T
(  can find room.) 37.72 540.79 T
(  lrwxrwxrwx   1 bil other ... time_disk0.tmp -> /disk2/6/temp_disk_test) 37.72 524.12 T
(  ln -s /disk2/6/temp_disk_test /tmp/time_disk0.tmp) 37.72 515.78 T
(  The file must be much larger than physical memory.  10x would be great,) 37.72 499.1 T
(  but 2x will do.  Expect \322performance\323 to improve as the mbuffers get) 37.72 490.77 T
(  loaded.  For a file 2x Physical, initial 100/s will improve to 200/s) 37.72 482.43 T
(  \050as 50% of the file will become cached\051.  To populate the cache, you) 37.72 474.09 T
(  can run this program for a while.) 37.72 465.75 T
(  runtime = \050Physical Memory / PAGE_SIZE\051   / READS_PER_SECOND  eg:) 37.72 449.07 T
(  160seconds = \050128MB        / \0508KB/PAGE\051\051  / 100) 37.72 440.74 T
(  CF: Same program in Java: TimeDisk/Test.java) 37.72 424.06 T
(*/) 37.72 407.38 T
(#define _POSIX_C_SOURCE 199506L) 37.72 382.37 T
(#include <pthread.h>) 37.72 365.69 T
(#include <semaphore.h>) 37.72 357.35 T
(#include <errno.h>) 37.72 349.02 T
(#include <time.h>) 37.72 340.68 T
(#include <tnf/probe.h>) 37.72 332.34 T
(#include <math.h>) 37.72 324 T
(#include <unistd.h>) 37.72 315.66 T
(#include \322thread_extensions.h\323) 37.72 307.33 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(190) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(#define MAX_FILE_SIZE   1024*1024*1024) 411.22 695.65 T
(#define PAGE_SIZE       8192) 411.22 687.31 T
(#define MAX_PAGES       \050MAX_FILE_SIZE/PAGE_SIZE\051) 411.22 678.97 T
(#define MAX_THREADS     512) 411.22 670.63 T
(#define MAX_DENSITY     100) 411.22 662.29 T
(/*  Hack for early TNF bug */) 411.22 637.28 T
(int PTHREAD_CREATE\050pthread_t *new_thread_ID,) 411.22 628.94 T
(                   const pthread_attr_t *attr,) 411.22 620.6 T
(                   void * \050*start_func\051\050void *\051, void *arg\051) 411.22 612.26 T
({) 411.22 603.92 T
(     thr_create\0500, NULL, start_func, arg, 0x00000001, new_thread_ID\051;) 411.22 595.59 T
(}) 411.22 587.25 T
(pthread_attr_t          attr;) 411.22 553.9 T
(int                     nProcessed[MAX_THREADS];) 411.22 545.56 T
(pthread_t               threads[MAX_THREADS];) 411.22 537.22 T
(int                     MAX_READS;) 411.22 528.88 T
(int                     density[MAX_DENSITY];) 411.22 520.54 T
(int                     hits[MAX_PAGES];) 411.22 512.21 T
(int                     fd;) 411.22 503.87 T
(char                    *path = \322/tmp/time_disk0.tmp\323;) 411.22 495.53 T
(off_t                   length;) 411.22 487.19 T
(int                     PID;) 411.22 478.85 T
(int                     stop=FALSE;) 411.22 470.52 T
(int                     N_THREADS=1, SPIN_TIME=0, RUNTIME=1, ITERATIONS=1;) 411.22 462.18 T
(extern double real_time, total_real_time, user_time,) 411.22 437.16 T
(  system_time, trap_time, wait_time;) 411.22 428.82 T
(void *test\050void *arg\051 {) 411.22 395.47 T
(  int    me = \050\050int\051 arg\051 % 1000; /* Hack to get two values in one! */) 411.22 387.13 T
(  /* Don\325t reuse seed, even across processes */) 411.22 370.46 T
(  long  seed = \050\050int\051 arg\051 + PID*100000;) 411.22 362.12 T
(  int   i, fileOffset, s;) 411.22 345.44 T
(  char  *thread = thread_name\050pthread_self\050\051\051;) 411.22 337.11 T
(  char  buf[10];) 411.22 328.77 T
(  for \050i=0; i< MAX_READS; i++\051 {) 411.22 312.09 T
(    if \050stop\051 break;) 411.22 303.75 T
(    fileOffset = abs\050\050rand_r\050&seed\051*PAGE_SIZE\051 % length\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 95
%%Page: "mini" 96
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(191) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(    hits[\050int\051 fileOffset/PAGE_SIZE]++;) 37.72 695.65 T
(    TNF_PROBE_1\050process_request_start,  \322start\323, \322\322,) 37.72 687.31 T
(                tnf_int, location, fileOffset\051;) 37.72 678.97 T
(    /* DEBUG\050printf\050\322%s reading at %d\134n\323, thread, fileOffset\051\051; */) 37.72 670.63 T
(    s = pread\050fd, &buf, 1, fileOffset\051;) 37.72 662.29 T
(    TNF_PROBE_0\050process_request_end, \322end\323, \322\322\051;) 37.72 653.95 T
(    if \050s != 1\051 printf\050\322Error! at %d\134n\323, fileOffset\051;) 37.72 645.62 T
(    delay\0500, SPIN_TIME*1000\051;) 37.72 637.28 T
(    nProcessed[me]++;) 37.72 628.94 T
(  }) 37.72 620.6 T
(  stop=TRUE;    /* If one thread completes MAX_READS, all quit. */) 37.72 612.26 T
(                /* Presumably never get here. */) 37.72 603.92 T
(}) 37.72 595.59 T
(main\050int argc, char **argv\051 {) 37.72 553.9 T
(  int           i, j;) 37.72 545.56 T
(  pthread_t     tid;) 37.72 537.22 T
(  double        rates[MAX_THREADS], S = 0.0, mean, rate_sum = 0.0;) 37.72 528.88 T
(  int           totalProcessed;) 37.72 520.54 T
(  PID = getpid\050\051;) 37.72 495.53 T
(  PTHREAD_ATTR_INIT\050&attr\051;) 37.72 487.19 T
(  pthread_attr_setdetachstate\050&attr, PTHREAD_CREATE_DETACHED\051;) 37.72 478.85 T
(  pthread_attr_setscope\050&attr, PTHREAD_SCOPE_SYSTEM\051;) 37.72 470.52 T
(  if \050argc > 1\051 N_THREADS       = atoi\050argv[1]\051;) 37.72 453.84 T
(  if \050argc > 2\051 SPIN_TIME       = atoi\050argv[2]\051;) 37.72 445.5 T
(  if \050argc > 3\051 RUNTIME         = atoi\050argv[3]\051;) 37.72 437.16 T
(  if \050argc > 4\051 ITERATIONS      = atoi\050argv[4]\051;) 37.72 428.82 T
(  printf\050\322time_disk\050N_THREADS %d SPIN_TIME %dms RUNTIME %ds ITERATIONS %d\051\134n\323,) 37.72 420.49 T
(         N_THREADS, SPIN_TIME, RUNTIME, ITERATIONS\051;) 37.72 412.15 T
(  if \050N_THREADS>MAX_THREADS\051 {) 37.72 403.81 T
(    printf\050\322Too many threads! Max is %d\134n\323, MAX_THREADS\051;) 37.72 395.47 T
(    abort\050\051;) 37.72 387.13 T
(  }) 37.72 378.8 T
(  fd = open\050path, O_RDONLY\051;) 37.72 362.12 T
(  if \050fd == -1\051   {printf\050\322Check %s \050see comments\051!\323, path\051; exit\0501\051;}) 37.72 353.78 T
(  length = lseek\050fd, 0, SEEK_END\051;) 37.72 345.44 T
(  /* Should never be used, except when seed==1 \050to read from mbufs\051*/) 37.72 328.77 T
(  MAX_READS=RUNTIME*10000;) 37.72 320.43 T
(  if \050SPIN_TIME>0\051  calibrate_delay\050\051;) 37.72 303.75 T
0 0 0 1 0 0 0 K
400.5 250.15 765 721.85 C
0 0 0 1 0 0 0 K
411.22 711.13 754.28 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
411.22 260.87 759.64 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 411.22 268.68 T
(wis) 429.11 268.68 T
1 F
(192) 577.39 268.68 T
(21 Mar) 708.9 268.68 T
(ch 2000) 730.86 268.68 T
411.22 282.31 754.28 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  for \050j=0; j<ITERATIONS; j++\051 {) 411.22 695.65 T
(    for \050i=0; i<MAX_PAGES; i++\051 hits[i]=0;) 411.22 678.97 T
(    for \050i=0; i<MAX_DENSITY; i++\051 density[i]=0;) 411.22 670.63 T
(    for \050i=0; i<N_THREADS; i++\051 nProcessed[i]=0;) 411.22 662.29 T
(    totalProcessed=0;) 411.22 653.95 T
(    for \050i=0; i<N_THREADS; i++\051) 411.22 637.28 T
(      PTHREAD_CREATE\050&threads[i], &attr, test, \050void *\051 \050j*1000 + i\051\051;) 411.22 628.94 T
(    iobench_start\050\051;) 411.22 612.26 T
(    sleep\050RUNTIME\051;) 411.22 603.92 T
(    stop = TRUE;) 411.22 595.59 T
(    for \050i=0; i<N_THREADS; i++\051 {pthread_join\050threads[i], NULL\051;}) 411.22 587.25 T
(    iobench_end\050\051;) 411.22 578.91 T
(    for \050i=0; i<N_THREADS; i++\051 {) 411.22 562.23 T
(      DEBUG\050printf\050\322%s processed \134t%d\134n\323,) 411.22 553.9 T
(                   thread_name\050threads[i]\051, nProcessed[i]\051\051;) 411.22 545.56 T
(      totalProcessed += nProcessed[i];) 411.22 537.22 T
(    }) 411.22 528.88 T
(    for \050i=0; i<MAX_PAGES; i++\051 {) 411.22 512.21 T
(      if \050hits[i] < MAX_DENSITY\051) 411.22 503.87 T
(        density[hits[i]]++;) 411.22 495.53 T
(      else) 411.22 487.19 T
(        DEBUG\050printf\050\322Page %d got %d hits\134n\323, i, hits[i]\051\051;) 411.22 478.85 T
(    }) 411.22 470.52 T
(    DEBUG\050printf\050\322nHits \134t nPages \134n\323\051\051;) 411.22 453.84 T
(    for \050i=1; i<MAX_DENSITY; i++\051 {) 411.22 445.5 T
(      if \050density[i]>0\051) 411.22 437.16 T
(        DEBUG\050printf\050\322%d \134t %d\134n\323, i, density[i]\051\051;) 411.22 428.82 T
(    }) 411.22 420.49 T
(    if \050ITERATIONS==1\051 iobench_report\050\051;) 411.22 403.81 T
(    if \050ITERATIONS==1\051 printf\050\322totalProcessed: %d, rate: %f/sec\134n\323,) 411.22 395.47 T
(                              totalProcessed, totalProcessed / real_time\051;) 411.22 387.13 T
(    rates[j] =  totalProcessed / real_time;) 411.22 378.8 T
(    rate_sum += totalProcessed / real_time;) 411.22 370.46 T
(    stop=FALSE;) 411.22 362.12 T
(  }) 411.22 353.78 T
(  if \050ITERATIONS>1\051 {) 411.22 337.11 T
(    mean = rate_sum/ITERATIONS;) 411.22 328.77 T
(    for \050i=0; i<ITERATIONS; i++\051 S+=\050mean-rates[i]\051*\050mean-rates[i]\051;) 411.22 312.09 T
(    S = sqrt\050S/\050ITERATIONS-1\051\051;) 411.22 303.75 T
(    printf\050\322Mean rate: %3.2f/sec, Standard Deviation: %3.2f\134n\323, mean, S\051;) 411.22 295.41 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 96
%%Page: "mini" 97
612 792 1 FMBEGINPAGE
[0 0 0 1 0 0 0]
[ 0 1 1 0 1 0 0]
[ 1 0 1 0 0 1 0]
[ 1 1 0 0 0 0 1]
[ 1 0 0 0 0 1 1]
[ 0 1 0 0 1 0 1]
[ 0 0 1 0 1 1 0]
 7 FrameSetSepColors
FrameNoSep
27 250.15 391.5 721.85 C
0 0 0 1 0 0 0 K
37.72 711.13 380.78 711.13 2 L
4.17 H
2 Z
4 X
0 0 0 1 0 0 0 K
N
37.72 260.87 386.14 273.45 R
7 X
V
0 7.15 Q
0 X
(Bil Le) 37.72 268.68 T
(wis) 55.61 268.68 T
1 F
(193) 203.89 268.68 T
(21 Mar) 335.4 268.68 T
(ch 2000) 357.36 268.68 T
37.72 282.31 380.78 282.31 2 L
4 X
N
0 0 0 1 0 0 0 K
0 0 0 1 0 0 0 K
4 F
0 X
(  }) 37.72 695.65 T
(}) 37.72 687.31 T
0 0 0 1 0 0 0 K
FMENDPAGE
%%EndPage: "mini" 97
%%Trailer
%%BoundingBox: 0 0 612 792
%%PageOrder: Ascend
%%Pages: 97
%%DocumentFonts: Times-Roman
%%+ Palatino-Roman
%%+ Helvetica-Bold
%%+ Helvetica
%%+ Courier-Bold
%%+ Helvetica-BoldOblique
%%+ Courier
%%EOF
