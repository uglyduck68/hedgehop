NAME = condor_startd

all_target( $(NAME) )


CFLAGS = $(STD_C_FLAGS) $(CONFIGURE_PCRE_CFLAGS)

#if HAVE_DLOPEN
PLUGIN_OBJ = StartdPluginManager.o
#endif

%-plugin.so: %.cpp
	$(CPlusPlus) $(C_PLUS_FLAGS) -shared -fPIC $< -o $@

#if IS_DARWIN
LDFLAGS = -framework IOKit -framework Carbon $(CONFIGURE_PCRE_LDFLAGS)
#else
LDFLAGS = $(CONFIGURE_PCRE_LDFLAGS)
#endif

#if HAVE_BACKFILL
#if HAVE_BOINC
BOINC_OBJS = boinc_mgr.o
#endif /* HAVE_BOINC */
BACKFILL_OBJS = $(BOINC_OBJS) backfill_mgr.o
#endif /* HAVE_BACKFILL */

#if HAVE_JOB_HOOKS
JOB_HOOKS_OBJS = StartdHookMgr.o
#endif /* HAVE_JOB_HOOKS */

#if IS_LINUX
GLEXEC_OBJ = glexec_starter.o
#endif

#if HAVE_HIBERNATION
HIBERNATION_OBJS = startd_hibernator.o
#endif

C_PLUS_FLAGS = $(STD_C_PLUS_FLAGS) $(CONFIGURE_PCRE_CFLAGS)

LIB= $(DAEMONCORE_LIB) $(STD_LIBS) $(CONFIGURE_GSOAP_LDFLAGS)

soapobjs(startd)

OBJ = IdDispenser.o \
	LoadQueue.o claim.o Reqexp.o ResAttributes.o ResMgr.o ResState.o \
	Resource.o Starter.o command.o startd_main.o util.o \
	startd_cronmgr.o startd_cronjob.o starter_mgr.o \
	setsyscalls.o  AvailStats.o cod_mgr.o \
	vm_common.o VMManager.o VMRegister.o VMMachine.o vmuniverse_mgr.o \
	$(PLUGIN_OBJ) \
	$(HIBERNATION_OBJS) \
	$(BACKFILL_OBJS) $(GLEXEC_OBJ) $(JOB_HOOKS_OBJS) $(SOAP_OBJS)


public_c_plus_target($(NAME),sbin,$(OBJ),$(LIB))

#if IS_LINUX
#if HAVE_EXT_GLOBUS
public_copy_target(glexec_starter_setup.sh, \
                   libexec, \
                   glexec_starter_setup.sh, \
                   EXECUTABLE_MODE)
public_c_plus_nowrap_target(condor_glexec_wrapper, \
                            libexec, \
                            glexec_wrapper.o, \
                            $(STD_LIBS))
#endif
#endif

c_plus_target(AvailStats.t,AvailStats.o AvailStats.t.o ,$(LIB))

html:

IMPORT_LINKS = ../../config/import_links
import_objs(../condor_util_lib, setsyscalls.o )

gen_soapfiles(startd,condorStartd)

testbin:: all
