# we can change this later...
NAME = condor_starter
RSH_NAME = rsh
WRAPPER_CLASS = CondorJavaWrapper.class
INFO_CLASS = CondorJavaInfo.class
BENCHMARK_CLASS = scimark2lib.jar

all_target($(NAME) $(RSH_NAME) condor_gridshell)

CFLAGS = $(STD_C_FLAGS) -I../condor_schedd.V6 $(CONFIGURE_PCRE_CFLAGS)
C_PLUS_FLAGS = $(STD_C_PLUS_FLAGS) -I../condor_schedd.V6 $(CONFIGURE_PCRE_CFLAGS)

LIB = $(DAEMONCORE_LIB) $(STD_LIBS) $(CONFIGURE_GSOAP_LDFLAGS) $(CONFIGURE_PCRE_LDFLAGS)
RSH_LIB = $(STD_LIBS) $(CLASSAD_LIB) $(CONFIGURE_PCRE_LDFLAGS)

#if HAVE_JOB_HOOKS
JOB_HOOKS_OBJS = StarterHookMgr.o
#endif /* HAVE_JOB_HOOKS */

#if IS_LINUX
GLEXEC_OBJS = glexec_privsep_helper.o
#endif

soapobjs(starter)

# this can (and will have to) be made better, but
# it will suffice for now:
OBJ = starter_v61_main.o baseStarter.o NTsenders.o user_proc.o \
	os_proc.o vanilla_proc.o sshd_proc.o mpi_master_proc.o mpi_comrade_proc.o \
	script_proc.o parallel_proc.o \
	io_proxy.o io_proxy_handler.o \
	java_proc.o java_detect.o tool_daemon_proc.o local_user_log.o \
	job_info_communicator.o jic_shadow.o jic_local.o \
	jic_local_config.o jic_local_file.o jic_local_schedd.o \
	starter_user_policy.o \
	condor_privsep_helper.UNIX.o \
	vm_proc.o vm_gahp_request.o vm_gahp_server.o \
	stream_handler.o $(SOAP_OBJS) $(JOB_HOOKS_OBJS) $(GLEXEC_OBJS)

RSH_OBJ = condor_rsh.o

public_c_plus_target($(NAME),sbin,$(OBJ),$(LIB))
public_c_plus_target($(RSH_NAME),libexec,$(RSH_OBJ),$(RSH_LIB))
html_target( starter.h user_proc.h os_proc.h vanilla_proc.h vm_proc.h )

public_copy_target($(WRAPPER_CLASS),lib,$(WRAPPER_CLASS),EXECUTABLE_MODE)
public_copy_target($(INFO_CLASS),lib,$(INFO_CLASS),EXECUTABLE_MODE)
public_copy_target($(BENCHMARK_CLASS),lib,$(BENCHMARK_CLASS),EXECUTABLE_MODE)

#if IS_LINUX
public_copy_target(condor_glexec_setup,libexec,condor_glexec_setup,EXECUTABLE_MODE)
public_copy_target(condor_glexec_run,libexec,condor_glexec_run,EXECUTABLE_MODE)
public_copy_target(condor_glexec_cleanup,libexec,condor_glexec_cleanup,EXECUTABLE_MODE)
public_copy_target(condor_glexec_kill,libexec,condor_glexec_kill,EXECUTABLE_MODE)
public_copy_target(condor_glexec_update_proxy,libexec,condor_glexec_update_proxy,EXECUTABLE_MODE)
public_c_plus_nowrap_target(condor_glexec_job_wrapper,libexec,glexec_job_wrapper.o,$(STD_LIBS))
#endif

#if HAVE_SSH_TO_JOB
public_copy_target(condor_ssh_to_job_sshd_setup,libexec,condor_ssh_to_job_sshd_setup,EXECUTABLE_MODE)
public_copy_target(condor_ssh_to_job_shell_setup,libexec,condor_ssh_to_job_shell_setup,EXECUTABLE_MODE)
public_copy_target(condor_ssh_to_job_sshd_config_template,lib,condor_ssh_to_job_sshd_config_template,OBJECT_MODE)
#endif


testbin:: all

clean::
	rm -f condor_gridshell

condor_gridshell: condor_starter
	rm -f condor_gridshell
	ln condor_starter condor_gridshell

public_link_target(sbin,condor_starter,condor_gridshell)

gen_soapfiles(starter,condorStarter)
