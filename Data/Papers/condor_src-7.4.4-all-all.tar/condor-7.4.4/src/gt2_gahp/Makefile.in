##**************************************************************
##
## Copyright (C) 1990-2007, Condor Team, Computer Sciences Department,
## University of Wisconsin-Madison, WI.
## 
## Licensed under the Apache License, Version 2.0 (the "License"); you
## may not use this file except in compliance with the License.  You may
## obtain a copy of the License at
## 
##    http://www.apache.org/licenses/LICENSE-2.0
## 
## Unless required by applicable law or agreed to in writing, software
## distributed under the License is distributed on an "AS IS" BASIS,
## WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
## See the License for the specific language governing permissions and
## limitations under the License.
##
##**************************************************************

CC = @CC@

GLOBUS_PATH = @globus@
FLAVOR = @flavor@
BUILD_STATIC = @build_static@

GLOBUS_INCLUDE_PATH = $(GLOBUS_PATH)/include/$(FLAVOR)
GLOBUS_LIB_PATH = $(GLOBUS_PATH)/lib
GLOBUS_LIBS = $(GLOBUS_LIB_PATH)/libglobus_gass_server_ez_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_gass_transfer_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_gram_client_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_rsl_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_gram_protocol_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_io_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_xio_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_gss_assist_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libgssapi_error_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_gssapi_gsi_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_gsi_proxy_core_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_gsi_credential_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_gsi_callback_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_oldgaa_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_gsi_sysconfig_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_proxy_ssl_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_gsi_cert_utils_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_openssl_error_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_openssl_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libssl_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libcrypto_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_callout_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libglobus_common_$(FLAVOR).a $(GLOBUS_LIB_PATH)/libltdl_$(FLAVOR).a

LIBS = @LIBS@
CFLAGS = -g -I$(GLOBUS_INCLUDE_PATH) @DEFS@

PRE_GLOBUS_LIBS = @PRE_GLOBUS_LIBS@
POST_GLOBUS_LIBS = @POST_GLOBUS_LIBS@

ifeq ($(BUILD_STATIC), YES)
STATIC_GAHP = gahp_server.static
endif

GAHPS = gahp_server gahp_server.dynamic $(STATIC_GAHP)

all: $(GAHPS)

gahp_server: gahp_server.dynamic
	cp gahp_server.dynamic gahp_server

gahp_server.dynamic: gahp_server.o my_ez.o internal.h
	$(CC) -o gahp_server.dynamic gahp_server.o my_ez.o -L$(GLOBUS_LIB_PATH) \
	$(PRE_GLOBUS_LIBS) $(GLOBUS_LIBS) $(POST_GLOBUS_LIBS) $(LIBS)

gahp_server.static: gahp_server.o my_ez.o internal.h
	$(CC) -static -o gahp_server.static gahp_server.o my_ez.o \
	-L$(GLOBUS_LIB_PATH) $(GLOBUS_LIBS) $(LIBS)

.c.o:
	$(CC) $(CFLAGS) -c $<

install: $(GAHPS)
	mkdir -p @prefix@/bin
	cp $(GAHPS) @prefix@/bin

clean:
	rm *.o $(GAHPS) config.log config.status
