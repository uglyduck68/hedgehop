##**************************************************************
##
## Copyright (C) 1990-2007, Condor Team, Computer Sciences Department,
## University of Wisconsin-Madison, WI.
## 
## Licensed under the Apache License, Version 2.0 (the "License"); you
## may not use this file except in compliance with the License.  You may
## obtain a copy of the License at
## 
##    http://www.apache.org/licenses/LICENSE-2.0
## 
## Unless required by applicable law or agreed to in writing, software
## distributed under the License is distributed on an "AS IS" BASIS,
## WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
## See the License for the specific language governing permissions and
## limitations under the License.
##
##**************************************************************

CC = @CC@

GlobusFlavor = gcc32dbgpthr

CREAM_PATH = @cream@
BUILD_STATIC = @build_static@

CREAM_INCLUDE_PATH = $(CREAM_PATH)/include
CREAM_LIB_PATH = $(CREAM_PATH)/lib
CREAM_LIBS = $(CREAM_LIB_PATH)/libglite_ce_cream_client_soap.a \
	$(CREAM_LIB_PATH)/libglite_ce_cream_client_util.a \
	$(CREAM_LIB_PATH)/libglite_security_gsoap_plugin_276b_gcc32dbgpthr.a \
	$(CREAM_LIB_PATH)/libglobus_gss_assist_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libglobus_gssapi_gsi_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libglobus_gsi_proxy_core_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libglobus_gsi_credential_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libglobus_gsi_callback_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libglobus_gsi_sysconfig_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libglobus_oldgaa_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libglobus_gsi_cert_utils_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libglobus_openssl_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libglobus_openssl_error_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libglobus_proxy_ssl_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libglobus_callout_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libglobus_common_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libltdl_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libvomsapi_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libglobus_gss_assist_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/libglobus_callout_$(GlobusFlavor).a \
	$(CREAM_LIB_PATH)/liblog4cpp.a \
	$(CREAM_LIB_PATH)/libgridsite.a \
	$(CREAM_LIB_PATH)/libares.a \
	$(CREAM_LIB_PATH)/libexpat.a \
	$(CREAM_LIB_PATH)/libboost_thread.a

LIBS = @LIBS@
CFLAGS = -g -I$(CREAM_INCLUDE_PATH)/$(GlobusFlavor) -I$(CREAM_INCLUDE_PATH) @DEFS@

PRE_CREAM_LIBS = @PRE_CREAM_LIBS@
POST_CREAM_LIBS = @POST_CREAM_LIBS@ \
	-lssl \
	-lcrypto \
	/usr/lib/libxml2.a -lz -lm -lpthread

ifeq ($(BUILD_STATIC), YES)
STATIC_GAHP = cream_gahp.static
endif

GAHPS = cream_gahp cream_gahp.dynamic $(STATIC_GAHP)

all: $(GAHPS)

cream_gahp: cream_gahp.dynamic
	cp cream_gahp.dynamic cream_gahp

cream_gahp.dynamic: cream_gahp_server.o
	g++ -o cream_gahp.dynamic cream_gahp_server.o \
	-L$(CREAM_LIB_PATH) \
	$(PRE_CREAM_LIBS) $(CREAM_LIBS) $(POST_CREAM_LIBS) $(LIBS)

cream_gahp.static: cream_gahp_server.o
	g++ -static -o cream_gahp.static cream_gahp_server.o \
	-L$(CREAM_LIB_PATH) \
	$(PRE_CREAM_LIBS) $(CREAM_LIBS) $(POST_CREAM_LIBS) $(LIBS)

.c.o:
	$(CC) $(CFLAGS) -c $<

.cpp.o:
	g++ $(CFLAGS) -c $<

install: $(GAHPS)
	mkdir -p @prefix@/bin
	cp $(GAHPS) @prefix@/bin

clean:
	rm *.o $(GAHPS) config.log config.status
